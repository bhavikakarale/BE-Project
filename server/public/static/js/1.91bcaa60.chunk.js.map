{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js","common.speech/Exports.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/construct.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","common/Error.ts","../node_modules/spoken/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","sdk/Contracts.ts","common/Guid.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","sdk/Audio/AudioStreamFormat.ts","common.speech/HeaderNames.ts","common.speech/RecognitionEvents.ts","common.speech/IAuthentication.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../node_modules/process/browser.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread2.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","common/PlatformEvent.ts","sdk/Audio/AudioOutputStream.ts","sdk/SpeechSynthesisEventArgs.ts","sdk/SpeechSynthesisResult.ts","sdk/SpeechSynthesisWordBoundaryEventArgs.ts","sdk/SpeechSynthesisBookmarkEventArgs.ts","sdk/SpeechSynthesisVisemeEventArgs.ts","common.speech/SynthesisAdapterBase.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../node_modules/microsoft-cognitiveservices-speech-sdk/node_modules/uuid/lib/rng-browser.js","../node_modules/microsoft-cognitiveservices-speech-sdk/node_modules/uuid/lib/bytesToUuid.js","common.speech/RecognizerConfig.ts","../node_modules/buffer/index.js","sdk/Audio/AudioOutputFormat.ts","common.speech/SpeechConnectionMessage.Internal.ts","common.speech/SynthesisContext.ts","common.speech/AgentConfig.ts","common.speech/ServiceMessages/SynthesisAudioMetadata.ts","common.speech/WebsocketMessageFormatter.ts","common.speech/ServiceMessages/SpeechHypothesis.ts","common.speech/ServiceMessages/SimpleSpeechPhrase.ts","common.speech/ServiceMessages/Enums.ts","common.speech/EnumTranslation.ts","common.speech/ServiceMessages/DetailedSpeechPhrase.ts","common.speech/DynamicGrammarBuilder.ts","common.speech/SpeechContext.ts","common.speech/ServiceMessages/SpeechDetected.ts","common.speech/CognitiveSubscriptionKeyAuthentication.ts","common.speech/CognitiveTokenAuthentication.ts","common/ConnectionOpenResponse.ts","common.browser/WebsocketMessageAdapter.ts","common.browser/WebsocketConnection.ts","common.browser/ProxyInfo.ts","common.speech/QueryParameterNames.ts","common.speech/ConnectionFactoryBase.ts","common.speech/SpeechConnectionFactory.ts","sdk/SpeechRecognitionResult.ts","sdk/RecognitionResult.ts","sdk/SpeechRecognitionEventArgs.ts","sdk/SpeechRecognitionCanceledEventArgs.ts","sdk/CancellationEventArgsBase.ts","common.speech/SpeechServiceRecognizer.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","common.browser/ReplayableAudioNode.ts","common/Timeout.ts","common.speech/ServiceRecognizerBase.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/superPropBase.js","common.speech/SynthesisEvents.ts","common.speech/SynthesisTurn.ts","common.speech/ServiceTelemetryListener.Internal.ts","common.speech/RequestSession.ts","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/nonIterableRest.js","../node_modules/regenerator-runtime/runtime.js","../node_modules/path-browserify/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/nonIterableSpread.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/setPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/isNativeReflectConstruct.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/typeof.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/assertThisInitialized.js","sdk/SpeechSynthesisOutputFormat.ts","common/Promise.ts","../node_modules/microsoft-cognitiveservices-speech-sdk/node_modules/uuid/index.js","../node_modules/microsoft-cognitiveservices-speech-sdk/node_modules/uuid/v1.js","../node_modules/microsoft-cognitiveservices-speech-sdk/node_modules/uuid/v4.js","common/EventSource.ts","sdk/Audio/AudioInputStream.ts","../node_modules/base64-js/index.js","../node_modules/ieee754/index.js","../node_modules/isarray/index.js","common/ConnectionMessage.ts","common.browser/CertChecks.ts","../node_modules/url-parse/index.js","../node_modules/requires-port/index.js","../node_modules/querystringify/index.js","common/OCSPEvents.ts","common/Queue.ts","common/List.ts","sdk/PropertyId.ts","sdk/PropertyCollection.ts","sdk/OutputFormat.ts","sdk/ServicePropertyChannel.ts","common/AudioSourceEvents.ts","common/ChunkedArrayBufferStream.ts","common/Stream.ts","common/Events.ts","sdk/CancellationReason.ts","sdk/CancellationErrorCodes.ts","sdk/ResultReason.ts","common/ConnectionEvents.ts","common/IConnection.ts","common/BackgroundError.ts","common/RawWebsocketMessage.ts","sdk/RecognitionEventArgs.ts","sdk/SessionEventArgs.ts","common/RiffPcmEncoder.ts","common.browser/PCMRecorder.ts","common.browser/MicAudioSource.ts","common.browser/FileAudioSource.ts","sdk/Audio/PullAudioInputStreamCallback.ts","sdk/Audio/SpeakerAudioDestination.ts","sdk/Audio/PushAudioOutputStreamCallback.ts","sdk/Audio/AudioFileWriter.ts","sdk/Audio/AudioConfig.ts","sdk/ProfanityOption.ts","sdk/SpeechConfig.ts","sdk/SpeechRecognizer.ts","sdk/Recognizer.ts"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","module","exports","_inherits","subClass","superClass","create","constructor","value","_createSuper","Derived","hasNativeReflectConstruct","result","Super","NewTarget","this","Reflect","construct","arguments","apply","OutputFormatPropertyName","CancellationErrorCodePropertyName","ServicePropertiesPropertyName","ForceDictationPropertyName","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","F","s","n","done","e","_e","f","err","normalCompletion","didErr","step","next","_e2","Parent","args","Class","isNativeReflectConstruct","a","push","Function","bind","setPrototypeOf","_cache","Map","undefined","fn","toString","call","indexOf","has","get","set","Wrapper","getPrototypeOf","argumentName","name","message","Error","error","objectName","__importDefault","mod","__esModule","SpokenCommand","modules_loader_1","require","spoken_command_1","default","recognizer_1","logger_1","Spoken","val","load","list","context","phrase","lang","_a","info","recognize","graph","id","path","state","findAutomataById","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread2","source","forEach","getOwnPropertyDescriptors","defineProperties","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","Promise","then","_asyncToGenerator","self","Contracts","param","throwIfNullOrUndefined","trim","isDisposed","array","item","throwIfNullOrWhitespace","createNoDashGuid","replace","RegExp","toUpperCase","unsupportedIterableToArray","_getPrototypeOf","__proto__","AudioStreamFormat","AudioStreamFormatImpl","getDefaultInputFormat","samplesPerSecond","bitsPerSample","channels","samplesPerSec","setString","view","offset","str","setUint8","charCodeAt","formatTag","avgBytesPerSec","blockAlign","Math","max","privHeader","ArrayBuffer","DataView","setUint32","setUint16","sampleRate","AudioContext","window","webkitAudioContext","navigator","mediaDevices","getSupportedConstraints","HeaderNames","AuthKey","ConnectionId","ContentType","CustomCommandsAppId","Path","RequestId","RequestStreamId","RequestTimestamp","RecognitionCompletionStatus","SpeechRecognitionEvent","eventName","requestId","sessionId","eventType","Info","privRequestId","privSessionId","RecognitionTriggeredEvent","audioSourceId","audioNodeId","privAudioSourceId","privAudioNodeId","ListeningStartedEvent","ConnectingToServiceEvent","authFetchEventid","privAuthFetchEventid","RecognitionStartedEvent","authFetchEventId","privAuthFetchEventId","AuthInfo","headerName","token","privHeaderName","privToken","arrayLikeToArray","minLen","slice","from","test","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","noop","nextTick","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","_defineProperty","obj","_setPrototypeOf","p","EventType","PlatformEvent","privName","privEventId","privEventTime","Date","toISOString","privEventType","privMetadata","AudioOutputStream","PullAudioOutputStream","PullAudioOutputStreamImpl","privId","privStream","privFormat","format","getDefaultOutputFormat","isClosed","dataBuffer","intView","Int8Array","totalBytes","privLastChunkView","byteLength","isReadEnded","read","chunk","isEnd","tmpBuffer","buffer","readEnded","writeStreamChunk","timeReceived","now","close","PushAudioOutputStream","callback","PushAudioOutputStreamImpl","privCallback","write","privResult","resultId","reason","audioData","errorDetails","properties","privResultId","privReason","privAudioData","privErrorDetails","privProperties","audioOffset","text","wordLength","textOffset","privAudioOffset","privText","privWordLength","privTextOffset","visemeId","animation","privVisemeId","privAnimation","authentication","connectionFactory","synthesizerConfig","speechSynthesizer","audioDestination","speakOverride","receiveMessageOverride","connectImplOverride","configConnectionOverride","sendSynthesisContext","connection","synthesisContextJson","synthesisContext","toJSON","send","Text","privSynthesisTurn","sendSpeechServiceConfig","SpeechServiceConfigJson","sendSsmlMessage","ssml","privAuthentication","privConnectionFactory","privSynthesizerConfig","privIsDisposed","privSpeechSynthesizer","privSessionAudioDestination","SynthesisTurn","privConnectionEvents","EventSource","privServiceEvents","privSynthesisContext","SynthesisContext","privAgentConfig","AgentConfig","connectionEvents","attach","connectionEvent","connectionClosedEvent","statusCode","cancelSynthesisLocal","CancellationReason","BadRequestParameters","ConnectionFailure","privActivityTemplate","messagePayload","privAudioOutputFormat","audioOutputFormat","privConnectionConfigurationPromise","dispose","connectImpl","payload","type","Binary","contentType","fetchConnection","isSSML","successCallback","errorCallBack","buildSsml","privSuccessCallback","privErrorCallback","startNewSynthesis","synthesisStartEventArgs","ResultReason","SynthesizingAudioStarted","synthesisStarted","receiveMessage","cancellationReason","errorCode","PropertyCollection","setProperty","Canceled","SynthesisCanceled","cancelEvent","isSynthesizing","onStopSynthesizing","cancelSynthesis","connectionMessage","privServiceHasSentMessage","fromConnectionMessage","toLowerCase","onServiceTurnStartResponse","onServiceResponseMessage","textBody","streamId","binaryBody","onAudioChunkReceived","synthesizing","audioWithHeader","SynthesisAdapterBase","addHeader","ev","SynthesizingAudio","metadataList","SynthesisAudioMetadata","fromJSON","Metadata","metadata","Type","WordBoundary","Bookmark","Viseme","onWordBoundaryEvent","Data","wordBoundaryEventArgs","Offset","Length","currentTextOffset","wordBoundary","bookmarkEventArgs","bookmarkReached","onVisemeMetadataReceived","IsLastAnimation","visemeEventArgs","VisemeId","getAndClearVisemeAnimation","visemeReceived","onServiceTurnEndResponse","getAllReceivedAudioWithHeader","audioBuffer","SynthesizingAudioCompleted","synthesisCompleted","processTypeSpecificMessages","serviceEvents","onEvent","isUnAuthorized","privConnectionPromise","Disconnected","privConnectionId","onPreConnectionStart","authPromise","fetchOnExpiry","fetch","onAuthCompleted","events","event","open","response","onConnectionEstablishCompleted","parameters","getProperty","PropertyId","SpeechServiceConnection_Endpoint","catch","configureConnection","SpeechServiceConfig","serialize","audio","hasHeader","updateHeader","tmp","Uint8Array","header","telemetryDataEnabled","arrayWithHoles","iterableToArrayLimit","nonIterableRest","arr","arr2","_isNativeReflectConstruct","sham","Proxy","getRandomValues","crypto","msCrypto","rnds8","rnds","r","random","byteToHex","substr","buf","bth","join","RecognitionMode","SpeechResultFormat","connectivity","RecognizerConfig","speechServiceConfig","privRecognitionMode","Interactive","privSpeechServiceConfig","Context","privParameters","privRecognitionActivityTimeout","Recognition","SpeechServiceConnection_AutoDetectSourceLanguages","JSON","stringify","replacement","k","hasOwnProperty","charAt","substring","recognition","os","system","System","build","OS","platform","base64","ieee754","kMaxLength","Buffer","TYPED_ARRAY_SUPPORT","createBuffer","that","RangeError","encodingOrOffset","allocUnsafe","byteOffset","fromArrayLike","fromArrayBuffer","string","encoding","isEncoding","actual","fromString","isBuffer","checked","copy","data","fromObject","assertSize","size","isView","loweredCase","utf8ToBytes","base64ToBytes","slowToString","start","end","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","b","m","bidirectionalIndexOf","isNaN","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","String","readUInt16BE","foundIndex","found","j","hexWrite","Number","remaining","strLen","parsed","parseInt","utf8Write","blitBuffer","asciiWrite","byteArray","asciiToBytes","latin1Write","base64Write","ucs2Write","units","c","hi","lo","utf16leToBytes","fromByteArray","min","res","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","decodeCodePointsArray","SlowBuffer","alloc","INSPECT_MAX_BYTES","global","foo","subarray","typedArraySupport","poolSize","_augment","species","fill","allocUnsafeSlow","_isBuffer","compare","x","y","pos","swap16","swap32","swap64","equals","inspect","match","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","_arr","ret","out","toHex","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt8","floor","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","code","INVALID_BASE64_RE","Infinity","leadSurrogate","toByteArray","stringtrim","base64clean","src","dst","AudioFormatTag","AudioOutputFormatImpl","audioFormatString","requestAudioFormatString","priAudioFormatString","priRequestAudioFormatString","priHasHeader","audioLength","speechSynthesisOutputFormat","fromSpeechSynthesisOutputFormatString","SpeechSynthesisOutputFormatToString","speechSynthesisOutputFormatString","PCM","Siren","MP3","SILKSkype","MuLaw","OGG_OPUS","WEBM_OPUS","Raw8Khz8BitMonoMULaw","Riff16Khz16KbpsMonoSiren","Audio16Khz16KbpsMonoSiren","Audio16Khz32KBitRateMonoMp3","Audio16Khz128KBitRateMonoMp3","Audio16Khz64KBitRateMonoMp3","Audio24Khz48KBitRateMonoMp3","Audio24Khz96KBitRateMonoMp3","Audio24Khz160KBitRateMonoMp3","Raw16Khz16BitMonoTrueSilk","Riff16Khz16BitMonoPcm","Riff8Khz16BitMonoPcm","Riff24Khz16BitMonoPcm","Riff8Khz8BitMonoMULaw","Raw16Khz16BitMonoPcm","Raw24Khz16BitMonoPcm","Raw8Khz16BitMonoPcm","Ogg16Khz16BitMonoOpus","Ogg24Khz16BitMonoOpus","Raw48Khz16BitMonoPcm","Riff48Khz16BitMonoPcm","Audio48Khz96KBitRateMonoMp3","Audio48Khz192KBitRateMonoMp3","Ogg48Khz16BitMonoOpus","Webm16Khz16BitMonoOpus","Webm24Khz16BitMonoOpus","SpeechConnectionMessage","messageType","body","additionalHeaders","headers","privPath","privContentType","privStreamId","privAdditionalHeaders","privContext","sectionName","synthesisSection","buildSynthesisContext","setSection","metadataOptions","bookmarkEnabled","sentenceBoundaryEnabled","visemeEnabled","wordBoundaryEnabled","outputFormat","language","autoDetection","autoDetectSourceLanguage","iPrivConfig","MetadataType","json","privSynthesisAudioMetadata","parse","WebsocketMessageFormatter","toConnectionMessage","deferral","textMessage","textContent","headerBodySplit","split","parseHeaders","binaryMessage","binaryContent","dataView","headerLength","getInt16","headersString","getInt8","promise","makeHeaders","content","headerBuffer","stringToArrayBuffer","headerInt8Array","payloadInt8Array","bodyInt8Array","headerMatches","separatorIndex","headerValue","SpeechHypothesis","privSpeechHypothesis","Duration","PrimaryLanguage","Language","Confidence","SpeakerId","SimpleSpeechPhrase","privSimpleSpeechPhrase","RecognitionStatus","DisplayText","SynthesisStatus","EnumTranslation","recognitionStatus","Success","RecognizedSpeech","NoMatch","InitialSilenceTimeout","BabbleTimeout","EndOfDictation","EndOfStream","NoError","ServiceError","TooManyRequests","DetailedSpeechPhrase","privDetailedSpeechPhrase","NBest","DynamicGrammarBuilder","privPhrases","grammar","privGrammars","retObj","ReferenceGrammars","retPhrases","index","Groups","Items","SpeechContext","dynamicGrammar","privDynamicGrammar","params","phraseDetection","enrichment","pronunciationAssessment","phraseOutput","detailed","options","dgi","generateGrammarObject","SpeechDetected","privSpeechStartDetected","CognitiveSubscriptionKeyAuthentication","subscriptionKey","privAuthInfo","AuthHeader","CognitiveTokenAuthentication","fetchCallback","fetchOnExpiryCallback","privFetchCallback","privFetchOnExpiryCallback","privStatusCode","uri","connectionId","messageFormatter","proxyInfo","enableCompression","privConnectionState","privConnectionEstablishDeferral","privCertificateValidatedDeferral","Connecting","WebSocket","WebsocketMessageAdapter","forceNpmWebSocket","privHeaders","perMessageDeflate","privEnableCompression","checkAgent","agent","GetAgent","privWebsocketClient","privUri","binaryType","privReceivingMessageQueue","Queue","privDisconnectDeferral","privSendMessageQueue","processSendQueue","Events","onopen","Connected","onerror","privLastErrorReceived","onclose","onClose","onmessage","networkReceivedTime","deferred","enqueueFromPromise","rawMessage","RawWebsocketMessage","privMessageFormatter","messageSendStatusDeferral","messageSendDeferral","Message","sendStatusDeferral","dequeue","sendRawMessage","sendItem","isWebsocketOpen","stack","None","closeReason","drainAndDispose","pendingReceiveItem","pendingSendItem","itemToSend","readyState","OPEN","queryParameters","privConnectionMessageAdapter","queryParams","paramName","encodeURIComponent","proxyHostName","proxyPort","proxyUserName","proxyPassword","privProxyHostName","privProxyPort","privProxyUserName","privProxyPassword","ProxyInfo","SpeechServiceConnection_ProxyHostName","SpeechServiceConnection_ProxyPort","SpeechServiceConnection_ProxyUserName","SpeechServiceConnection_ProxyPassword","config","fromParameters","BotId","CustomSpeechDeploymentId","CustomVoiceDeploymentId","EnableAudioLogging","EnableLanguageId","EnableWordLevelTimestamps","EndSilenceTimeoutMs","Format","InitialSilenceTimeoutMs","Profanity","RequestBotStatusMessages","StableIntermediateThreshold","StableTranslation","TestHooks","endpoint","setUrlParameter","SpeechServiceConnection_EnableAudioLogging","SpeechServiceResponse_RequestWordLevelTimestamps","SpeechServiceResponse_ProfanityOption","SpeechServiceConnection_InitialSilenceTimeoutMs","SpeechServiceConnection_EndSilenceTimeoutMs","SpeechServiceResponse_StablePartialResultThreshold","serviceProperties","num","propId","parameterName","search","toLocaleLowerCase","interactiveRelativeUri","conversationRelativeUri","dictationRelativeUri","authInfo","region","SpeechServiceConnection_Region","hostSuffix","startsWith","host","SpeechServiceConnection_Host","endpointId","SpeechServiceConnection_EndpointId","SpeechServiceConnection_RecoLanguage","OutputFormat","Simple","autoDetectSourceLanguages","setCommonUrlParams","recognitionMode","Conversation","Dictation","SpeechServiceConnection_Url","fromRecognizerConfig","duration","languageDetectionConfidence","speakerId","privSpeakerId","privDuration","privOffset","privLanguage","privLanguageDetectionConfidence","privJson","RecognitionEventArgs","privErrorCode","audioSource","recognizerConfig","speechRecognizer","privSpeechRecognizer","sourceLanguages","privSpeechContext","languages","onSuccess","action","onUnknown","interimResults","resultType","phraseResults","resultProps","SpeechServiceResponse_JsonResult","processed","hypothesis","privRequestSession","currentTurnAudioOffset","RecognizingSpeech","LanguageDetectionConfidence","onHypothesis","recognizing","simple","resultReason","implTranslateRecognitionResult","onPhraseRecognized","cancelReason","implTranslateCancelResult","cancelRecognitionLocal","implTranslateCancelErrorCode","isSpeechEnded","privRecognizerConfig","Display","recognized","canceled","ServiceRecognizerBase","_typeof","_possibleConstructorReturn","ReferenceError","bytesPerSecond","privBuffers","privReplayOffset","privLastShrinkOffset","privBufferStartOffset","privBufferSerial","privBufferedBytes","privReplay","privLastChunkAcquiredTime","privAudioNode","privBytesPerSecond","offsetToSeek","bytesToSeek","round","retVal","detach","startOffset","endOffset","serial","workerTimers","timerId","timers","func","delay","url","scheduledTimeoutFunctions","unhandledRequests","worker","Worker","addEventListener","isCallNotification","idOrFunc","unhandledTimerId","delete","isClearResponse","postMessage","method","performance","loadWorkerTimers","blob","Blob","URL","createObjectURL","revokeObjectURL","recognizer","privSetTimeout","privIsLiveAudio","recognizeOverride","disconnectOverride","sendSpeechContext","speechContextJson","speechContext","sendPrePayloadJSONOverride","postConnectImplOverride","requestSession","privMustReportEndOfStream","privAudioSource","privRecognizer","RequestSession","ConversationTranslator_Token","auth","recoMode","startNewRecognition","listenForServiceTelemetry","conPromise","audioStreamNode","deviceInfo","Microphones","audioNode","onAudioSourceAttachCompleted","onStopRecognizing","sessionStartEventArgs","SessionEventArgs","sessionStarted","sendAudio","RuntimeError","isRecognizing","turnOff","sendFinalAudio","turnCompletionPromise","cb","telemetryData","getTelemetry","cancelRecognition","speechStartDetected","speechStartEventArgs","speechStopDetected","isContinuousRecognition","onServiceRecognized","speechStopEventArgs","speechEndDetected","sendTelemetryData","sessionStopEventArgs","sessionStopped","sendPrePayloadJSON","sendWaveHeader","Speech_SessionId","audioFormat","nextSendTime","fastLaneSizeMs","maxSendUnthrottledBytes","startRecogNumber","recogNumber","readAndUploadCycle","audioStreamChunk","sendDelay","onAudioSent","bytesSent","onSpeechEnded","delayMs","readView","padStart","console","property","receiver","base","desc","sessionAudioDestinationId","turnAudioDestinationId","privSessionAudioDestinationId","privTurnAudioDestinationId","privIsSynthesizing","privIsSynthesisEnded","privBytesReceived","privInTurn","privNextSearchTextIndex","isError","onComplete","responseJson","privTurnDeferral","privAudioOutputStream","privTurnAudioDestination","privReceivedAudio","readAllAudioFromStream","privReceivedAudioWithHeader","getAllReceivedAudio","rawText","privRawText","privIsSSML","privPartialVisemeAnimation","updateTextOffset","AnimationChunk","bytesReceived","privListeningTriggerMetric","privMicMetric","privConnectionEstablishMetric","End","eventTime","Name","Start","privMicStartTime","privConnectionStartTime","Id","getConnectionError","privReceivedMessages","metrics","privPhraseLatencies","PhraseLatencyMs","privHypothesisLatencies","FirstHypothesisLatencyMs","telemetry","Metrics","ReceivedMessages","audioReceivedTime","privDetachables","privIsAudioNodeDetached","privIsRecognizing","privIsSpeechEnded","privTurnStartAudioOffset","privLastRecoOffset","privHypothesisReceived","privBytesSent","privRecogNumber","privServiceTelemetryListener","hasTelemetry","eventSource","attachListener","replay","continuousRecognition","hypothesisReceived","findTimeAtOffset","phraseReceived","shrinkBuffers","detachable","detachAudioNode","_n","_d","_s","_i","runtime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","_invoke","GenStateSuspendedStart","GenStateExecuting","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","GenStateSuspendedYield","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","values","Gp","defineIteratorMethods","AsyncIterator","PromiseImpl","invoke","__await","unwrapped","previousPromise","callInvokeWithMethodAndArg","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","mark","awrap","async","iter","reverse","pop","skipTempReset","prev","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","normalizeArray","parts","allowAboveRoot","up","last","splice","unshift","xs","resolvedPath","resolvedAbsolute","normalize","isAbsolute","trailingSlash","paths","relative","to","fromParts","toParts","samePartsLength","outputParts","sep","delimiter","dirname","hasRoot","matchedSlash","basename","extname","startDot","startPart","preDotState","arrayWithoutHoles","iterableToArray","nonIterableSpread","possibleConstructorReturn","assertThisInitialized","SpeechSynthesisOutputFormat","PromiseState","Deferred","privResolve","privReject","privPromise","marshalPromiseToCallbacks","typedError","v1","v4","uuid","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","node","clockseq","seedBytes","msecs","getTime","nsecs","dt","tl","tmh","ii","privEventListeners","eventId","onEventCallback","listener","AudioInputStream","PushAudioInputStream","PullAudioInputStream","PushAudioInputStreamImpl","privEvents","bufferData","readCycle","XMLHttpRequest","toBuffer","turnOn","stream","bitspersample","channelcount","Unknown","manufacturer","model","samplerate","Stream","arrayBuffer","PullAudioInputStreamImpl","privIsClosed","privBufferSize","transmitBuff","readBuff","pulledBytes","b64","lens","getLens","validLen","placeHoldersLen","Arr","_byteLength","curByte","revLookup","uint8","extraBytes","maxChunkLength","len2","encodeChunk","lookup","output","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","d","NaN","rt","abs","log","LN2","MessageType","ConnectionMessage","privBody","privMessageType","privSize","CertCheckAgent","privProxyInfo","privDiskCache","supportBuffer","location","SPEECH_OCSP_CACHE_ROOT","disableStapling","Agent","CreateConnection","HostName","Port","request","socketPromise","enableOCSP","NODE_TLS_REJECT_UNAUTHORIZED","SPEECH_CONDUCT_OCSP_CHECK","secureEndpoint","requestOCSP","forceDisableOCSPStapling","servername","baseAgent","GetProxyAgent","socket","OCSPCheck","privMemCache","httpProxyOptions","port","UserName","Password","resolved","cork","tlsSocket","stapling","destroy","peer","getPeerCertificate","GetIssuer","issuer","ocspRequest","generate","raw","sig","GetResponseFromCache","cacheEntry","VerifyOCSPResponse","uncork","issuerCertificate","fetchIssuer","signature","cachedResponse","diskCacheResponse","isCached","StoreMemoryCacheEntry","cachedOcspResponse","parseResponse","tbsData","tbsResponseData","responses","cachedStartTime","thisUpdate","cachedNextTime","nextUpdate","testTimeOffset","minUpdate","UpdateCache","cacheValue","ocspResponse","certID","GetOCSPResponse","StoreCacheEntry","req","rawResponse","StoreDiskCacheEntry","getAuthorityInfo","cert","parsedUri","pathname","getResponse","required","qs","slashes","protocolre","left","trimLeft","rules","address","ignore","hash","query","lolcation","finaldestination","protocol","Url","unescape","href","extractProtocol","exec","rest","parser","extracted","instruction","instructions","hostname","username","password","origin","part","char","ins","decode","input","decodeURIComponent","encode","prefix","pairs","undef","OCSPEvent","privSignature","OCSPMemoryCacheHitEvent","Debug","OCSPCacheMissEvent","OCSPDiskCacheHitEvent","OCSPCacheUpdateNeededEvent","OCSPMemoryCacheStoreEvent","OCSPDiskCacheStoreEvent","OCSPCacheUpdatehCompleteEvent","OCSPStapleReceivedEvent","OCSPCacheEntryExpiredEvent","serialNumber","expireTime","privExpireTime","OCSPCacheEntryNeedsRefreshEvent","startTime","privStartTime","OCSPCacheHitEvent","privExpireTimeString","toLocaleDateString","privStartTimeString","toLocaleTimeString","OCSPVerificationFailedEvent","privError","OCSPCacheFetchErrorEvent","OCSPResponseRetrievedEvent","OCSPCacheUpdateErrorEvent","SubscriberType","privSubscriptionIdCounter","privAddSubscriptions","privRemoveSubscriptions","privDisposedSubscriptions","privDisposeReason","itemIndex","throwIfDisposed","privList","first","add","insertAt","triggerSubscriptions","removeFirst","removeAt","removeLast","remove","count","removedElements","clear","onAdded","addedCallback","subscriptionId","onRemoved","removedCallback","onDisposed","disposedCallback","seperator","toArray","cloneCopy","any","where","all","select","selectList","List","filteredList","orderBy","compareFn","orderedArray","sort","orderByDesc","clone","concatArray","subscriptions","privPromiseStore","privIsDrainInProgress","privIsDisposing","enqueue","throwIfDispose","deferredSubscriber","privSubscribers","Dequeue","drain","peek","Peek","subs","lists","subscriber","dequeuedItem","pendingItemProcessor","promiseArray","wrapper","finally","privKeys","privValues","def","keyToUse","clonedMap","destinationCollection","ServicePropertyChannel","AudioSourceEvent","AudioSourceInitializingEvent","AudioSourceReadyEvent","AudioSourceOffEvent","AudioSourceErrorEvent","AudioStreamNodeEvent","AudioStreamNodeAttachingEvent","AudioStreamNodeAttachedEvent","AudioStreamNodeDetachedEvent","AudioStreamNodeErrorEvent","ChunkedArrayBufferStream","targetChunkSize","privTargetChunkSize","privNextBufferReadyBytes","bytesCopiedFromBuffer","privNextBufferToWrite","privNextBufferStartTime","bytesToCopy","targetView","sourceView","privIsWriteEnded","privIsReadEnded","privReaderQueue","streamChunk","throwIfClosed","privInstance","setEventSource","CancellationErrorCode","ServiceEvent","jsonstring","privJsonResult","ConnectionEvent","ConnectionStartEvent","ConnectionEstablishedEvent","ConnectionClosedEvent","ConnectionErrorEvent","privMessage","privType","ConnectionEstablishErrorEvent","statuscode","ConnectionMessageReceivedEvent","networkReceivedTimeISO","privNetworkReceivedTime","ConnectionMessageSentEvent","networkSentTimeISO","privNetworkSentTime","ConnectionState","BackgroundEvent","privPayload","actualSampleRate","desiredSampleRate","actualAudioFrame","audioFrame","downSampleAudioFrame","privActualSampleRate","privDesiredSampleRate","floatTo16BitPCM","setInt16","srcFrame","srcRate","dstRate","ratio","dstLength","dstFrame","Float32Array","srcOffset","dstOffset","nextSrcOffset","accum","mediaStream","outputStream","scriptNode","bufferSize","createScriptProcessor","audioSampleRate","waveStreamEncoder","onaudioprocess","inputFrame","inputBuffer","getChannelData","waveFrame","micInput","createMediaStreamSource","privSpeechProcessorScript","audioWorklet","addModule","workletNode","AudioWorkletNode","connect","destination","privMediaResources","scriptProcessorNode","releaseMediaResources","disconnect","getTracks","track","privRecorder","deviceId","privStreams","privInitializeDeferral","createAudioContext","nav","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","constraints","errorCallback","privMediaStream","active","video","errorMsg","resume","listen","privOutputChunkSize","getAudioContext","MicAudioSource","AUDIOFORMAT","destroyAudioContext","getMicrophoneLabel","label","setWorkletUrl","defaultMicrophoneName","privMicrophoneLabel","microphoneDeviceId","getSettings","enumerateDevices","devices","device","hasClose","suspend","file","filename","privHeaderEnd","privFilename","upload","privSource","privAudioFormatPromise","readHeader","File","headerResult","processHeader","getWord","getUint8","formatSize","getInt32","channelCount","getUint16","getUint32","maxHeaderSize","getWaveFormatPCM","reader","FileReader","onload","readAsArrayBuffer","h","processFile","buff","fileBuffer","AudioFormatToMimeType","audioDestinationId","privPlaybackStarted","privAppendingToBuffer","privMediaSourceOpened","privIsPaused","privAudioBuffer","updateSourceBuffer","privSourceBuffer","handleSourceBufferUpdateEnd","receivedAudio","_","audioBlob","privAudio","notifyPlayback","mimeType","warn","MediaSource","isTypeSupported","Audio","privMediaSource","onsourceopen","addSourceBuffer","onupdate","onupdateend","onupdatestart","currentTime","pause","play","sourceBufferAvailable","binary","shift","appendBuffer","canEndStream","endOfStream","onAudioStart","onended","onAudioEnd","updating","privFd","throwIfNotUndefined","privAudioFormat","headerOffset","privWriteStream","fd","autoClose","bytesWritten","pcmRecorder","audioStream","MediaStream","player","AudioConfig","fromDefaultSpeakerOutput","throwIfNull","privDestination","ProfanityOption","speechImpl","SpeechServiceConnection_IntentRegion","SpeechServiceConnection_Key","hostName","authorizationToken","speechRecognitionLanguage","SpeechServiceAuthorization_Token","channel","currentProperties","profanity","SpeechConfigImpl","SpeechServiceConnection_SynthLanguage","SpeechServiceConnection_SynthVoice","voice","SpeechServiceConnection_SynthOutputFormat","speechConfig","audioConfig","speechConfigImpl","SpeechConnectionFactory","privDisposedRecognizer","Detailed","recognizeOnceAsyncImpl","startContinuousRecognitionAsyncImpl","stopContinuousRecognitionAsyncImpl","errorCb","disposing","implRecognizerStop","configImpl","SpeechServiceRecognizer","autoDetectSourceLanguageConfig","mergeTo","SpeechRecognizer","fromDefaultMicrophoneInput","privDisposed","implCommonRecognizerSetup","privReco","osPlatform","osName","osVersion","userAgent","appVersion","createRecognizerConfig","createServiceRecognizer","Recognizer","getAuthFromProperties","stopRecognizing","enabled"],"mappings":"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G,4BAA8BF,EACnC,EAAKG,aAAejP,EAPa,EA1DzC,2CAoYI,WACI,OAAOrc,KAAKsrB,eArYpB,kBA8YI,WACI,GAAItrB,KAAKqc,UACL,OAAOrc,KAAK4I,aAhZxB,0BA4ZW,SAAa2iB,GACZvrB,KAAKsrB,cACQ,IAAIxiB,SAAS9I,KAAK4I,YAC1BG,UAAU,GAAIwiB,GAAa,KA/Z5C,oCAyaI,WACI,OAAOvrB,KAAKqrB,+BA1apB,8CAoEW,SAAuCG,GAC1C,YAAoC/oB,IAAhC+oB,EACOP,EAAsBhb,yBAE1Bgb,EAAsBQ,sCACzBR,EAAsBS,oCAAoCF,MAzEtE,mDA4EW,SAA6CG,GAChD,OAAQA,GACJ,IAAK,2BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,IACA,IACA,EACA,EACAD,EACAA,GACA,GACR,IAAK,+BACD,OAAO,IAAIV,EACPD,EAAea,MACf,EACA,KACA,IACA,GACA,EACAF,EACA,iCACA,GACR,IAAK,gCACD,OAAO,IAAIV,EACPD,EAAea,MACf,EACA,KACA,IACA,GACA,EACAF,EACAA,GACA,GACR,IAAK,kCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,KACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,mCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,MACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,kCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,KACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,kCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,KACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,kCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,MACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,mCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,MACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,gCACD,OAAO,IAAIV,EACPD,EAAee,UACf,EACA,KACA,KACA,EACA,GACAJ,EACAA,GACA,GAER,IAAK,2BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,IACA,KACA,EACA,GACAD,EACA,2BACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,KACA,KACA,EACA,GACAD,EACA,4BACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAegB,MACf,EACA,IACA,IACA,EACA,EACAL,EACA,4BACA,GACR,IAAK,2BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,KACA,KACA,EACA,GACAD,EACA,4BACA,GACR,IAAK,2BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,KACA,KACA,EACA,GACAD,EACA,4BACA,GACR,IAAK,0BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,IACA,KACA,EACA,GACAD,EACA,2BACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAeiB,SACf,EACA,KACA,KACA,EACA,GACAN,EACAA,GACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAeiB,SACf,EACA,KACA,KACA,EACA,GACAN,EACAA,GACA,GACR,IAAK,2BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,KACA,KACA,EACA,GACAD,EACA,4BACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAeY,IACf,EACA,KACA,KACA,EACA,GACAD,EACA,4BACA,GACR,IAAK,kCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,MACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,mCACD,OAAO,IAAIV,EACPD,EAAec,IACf,EACA,KACA,MACA,EACA,GACAH,EACAA,GACA,GACR,IAAK,4BACD,OAAO,IAAIV,EACPD,EAAeiB,SACf,EACA,KACA,KACA,EACA,GACAN,EACAA,GACA,GACR,IAAK,6BACD,OAAO,IAAIV,EACPD,EAAekB,UACf,EACA,KACA,IACA,EACA,GACAP,EACAA,GACA,GACR,IAAK,6BACD,OAAO,IAAIV,EACPD,EAAekB,UACf,EACA,KACA,IACA,EACA,GACAP,EA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","file":"static/js/1.91bcaa60.chunk.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","module.exports = require(\"regenerator-runtime\");\n","import setPrototypeOf from \"@babel/runtime/helpers/esm/setPrototypeOf\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport isNativeReflectConstruct from \"@babel/runtime/helpers/esm/isNativeReflectConstruct\";\nimport possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nexport default function _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// Make sure not to export internal modules.\r\n//\r\nexport * from \"./CognitiveSubscriptionKeyAuthentication\";\r\nexport * from \"./CognitiveTokenAuthentication\";\r\nexport * from \"./IAuthentication\";\r\nexport * from \"./IConnectionFactory\";\r\nexport * from \"./ISynthesisConnectionFactory\";\r\nexport * from \"./IntentConnectionFactory\";\r\nexport * from \"./RecognitionEvents\";\r\nexport * from \"./ServiceRecognizerBase\";\r\nexport * from \"./RecognizerConfig\";\r\nexport * from \"./SpeechServiceInterfaces\";\r\nexport * from \"./WebsocketMessageFormatter\";\r\nexport * from \"./SpeechConnectionFactory\";\r\nexport * from \"./TranscriberConnectionFactory\";\r\nexport * from \"./TranslationConnectionFactory\";\r\nexport * from \"./SpeechSynthesisConnectionFactory\";\r\nexport * from \"./EnumTranslation\";\r\nexport * from \"./ServiceMessages/Enums\";\r\nexport * from \"./ServiceMessages/TranslationSynthesisEnd\";\r\nexport * from \"./ServiceMessages/TranslationHypothesis\";\r\nexport * from \"./ServiceMessages/TranslationPhrase\";\r\nexport * from \"./TranslationServiceRecognizer\";\r\nexport * from \"./ServiceMessages/SpeechDetected\";\r\nexport * from \"./ServiceMessages/SpeechHypothesis\";\r\nexport * from \"./SpeechServiceRecognizer\";\r\nexport * from \"./TranscriptionServiceRecognizer\";\r\nexport * from \"./ServiceMessages/DetailedSpeechPhrase\";\r\nexport * from \"./ServiceMessages/SimpleSpeechPhrase\";\r\nexport * from \"./AddedLmIntent\";\r\nexport * from \"./IntentServiceRecognizer\";\r\nexport * from \"./ServiceMessages/IntentResponse\";\r\nexport * from \"./RequestSession\";\r\nexport * from \"./SpeechContext\";\r\nexport * from \"./DynamicGrammarBuilder\";\r\nexport * from \"./DynamicGrammarInterfaces\";\r\nexport * from \"./DialogServiceAdapter\";\r\nexport * from \"./AgentConfig\";\r\nexport * from \"./Transcription/Exports\";\r\nexport * from \"./ServiceMessages/SynthesisAudioMetadata\";\r\nexport * from \"./SynthesisTurn\";\r\nexport * from \"./SynthesisAdapterBase\";\r\nexport * from \"./SynthesizerConfig\";\r\nexport * from \"./SynthesisContext\";\r\nexport * from \"./SpeakerRecognitionConfig\";\r\nexport * from \"./SpeakerIdMessageAdapter\";\r\n\r\nexport const OutputFormatPropertyName: string = \"OutputFormat\";\r\nexport const CancellationErrorCodePropertyName: string = \"CancellationErrorCode\";\r\nexport const ServicePropertiesPropertyName: string = \"ServiceProperties\";\r\nexport const ForceDictationPropertyName: string = \"ForceDictation\";\r\nexport const AutoDetectSourceLanguagesOpenRangeOptionName: string = \"OpenRange\";\r\n","import unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","import setPrototypeOf from \"@babel/runtime/helpers/esm/setPrototypeOf\";\nimport isNativeReflectConstruct from \"@babel/runtime/helpers/esm/isNativeReflectConstruct\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","import getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport setPrototypeOf from \"@babel/runtime/helpers/esm/setPrototypeOf\";\nimport isNativeFunction from \"@babel/runtime/helpers/esm/isNativeFunction\";\nimport construct from \"@babel/runtime/helpers/esm/construct\";\nexport default function _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}","export default function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\n/**\r\n * The error that is thrown when an argument passed in is null.\r\n *\r\n * @export\r\n * @class ArgumentNullError\r\n * @extends {Error}\r\n */\r\nexport class ArgumentNullError extends Error {\r\n\r\n    /**\r\n     * Creates an instance of ArgumentNullError.\r\n     *\r\n     * @param {string} argumentName - Name of the argument that is null\r\n     *\r\n     * @memberOf ArgumentNullError\r\n     */\r\n    public constructor(argumentName: string) {\r\n        super(argumentName);\r\n        this.name = \"ArgumentNull\";\r\n        this.message = argumentName;\r\n    }\r\n}\r\n\r\n/**\r\n * The error that is thrown when an invalid operation is performed in the code.\r\n *\r\n * @export\r\n * @class InvalidOperationError\r\n * @extends {Error}\r\n */\r\nexport class InvalidOperationError extends Error {\r\n\r\n    /**\r\n     * Creates an instance of InvalidOperationError.\r\n     *\r\n     * @param {string} error - The error\r\n     *\r\n     * @memberOf InvalidOperationError\r\n     */\r\n    public constructor(error: string) {\r\n        super(error);\r\n        this.name = \"InvalidOperation\";\r\n        this.message = error;\r\n    }\r\n}\r\n\r\n/**\r\n * The error that is thrown when an object is disposed.\r\n *\r\n * @export\r\n * @class ObjectDisposedError\r\n * @extends {Error}\r\n */\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class ObjectDisposedError extends Error {\r\n\r\n    /**\r\n     * Creates an instance of ObjectDisposedError.\r\n     *\r\n     * @param {string} objectName - The object that is disposed\r\n     * @param {string} error - The error\r\n     *\r\n     * @memberOf ObjectDisposedError\r\n     */\r\n    public constructor(objectName: string, error?: string) {\r\n        super(error);\r\n        this.name = objectName + \"ObjectDisposed\";\r\n        this.message = error;\r\n    }\r\n}\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.SpokenCommand = void 0;\r\nconst modules_loader_1 = __importDefault(require(\"./modules-loader\"));\r\nconst spoken_command_1 = __importDefault(require(\"./spoken-command\"));\r\nexports.SpokenCommand = spoken_command_1.default;\r\nconst recognizer_1 = __importDefault(require(\"./recognizer\"));\r\nconst logger_1 = __importDefault(require(\"./logger\"));\r\nclass Spoken {\r\n    async init(val) {\r\n        await modules_loader_1.default.load(val);\r\n    }\r\n    get modules() {\r\n        return modules_loader_1.default.list;\r\n    }\r\n    get context() {\r\n        return modules_loader_1.default.context;\r\n    }\r\n    recognizePhrase(phrase, lang) {\r\n        var _a;\r\n        if (!((_a = modules_loader_1.default === null || modules_loader_1.default === void 0 ? void 0 : modules_loader_1.default.list) === null || _a === void 0 ? void 0 : _a.length))\r\n            throw new Error('Grammar is not loaded');\r\n        logger_1.default.info('Looking for a match for: ', '\"' + phrase + '\"');\r\n        const result = recognizer_1.default.recognize(phrase, lang);\r\n        if (result == null)\r\n            return null;\r\n        logger_1.default.info('Match found for:', '\"' + phrase + '\"', \"ID:\", result[0].graph().id, \"Path:\", result[1].path);\r\n        const [graph, state] = result;\r\n        return new spoken_command_1.default(graph.graph(), state.path);\r\n    }\r\n    findById(id, lang) {\r\n        var _a;\r\n        if (!((_a = modules_loader_1.default === null || modules_loader_1.default === void 0 ? void 0 : modules_loader_1.default.list) === null || _a === void 0 ? void 0 : _a.length))\r\n            throw new Error('Grammar is not loaded');\r\n        const result = modules_loader_1.default.findAutomataById(id, lang);\r\n        if (result == null)\r\n            return null;\r\n        return new spoken_command_1.default(result.graph());\r\n    }\r\n}\r\nexports.default = new Spoken();\r\n","import defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * @class Contracts\r\n * @private\r\n */\r\nexport class Contracts {\r\n    public static throwIfNullOrUndefined(param: any, name: string): void {\r\n        if (param === undefined || param === null) {\r\n            throw new Error(\"throwIfNullOrUndefined:\" + name);\r\n        }\r\n    }\r\n\r\n    public static throwIfNull(param: any, name: string): void {\r\n        if (param === null) {\r\n            throw new Error(\"throwIfNull:\" + name);\r\n        }\r\n    }\r\n\r\n    public static throwIfNullOrWhitespace(param: string, name: string): void {\r\n        Contracts.throwIfNullOrUndefined(param, name);\r\n\r\n        if ((\"\" + param).trim().length < 1) {\r\n            throw new Error(\"throwIfNullOrWhitespace:\" + name);\r\n        }\r\n    }\r\n\r\n    public static throwIfDisposed(isDisposed: boolean): void {\r\n        if (isDisposed) {\r\n            throw new Error(\"the object is already disposed\");\r\n        }\r\n    }\r\n\r\n    public static throwIfArrayEmptyOrWhitespace(array: string[], name: string): void {\r\n        Contracts.throwIfNullOrUndefined(array, name);\r\n\r\n        if (array.length === 0) {\r\n            throw new Error(\"throwIfArrayEmptyOrWhitespace:\" + name);\r\n        }\r\n\r\n        for (const item of array) {\r\n            Contracts.throwIfNullOrWhitespace(item, name);\r\n        }\r\n    }\r\n\r\n    public static throwIfFileDoesNotExist(param: any, name: string): void {\r\n        Contracts.throwIfNullOrWhitespace(param, name);\r\n\r\n        // TODO check for file existence.\r\n    }\r\n\r\n    public static throwIfNotUndefined(param: any, name: string): void {\r\n        if (param !== undefined) {\r\n            throw new Error(\"throwIfNotUndefined:\" + name);\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nconst createGuid: () => string = (): string => {\r\n    return uuid();\r\n};\r\n\r\nconst createNoDashGuid: () => string = (): string => {\r\n    return createGuid().replace(new RegExp(\"-\", \"g\"), \"\").toUpperCase();\r\n};\r\n\r\nexport { createGuid, createNoDashGuid };\r\n","var unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nmodule.exports = _createForOfIteratorHelper;","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Represents audio stream format used for custom audio input configurations.\r\n * @class AudioStreamFormat\r\n */\r\nexport abstract class AudioStreamFormat {\r\n    /**\r\n     * Creates an audio stream format object representing the default audio stream\r\n     * format (16KHz 16bit mono PCM).\r\n     * @member AudioStreamFormat.getDefaultInputFormat\r\n     * @function\r\n     * @public\r\n     * @returns {AudioStreamFormat} The audio stream format being created.\r\n     */\r\n    public static getDefaultInputFormat(): AudioStreamFormat {\r\n        return AudioStreamFormatImpl.getDefaultInputFormat();\r\n    }\r\n\r\n    /**\r\n     * Creates an audio stream format object with the specified pcm waveformat characteristics.\r\n     * @member AudioStreamFormat.getWaveFormatPCM\r\n     * @function\r\n     * @public\r\n     * @param {number} samplesPerSecond - Sample rate, in samples per second (Hertz).\r\n     * @param {number} bitsPerSample - Bits per sample, typically 16.\r\n     * @param {number} channels - Number of channels in the waveform-audio data. Monaural data\r\n     *        uses one channel and stereo data uses two channels.\r\n     * @returns {AudioStreamFormat} The audio stream format being created.\r\n     */\r\n    public static getWaveFormatPCM(samplesPerSecond: number, bitsPerSample: number, channels: number): AudioStreamFormat {\r\n        return new AudioStreamFormatImpl(samplesPerSecond, bitsPerSample, channels);\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member AudioStreamFormat.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n\r\n/**\r\n * @private\r\n * @class AudioStreamFormatImpl\r\n */\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class AudioStreamFormatImpl extends AudioStreamFormat {\r\n    protected privHeader: ArrayBuffer;\r\n\r\n    /**\r\n     * Creates an instance with the given values.\r\n     * @constructor\r\n     * @param {number} samplesPerSec - Samples per second.\r\n     * @param {number} bitsPerSample - Bits per sample.\r\n     * @param {number} channels - Number of channels.\r\n     */\r\n    public constructor(samplesPerSec: number = 16000, bitsPerSample: number = 16, channels: number = 1) {\r\n        super();\r\n        this.formatTag = 1;\r\n        this.bitsPerSample = bitsPerSample;\r\n        this.samplesPerSec = samplesPerSec;\r\n        this.channels = channels;\r\n        this.avgBytesPerSec = this.samplesPerSec * this.channels * (this.bitsPerSample / 8);\r\n        this.blockAlign = this.channels * Math.max(this.bitsPerSample, 8);\r\n\r\n        this.privHeader = new ArrayBuffer(44);\r\n\r\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView\r\n        const view = new DataView(this.privHeader);\r\n\r\n        /* RIFF identifier */\r\n        this.setString(view, 0, \"RIFF\");\r\n        /* file length */\r\n        view.setUint32(4, 0, true);\r\n        /* RIFF type & Format */\r\n        this.setString(view, 8, \"WAVEfmt \");\r\n        /* format chunk length */\r\n        view.setUint32(16, 16, true);\r\n        /* sample format (raw) */\r\n        view.setUint16(20, 1, true);\r\n        /* channel count */\r\n        view.setUint16(22, this.channels, true);\r\n        /* sample rate */\r\n        view.setUint32(24, this.samplesPerSec, true);\r\n        /* byte rate (sample rate * block align) */\r\n        view.setUint32(28, this.avgBytesPerSec, true);\r\n        /* block align (channel count * bytes per sample) */\r\n        view.setUint16(32, this.channels * (this.bitsPerSample / 8), true);\r\n        /* bits per sample */\r\n        view.setUint16(34, this.bitsPerSample, true);\r\n        /* data chunk identifier */\r\n        this.setString(view, 36, \"data\");\r\n        /* data chunk length */\r\n        view.setUint32(40, 0, true);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the default input format.\r\n     * @member AudioStreamFormatImpl.getDefaultInputFormat\r\n     * @function\r\n     * @public\r\n     * @returns {AudioStreamFormatImpl} The default input format.\r\n     */\r\n    public static getDefaultInputFormat(): AudioStreamFormatImpl {\r\n        return new AudioStreamFormatImpl();\r\n    }\r\n\r\n    /**\r\n     * Creates an audio context appropriate to current browser\r\n     * @member AudioStreamFormatImpl.getAudioContext\r\n     * @function\r\n     * @public\r\n     * @returns {AudioContext} An audio context instance\r\n     */\r\n    public static getAudioContext(sampleRate?: number): AudioContext {\r\n        // Workaround for Speech SDK bug in Safari.\r\n        const AudioContext = (window as any).AudioContext // our preferred impl\r\n            || (window as any).webkitAudioContext // fallback, mostly when on Safari\r\n            || false; // could not find.\r\n\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/AudioContext\r\n        if (!!AudioContext) {\r\n            if (sampleRate !== undefined && navigator.mediaDevices.getSupportedConstraints().sampleRate) {\r\n                return new AudioContext({ sampleRate });\r\n            } else {\r\n                return new AudioContext();\r\n            }\r\n        } else {\r\n            throw new Error(\"Browser does not support Web Audio API (AudioContext is not available).\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Closes the configuration object.\r\n     * @member AudioStreamFormatImpl.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(): void { return; }\r\n\r\n    /**\r\n     * The format of the audio, valid values: 1 (PCM)\r\n     * @member AudioStreamFormatImpl.prototype.formatTag\r\n     * @function\r\n     * @public\r\n     */\r\n    public formatTag: number;\r\n\r\n    /**\r\n     * The number of channels, valid values: 1 (Mono).\r\n     * @member AudioStreamFormatImpl.prototype.channels\r\n     * @function\r\n     * @public\r\n     */\r\n    public channels: number;\r\n\r\n    /**\r\n     * The sample rate, valid values: 16000.\r\n     * @member AudioStreamFormatImpl.prototype.samplesPerSec\r\n     * @function\r\n     * @public\r\n     */\r\n    public samplesPerSec: number;\r\n\r\n    /**\r\n     * The bits per sample, valid values: 16\r\n     * @member AudioStreamFormatImpl.prototype.b\r\n     * @function\r\n     * @public\r\n     */\r\n    public bitsPerSample: number;\r\n\r\n    /**\r\n     * Average bytes per second, usually calculated as nSamplesPerSec * nChannels * ceil(wBitsPerSample, 8).\r\n     * @member AudioStreamFormatImpl.prototype.avgBytesPerSec\r\n     * @function\r\n     * @public\r\n     */\r\n    public avgBytesPerSec: number;\r\n\r\n    /**\r\n     * The size of a single frame, valid values: nChannels * ceil(wBitsPerSample, 8).\r\n     * @member AudioStreamFormatImpl.prototype.blockAlign\r\n     * @function\r\n     * @public\r\n     */\r\n    public blockAlign: number;\r\n\r\n    public get header(): ArrayBuffer {\r\n        return this.privHeader;\r\n    }\r\n\r\n    protected setString = (view: DataView, offset: number, str: string): void => {\r\n        for (let i = 0; i < str.length; i++) {\r\n            view.setUint8(offset + i, str.charCodeAt(i));\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport class HeaderNames {\r\n    public static AuthKey: string = \"Ocp-Apim-Subscription-Key\";\r\n    public static ConnectionId: string = \"X-ConnectionId\";\r\n    public static ContentType: string = \"Content-Type\";\r\n    public static CustomCommandsAppId: string = \"X-CommandsAppId\";\r\n    public static Path: string = \"Path\";\r\n    public static RequestId: string = \"X-RequestId\";\r\n    public static RequestStreamId: string = \"X-StreamId\";\r\n    public static RequestTimestamp: string = \"X-Timestamp\";\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { EventType, PlatformEvent } from \"../common/Exports\";\r\n\r\nexport class SpeechRecognitionEvent extends PlatformEvent {\r\n    private privRequestId: string;\r\n    private privSessionId: string;\r\n\r\n    constructor(eventName: string, requestId: string, sessionId: string, eventType: EventType = EventType.Info) {\r\n        super(eventName, eventType);\r\n\r\n        this.privRequestId = requestId;\r\n        this.privSessionId = sessionId;\r\n    }\r\n\r\n    public get requestId(): string {\r\n        return this.privRequestId;\r\n    }\r\n\r\n    public get sessionId(): string {\r\n        return this.privSessionId;\r\n    }\r\n}\r\n\r\nexport class RecognitionTriggeredEvent extends SpeechRecognitionEvent {\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n\r\n    constructor(requestId: string, sessionId: string, audioSourceId: string, audioNodeId: string) {\r\n        super(\"RecognitionTriggeredEvent\", requestId, sessionId);\r\n\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privAudioNodeId = audioNodeId;\r\n    }\r\n\r\n    public get audioSourceId(): string {\r\n        return this.privAudioSourceId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n}\r\n\r\nexport class ListeningStartedEvent extends SpeechRecognitionEvent {\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n\r\n    constructor(requestId: string, sessionId: string, audioSourceId: string, audioNodeId: string) {\r\n        super(\"ListeningStartedEvent\", requestId, sessionId);\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privAudioNodeId = audioNodeId;\r\n    }\r\n\r\n    public get audioSourceId(): string {\r\n        return this.privAudioSourceId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n}\r\n\r\nexport class ConnectingToServiceEvent extends SpeechRecognitionEvent {\r\n    private privAuthFetchEventid: string;\r\n\r\n    constructor(requestId: string, authFetchEventid: string, sessionId: string) {\r\n        super(\"ConnectingToServiceEvent\", requestId, sessionId);\r\n        this.privAuthFetchEventid = authFetchEventid;\r\n    }\r\n\r\n    public get authFetchEventid(): string {\r\n        return this.privAuthFetchEventid;\r\n    }\r\n}\r\n\r\nexport class RecognitionStartedEvent extends SpeechRecognitionEvent {\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n    private privAuthFetchEventId: string;\r\n\r\n    constructor(requestId: string, audioSourceId: string, audioNodeId: string, authFetchEventId: string, sessionId: string) {\r\n        super(\"RecognitionStartedEvent\", requestId, sessionId);\r\n\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privAudioNodeId = audioNodeId;\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n    }\r\n\r\n    public get audioSourceId(): string {\r\n        return this.privAudioSourceId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n\r\n    public get authFetchEventId(): string {\r\n        return this.privAuthFetchEventId;\r\n    }\r\n}\r\n\r\nexport enum RecognitionCompletionStatus {\r\n    Success,\r\n    AudioSourceError,\r\n    AudioSourceTimeout,\r\n    AuthTokenFetchError,\r\n    AuthTokenFetchTimeout,\r\n    UnAuthorized,\r\n    ConnectTimeout,\r\n    ConnectError,\r\n    ClientRecognitionActivityTimeout,\r\n    UnknownError,\r\n}\r\n\r\nexport class RecognitionEndedEvent extends SpeechRecognitionEvent {\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n    private privAuthFetchEventId: string;\r\n    private privServiceTag: string;\r\n    private privStatus: RecognitionCompletionStatus;\r\n    private privError: string;\r\n\r\n    constructor(\r\n        requestId: string,\r\n        audioSourceId: string,\r\n        audioNodeId: string,\r\n        authFetchEventId: string,\r\n        sessionId: string,\r\n        serviceTag: string,\r\n        status: RecognitionCompletionStatus,\r\n        error: string) {\r\n\r\n        super(\"RecognitionEndedEvent\", requestId, sessionId, status === RecognitionCompletionStatus.Success ? EventType.Info : EventType.Error);\r\n\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privAudioNodeId = audioNodeId;\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n        this.privStatus = status;\r\n        this.privError = error;\r\n        this.privServiceTag = serviceTag;\r\n    }\r\n\r\n    public get audioSourceId(): string {\r\n        return this.privAudioSourceId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n\r\n    public get authFetchEventId(): string {\r\n        return this.privAuthFetchEventId;\r\n    }\r\n\r\n    public get serviceTag(): string {\r\n        return this.privServiceTag;\r\n    }\r\n\r\n    public get status(): RecognitionCompletionStatus {\r\n        return this.privStatus;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport interface IAuthentication {\r\n    fetch(authFetchEventId: string): Promise<AuthInfo>;\r\n    fetchOnExpiry(authFetchEventId: string): Promise<AuthInfo>;\r\n}\r\n\r\nexport class AuthInfo {\r\n    private privHeaderName: string;\r\n    private privToken: string;\r\n\r\n    public constructor(headerName: string, token: string) {\r\n        this.privHeaderName = headerName;\r\n        this.privToken = token;\r\n    }\r\n\r\n    public get headerName(): string {\r\n        return this.privHeaderName;\r\n    }\r\n\r\n    public get token(): string {\r\n        return this.privToken;\r\n    }\r\n}\r\n","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var defineProperty = require(\"./defineProperty\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectSpread2;","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { createNoDashGuid } from \"./Guid\";\r\nimport { IStringDictionary } from \"./IDictionary\";\r\n\r\nexport enum EventType {\r\n    Debug,\r\n    Info,\r\n    Warning,\r\n    Error,\r\n}\r\n\r\nexport class PlatformEvent {\r\n    private privName: string;\r\n    private privEventId: string;\r\n    private privEventTime: string;\r\n    private privEventType: EventType;\r\n    private privMetadata: IStringDictionary<string>;\r\n\r\n    constructor(eventName: string, eventType: EventType) {\r\n        this.privName = eventName;\r\n        this.privEventId = createNoDashGuid();\r\n        this.privEventTime = new Date().toISOString();\r\n        this.privEventType = eventType;\r\n        this.privMetadata = { };\r\n    }\r\n\r\n    public get name(): string {\r\n        return this.privName;\r\n    }\r\n\r\n    public get eventId(): string {\r\n        return this.privEventId;\r\n    }\r\n\r\n    public get eventTime(): string {\r\n        return this.privEventTime;\r\n    }\r\n\r\n    public get eventType(): EventType {\r\n        return this.privEventType;\r\n    }\r\n\r\n    public get metadata(): IStringDictionary<string> {\r\n        return this.privMetadata;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport {\r\n    createNoDashGuid,\r\n    Deferred,\r\n    IAudioDestination,\r\n    IStreamChunk,\r\n    Stream,\r\n} from \"../../common/Exports\";\r\nimport { Contracts } from \"../Contracts\";\r\nimport {\r\n    AudioStreamFormat,\r\n    PushAudioOutputStreamCallback\r\n} from \"../Exports\";\r\nimport { AudioOutputFormatImpl } from \"./AudioOutputFormat\";\r\n\r\n/**\r\n * Represents audio output stream used for custom audio output configurations.\r\n * @class AudioOutputStream\r\n */\r\nexport abstract class AudioOutputStream {\r\n\r\n    /**\r\n     * Creates and initializes an instance.\r\n     * @constructor\r\n     */\r\n    protected constructor() { }\r\n\r\n    /**\r\n     * Sets the format of the AudioOutputStream\r\n     * Note: the format is set by the synthesizer before writing. Do not set it before passing it to AudioConfig\r\n     * @member AudioOutputStream.prototype.format\r\n     */\r\n    public abstract set format(format: AudioStreamFormat);\r\n\r\n    /**\r\n     * Creates a memory backed PullAudioOutputStream with the specified audio format.\r\n     * @member AudioOutputStream.createPullStream\r\n     * @function\r\n     * @public\r\n     * @returns {PullAudioOutputStream} The audio output stream being created.\r\n     */\r\n    public static createPullStream(): PullAudioOutputStream {\r\n        return PullAudioOutputStream.create();\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member AudioOutputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n\r\n/**\r\n * Represents memory backed push audio output stream used for custom audio output configurations.\r\n * @class PullAudioOutputStream\r\n */\r\nexport abstract class PullAudioOutputStream extends AudioOutputStream {\r\n\r\n    /**\r\n     * Creates a memory backed PullAudioOutputStream with the specified audio format.\r\n     * @member PullAudioOutputStream.create\r\n     * @function\r\n     * @public\r\n     * @returns {PullAudioOutputStream} The push audio output stream being created.\r\n     */\r\n    public static create(): PullAudioOutputStream {\r\n        return new PullAudioOutputStreamImpl();\r\n    }\r\n\r\n    /**\r\n     * Reads audio data from the internal buffer.\r\n     * @member PullAudioOutputStream.prototype.read\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - An ArrayBuffer to store the read data.\r\n     * @returns {Promise<number>} Audio buffer length has been read.\r\n     */\r\n    public abstract read(dataBuffer: ArrayBuffer): Promise<number>;\r\n\r\n    /**\r\n     * Closes the stream.\r\n     * @member PullAudioOutputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n\r\n/**\r\n * Represents memory backed push audio output stream used for custom audio output configurations.\r\n * @private\r\n * @class PullAudioOutputStreamImpl\r\n */\r\nexport class PullAudioOutputStreamImpl extends PullAudioOutputStream implements IAudioDestination {\r\n    private privFormat: AudioOutputFormatImpl;\r\n    private privId: string;\r\n    private privStream: Stream<ArrayBuffer>;\r\n    private privLastChunkView: Int8Array;\r\n\r\n    /**\r\n     * Creates and initializes an instance with the given values.\r\n     * @constructor\r\n     */\r\n    public constructor() {\r\n        super();\r\n        this.privId = createNoDashGuid();\r\n        this.privStream = new Stream<ArrayBuffer>();\r\n    }\r\n\r\n    /**\r\n     * Sets the format information to the stream. For internal use only.\r\n     * @param {AudioStreamFormat} format - the format to be set.\r\n     */\r\n    public set format(format: AudioStreamFormat) {\r\n        if (format === undefined || format === null) {\r\n            this.privFormat = AudioOutputFormatImpl.getDefaultOutputFormat();\r\n        }\r\n        this.privFormat = format as AudioOutputFormatImpl;\r\n    }\r\n\r\n    /**\r\n     * Format information for the audio\r\n     */\r\n    public get format(): AudioStreamFormat {\r\n        return this.privFormat;\r\n    }\r\n\r\n    /**\r\n     * Checks if the stream is closed\r\n     * @member PullAudioOutputStreamImpl.prototype.isClosed\r\n     * @property\r\n     * @public\r\n     */\r\n    public get isClosed(): boolean {\r\n        return this.privStream.isClosed;\r\n    }\r\n\r\n    /**\r\n     * Gets the id of the stream\r\n     * @member PullAudioOutputStreamImpl.prototype.id\r\n     * @property\r\n     * @public\r\n     */\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    /**\r\n     * Reads audio data from the internal buffer.\r\n     * @member PullAudioOutputStreamImpl.prototype.read\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - An ArrayBuffer to store the read data.\r\n     * @returns {Promise<number>} - Audio buffer length has been read.\r\n     */\r\n    public async read(dataBuffer: ArrayBuffer): Promise<number> {\r\n        const intView: Int8Array = new Int8Array(dataBuffer);\r\n        let totalBytes: number = 0;\r\n\r\n        if (this.privLastChunkView !== undefined) {\r\n            if (this.privLastChunkView.length > dataBuffer.byteLength) {\r\n                intView.set(this.privLastChunkView.slice(0, dataBuffer.byteLength));\r\n                this.privLastChunkView = this.privLastChunkView.slice(dataBuffer.byteLength);\r\n                return Promise.resolve(dataBuffer.byteLength);\r\n            }\r\n            intView.set(this.privLastChunkView);\r\n            totalBytes = this.privLastChunkView.length;\r\n            this.privLastChunkView = undefined;\r\n        }\r\n\r\n        // Until we have the minimum number of bytes to send in a transmission, keep asking for more.\r\n        while (totalBytes < dataBuffer.byteLength && !this.privStream.isReadEnded) {\r\n            const chunk: IStreamChunk<ArrayBuffer> = await this.privStream.read();\r\n            if (chunk !== undefined && !chunk.isEnd) {\r\n                let tmpBuffer: ArrayBuffer;\r\n                if (chunk.buffer.byteLength > dataBuffer.byteLength - totalBytes) {\r\n                    tmpBuffer = chunk.buffer.slice(0, dataBuffer.byteLength - totalBytes);\r\n                    this.privLastChunkView = new Int8Array(chunk.buffer.slice(dataBuffer.byteLength - totalBytes));\r\n                } else {\r\n                    tmpBuffer = chunk.buffer;\r\n                }\r\n                intView.set(new Int8Array(tmpBuffer), totalBytes);\r\n                totalBytes += tmpBuffer.byteLength;\r\n            } else {\r\n                await this.privStream.readEnded();\r\n            }\r\n        }\r\n        return totalBytes;\r\n    }\r\n\r\n    /**\r\n     * Writes the audio data specified by making an internal copy of the data.\r\n     * @member PullAudioOutputStreamImpl.prototype.write\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - The audio buffer of which this function will make a copy.\r\n     */\r\n    public write(dataBuffer: ArrayBuffer): void {\r\n        Contracts.throwIfNullOrUndefined(this.privStream, \"must set format before writing\");\r\n        this.privStream.writeStreamChunk({\r\n            buffer: dataBuffer,\r\n            isEnd: false,\r\n            timeReceived: Date.now()\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Closes the stream.\r\n     * @member PullAudioOutputStreamImpl.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(): void {\r\n        this.privStream.close();\r\n    }\r\n}\r\n\r\n/*\r\n * Represents audio output stream used for custom audio output configurations.\r\n * @class PushAudioOutputStream\r\n */\r\nexport abstract class PushAudioOutputStream extends AudioOutputStream {\r\n    /**\r\n     * Creates and initializes and instance.\r\n     * @constructor\r\n     */\r\n    protected constructor() { super(); }\r\n\r\n    /**\r\n     * Creates a PushAudioOutputStream that delegates to the specified callback interface for\r\n     * write() and close() methods.\r\n     * @member PushAudioOutputStream.create\r\n     * @function\r\n     * @public\r\n     * @param {PushAudioOutputStreamCallback} callback - The custom audio output object,\r\n     *        derived from PushAudioOutputStreamCallback\r\n     * @returns {PushAudioOutputStream} The push audio output stream being created.\r\n     */\r\n    public static create(callback: PushAudioOutputStreamCallback): PushAudioOutputStream {\r\n        return new PushAudioOutputStreamImpl(callback);\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member PushAudioOutputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n\r\n}\r\n\r\n/**\r\n * Represents audio output stream used for custom audio output configurations.\r\n * @private\r\n * @class PushAudioOutputStreamImpl\r\n */\r\nexport class PushAudioOutputStreamImpl extends PushAudioOutputStream implements IAudioDestination {\r\n    private readonly privId: string;\r\n    private privCallback: PushAudioOutputStreamCallback;\r\n\r\n    /**\r\n     * Creates a PushAudioOutputStream that delegates to the specified callback interface for\r\n     * read() and close() methods.\r\n     * @constructor\r\n     * @param {PushAudioOutputStreamCallback} callback - The custom audio output object,\r\n     *        derived from PushAudioOutputStreamCallback\r\n     */\r\n    public constructor(callback: PushAudioOutputStreamCallback) {\r\n        super();\r\n        this.privId = createNoDashGuid();\r\n        this.privCallback = callback;\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public set format(format: AudioStreamFormat) { }\r\n\r\n    public write(buffer: ArrayBuffer): void {\r\n        if (!!this.privCallback.write) {\r\n            this.privCallback.write(buffer);\r\n        }\r\n    }\r\n\r\n    public close(): void {\r\n        if (!!this.privCallback.close) {\r\n            this.privCallback.close();\r\n        }\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { SpeechSynthesisResult } from \"./Exports\";\r\n\r\n/**\r\n * Defines contents of speech synthesis events.\r\n * @class SpeechSynthesisEventArgs\r\n * Added in version 1.11.0\r\n */\r\nexport class SpeechSynthesisEventArgs {\r\n    private readonly privResult: SpeechSynthesisResult;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {SpeechSynthesisResult} result - The speech synthesis result.\r\n     */\r\n    public constructor(result: SpeechSynthesisResult) {\r\n        this.privResult = result;\r\n    }\r\n\r\n    /**\r\n     * Specifies the synthesis result.\r\n     * @member SpeechSynthesisEventArgs.prototype.result\r\n     * @function\r\n     * @public\r\n     * @returns {SpeechSynthesisResult} the synthesis result.\r\n     */\r\n    public get result(): SpeechSynthesisResult {\r\n        return this.privResult;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { PropertyCollection, ResultReason } from \"./Exports\";\r\n\r\n/**\r\n * Defines result of speech synthesis.\r\n * @class SpeechSynthesisResult\r\n * Added in version 1.11.0\r\n */\r\nexport class SpeechSynthesisResult {\r\n    private privResultId: string;\r\n    private privReason: ResultReason;\r\n    private privAudioData: ArrayBuffer;\r\n    private privErrorDetails: string;\r\n    private privProperties: PropertyCollection;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {string} resultId - The result id.\r\n     * @param {ResultReason} reason - The reason.\r\n     * @param {number} audioData - The offset into the stream.\r\n     * @param {string} errorDetails - Error details, if provided.\r\n     * @param {PropertyCollection} properties - Additional properties, if provided.\r\n     */\r\n    constructor(resultId?: string, reason?: ResultReason,  audioData?: ArrayBuffer,\r\n                errorDetails?: string, properties?: PropertyCollection) {\r\n        this.privResultId = resultId;\r\n        this.privReason = reason;\r\n        this.privAudioData = audioData;\r\n        this.privErrorDetails = errorDetails;\r\n        this.privProperties = properties;\r\n    }\r\n\r\n    /**\r\n     * Specifies the result identifier.\r\n     * @member SpeechSynthesisResult.prototype.resultId\r\n     * @function\r\n     * @public\r\n     * @returns {string} Specifies the result identifier.\r\n     */\r\n    public get resultId(): string {\r\n        return this.privResultId;\r\n    }\r\n\r\n    /**\r\n     * Specifies status of the result.\r\n     * @member SpeechSynthesisResult.prototype.reason\r\n     * @function\r\n     * @public\r\n     * @returns {ResultReason} Specifies status of the result.\r\n     */\r\n    public get reason(): ResultReason {\r\n        return this.privReason;\r\n    }\r\n\r\n    /**\r\n     * The synthesized audio data\r\n     * @member SpeechSynthesisResult.prototype.audioData\r\n     * @function\r\n     * @public\r\n     * @returns {ArrayBuffer} The synthesized audio data.\r\n     */\r\n    public get audioData(): ArrayBuffer {\r\n        return this.privAudioData;\r\n    }\r\n\r\n    /**\r\n     * In case of an unsuccessful synthesis, provides details of the occurred error.\r\n     * @member SpeechSynthesisResult.prototype.errorDetails\r\n     * @function\r\n     * @public\r\n     * @returns {string} a brief description of an error.\r\n     */\r\n    public get errorDetails(): string {\r\n        return this.privErrorDetails;\r\n    }\r\n\r\n    /**\r\n     *  The set of properties exposed in the result.\r\n     * @member SpeechSynthesisResult.prototype.properties\r\n     * @function\r\n     * @public\r\n     * @returns {PropertyCollection} The set of properties exposed in the result.\r\n     */\r\n    public get properties(): PropertyCollection {\r\n        return this.privProperties;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines contents of speech synthesis word boundary event.\r\n * @class SpeechSynthesisWordBoundaryEventArgs\r\n * Added in version 1.11.0\r\n */\r\nexport class SpeechSynthesisWordBoundaryEventArgs {\r\n    private privAudioOffset: number;\r\n    private privText: string;\r\n    private privWordLength: number;\r\n    private privTextOffset: number;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {number} audioOffset - The audio offset.\r\n     * @param {string} text - The text.\r\n     * @param {number} wordLength - The length of the word.\r\n     * @param {number} textOffset - The text offset.\r\n     */\r\n    public constructor(audioOffset: number, text: string, wordLength: number, textOffset: number) {\r\n        this.privAudioOffset = audioOffset;\r\n        this.privText = text;\r\n        this.privWordLength = wordLength;\r\n        this.privTextOffset = textOffset;\r\n    }\r\n\r\n    /**\r\n     * Specifies the audio offset.\r\n     * @member SpeechSynthesisWordBoundaryEventArgs.prototype.audioOffset\r\n     * @function\r\n     * @public\r\n     * @returns {number} the audio offset.\r\n     */\r\n    public get audioOffset(): number {\r\n        return this.privAudioOffset;\r\n    }\r\n\r\n    /**\r\n     * Specifies the text of the word boundary event.\r\n     * @member SpeechSynthesisWordBoundaryEventArgs.prototype.text\r\n     * @function\r\n     * @public\r\n     * @returns {string} the text.\r\n     */\r\n    public get text(): string {\r\n        return this.privText;\r\n    }\r\n\r\n    /**\r\n     * Specifies the word length\r\n     * @member SpeechSynthesisWordBoundaryEventArgs.prototype.wordLength\r\n     * @function\r\n     * @public\r\n     * @returns {number} the word length\r\n     */\r\n    public get wordLength(): number {\r\n        return this.privWordLength;\r\n    }\r\n\r\n    /**\r\n     * Specifies the text offset.\r\n     * @member SpeechSynthesisWordBoundaryEventArgs.prototype.textOffset\r\n     * @function\r\n     * @public\r\n     * @returns {number} the text offset.\r\n     */\r\n    public get textOffset(): number {\r\n        return this.privTextOffset;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines contents of speech synthesis bookmark event.\r\n * @class SpeechSynthesisBookmarkEventArgs\r\n * Added in version 1.16.0\r\n */\r\nexport class SpeechSynthesisBookmarkEventArgs {\r\n    private privAudioOffset: number;\r\n    private privText: string;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {number} audioOffset - The audio offset.\r\n     * @param {string} text - The bookmark text.\r\n     */\r\n    public constructor(audioOffset: number, text: string) {\r\n        this.privAudioOffset = audioOffset;\r\n        this.privText = text;\r\n    }\r\n\r\n    /**\r\n     * Specifies the audio offset.\r\n     * @member SpeechSynthesisBookmarkEventArgs.prototype.audioOffset\r\n     * @function\r\n     * @public\r\n     * @returns {number} the audio offset.\r\n     */\r\n    public get audioOffset(): number {\r\n        return this.privAudioOffset;\r\n    }\r\n\r\n    /**\r\n     * Specifies the bookmark.\r\n     * @member SpeechSynthesisBookmarkEventArgs.prototype.text\r\n     * @function\r\n     * @public\r\n     * @returns {string} the bookmark text.\r\n     */\r\n    public get text(): string {\r\n        return this.privText;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines contents of speech synthesis viseme event.\r\n * @class SpeechSynthesisVisemeEventArgs\r\n * Added in version 1.16.0\r\n */\r\nexport class SpeechSynthesisVisemeEventArgs {\r\n    private privAudioOffset: number;\r\n    private privVisemeId: number;\r\n    private privAnimation: string;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {number} audioOffset - The audio offset.\r\n     * @param {number} visemeId - The viseme ID.\r\n     * @param {string} animation - The animation, could be in svg or other format.\r\n     */\r\n    public constructor(audioOffset: number, visemeId: number, animation: string) {\r\n        this.privAudioOffset = audioOffset;\r\n        this.privVisemeId = visemeId;\r\n        this.privAnimation = animation;\r\n    }\r\n\r\n    /**\r\n     * Specifies the audio offset.\r\n     * @member SpeechSynthesisVisemeEventArgs.prototype.audioOffset\r\n     * @function\r\n     * @public\r\n     * @returns {number} the audio offset.\r\n     */\r\n    public get audioOffset(): number {\r\n        return this.privAudioOffset;\r\n    }\r\n\r\n    /**\r\n     * Specifies the viseme ID.\r\n     * @member SpeechSynthesisVisemeEventArgs.prototype.visemeId\r\n     * @function\r\n     * @public\r\n     * @returns {number} the viseme ID.\r\n     */\r\n    public get visemeId(): number {\r\n        return this.privVisemeId;\r\n    }\r\n\r\n    /**\r\n     * Specifies the animation.\r\n     * @member SpeechSynthesisVisemeEventArgs.prototype.animation\r\n     * @function\r\n     * @public\r\n     * @returns {string} the animation, could be in svg or other format.\r\n     */\r\n    public get animation(): string {\r\n        return this.privAnimation;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ArgumentNullError,\r\n    ConnectionClosedEvent,\r\n    ConnectionEvent,\r\n    ConnectionMessage,\r\n    ConnectionState,\r\n    createNoDashGuid,\r\n    EventSource,\r\n    IAudioDestination,\r\n    IConnection,\r\n    IDisposable,\r\n    MessageType,\r\n    ServiceEvent,\r\n} from \"../common/Exports\";\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\r\nimport {\r\n    CancellationErrorCode,\r\n    CancellationReason,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    ResultReason,\r\n    SpeechSynthesisBookmarkEventArgs,\r\n    SpeechSynthesisEventArgs,\r\n    SpeechSynthesisResult,\r\n    SpeechSynthesisVisemeEventArgs,\r\n    SpeechSynthesisWordBoundaryEventArgs,\r\n    SpeechSynthesizer,\r\n} from \"../sdk/Exports\";\r\nimport {\r\n    AgentConfig,\r\n    CancellationErrorCodePropertyName,\r\n    ISynthesisConnectionFactory,\r\n    MetadataType,\r\n    SynthesisAudioMetadata,\r\n    SynthesisContext,\r\n    SynthesisTurn,\r\n    SynthesizerConfig\r\n} from \"./Exports\";\r\nimport { AuthInfo, IAuthentication } from \"./IAuthentication\";\r\nimport { SpeechConnectionMessage } from \"./SpeechConnectionMessage.Internal\";\r\n\r\nexport class SynthesisAdapterBase implements IDisposable {\r\n    protected privSynthesisTurn: SynthesisTurn;\r\n    protected privConnectionId: string;\r\n    protected privSynthesizerConfig: SynthesizerConfig;\r\n    protected privSpeechSynthesizer: SpeechSynthesizer;\r\n    protected privSuccessCallback: (e: SpeechSynthesisResult) => void;\r\n    protected privErrorCallback: (e: string) => void;\r\n\r\n    public get synthesisContext(): SynthesisContext {\r\n        return this.privSynthesisContext;\r\n    }\r\n\r\n    public get agentConfig(): AgentConfig {\r\n        return this.privAgentConfig;\r\n    }\r\n\r\n    public get connectionEvents(): EventSource<ConnectionEvent> {\r\n        return this.privConnectionEvents;\r\n    }\r\n\r\n    public get serviceEvents(): EventSource<ServiceEvent> {\r\n        return this.privServiceEvents;\r\n    }\r\n\r\n    protected speakOverride: (ssml: string, requestId: string, sc: (e: SpeechSynthesisResult) => void, ec: (e: string) => void) => any = undefined;\r\n\r\n    // Called when telemetry data is sent to the service.\r\n    // Used for testing Telemetry capture.\r\n    public static telemetryData: (json: string) => void;\r\n    public static telemetryDataEnabled: boolean = true;\r\n\r\n    public set activityTemplate(messagePayload: string) { this.privActivityTemplate = messagePayload; }\r\n    public get activityTemplate(): string { return this.privActivityTemplate; }\r\n\r\n    protected receiveMessageOverride: () => any = undefined;\r\n\r\n    protected connectImplOverride: (isUnAuthorized: boolean) => any = undefined;\r\n\r\n    protected configConnectionOverride: (connection: IConnection) => any = undefined;\r\n\r\n    public set audioOutputFormat(format: AudioOutputFormatImpl) {\r\n        this.privAudioOutputFormat = format;\r\n        this.privSynthesisTurn.audioOutputFormat = format;\r\n        if (this.privSessionAudioDestination !== undefined) {\r\n            this.privSessionAudioDestination.format = format;\r\n        }\r\n        if (this.synthesisContext !== undefined) {\r\n            this.synthesisContext.audioOutputFormat = format;\r\n        }\r\n    }\r\n    private privAuthentication: IAuthentication;\r\n    private privConnectionFactory: ISynthesisConnectionFactory;\r\n\r\n    // A promise for a configured connection.\r\n    // Do not consume directly, call fetchConnection instead.\r\n    private privConnectionConfigurationPromise: Promise<IConnection>;\r\n\r\n    // A promise for a connection, but one that has not had the speech context sent yet.\r\n    // Do not consume directly, call fetchConnection instead.\r\n    private privConnectionPromise: Promise<IConnection>;\r\n    private privAuthFetchEventId: string;\r\n    private privIsDisposed: boolean;\r\n    private privConnectionEvents: EventSource<ConnectionEvent>;\r\n    private privServiceEvents: EventSource<ServiceEvent>;\r\n    private privSynthesisContext: SynthesisContext;\r\n    private privAgentConfig: AgentConfig;\r\n    private privServiceHasSentMessage: boolean;\r\n    private privActivityTemplate: string;\r\n    private privAudioOutputFormat: AudioOutputFormatImpl;\r\n    private privSessionAudioDestination: IAudioDestination;\r\n\r\n    public constructor(\r\n        authentication: IAuthentication,\r\n        connectionFactory: ISynthesisConnectionFactory,\r\n        synthesizerConfig: SynthesizerConfig,\r\n        speechSynthesizer: SpeechSynthesizer,\r\n        audioDestination: IAudioDestination) {\r\n\r\n        if (!authentication) {\r\n            throw new ArgumentNullError(\"authentication\");\r\n        }\r\n\r\n        if (!connectionFactory) {\r\n            throw new ArgumentNullError(\"connectionFactory\");\r\n        }\r\n\r\n        if (!synthesizerConfig) {\r\n            throw new ArgumentNullError(\"synthesizerConfig\");\r\n        }\r\n\r\n        this.privAuthentication = authentication;\r\n        this.privConnectionFactory = connectionFactory;\r\n        this.privSynthesizerConfig = synthesizerConfig;\r\n        this.privIsDisposed = false;\r\n        this.privSpeechSynthesizer = speechSynthesizer;\r\n        this.privSessionAudioDestination = audioDestination;\r\n        this.privSynthesisTurn = new SynthesisTurn();\r\n        this.privConnectionEvents = new EventSource<ConnectionEvent>();\r\n        this.privServiceEvents = new EventSource<ServiceEvent>();\r\n        this.privSynthesisContext = new SynthesisContext(this.privSpeechSynthesizer);\r\n        this.privAgentConfig = new AgentConfig();\r\n\r\n        this.connectionEvents.attach((connectionEvent: ConnectionEvent): void => {\r\n            if (connectionEvent.name === \"ConnectionClosedEvent\") {\r\n                const connectionClosedEvent = connectionEvent as ConnectionClosedEvent;\r\n                if (connectionClosedEvent.statusCode !== 1000) {\r\n                    this.cancelSynthesisLocal(CancellationReason.Error,\r\n                        connectionClosedEvent.statusCode === 1007 ? CancellationErrorCode.BadRequestParameters : CancellationErrorCode.ConnectionFailure,\r\n                        connectionClosedEvent.reason + \" websocket error code: \" + connectionClosedEvent.statusCode);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public static addHeader(audio: ArrayBuffer, format: AudioOutputFormatImpl): ArrayBuffer {\r\n        if (!format.hasHeader) {\r\n            return audio;\r\n        }\r\n        format.updateHeader(audio.byteLength);\r\n        const tmp = new Uint8Array(audio.byteLength + format.header.byteLength);\r\n        tmp.set(new Uint8Array(format.header), 0);\r\n        tmp.set(new Uint8Array(audio), format.header.byteLength);\r\n        return tmp.buffer;\r\n    }\r\n\r\n    public isDisposed(): boolean {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    public async dispose(reason?: string): Promise<void> {\r\n        this.privIsDisposed = true;\r\n        if (this.privSessionAudioDestination !== undefined) {\r\n            this.privSessionAudioDestination.close();\r\n        }\r\n        if (this.privConnectionConfigurationPromise) {\r\n            const connection: IConnection = await this.privConnectionConfigurationPromise;\r\n            await connection.dispose(reason);\r\n        }\r\n    }\r\n\r\n    public async connect(): Promise<void> {\r\n        await this.connectImpl();\r\n    }\r\n\r\n    public async sendNetworkMessage(path: string, payload: string | ArrayBuffer): Promise<void> {\r\n        const type: MessageType = typeof payload === \"string\" ? MessageType.Text : MessageType.Binary;\r\n        const contentType: string = typeof payload === \"string\" ? \"application/json\" : \"\";\r\n\r\n        const connection: IConnection = await this.fetchConnection();\r\n        return connection.send(new SpeechConnectionMessage(type, path, this.privSynthesisTurn.requestId, contentType, payload));\r\n    }\r\n\r\n    public async Speak(\r\n        text: string,\r\n        isSSML: boolean,\r\n        requestId: string,\r\n        successCallback: (e: SpeechSynthesisResult) => void,\r\n        errorCallBack: (e: string) => void,\r\n        audioDestination: IAudioDestination,\r\n    ): Promise<void> {\r\n\r\n        let ssml: string;\r\n\r\n        if (isSSML) {\r\n            ssml = text;\r\n        } else {\r\n            ssml = this.privSpeechSynthesizer.buildSsml(text);\r\n        }\r\n\r\n        if (this.speakOverride !== undefined) {\r\n            return this.speakOverride(ssml, requestId, successCallback, errorCallBack);\r\n        }\r\n\r\n        this.privSuccessCallback = successCallback;\r\n        this.privErrorCallback = errorCallBack;\r\n\r\n        this.privSynthesisTurn.startNewSynthesis(requestId, text, isSSML, audioDestination);\r\n\r\n        try {\r\n            await this.connectImpl();\r\n            const connection: IConnection = await this.fetchConnection();\r\n            await this.sendSynthesisContext(connection);\r\n            await this.sendSsmlMessage(connection, ssml, requestId);\r\n            const synthesisStartEventArgs: SpeechSynthesisEventArgs = new SpeechSynthesisEventArgs(\r\n                new SpeechSynthesisResult(\r\n                    requestId,\r\n                    ResultReason.SynthesizingAudioStarted,\r\n                )\r\n            );\r\n\r\n            if (!!this.privSpeechSynthesizer.synthesisStarted) {\r\n                this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer, synthesisStartEventArgs);\r\n            }\r\n\r\n            const messageRetrievalPromise = this.receiveMessage();\r\n        } catch (e) {\r\n            this.cancelSynthesisLocal(CancellationReason.Error, CancellationErrorCode.ConnectionFailure, e);\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n\r\n    // Cancels synthesis.\r\n    protected cancelSynthesis(\r\n        requestId: string,\r\n        cancellationReason: CancellationReason,\r\n        errorCode: CancellationErrorCode,\r\n        error: string): void {\r\n        const properties: PropertyCollection = new PropertyCollection();\r\n        properties.setProperty(CancellationErrorCodePropertyName, CancellationErrorCode[errorCode]);\r\n        const result: SpeechSynthesisResult = new SpeechSynthesisResult(\r\n            requestId,\r\n            ResultReason.Canceled,\r\n            undefined,\r\n            error,\r\n            properties\r\n        );\r\n\r\n        if (!!this.privSpeechSynthesizer.SynthesisCanceled) {\r\n            const cancelEvent: SpeechSynthesisEventArgs = new SpeechSynthesisEventArgs(result);\r\n            try {\r\n                this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer, cancelEvent);\r\n                /* tslint:disable:no-empty */\r\n            } catch { }\r\n        }\r\n\r\n        if (!!this.privSuccessCallback) {\r\n            try {\r\n                this.privSuccessCallback(result);\r\n                /* tslint:disable:no-empty */\r\n            } catch { }\r\n        }\r\n    }\r\n\r\n    // Cancels synthesis.\r\n    protected cancelSynthesisLocal(\r\n        cancellationReason: CancellationReason,\r\n        errorCode: CancellationErrorCode,\r\n        error: string): void {\r\n\r\n        if (!!this.privSynthesisTurn.isSynthesizing) {\r\n            this.privSynthesisTurn.onStopSynthesizing();\r\n\r\n            this.cancelSynthesis(\r\n                this.privSynthesisTurn.requestId,\r\n                cancellationReason,\r\n                errorCode,\r\n                error);\r\n        }\r\n    }\r\n\r\n    protected processTypeSpecificMessages(\r\n        connectionMessage: SpeechConnectionMessage,\r\n        successCallback?: (e: SpeechSynthesisResult) => void,\r\n        errorCallBack?: (e: string) => void): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected async receiveMessage(): Promise<void> {\r\n        try {\r\n            const connection: IConnection = await this.fetchConnection();\r\n            const message: ConnectionMessage = await connection.read();\r\n\r\n            if (this.receiveMessageOverride !== undefined) {\r\n                return this.receiveMessageOverride();\r\n            }\r\n            if (this.privIsDisposed) {\r\n                // We're done.\r\n                return;\r\n            }\r\n\r\n            // indicates we are draining the queue and it came with no message;\r\n            if (!message) {\r\n                if (!this.privSynthesisTurn.isSynthesizing) {\r\n                    return;\r\n                } else {\r\n                    return this.receiveMessage();\r\n                }\r\n            }\r\n\r\n            this.privServiceHasSentMessage = true;\r\n\r\n            const connectionMessage = SpeechConnectionMessage.fromConnectionMessage(message);\r\n\r\n            if (connectionMessage.requestId.toLowerCase() === this.privSynthesisTurn.requestId.toLowerCase()) {\r\n                switch (connectionMessage.path.toLowerCase()) {\r\n                    case \"turn.start\":\r\n                        this.privSynthesisTurn.onServiceTurnStartResponse();\r\n                        break;\r\n                    case \"response\":\r\n                        this.privSynthesisTurn.onServiceResponseMessage(connectionMessage.textBody);\r\n                        break;\r\n                    case \"audio\":\r\n                        if (this.privSynthesisTurn.streamId.toLowerCase() === connectionMessage.streamId.toLowerCase()\r\n                            && !!connectionMessage.binaryBody) {\r\n                            this.privSynthesisTurn.onAudioChunkReceived(connectionMessage.binaryBody);\r\n                            if (!!this.privSpeechSynthesizer.synthesizing) {\r\n                                try {\r\n                                    const audioWithHeader = SynthesisAdapterBase.addHeader(connectionMessage.binaryBody, this.privSynthesisTurn.audioOutputFormat);\r\n                                    const ev: SpeechSynthesisEventArgs = new SpeechSynthesisEventArgs(\r\n                                        new SpeechSynthesisResult(\r\n                                            this.privSynthesisTurn.requestId,\r\n                                            ResultReason.SynthesizingAudio,\r\n                                            audioWithHeader));\r\n                                    this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer, ev);\r\n                                } catch (error) {\r\n                                    // Not going to let errors in the event handler\r\n                                    // trip things up.\r\n                                }\r\n                            }\r\n                            if (this.privSessionAudioDestination !== undefined) {\r\n                                this.privSessionAudioDestination.write(connectionMessage.binaryBody);\r\n                            }\r\n                        }\r\n                        break;\r\n                    case \"audio.metadata\":\r\n                        const metadataList = SynthesisAudioMetadata.fromJSON(connectionMessage.textBody).Metadata;\r\n                        for (const metadata of metadataList) {\r\n                            switch (metadata.Type) {\r\n                                case MetadataType.WordBoundary:\r\n                                    this.privSynthesisTurn.onWordBoundaryEvent(metadata.Data.text.Text);\r\n\r\n                                    const wordBoundaryEventArgs: SpeechSynthesisWordBoundaryEventArgs = new SpeechSynthesisWordBoundaryEventArgs(\r\n                                        metadata.Data.Offset,\r\n                                        metadata.Data.text.Text,\r\n                                        metadata.Data.text.Length,\r\n                                        this.privSynthesisTurn.currentTextOffset);\r\n\r\n                                    if (!!this.privSpeechSynthesizer.wordBoundary) {\r\n                                        try {\r\n                                            this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer, wordBoundaryEventArgs);\r\n                                        } catch (error) {\r\n                                            // Not going to let errors in the event handler\r\n                                            // trip things up.\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                case MetadataType.Bookmark:\r\n                                    const bookmarkEventArgs: SpeechSynthesisBookmarkEventArgs = new SpeechSynthesisBookmarkEventArgs(\r\n                                        metadata.Data.Offset,\r\n                                        metadata.Data.Bookmark);\r\n\r\n                                    if (!!this.privSpeechSynthesizer.bookmarkReached) {\r\n                                        try {\r\n                                            this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer, bookmarkEventArgs);\r\n                                        } catch (error) {\r\n                                            // Not going to let errors in the event handler\r\n                                            // trip things up.\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                                case MetadataType.Viseme:\r\n\r\n                                    this.privSynthesisTurn.onVisemeMetadataReceived(metadata);\r\n\r\n                                    if (metadata.Data.IsLastAnimation) {\r\n                                        const visemeEventArgs: SpeechSynthesisVisemeEventArgs = new SpeechSynthesisVisemeEventArgs(\r\n                                            metadata.Data.Offset,\r\n                                            metadata.Data.VisemeId,\r\n                                            this.privSynthesisTurn.getAndClearVisemeAnimation());\r\n\r\n                                        if (!!this.privSpeechSynthesizer.visemeReceived) {\r\n                                            try {\r\n                                                this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer, visemeEventArgs);\r\n                                            } catch (error) {\r\n                                                // Not going to let errors in the event handler\r\n                                                // trip things up.\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    break;\r\n                            }\r\n                        }\r\n                        break;\r\n                    case \"turn.end\":\r\n                        this.privSynthesisTurn.onServiceTurnEndResponse();\r\n                        let result: SpeechSynthesisResult;\r\n                        try {\r\n                            const audioBuffer: ArrayBuffer = await this.privSynthesisTurn.getAllReceivedAudioWithHeader();\r\n                            result = new SpeechSynthesisResult(\r\n                                this.privSynthesisTurn.requestId,\r\n                                ResultReason.SynthesizingAudioCompleted,\r\n                                audioBuffer\r\n                            );\r\n                            if (!!this.privSuccessCallback) {\r\n                                this.privSuccessCallback(result);\r\n                            }\r\n                        } catch (error) {\r\n                            if (!!this.privErrorCallback) {\r\n                                this.privErrorCallback(error);\r\n                            }\r\n                        }\r\n                        if (this.privSpeechSynthesizer.synthesisCompleted) {\r\n                            try {\r\n                                this.privSpeechSynthesizer.synthesisCompleted(\r\n                                    this.privSpeechSynthesizer,\r\n                                    new SpeechSynthesisEventArgs(result)\r\n                                );\r\n                            } catch (e) {\r\n                                // Not going to let errors in the event handler\r\n                                // trip things up.\r\n                            }\r\n                        }\r\n                        break;\r\n\r\n                    default:\r\n\r\n                        if (!this.processTypeSpecificMessages(connectionMessage)) {\r\n                            // here are some messages that the derived class has not processed, dispatch them to connect class\r\n                            if (!!this.privServiceEvents) {\r\n                                this.serviceEvents.onEvent(new ServiceEvent(connectionMessage.path.toLowerCase(), connectionMessage.textBody));\r\n                            }\r\n                        }\r\n\r\n                }\r\n            }\r\n\r\n            return this.receiveMessage();\r\n\r\n        } catch (e) {\r\n            // TODO: What goes here?\r\n        }\r\n    }\r\n\r\n    protected sendSynthesisContext = (connection: IConnection): Promise<void> => {\r\n        const synthesisContextJson = this.synthesisContext.toJSON();\r\n\r\n        if (synthesisContextJson) {\r\n            return connection.send(new SpeechConnectionMessage(\r\n                MessageType.Text,\r\n                \"synthesis.context\",\r\n                this.privSynthesisTurn.requestId,\r\n                \"application/json\",\r\n                synthesisContextJson));\r\n        }\r\n        return;\r\n    }\r\n\r\n    protected connectImpl(isUnAuthorized: boolean = false): Promise<IConnection> {\r\n        if (this.privConnectionPromise) {\r\n            return this.privConnectionPromise.then((connection: IConnection): Promise<IConnection> => {\r\n                if (connection.state() === ConnectionState.Disconnected) {\r\n                    this.privConnectionId = null;\r\n                    this.privConnectionPromise = null;\r\n                    this.privServiceHasSentMessage = false;\r\n                    return this.connectImpl();\r\n                }\r\n                return this.privConnectionPromise;\r\n            }, (error: string): Promise<IConnection> => {\r\n                this.privConnectionId = null;\r\n                this.privConnectionPromise = null;\r\n                this.privServiceHasSentMessage = false;\r\n                return this.connectImpl();\r\n            });\r\n        }\r\n        this.privAuthFetchEventId = createNoDashGuid();\r\n        this.privConnectionId = createNoDashGuid();\r\n\r\n        this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId, this.privConnectionId);\r\n\r\n        const authPromise = isUnAuthorized ? this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId) : this.privAuthentication.fetch(this.privAuthFetchEventId);\r\n\r\n        this.privConnectionPromise = authPromise.then(async (result: AuthInfo) => {\r\n            await this.privSynthesisTurn.onAuthCompleted(false);\r\n\r\n            const connection: IConnection = this.privConnectionFactory.create(this.privSynthesizerConfig, result, this.privConnectionId);\r\n\r\n            // Attach to the underlying event. No need to hold onto the detach pointers as in the event the connection goes away,\r\n            // it'll stop sending events.\r\n            connection.events.attach((event: ConnectionEvent) => {\r\n                this.connectionEvents.onEvent(event);\r\n            });\r\n            const response = await connection.open();\r\n            if (response.statusCode === 200) {\r\n                await this.privSynthesisTurn.onConnectionEstablishCompleted(response.statusCode);\r\n                return Promise.resolve(connection);\r\n            } else if (response.statusCode === 403 && !isUnAuthorized) {\r\n                return this.connectImpl(true);\r\n            } else {\r\n                await this.privSynthesisTurn.onConnectionEstablishCompleted(response.statusCode, response.reason);\r\n                return Promise.reject(`Unable to contact server. StatusCode: ${response.statusCode}, ${this.privSynthesizerConfig.parameters.getProperty(PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${response.reason}`);\r\n            }\r\n        }, async (error: string): Promise<IConnection> => {\r\n            await this.privSynthesisTurn.onAuthCompleted(true, error);\r\n            throw new Error(error);\r\n        });\r\n\r\n        // Attach an empty handler to allow the promise to run in the background while\r\n        // other startup events happen. It'll eventually be awaited on.\r\n        this.privConnectionPromise.catch(() => { });\r\n\r\n        return this.privConnectionPromise;\r\n    }\r\n    protected sendSpeechServiceConfig = (connection: IConnection, SpeechServiceConfigJson: string): Promise<void> => {\r\n        if (SpeechServiceConfigJson) {\r\n            return connection.send(new SpeechConnectionMessage(\r\n                MessageType.Text,\r\n                \"speech.config\",\r\n                this.privSynthesisTurn.requestId,\r\n                \"application/json\",\r\n                SpeechServiceConfigJson));\r\n        }\r\n    }\r\n\r\n    protected sendSsmlMessage = (connection: IConnection, ssml: string, requestId: string): Promise<void> => {\r\n        return connection.send(new SpeechConnectionMessage(\r\n            MessageType.Text,\r\n            \"ssml\",\r\n            requestId,\r\n            \"application/ssml+xml\",\r\n            ssml));\r\n    }\r\n\r\n    private async fetchConnection(): Promise<IConnection> {\r\n        if (this.privConnectionConfigurationPromise) {\r\n            return this.privConnectionConfigurationPromise.then((connection: IConnection): Promise<IConnection> => {\r\n                if (connection.state() === ConnectionState.Disconnected) {\r\n                    this.privConnectionId = null;\r\n                    this.privConnectionConfigurationPromise = null;\r\n                    this.privServiceHasSentMessage = false;\r\n                    return this.fetchConnection();\r\n                }\r\n                return this.privConnectionConfigurationPromise;\r\n            }, (error: string): Promise<IConnection> => {\r\n                this.privConnectionId = null;\r\n                this.privConnectionConfigurationPromise = null;\r\n                this.privServiceHasSentMessage = false;\r\n                return this.fetchConnection();\r\n            });\r\n        }\r\n        this.privConnectionConfigurationPromise = this.configureConnection();\r\n        return await this.privConnectionConfigurationPromise;\r\n    }\r\n\r\n    // Takes an established websocket connection to the endpoint and sends speech configuration information.\r\n    private async configureConnection(): Promise<IConnection> {\r\n        const connection: IConnection = await this.connectImpl();\r\n        if (this.configConnectionOverride !== undefined) {\r\n            return this.configConnectionOverride(connection);\r\n        }\r\n        await this.sendSpeechServiceConfig(connection, this.privSynthesizerConfig.SpeechServiceConfig.serialize());\r\n        return connection;\r\n    }\r\n}\r\n","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]\n  ]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { PropertyCollection, PropertyId } from \"../sdk/Exports\";\r\n\r\nexport enum RecognitionMode {\r\n    Interactive,\r\n    Conversation,\r\n    Dictation,\r\n}\r\n\r\nexport enum SpeechResultFormat {\r\n    Simple,\r\n    Detailed,\r\n}\r\n\r\nexport class RecognizerConfig {\r\n    private privRecognitionMode: RecognitionMode = RecognitionMode.Interactive;\r\n    private privSpeechServiceConfig: SpeechServiceConfig;\r\n    private privRecognitionActivityTimeout: number;\r\n    private privParameters: PropertyCollection;\r\n\r\n    constructor(\r\n        speechServiceConfig: SpeechServiceConfig,\r\n        parameters: PropertyCollection) {\r\n        this.privSpeechServiceConfig = speechServiceConfig ? speechServiceConfig : new SpeechServiceConfig(new Context(null));\r\n        this.privParameters = parameters;\r\n    }\r\n\r\n    public get parameters(): PropertyCollection {\r\n        return this.privParameters;\r\n    }\r\n\r\n    public get recognitionMode(): RecognitionMode {\r\n        return this.privRecognitionMode;\r\n    }\r\n\r\n    public set recognitionMode(value: RecognitionMode) {\r\n        this.privRecognitionMode = value;\r\n        this.privRecognitionActivityTimeout = value === RecognitionMode.Interactive ? 8000 : 25000;\r\n        this.privSpeechServiceConfig.Recognition = RecognitionMode[value];\r\n    }\r\n\r\n    public get SpeechServiceConfig(): SpeechServiceConfig {\r\n        return this.privSpeechServiceConfig;\r\n    }\r\n\r\n    public get recognitionActivityTimeout(): number {\r\n        return this.privRecognitionActivityTimeout;\r\n    }\r\n\r\n    public get isContinuousRecognition(): boolean {\r\n        return this.privRecognitionMode !== RecognitionMode.Interactive;\r\n    }\r\n\r\n    public get autoDetectSourceLanguages(): string {\r\n        return this.parameters.getProperty(PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages, undefined);\r\n    }\r\n}\r\n\r\n// The config is serialized and sent as the Speech.Config\r\nexport class SpeechServiceConfig {\r\n    private context: Context;\r\n    private recognition: string;\r\n\r\n    constructor(context: Context) {\r\n        this.context = context;\r\n    }\r\n\r\n    public serialize = (): string => {\r\n        return JSON.stringify(this, (key: any, value: any): any => {\r\n            if (value && typeof value === \"object\") {\r\n                const replacement: any = {};\r\n                for (const k in value) {\r\n                    if (Object.hasOwnProperty.call(value, k)) {\r\n                        replacement[k && k.charAt(0).toLowerCase() + k.substring(1)] = value[k];\r\n                    }\r\n                }\r\n                return replacement;\r\n            }\r\n            return value;\r\n        });\r\n    }\r\n\r\n    public get Context(): Context {\r\n        return this.context;\r\n    }\r\n\r\n    public get Recognition(): string {\r\n        return this.recognition;\r\n    }\r\n\r\n    public set Recognition(value: string) {\r\n        this.recognition = value.toLowerCase();\r\n    }\r\n}\r\n\r\nexport class Context {\r\n    public system: System;\r\n    public os: OS;\r\n    public audio: ISpeechConfigAudio;\r\n\r\n    constructor(os: OS) {\r\n        this.system = new System();\r\n        this.os = os;\r\n    }\r\n}\r\n\r\nexport class System {\r\n    public name: string;\r\n    public version: string;\r\n    public build: string;\r\n    public lang: string;\r\n\r\n    constructor() {\r\n        // Note: below will be patched for official builds.\r\n        const SPEECHSDK_CLIENTSDK_VERSION = \"1.16.0\";\r\n\r\n        this.name = \"SpeechSDK\";\r\n        this.version = SPEECHSDK_CLIENTSDK_VERSION;\r\n        this.build = \"JavaScript\";\r\n        this.lang = \"JavaScript\";\r\n    }\r\n}\r\n\r\nexport class OS {\r\n    public platform: string;\r\n    public name: string;\r\n    public version: string;\r\n\r\n    constructor(platform: string, name: string, version: string) {\r\n        this.platform = platform;\r\n        this.name = name;\r\n        this.version = version;\r\n    }\r\n}\r\n\r\nexport class Device {\r\n    public manufacturer: string;\r\n    public model: string;\r\n    public version: string;\r\n\r\n    constructor(manufacturer: string, model: string, version: string) {\r\n        this.manufacturer = manufacturer;\r\n        this.model = model;\r\n        this.version = version;\r\n    }\r\n}\r\n\r\nexport interface ISpeechConfigAudio {\r\n    source?: ISpeechConfigAudioDevice;\r\n    playback?: ISpeechConfigAudioDevice;\r\n}\r\n\r\nexport interface ISpeechConfigAudioDevice {\r\n    manufacturer: string;\r\n    model: string;\r\n    connectivity: connectivity;\r\n    type: type;\r\n    samplerate: number;\r\n    bitspersample: number;\r\n    channelcount: number;\r\n}\r\n\r\nexport enum connectivity {\r\n    Bluetooth = \"Bluetooth\",\r\n    Wired = \"Wired\",\r\n    WiFi = \"WiFi\",\r\n    Cellular = \"Cellular\",\r\n    InBuilt = \"InBuilt\",\r\n    Unknown = \"Unknown\",\r\n}\r\n\r\nexport enum type {\r\n    Phone = \"Phone\",\r\n    Speaker = \"Speaker\",\r\n    Car = \"Car\",\r\n    Headset = \"Headset\",\r\n    Thermostat = \"Thermostat\",\r\n    Microphones = \"Microphones\",\r\n    Deskphone = \"Deskphone\",\r\n    RemoteControl = \"RemoteControl\",\r\n    Unknown = \"Unknown\",\r\n    File = \"File\",\r\n    Stream = \"Stream\",\r\n}\r\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { INumberDictionary } from \"../../common/Exports\";\r\nimport { SpeechSynthesisOutputFormat } from \"../SpeechSynthesisOutputFormat\";\r\nimport { AudioStreamFormatImpl } from \"./AudioStreamFormat\";\r\n\r\nexport enum AudioFormatTag {\r\n    PCM = 1,\r\n    MuLaw,\r\n    Siren,\r\n    MP3,\r\n    SILKSkype,\r\n    OGG_OPUS,\r\n    WEBM_OPUS,\r\n}\r\n\r\n/**\r\n * @private\r\n * @class AudioOutputFormatImpl\r\n * Updated in version 1.16.0\r\n */\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class AudioOutputFormatImpl extends AudioStreamFormatImpl {\r\n    public static SpeechSynthesisOutputFormatToString: INumberDictionary<string> = {\r\n        [SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]: \"raw-8khz-8bit-mono-mulaw\",\r\n        [SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]: \"riff-16khz-16kbps-mono-siren\",\r\n        [SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]: \"audio-16khz-16kbps-mono-siren\",\r\n        [SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]: \"audio-16khz-32kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]: \"audio-16khz-128kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]: \"audio-16khz-64kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]: \"audio-24khz-48kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]: \"audio-24khz-96kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]: \"audio-24khz-160kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]: \"raw-16khz-16bit-mono-truesilk\",\r\n        [SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]: \"riff-16khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]: \"riff-8khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]: \"riff-24khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]: \"riff-8khz-8bit-mono-mulaw\",\r\n        [SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]: \"raw-16khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]: \"raw-24khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]: \"raw-8khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]: \"ogg-16khz-16bit-mono-opus\",\r\n        [SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]: \"ogg-24khz-16bit-mono-opus\",\r\n        [SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]: \"raw-48khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]: \"riff-48khz-16bit-mono-pcm\",\r\n        [SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]: \"audio-48khz-96kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]: \"audio-48khz-192kbitrate-mono-mp3\",\r\n        [SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]: \"ogg-48khz-16bit-mono-opus\",\r\n        [SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]: \"webm-16khz-16bit-mono-opus\",\r\n        [SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]: \"webm-24khz-16bit-mono-opus\",\r\n    };\r\n    private priAudioFormatString: string;\r\n    /**\r\n     * audio format string for synthesis request, which may differ from priAudioFormatString.\r\n     * e.g. for riff format, we will request raw format and add a header in SDK side.\r\n     */\r\n    private readonly priRequestAudioFormatString: string;\r\n    private readonly priHasHeader: boolean;\r\n\r\n    /**\r\n     * Creates an instance with the given values.\r\n     * @constructor\r\n     * @param formatTag\r\n     * @param {number} channels - Number of channels.\r\n     * @param {number} samplesPerSec - Samples per second.\r\n     * @param {number} avgBytesPerSec - Average bytes per second.\r\n     * @param {number} blockAlign - Block alignment.\r\n     * @param {number} bitsPerSample - Bits per sample.\r\n     * @param {string} audioFormatString - Audio format string\r\n     * @param {string} requestAudioFormatString - Audio format string sent to service.\r\n     * @param {boolean} hasHeader - If the format has header or not.\r\n     */\r\n    public constructor(formatTag: AudioFormatTag,\r\n                       channels: number,\r\n                       samplesPerSec: number,\r\n                       avgBytesPerSec: number,\r\n                       blockAlign: number,\r\n                       bitsPerSample: number,\r\n                       audioFormatString: string,\r\n                       requestAudioFormatString: string,\r\n                       hasHeader: boolean) {\r\n        super(samplesPerSec, bitsPerSample, channels);\r\n        this.formatTag = formatTag;\r\n        this.avgBytesPerSec = avgBytesPerSec;\r\n        this.blockAlign = blockAlign;\r\n        this.priAudioFormatString = audioFormatString;\r\n        this.priRequestAudioFormatString = requestAudioFormatString;\r\n        this.priHasHeader = hasHeader;\r\n    }\r\n\r\n    public static fromSpeechSynthesisOutputFormat(speechSynthesisOutputFormat?: SpeechSynthesisOutputFormat): AudioOutputFormatImpl {\r\n        if (speechSynthesisOutputFormat === undefined) {\r\n            return AudioOutputFormatImpl.getDefaultOutputFormat();\r\n        }\r\n        return AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(\r\n            AudioOutputFormatImpl.SpeechSynthesisOutputFormatToString[speechSynthesisOutputFormat]);\r\n    }\r\n\r\n    public static fromSpeechSynthesisOutputFormatString(speechSynthesisOutputFormatString: string): AudioOutputFormatImpl {\r\n        switch (speechSynthesisOutputFormatString) {\r\n            case \"raw-8khz-8bit-mono-mulaw\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    8000,\r\n                    8000,\r\n                    1,\r\n                    8,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"riff-16khz-16kbps-mono-siren\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.Siren,\r\n                    1,\r\n                    16000,\r\n                    2000,\r\n                    40,\r\n                    0,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"audio-16khz-16kbps-mono-siren\",\r\n                    true);\r\n            case \"audio-16khz-16kbps-mono-siren\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.Siren,\r\n                    1,\r\n                    16000,\r\n                    2000,\r\n                    40,\r\n                    0,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-16khz-32kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    16000,\r\n                    32 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-16khz-128kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    16000,\r\n                    128 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-16khz-64kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    16000,\r\n                    64 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-24khz-48kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    24000,\r\n                    48 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-24khz-96kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    24000,\r\n                    96 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-24khz-160kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    24000,\r\n                    160 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"raw-16khz-16bit-mono-truesilk\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.SILKSkype,\r\n                    1,\r\n                    16000,\r\n                    32000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n\r\n            case \"riff-8khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    8000,\r\n                    16000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-8khz-16bit-mono-pcm\",\r\n                    true);\r\n            case \"riff-24khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    24000,\r\n                    48000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-24khz-16bit-mono-pcm\",\r\n                    true);\r\n            case \"riff-8khz-8bit-mono-mulaw\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MuLaw,\r\n                    1,\r\n                    8000,\r\n                    8000,\r\n                    1,\r\n                    8,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-8khz-8bit-mono-mulaw\",\r\n                    true);\r\n            case \"raw-16khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    16000,\r\n                    32000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-16khz-16bit-mono-pcm\",\r\n                    false);\r\n            case \"raw-24khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    24000,\r\n                    48000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-24khz-16bit-mono-pcm\",\r\n                    false);\r\n            case \"raw-8khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    8000,\r\n                    16000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-8khz-16bit-mono-pcm\",\r\n                    false);\r\n            case \"ogg-16khz-16bit-mono-opus\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.OGG_OPUS,\r\n                    1,\r\n                    16000,\r\n                    8192,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"ogg-24khz-16bit-mono-opus\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.OGG_OPUS,\r\n                    1,\r\n                    24000,\r\n                    8192,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"raw-48khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    48000,\r\n                    96000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-48khz-16bit-mono-pcm\",\r\n                    false);\r\n            case \"riff-48khz-16bit-mono-pcm\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    48000,\r\n                    96000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    \"raw-48khz-16bit-mono-pcm\",\r\n                    true);\r\n            case \"audio-48khz-96kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    48000,\r\n                    96 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"audio-48khz-192kbitrate-mono-mp3\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.MP3,\r\n                    1,\r\n                    48000,\r\n                    192 << 7,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"ogg-48khz-16bit-mono-opus\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.OGG_OPUS,\r\n                    1,\r\n                    48000,\r\n                    12000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"webm-16khz-16bit-mono-opus\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.WEBM_OPUS,\r\n                    1,\r\n                    16000,\r\n                    8000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"webm-24khz-16bit-mono-opus\":\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.WEBM_OPUS,\r\n                    1,\r\n                    24000,\r\n                    8000,\r\n                    2,\r\n                    16,\r\n                    speechSynthesisOutputFormatString,\r\n                    speechSynthesisOutputFormatString,\r\n                    false);\r\n            case \"riff-16khz-16bit-mono-pcm\":\r\n            default:\r\n                return new AudioOutputFormatImpl(\r\n                    AudioFormatTag.PCM,\r\n                    1,\r\n                    16000,\r\n                    32000,\r\n                    2,\r\n                    16,\r\n                    \"riff-16khz-16bit-mono-pcm\",\r\n                    \"raw-16khz-16bit-mono-pcm\",\r\n                    true);\r\n        }\r\n    }\r\n\r\n    public static getDefaultOutputFormat(): AudioOutputFormatImpl {\r\n        return AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(\r\n            (typeof window !== \"undefined\") ? \"audio-24khz-48kbitrate-mono-mp3\" : \"riff-16khz-16bit-mono-pcm\");\r\n    }\r\n\r\n    /**\r\n     * The format tag of the audio\r\n     * @AudioFormatTag AudioOutputFormatImpl.prototype.formatTag\r\n     * @function\r\n     * @public\r\n     */\r\n    public formatTag: AudioFormatTag;\r\n\r\n    /**\r\n     * Specifies if this audio output format has a header\r\n     * @boolean AudioOutputFormatImpl.prototype.hasHeader\r\n     * @function\r\n     * @public\r\n     */\r\n    public get hasHeader(): boolean {\r\n        return this.priHasHeader;\r\n    }\r\n\r\n    /**\r\n     * Specifies the header of this format\r\n     * @ArrayBuffer AudioOutputFormatImpl.prototype.header\r\n     * @function\r\n     * @public\r\n     */\r\n    public get header(): ArrayBuffer {\r\n        if (this.hasHeader) {\r\n            return this.privHeader;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * Updates the header based on the audio length\r\n     * @member AudioOutputFormatImpl.updateHeader\r\n     * @function\r\n     * @public\r\n     * @param {number} audioLength - the audio length\r\n     */\r\n    public updateHeader(audioLength: number): void {\r\n        if (this.priHasHeader) {\r\n            const view = new DataView(this.privHeader);\r\n            view.setUint32(40, audioLength, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Specifies the audio format string to be sent to the service\r\n     * @string AudioOutputFormatImpl.prototype.requestAudioFormatString\r\n     * @function\r\n     * @public\r\n     */\r\n    public get requestAudioFormatString(): string {\r\n        return this.priRequestAudioFormatString;\r\n    }\r\n\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ArgumentNullError, ConnectionMessage, IStringDictionary, MessageType } from \"../common/Exports\";\r\nimport { HeaderNames } from \"./HeaderNames\";\r\n\r\nexport class SpeechConnectionMessage extends ConnectionMessage {\r\n\r\n    private privPath: string;\r\n    private privRequestId: string;\r\n    private privContentType: string;\r\n    private privStreamId: string;\r\n    private privAdditionalHeaders: IStringDictionary<string>;\r\n\r\n    public constructor(\r\n        messageType: MessageType,\r\n        path: string,\r\n        requestId: string,\r\n        contentType: string,\r\n        body: any,\r\n        streamId?: string,\r\n        additionalHeaders?: IStringDictionary<string>,\r\n        id?: string) {\r\n\r\n        if (!path) {\r\n            throw new ArgumentNullError(\"path\");\r\n        }\r\n\r\n        if (!requestId) {\r\n            throw new ArgumentNullError(\"requestId\");\r\n        }\r\n\r\n        const headers: IStringDictionary<string> = {};\r\n        headers[HeaderNames.Path] = path;\r\n        headers[HeaderNames.RequestId] = requestId;\r\n        headers[HeaderNames.RequestTimestamp] = new Date().toISOString();\r\n        if (contentType) {\r\n            headers[HeaderNames.ContentType] = contentType;\r\n        }\r\n\r\n        if (streamId) {\r\n            headers[HeaderNames.RequestStreamId] = streamId;\r\n        }\r\n\r\n        if (additionalHeaders) {\r\n            for (const headerName in additionalHeaders) {\r\n                if (headerName) {\r\n                    headers[headerName] = additionalHeaders[headerName];\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (id) {\r\n            super(messageType, body, headers, id);\r\n        } else {\r\n            super(messageType, body, headers);\r\n        }\r\n\r\n        this.privPath = path;\r\n        this.privRequestId = requestId;\r\n        this.privContentType = contentType;\r\n        this.privStreamId = streamId;\r\n        this.privAdditionalHeaders = additionalHeaders;\r\n    }\r\n\r\n    public get path(): string {\r\n        return this.privPath;\r\n    }\r\n\r\n    public get requestId(): string {\r\n        return this.privRequestId;\r\n    }\r\n\r\n    public get contentType(): string {\r\n        return this.privContentType;\r\n    }\r\n\r\n    public get streamId(): string {\r\n        return this.privStreamId;\r\n    }\r\n\r\n    public get additionalHeaders(): IStringDictionary<string> {\r\n        return this.privAdditionalHeaders;\r\n    }\r\n\r\n    public static fromConnectionMessage = (message: ConnectionMessage): SpeechConnectionMessage => {\r\n        let path = null;\r\n        let requestId = null;\r\n        let contentType = null;\r\n        let requestTimestamp = null;\r\n        let streamId = null;\r\n        const additionalHeaders: IStringDictionary<string> = {};\r\n\r\n        if (message.headers) {\r\n            for (const headerName in message.headers) {\r\n                if (headerName) {\r\n                    if (headerName.toLowerCase() === HeaderNames.Path.toLowerCase()) {\r\n                        path = message.headers[headerName];\r\n                    } else if (headerName.toLowerCase() === HeaderNames.RequestId.toLowerCase()) {\r\n                        requestId = message.headers[headerName];\r\n                    } else if (headerName.toLowerCase() === HeaderNames.RequestTimestamp.toLowerCase()) {\r\n                        requestTimestamp = message.headers[headerName];\r\n                    } else if (headerName.toLowerCase() === HeaderNames.ContentType.toLowerCase()) {\r\n                        contentType = message.headers[headerName];\r\n                    } else if (headerName.toLowerCase() === HeaderNames.RequestStreamId.toLowerCase()) {\r\n                        streamId = message.headers[headerName];\r\n                    } else {\r\n                        additionalHeaders[headerName] = message.headers[headerName];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return new SpeechConnectionMessage(\r\n            message.messageType,\r\n            path,\r\n            requestId,\r\n            contentType,\r\n            message.body,\r\n            streamId,\r\n            additionalHeaders,\r\n            message.id);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\r\nimport { SpeechSynthesizer } from \"../sdk/Exports\";\r\n\r\n/**\r\n * Represents the JSON used in the synthesis.context message sent to the speech service.\r\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\r\n */\r\nexport class SynthesisContext {\r\n    private privContext: { [section: string]: any } = {};\r\n    private privSpeechSynthesizer: SpeechSynthesizer;\r\n    private privAudioOutputFormat: AudioOutputFormatImpl;\r\n\r\n    constructor(speechSynthesizer: SpeechSynthesizer) {\r\n        this.privSpeechSynthesizer = speechSynthesizer;\r\n    }\r\n\r\n    /**\r\n     * Adds a section to the synthesis.context object.\r\n     * @param sectionName Name of the section to add.\r\n     * @param value JSON serializable object that represents the value.\r\n     */\r\n    public setSection(sectionName: string, value: any): void {\r\n        this.privContext[sectionName] = value;\r\n    }\r\n\r\n    /**\r\n     * Sets the audio output format for synthesis context generation.\r\n     * @param format {AudioOutputFormatImpl} the output format\r\n     */\r\n    public set audioOutputFormat(format: AudioOutputFormatImpl) {\r\n        this.privAudioOutputFormat = format;\r\n    }\r\n\r\n    public toJSON(): string {\r\n\r\n        const synthesisSection: ISynthesisSection = this.buildSynthesisContext();\r\n        this.setSection(\"synthesis\", synthesisSection);\r\n\r\n        return JSON.stringify(this.privContext);\r\n    }\r\n\r\n    private buildSynthesisContext(): ISynthesisSection {\r\n        return {\r\n            audio: {\r\n                metadataOptions: {\r\n                    bookmarkEnabled: (!!this.privSpeechSynthesizer.bookmarkReached),\r\n                    sentenceBoundaryEnabled: false,\r\n                    visemeEnabled: (!!this.privSpeechSynthesizer.visemeReceived),\r\n                    wordBoundaryEnabled: (!!this.privSpeechSynthesizer.wordBoundary),\r\n                },\r\n                outputFormat: this.privAudioOutputFormat.requestAudioFormatString,\r\n            },\r\n            language: {\r\n                autoDetection: this.privSpeechSynthesizer.autoDetectSourceLanguage\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\ninterface ISynthesisSection {\r\n    audio: {\r\n        outputFormat: string,\r\n        metadataOptions: {\r\n            bookmarkEnabled: boolean,\r\n            wordBoundaryEnabled: boolean,\r\n            visemeEnabled: boolean,\r\n            sentenceBoundaryEnabled: boolean,\r\n        }\r\n    };\r\n    language: {\r\n        autoDetection: boolean\r\n    };\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Represents the JSON used in the agent.config message sent to the speech service.\r\n */\r\nexport class AgentConfig {\r\n    private iPrivConfig: IAgentConfig;\r\n\r\n    public toJsonString(): string {\r\n        return JSON.stringify(this.iPrivConfig);\r\n    }\r\n\r\n    public get(): IAgentConfig {\r\n        return this.iPrivConfig;\r\n    }\r\n\r\n    /**\r\n     * Setter for the agent.config object.\r\n     * @param value a JSON serializable object.\r\n     */\r\n    public set(value: IAgentConfig): void {\r\n        this.iPrivConfig = value;\r\n    }\r\n}\r\n\r\nexport interface IAgentConfig {\r\n    botInfo: {\r\n        commType: string,\r\n        connectionId: string,\r\n        conversationId: string,\r\n        fromId: string\r\n        commandsCulture: string,\r\n        ttsAudioFormat: string\r\n    };\r\n    version: number;\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport enum MetadataType {\r\n    WordBoundary = \"WordBoundary\",\r\n    Bookmark = \"Bookmark\",\r\n    Viseme = \"Viseme\"\r\n}\r\n\r\nexport interface ISynthesisMetadata {\r\n    Type: MetadataType;\r\n    Data: {\r\n        Offset: number;\r\n        text: {\r\n            Text: string;\r\n            Length: number;\r\n        };\r\n        Bookmark: string;\r\n        VisemeId: number;\r\n        AnimationChunk: string;\r\n        IsLastAnimation: boolean;\r\n    };\r\n}\r\n\r\n// audio.metadata\r\nexport interface ISynthesisAudioMetadata {\r\n    Metadata: ISynthesisMetadata[];\r\n}\r\n\r\nexport class SynthesisAudioMetadata implements ISynthesisAudioMetadata {\r\n    private privSynthesisAudioMetadata: ISynthesisAudioMetadata;\r\n\r\n    private constructor(json: string) {\r\n        this.privSynthesisAudioMetadata = JSON.parse(json);\r\n    }\r\n\r\n    public static fromJSON(json: string): SynthesisAudioMetadata {\r\n        return new SynthesisAudioMetadata(json);\r\n    }\r\n\r\n    public get Metadata(): ISynthesisMetadata[] {\r\n        return this.privSynthesisAudioMetadata.Metadata;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ConnectionMessage,\r\n    Deferred,\r\n    IStringDictionary,\r\n    IWebsocketMessageFormatter,\r\n    MessageType,\r\n    RawWebsocketMessage,\r\n} from \"../common/Exports\";\r\n\r\nconst CRLF: string = \"\\r\\n\";\r\n\r\nexport class WebsocketMessageFormatter implements IWebsocketMessageFormatter {\r\n\r\n    public toConnectionMessage = (message: RawWebsocketMessage): Promise<ConnectionMessage> => {\r\n        const deferral = new Deferred<ConnectionMessage>();\r\n\r\n        try {\r\n            if (message.messageType === MessageType.Text) {\r\n                const textMessage: string = message.textContent;\r\n                let headers: IStringDictionary<string> = {};\r\n                let body: string = null;\r\n\r\n                if (textMessage) {\r\n                    const headerBodySplit = textMessage.split(\"\\r\\n\\r\\n\");\r\n                    if (headerBodySplit && headerBodySplit.length > 0) {\r\n                        headers = this.parseHeaders(headerBodySplit[0]);\r\n                        if (headerBodySplit.length > 1) {\r\n                            body = headerBodySplit[1];\r\n                        }\r\n                    }\r\n                }\r\n\r\n                deferral.resolve(new ConnectionMessage(message.messageType, body, headers, message.id));\r\n            } else if (message.messageType === MessageType.Binary) {\r\n                const binaryMessage: ArrayBuffer = message.binaryContent;\r\n                let headers: IStringDictionary<string> = {};\r\n                let body: ArrayBuffer = null;\r\n\r\n                if (!binaryMessage || binaryMessage.byteLength < 2) {\r\n                    throw new Error(\"Invalid binary message format. Header length missing.\");\r\n                }\r\n\r\n                const dataView = new DataView(binaryMessage);\r\n                const headerLength = dataView.getInt16(0);\r\n\r\n                if (binaryMessage.byteLength < headerLength + 2) {\r\n                    throw new Error(\"Invalid binary message format. Header content missing.\");\r\n                }\r\n\r\n                let headersString = \"\";\r\n                for (let i = 0; i < headerLength; i++) {\r\n                    headersString += String.fromCharCode((dataView).getInt8(i + 2));\r\n                }\r\n\r\n                headers = this.parseHeaders(headersString);\r\n\r\n                if (binaryMessage.byteLength > headerLength + 2) {\r\n                    body = binaryMessage.slice(2 + headerLength);\r\n                }\r\n\r\n                deferral.resolve(new ConnectionMessage(message.messageType, body, headers, message.id));\r\n            }\r\n        } catch (e) {\r\n            deferral.reject(`Error formatting the message. Error: ${e}`);\r\n        }\r\n\r\n        return deferral.promise;\r\n    }\r\n\r\n    public fromConnectionMessage = (message: ConnectionMessage): Promise<RawWebsocketMessage> => {\r\n        const deferral = new Deferred<RawWebsocketMessage>();\r\n\r\n        try {\r\n            if (message.messageType === MessageType.Text) {\r\n                const payload = `${this.makeHeaders(message)}${CRLF}${message.textBody ? message.textBody : \"\"}`;\r\n\r\n                deferral.resolve(new RawWebsocketMessage(MessageType.Text, payload, message.id));\r\n\r\n            } else if (message.messageType === MessageType.Binary) {\r\n                const headersString = this.makeHeaders(message);\r\n                const content = message.binaryBody;\r\n\r\n                const headerBuffer = this.stringToArrayBuffer(headersString);\r\n                const headerInt8Array = new Int8Array(headerBuffer);\r\n                const headerLength = headerInt8Array.byteLength;\r\n\r\n                const payloadInt8Array = new Int8Array(2 + headerLength + (content ? content.byteLength : 0));\r\n                payloadInt8Array[0] = ((headerLength >> 8) & 0xff);\r\n                payloadInt8Array[1] = headerLength & 0xff;\r\n                payloadInt8Array.set(headerInt8Array, 2);\r\n\r\n                if (content) {\r\n                    const bodyInt8Array = new Int8Array(content);\r\n                    payloadInt8Array.set(bodyInt8Array, 2 + headerLength);\r\n                }\r\n\r\n                const payload: ArrayBuffer = payloadInt8Array.buffer;\r\n\r\n                deferral.resolve(new RawWebsocketMessage(MessageType.Binary, payload, message.id));\r\n            }\r\n        } catch (e) {\r\n            deferral.reject(`Error formatting the message. ${e}`);\r\n        }\r\n\r\n        return deferral.promise;\r\n    }\r\n\r\n    private makeHeaders = (message: ConnectionMessage): string => {\r\n        let headersString: string = \"\";\r\n\r\n        if (message.headers) {\r\n            for (const header in message.headers) {\r\n                if (header) {\r\n                    headersString += `${header}: ${message.headers[header]}${CRLF}`;\r\n                }\r\n            }\r\n        }\r\n\r\n        return headersString;\r\n    }\r\n\r\n    private parseHeaders = (headersString: string): IStringDictionary<string> => {\r\n        const headers: IStringDictionary<string> = {};\r\n\r\n        if (headersString) {\r\n            const headerMatches = headersString.match(/[^\\r\\n]+/g);\r\n            if (headers) {\r\n                for (const header of headerMatches) {\r\n                    if (header) {\r\n                        const separatorIndex = header.indexOf(\":\");\r\n                        const headerName = separatorIndex > 0 ? header.substr(0, separatorIndex).trim().toLowerCase() : header;\r\n                        const headerValue =\r\n                            separatorIndex > 0 && header.length > (separatorIndex + 1) ?\r\n                                header.substr(separatorIndex + 1).trim() :\r\n                                \"\";\r\n\r\n                        headers[headerName] = headerValue;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return headers;\r\n    }\r\n\r\n    private stringToArrayBuffer = (str: string): ArrayBuffer => {\r\n        const buffer = new ArrayBuffer(str.length);\r\n        const view = new DataView(buffer);\r\n        for (let i = 0; i < str.length; i++) {\r\n            view.setUint8(i, str.charCodeAt(i));\r\n        }\r\n        return buffer;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { IPrimaryLanguage } from \"./SimpleSpeechPhrase\";\r\n\r\n// speech.hypothesis\r\nexport interface ISpeechHypothesis {\r\n    Text: string;\r\n    Offset: number;\r\n    Duration: number;\r\n    PrimaryLanguage?: IPrimaryLanguage;\r\n    SpeakerId?: string;\r\n}\r\n\r\nexport class SpeechHypothesis implements ISpeechHypothesis {\r\n    private privSpeechHypothesis: ISpeechHypothesis;\r\n\r\n    private constructor(json: string) {\r\n        this.privSpeechHypothesis = JSON.parse(json);\r\n    }\r\n\r\n    public static fromJSON(json: string): SpeechHypothesis {\r\n        return new SpeechHypothesis(json);\r\n    }\r\n\r\n    public get Text(): string {\r\n        return this.privSpeechHypothesis.Text;\r\n    }\r\n\r\n    public get Offset(): number {\r\n        return this.privSpeechHypothesis.Offset;\r\n    }\r\n\r\n    public get Duration(): number {\r\n        return this.privSpeechHypothesis.Duration;\r\n    }\r\n\r\n    public get Language(): string {\r\n        return this.privSpeechHypothesis.PrimaryLanguage === undefined ? undefined : this.privSpeechHypothesis.PrimaryLanguage.Language;\r\n    }\r\n\r\n    public get LanguageDetectionConfidence(): string {\r\n        return this.privSpeechHypothesis.PrimaryLanguage === undefined ? undefined : this.privSpeechHypothesis.PrimaryLanguage.Confidence;\r\n    }\r\n\r\n    public get SpeakerId(): string {\r\n        return this.privSpeechHypothesis.SpeakerId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { RecognitionStatus } from \"../Exports\";\r\n\r\n// speech.phrase\r\nexport interface ISimpleSpeechPhrase {\r\n    RecognitionStatus: RecognitionStatus;\r\n    DisplayText: string;\r\n    Offset?: number;\r\n    Duration?: number;\r\n    PrimaryLanguage?: IPrimaryLanguage;\r\n    SpeakerId?: string;\r\n}\r\n\r\nexport interface IPrimaryLanguage {\r\n    Language: string;\r\n    Confidence: string;\r\n}\r\n\r\nexport class SimpleSpeechPhrase implements ISimpleSpeechPhrase {\r\n    private privSimpleSpeechPhrase: ISimpleSpeechPhrase;\r\n\r\n    private constructor(json: string) {\r\n        this.privSimpleSpeechPhrase = JSON.parse(json);\r\n        this.privSimpleSpeechPhrase.RecognitionStatus = (RecognitionStatus as any)[this.privSimpleSpeechPhrase.RecognitionStatus];\r\n    }\r\n\r\n    public static fromJSON(json: string): SimpleSpeechPhrase {\r\n        return new SimpleSpeechPhrase(json);\r\n    }\r\n\r\n    public get RecognitionStatus(): RecognitionStatus {\r\n        return this.privSimpleSpeechPhrase.RecognitionStatus;\r\n    }\r\n\r\n    public get DisplayText(): string {\r\n        return this.privSimpleSpeechPhrase.DisplayText;\r\n    }\r\n\r\n    public get Offset(): number {\r\n        return this.privSimpleSpeechPhrase.Offset;\r\n    }\r\n\r\n    public get Duration(): number {\r\n        return this.privSimpleSpeechPhrase.Duration;\r\n    }\r\n\r\n    public get Language(): string {\r\n        return this.privSimpleSpeechPhrase.PrimaryLanguage === undefined ? undefined : this.privSimpleSpeechPhrase.PrimaryLanguage.Language;\r\n    }\r\n\r\n    public get LanguageDetectionConfidence(): string {\r\n        return this.privSimpleSpeechPhrase.PrimaryLanguage === undefined ? undefined : this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence;\r\n    }\r\n\r\n    public get SpeakerId(): string {\r\n        return this.privSimpleSpeechPhrase.SpeakerId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * @class SynthesisStatus\r\n * @private\r\n */\r\nexport enum SynthesisStatus {\r\n    /**\r\n     * The response contains valid audio data.\r\n     * @member SynthesisStatus.Success\r\n     */\r\n    Success,\r\n\r\n    /**\r\n     * Indicates the end of audio data. No valid audio data is included in the message.\r\n     * @member SynthesisStatus.SynthesisEnd\r\n     */\r\n    SynthesisEnd,\r\n\r\n    /**\r\n     * Indicates an error occurred during synthesis data processing.\r\n     * @member SynthesisStatus.Error\r\n     */\r\n    Error,\r\n}\r\n\r\nexport enum RecognitionStatus {\r\n    Success,\r\n    NoMatch,\r\n    InitialSilenceTimeout,\r\n    BabbleTimeout,\r\n    Error,\r\n    EndOfDictation,\r\n    TooManyRequests,\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    CancellationErrorCode,\r\n    CancellationReason,\r\n    ResultReason\r\n} from \"../sdk/Exports\";\r\nimport { RecognitionStatus } from \"./Exports\";\r\n\r\nexport class EnumTranslation {\r\n    public static implTranslateRecognitionResult(recognitionStatus: RecognitionStatus): ResultReason {\r\n        let reason = ResultReason.Canceled;\r\n        switch (recognitionStatus) {\r\n            case RecognitionStatus.Success:\r\n                reason = ResultReason.RecognizedSpeech;\r\n                break;\r\n            case RecognitionStatus.NoMatch:\r\n            case RecognitionStatus.InitialSilenceTimeout:\r\n            case RecognitionStatus.BabbleTimeout:\r\n            case RecognitionStatus.EndOfDictation:\r\n                reason = ResultReason.NoMatch;\r\n                break;\r\n            case RecognitionStatus.Error:\r\n            default:\r\n                reason = ResultReason.Canceled;\r\n                break;\r\n        }\r\n        return reason;\r\n    }\r\n\r\n    public static implTranslateCancelResult(recognitionStatus: RecognitionStatus): CancellationReason {\r\n        let reason = CancellationReason.EndOfStream;\r\n        switch (recognitionStatus) {\r\n            case RecognitionStatus.Success:\r\n            case RecognitionStatus.EndOfDictation:\r\n            case RecognitionStatus.NoMatch:\r\n                reason = CancellationReason.EndOfStream;\r\n                break;\r\n            case RecognitionStatus.InitialSilenceTimeout:\r\n            case RecognitionStatus.BabbleTimeout:\r\n            case RecognitionStatus.Error:\r\n            default:\r\n                reason = CancellationReason.Error;\r\n                break;\r\n        }\r\n        return reason;\r\n    }\r\n\r\n    public static implTranslateCancelErrorCode(recognitionStatus: RecognitionStatus): CancellationErrorCode {\r\n        let reason: CancellationErrorCode = CancellationErrorCode.NoError;\r\n        switch (recognitionStatus) {\r\n            case RecognitionStatus.Error:\r\n                reason = CancellationErrorCode.ServiceError;\r\n                break;\r\n            case RecognitionStatus.TooManyRequests:\r\n                reason = CancellationErrorCode.TooManyRequests;\r\n                break;\r\n            default:\r\n                reason = CancellationErrorCode.NoError;\r\n                break;\r\n        }\r\n\r\n        return reason;\r\n\r\n    }\r\n\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { IPrimaryLanguage, RecognitionStatus } from \"../Exports\";\r\n\r\n// speech.phrase for detailed\r\nexport interface IDetailedSpeechPhrase {\r\n    RecognitionStatus: RecognitionStatus;\r\n    NBest: IPhrase[];\r\n    Duration?: number;\r\n    Offset?: number;\r\n    PrimaryLanguage?: IPrimaryLanguage;\r\n}\r\n\r\nexport interface IPhrase {\r\n    Confidence?: number;\r\n    Lexical: string;\r\n    ITN: string;\r\n    MaskedITN: string;\r\n    Display: string;\r\n}\r\n\r\nexport class DetailedSpeechPhrase implements IDetailedSpeechPhrase {\r\n    private privDetailedSpeechPhrase: IDetailedSpeechPhrase;\r\n\r\n    private constructor(json: string) {\r\n        this.privDetailedSpeechPhrase = JSON.parse(json);\r\n        this.privDetailedSpeechPhrase.RecognitionStatus = (RecognitionStatus as any)[this.privDetailedSpeechPhrase.RecognitionStatus];\r\n    }\r\n\r\n    public static fromJSON(json: string): DetailedSpeechPhrase {\r\n        return new DetailedSpeechPhrase(json);\r\n    }\r\n\r\n    public get RecognitionStatus(): RecognitionStatus {\r\n        return this.privDetailedSpeechPhrase.RecognitionStatus;\r\n    }\r\n    public get NBest(): IPhrase[] {\r\n        return this.privDetailedSpeechPhrase.NBest;\r\n    }\r\n    public get Duration(): number {\r\n        return this.privDetailedSpeechPhrase.Duration;\r\n    }\r\n    public get Offset(): number {\r\n        return this.privDetailedSpeechPhrase.Offset;\r\n    }\r\n    public get Language(): string {\r\n        return this.privDetailedSpeechPhrase.PrimaryLanguage === undefined ? undefined : this.privDetailedSpeechPhrase.PrimaryLanguage.Language;\r\n    }\r\n    public get LanguageDetectionConfidence(): string {\r\n        return this.privDetailedSpeechPhrase.PrimaryLanguage === undefined ? undefined : this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    IDynamicGrammar,\r\n    IDynamicGrammarGeneric,\r\n} from \"./Exports\";\r\n\r\n/**\r\n * Responsible for building the object to be sent to the speech service to support dynamic grammars.\r\n * @class DynamicGrammarBuilder\r\n */\r\nexport class DynamicGrammarBuilder {\r\n\r\n    private privPhrases: string[];\r\n    private privGrammars: string[];\r\n\r\n    // Adds one more reference phrases to the dynamic grammar to send.\r\n    // All added phrases are generic phrases.\r\n    public addPhrase(phrase: string | string[]): void {\r\n        if (!this.privPhrases) {\r\n            this.privPhrases = [];\r\n        }\r\n\r\n        if (phrase instanceof Array) {\r\n            this.privPhrases = this.privPhrases.concat(phrase as string[]);\r\n        } else {\r\n            this.privPhrases.push(phrase as string);\r\n        }\r\n    }\r\n\r\n    // Clears all phrases stored in the current object.\r\n    public clearPhrases(): void {\r\n        this.privPhrases = undefined;\r\n    }\r\n\r\n    // Adds one or more reference grammars to the current grammar.\r\n    public addReferenceGrammar(grammar: string | string[]): void {\r\n        if (!this.privGrammars) {\r\n            this.privGrammars = [];\r\n        }\r\n\r\n        if (grammar instanceof Array) {\r\n            this.privGrammars = this.privGrammars.concat(grammar as string[]);\r\n        } else {\r\n            this.privGrammars.push(grammar as string);\r\n        }\r\n    }\r\n\r\n    // clears all grammars stored on the recognizer.\r\n    public clearGrammars(): void {\r\n        this.privGrammars = undefined;\r\n    }\r\n\r\n    // Generates an object that represents the dynamic grammar used by the Speech Service.\r\n    // This is done by building an object with the correct layout based on the phrases and reference grammars added to this instance\r\n    // of a DynamicGrammarBuilder\r\n    public generateGrammarObject(): IDynamicGrammar {\r\n        if (this.privGrammars === undefined && this.privPhrases === undefined) {\r\n            return undefined;\r\n        }\r\n\r\n        const retObj: IDynamicGrammar = {};\r\n        retObj.ReferenceGrammars = this.privGrammars;\r\n\r\n        if (undefined !== this.privPhrases && 0 !== this.privPhrases.length) {\r\n            const retPhrases: IDynamicGrammarGeneric[] = [];\r\n\r\n            this.privPhrases.forEach((value: string, index: number, array: string[]): void => {\r\n                retPhrases.push({\r\n                    Text: value,\r\n                });\r\n            });\r\n\r\n            retObj.Groups = [{ Type: \"Generic\", Items: retPhrases }];\r\n        }\r\n\r\n        return retObj;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    DynamicGrammarBuilder,\r\n    IDynamicGrammar,\r\n} from \"./Exports\";\r\n\r\n/**\r\n * Represents the JSON used in the speech.context message sent to the speech service.\r\n * The dynamic grammar is always refreshed from the encapsulated dynamic grammar object.\r\n */\r\nexport class SpeechContext {\r\n    private privContext: { [section: string]: any } = {};\r\n    private privDynamicGrammar: DynamicGrammarBuilder;\r\n\r\n    constructor(dynamicGrammar: DynamicGrammarBuilder) {\r\n        this.privDynamicGrammar = dynamicGrammar;\r\n    }\r\n\r\n    /**\r\n     * Adds a section to the speech.context object.\r\n     * @param sectionName Name of the section to add.\r\n     * @param value JSON serializable object that represents the value.\r\n     */\r\n    public setSection(sectionName: string, value: any): void {\r\n        this.privContext[sectionName] = value;\r\n    }\r\n\r\n    /**\r\n     * @Internal\r\n     * This is only used by pronunciation assessment config.\r\n     * Do not use externally, object returned will change without warning or notice.\r\n     */\r\n    public setPronunciationAssessmentParams(params: string): void {\r\n        if (this.privContext.phraseDetection === undefined) {\r\n            this.privContext.phraseDetection = {\r\n                enrichment: {\r\n                    pronunciationAssessment: {}\r\n                }\r\n            };\r\n        }\r\n        this.privContext.phraseDetection.enrichment.pronunciationAssessment = JSON.parse(params);\r\n        if (this.privContext.phraseOutput === undefined) {\r\n            this.privContext.phraseOutput = {\r\n                detailed: {\r\n                    options: []\r\n                },\r\n                format: {}\r\n            };\r\n        }\r\n        this.privContext.phraseOutput.format = \"Detailed\";\r\n        this.privContext.phraseOutput.detailed.options.push(\"PronunciationAssessment\");\r\n        if (this.privContext.phraseOutput.detailed.options.indexOf(\"WordTimings\") === -1) {\r\n            this.privContext.phraseOutput.detailed.options.push(\"WordTimings\");\r\n        }\r\n    }\r\n\r\n    public toJSON(): string {\r\n\r\n        const dgi: IDynamicGrammar = this.privDynamicGrammar.generateGrammarObject();\r\n        this.setSection(\"dgi\", dgi);\r\n\r\n        const ret: string = JSON.stringify(this.privContext);\r\n        return ret;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// speech.endDetected\r\nexport interface ISpeechDetected {\r\n    Offset: number;\r\n}\r\n\r\nexport class SpeechDetected implements ISpeechDetected {\r\n    private privSpeechStartDetected: ISpeechDetected;\r\n\r\n    private constructor(json: string) {\r\n        this.privSpeechStartDetected = JSON.parse(json);\r\n    }\r\n\r\n    public static fromJSON(json: string): SpeechDetected {\r\n        return new SpeechDetected(json);\r\n    }\r\n\r\n    public get Offset(): number {\r\n        return this.privSpeechStartDetected.Offset;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ArgumentNullError,\r\n} from \"../common/Exports\";\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport {\r\n    AuthInfo,\r\n    IAuthentication\r\n} from \"./IAuthentication\";\r\n\r\n/**\r\n * @class\r\n */\r\nexport class CognitiveSubscriptionKeyAuthentication implements IAuthentication {\r\n    private privAuthInfo: AuthInfo;\r\n\r\n    /**\r\n     * Creates and initializes an instance of the CognitiveSubscriptionKeyAuthentication class.\r\n     * @constructor\r\n     * @param {string} subscriptionKey - The subscription key\r\n     */\r\n    constructor(subscriptionKey: string) {\r\n        if (!subscriptionKey) {\r\n            throw new ArgumentNullError(\"subscriptionKey\");\r\n        }\r\n\r\n        this.privAuthInfo = new AuthInfo(HeaderNames.AuthKey, subscriptionKey);\r\n    }\r\n\r\n    /**\r\n     * Fetches the subscription key.\r\n     * @member\r\n     * @function\r\n     * @public\r\n     * @param {string} authFetchEventId - The id to fetch.\r\n     */\r\n    public fetch = (authFetchEventId: string): Promise<AuthInfo> => {\r\n        return Promise.resolve(this.privAuthInfo);\r\n    }\r\n\r\n    /**\r\n     * Fetches the subscription key.\r\n     * @member\r\n     * @function\r\n     * @public\r\n     * @param {string} authFetchEventId - The id to fetch.\r\n     */\r\n    public fetchOnExpiry = (authFetchEventId: string): Promise<AuthInfo> => {\r\n        return Promise.resolve(this.privAuthInfo);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ArgumentNullError } from \"../common/Exports\";\r\nimport { AuthInfo, IAuthentication } from \"./IAuthentication\";\r\n\r\nconst AuthHeader: string = \"Authorization\";\r\n\r\nexport class CognitiveTokenAuthentication implements IAuthentication {\r\n    private privFetchCallback: (authFetchEventId: string) => Promise<string>;\r\n    private privFetchOnExpiryCallback: (authFetchEventId: string) => Promise<string>;\r\n\r\n    constructor(fetchCallback: (authFetchEventId: string) => Promise<string>, fetchOnExpiryCallback: (authFetchEventId: string) => Promise<string>) {\r\n        if (!fetchCallback) {\r\n            throw new ArgumentNullError(\"fetchCallback\");\r\n        }\r\n\r\n        if (!fetchOnExpiryCallback) {\r\n            throw new ArgumentNullError(\"fetchOnExpiryCallback\");\r\n        }\r\n\r\n        this.privFetchCallback = fetchCallback;\r\n        this.privFetchOnExpiryCallback = fetchOnExpiryCallback;\r\n    }\r\n\r\n    public fetch = (authFetchEventId: string): Promise<AuthInfo> => {\r\n        return this.privFetchCallback(authFetchEventId).then((token: string) => new AuthInfo(AuthHeader, token));\r\n    }\r\n\r\n    public fetchOnExpiry = (authFetchEventId: string): Promise<AuthInfo> => {\r\n        return this.privFetchOnExpiryCallback(authFetchEventId).then((token: string) => new AuthInfo(AuthHeader, token));\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport class ConnectionOpenResponse {\r\n    private privStatusCode: number;\r\n    private privReason: string;\r\n\r\n    constructor(statusCode: number, reason: string) {\r\n        this.privStatusCode = statusCode;\r\n        this.privReason = reason;\r\n    }\r\n\r\n    public get statusCode(): number {\r\n        return this.privStatusCode;\r\n    }\r\n\r\n    public get reason(): string {\r\n        return this.privReason;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { HeaderNames } from \"../common.speech/HeaderNames\";\r\nimport {\r\n    ArgumentNullError,\r\n    BackgroundEvent,\r\n    ConnectionClosedEvent,\r\n    ConnectionErrorEvent,\r\n    ConnectionEstablishedEvent,\r\n    ConnectionEvent,\r\n    ConnectionMessage,\r\n    ConnectionMessageReceivedEvent,\r\n    ConnectionMessageSentEvent,\r\n    ConnectionOpenResponse,\r\n    ConnectionStartEvent,\r\n    ConnectionState,\r\n    Deferred,\r\n    Events,\r\n    EventSource,\r\n    IWebsocketMessageFormatter,\r\n    MessageType,\r\n    Queue,\r\n    RawWebsocketMessage,\r\n} from \"../common/Exports\";\r\nimport { ProxyInfo } from \"./ProxyInfo\";\r\n\r\n// Node.JS specific web socket / browser support.\r\nimport ws from \"ws\";\r\nimport { CertCheckAgent } from \"./CertChecks\";\r\n\r\ninterface ISendItem {\r\n    Message: ConnectionMessage;\r\n    RawWebsocketMessage: RawWebsocketMessage;\r\n    sendStatusDeferral: Deferred<void>;\r\n}\r\n\r\nexport class WebsocketMessageAdapter {\r\n    private privConnectionState: ConnectionState;\r\n    private privMessageFormatter: IWebsocketMessageFormatter;\r\n    private privWebsocketClient: WebSocket | ws;\r\n\r\n    private privSendMessageQueue: Queue<ISendItem>;\r\n    private privReceivingMessageQueue: Queue<ConnectionMessage>;\r\n    private privConnectionEstablishDeferral: Deferred<ConnectionOpenResponse>;\r\n    private privCertificateValidatedDeferral: Deferred<void>;\r\n    private privDisconnectDeferral: Deferred<void>;\r\n    private privConnectionEvents: EventSource<ConnectionEvent>;\r\n    private privConnectionId: string;\r\n    private privUri: string;\r\n    private proxyInfo: ProxyInfo;\r\n    private privHeaders: { [key: string]: string; };\r\n    private privLastErrorReceived: string;\r\n    private privEnableCompression: boolean;\r\n\r\n    public static forceNpmWebSocket: boolean = false;\r\n\r\n    public constructor(\r\n        uri: string,\r\n        connectionId: string,\r\n        messageFormatter: IWebsocketMessageFormatter,\r\n        proxyInfo: ProxyInfo,\r\n        headers: { [key: string]: string; },\r\n        enableCompression: boolean) {\r\n\r\n        if (!uri) {\r\n            throw new ArgumentNullError(\"uri\");\r\n        }\r\n\r\n        if (!messageFormatter) {\r\n            throw new ArgumentNullError(\"messageFormatter\");\r\n        }\r\n\r\n        this.proxyInfo = proxyInfo;\r\n        this.privConnectionEvents = new EventSource<ConnectionEvent>();\r\n        this.privConnectionId = connectionId;\r\n        this.privMessageFormatter = messageFormatter;\r\n        this.privConnectionState = ConnectionState.None;\r\n        this.privUri = uri;\r\n        this.privHeaders = headers;\r\n        this.privEnableCompression = enableCompression;\r\n\r\n        // Add the connection ID to the headers\r\n        this.privHeaders[HeaderNames.ConnectionId] = this.privConnectionId;\r\n\r\n        this.privLastErrorReceived = \"\";\r\n    }\r\n\r\n    public get state(): ConnectionState {\r\n        return this.privConnectionState;\r\n    }\r\n\r\n    public open = (): Promise<ConnectionOpenResponse> => {\r\n        if (this.privConnectionState === ConnectionState.Disconnected) {\r\n            return Promise.reject<ConnectionOpenResponse>(`Cannot open a connection that is in ${this.privConnectionState} state`);\r\n        }\r\n\r\n        if (this.privConnectionEstablishDeferral) {\r\n            return this.privConnectionEstablishDeferral.promise;\r\n        }\r\n\r\n        this.privConnectionEstablishDeferral = new Deferred<ConnectionOpenResponse>();\r\n        this.privCertificateValidatedDeferral = new Deferred<void>();\r\n\r\n        this.privConnectionState = ConnectionState.Connecting;\r\n\r\n        try {\r\n\r\n            if (typeof WebSocket !== \"undefined\" && !WebsocketMessageAdapter.forceNpmWebSocket) {\r\n                // Browser handles cert checks.\r\n                this.privCertificateValidatedDeferral.resolve();\r\n\r\n                this.privWebsocketClient = new WebSocket(this.privUri);\r\n            } else {\r\n                const options: ws.ClientOptions = { headers: this.privHeaders, perMessageDeflate: this.privEnableCompression };\r\n                // The ocsp library will handle validation for us and fail the connection if needed.\r\n                this.privCertificateValidatedDeferral.resolve();\r\n                const checkAgent: CertCheckAgent = new CertCheckAgent(this.proxyInfo);\r\n\r\n                options.agent = checkAgent.GetAgent();\r\n                this.privWebsocketClient = new ws(this.privUri, options);\r\n            }\r\n\r\n            this.privWebsocketClient.binaryType = \"arraybuffer\";\r\n            this.privReceivingMessageQueue = new Queue<ConnectionMessage>();\r\n            this.privDisconnectDeferral = new Deferred<void>();\r\n            this.privSendMessageQueue = new Queue<ISendItem>();\r\n            this.processSendQueue().catch((reason: string): void => {\r\n                Events.instance.onEvent(new BackgroundEvent(reason));\r\n            });\r\n        } catch (error) {\r\n            this.privConnectionEstablishDeferral.resolve(new ConnectionOpenResponse(500, error));\r\n            return this.privConnectionEstablishDeferral.promise;\r\n        }\r\n\r\n        this.onEvent(new ConnectionStartEvent(this.privConnectionId, this.privUri));\r\n\r\n        this.privWebsocketClient.onopen = (e: { target: WebSocket | ws }) => {\r\n            this.privCertificateValidatedDeferral.promise.then((): void => {\r\n                this.privConnectionState = ConnectionState.Connected;\r\n                this.onEvent(new ConnectionEstablishedEvent(this.privConnectionId));\r\n                this.privConnectionEstablishDeferral.resolve(new ConnectionOpenResponse(200, \"\"));\r\n            }, (error: string): void => {\r\n                this.privConnectionEstablishDeferral.reject(error);\r\n            });\r\n        };\r\n\r\n        this.privWebsocketClient.onerror = (e: { error: any; message: string; type: string; target: WebSocket | ws }) => {\r\n            this.onEvent(new ConnectionErrorEvent(this.privConnectionId, e.message, e.type));\r\n            this.privLastErrorReceived = e.message;\r\n        };\r\n\r\n        this.privWebsocketClient.onclose = (e: { wasClean: boolean; code: number; reason: string; target: WebSocket | ws }) => {\r\n            if (this.privConnectionState === ConnectionState.Connecting) {\r\n                this.privConnectionState = ConnectionState.Disconnected;\r\n                // this.onEvent(new ConnectionEstablishErrorEvent(this.connectionId, e.code, e.reason));\r\n                this.privConnectionEstablishDeferral.resolve(new ConnectionOpenResponse(e.code, e.reason + \" \" + this.privLastErrorReceived));\r\n            } else {\r\n                this.privConnectionState = ConnectionState.Disconnected;\r\n                this.onEvent(new ConnectionClosedEvent(this.privConnectionId, e.code, e.reason));\r\n            }\r\n\r\n            this.onClose(e.code, e.reason).catch((reason: string): void => {\r\n                Events.instance.onEvent(new BackgroundEvent(reason));\r\n            });\r\n        };\r\n\r\n        this.privWebsocketClient.onmessage = (e: { data: ws.Data; type: string; target: WebSocket | ws }) => {\r\n            const networkReceivedTime = new Date().toISOString();\r\n            if (this.privConnectionState === ConnectionState.Connected) {\r\n                const deferred = new Deferred<ConnectionMessage>();\r\n                // let id = ++this.idCounter;\r\n                this.privReceivingMessageQueue.enqueueFromPromise(deferred.promise);\r\n                if (e.data instanceof ArrayBuffer) {\r\n                    const rawMessage = new RawWebsocketMessage(MessageType.Binary, e.data);\r\n                    this.privMessageFormatter\r\n                        .toConnectionMessage(rawMessage)\r\n                        .then((connectionMessage: ConnectionMessage) => {\r\n                            this.onEvent(new ConnectionMessageReceivedEvent(this.privConnectionId, networkReceivedTime, connectionMessage));\r\n                            deferred.resolve(connectionMessage);\r\n                        }, (error: string) => {\r\n                            // TODO: Events for these ?\r\n                            deferred.reject(`Invalid binary message format. Error: ${error}`);\r\n                        });\r\n                } else {\r\n                    const rawMessage = new RawWebsocketMessage(MessageType.Text, e.data);\r\n                    this.privMessageFormatter\r\n                        .toConnectionMessage(rawMessage)\r\n                        .then((connectionMessage: ConnectionMessage) => {\r\n                            this.onEvent(new ConnectionMessageReceivedEvent(this.privConnectionId, networkReceivedTime, connectionMessage));\r\n                            deferred.resolve(connectionMessage);\r\n                        }, (error: string) => {\r\n                            // TODO: Events for these ?\r\n                            deferred.reject(`Invalid text message format. Error: ${error}`);\r\n                        });\r\n                }\r\n            }\r\n        };\r\n\r\n        return this.privConnectionEstablishDeferral.promise;\r\n    }\r\n\r\n    public send = (message: ConnectionMessage): Promise<void> => {\r\n        if (this.privConnectionState !== ConnectionState.Connected) {\r\n            return Promise.reject(`Cannot send on connection that is in ${ConnectionState[this.privConnectionState]} state`);\r\n        }\r\n\r\n        const messageSendStatusDeferral = new Deferred<void>();\r\n        const messageSendDeferral = new Deferred<ISendItem>();\r\n\r\n        this.privSendMessageQueue.enqueueFromPromise(messageSendDeferral.promise);\r\n\r\n        this.privMessageFormatter\r\n            .fromConnectionMessage(message)\r\n            .then((rawMessage: RawWebsocketMessage) => {\r\n                messageSendDeferral.resolve({\r\n                    Message: message,\r\n                    RawWebsocketMessage: rawMessage,\r\n                    sendStatusDeferral: messageSendStatusDeferral,\r\n                });\r\n            }, (error: string) => {\r\n                messageSendDeferral.reject(`Error formatting the message. ${error}`);\r\n            });\r\n\r\n        return messageSendStatusDeferral.promise;\r\n    }\r\n\r\n    public read = (): Promise<ConnectionMessage> => {\r\n        if (this.privConnectionState !== ConnectionState.Connected) {\r\n            return Promise.reject<ConnectionMessage>(`Cannot read on connection that is in ${this.privConnectionState} state`);\r\n        }\r\n\r\n        return this.privReceivingMessageQueue.dequeue();\r\n    }\r\n\r\n    public close = (reason?: string): Promise<void> => {\r\n        if (this.privWebsocketClient) {\r\n            if (this.privConnectionState !== ConnectionState.Disconnected) {\r\n                this.privWebsocketClient.close(1000, reason ? reason : \"Normal closure by client\");\r\n            }\r\n        } else {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        return this.privDisconnectDeferral.promise;\r\n    }\r\n\r\n    public get events(): EventSource<ConnectionEvent> {\r\n        return this.privConnectionEvents;\r\n    }\r\n\r\n    private sendRawMessage = (sendItem: ISendItem): Promise<void> => {\r\n        try {\r\n            // indicates we are draining the queue and it came with no message;\r\n            if (!sendItem) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            this.onEvent(new ConnectionMessageSentEvent(this.privConnectionId, new Date().toISOString(), sendItem.Message));\r\n\r\n            // add a check for the ws readystate in order to stop the red console error 'WebSocket is already in CLOSING or CLOSED state' appearing\r\n            if (this.isWebsocketOpen) {\r\n                this.privWebsocketClient.send(sendItem.RawWebsocketMessage.payload);\r\n            } else {\r\n                return Promise.reject(\"websocket send error: Websocket not ready \" + this.privConnectionId + \" \" + sendItem.Message.id + \" \" + new Error().stack);\r\n            }\r\n            return Promise.resolve();\r\n\r\n        } catch (e) {\r\n            return Promise.reject(`websocket send error: ${e}`);\r\n        }\r\n    }\r\n\r\n    private async onClose(code: number, reason: string): Promise<void> {\r\n        const closeReason = `Connection closed. ${code}: ${reason}`;\r\n        this.privConnectionState = ConnectionState.Disconnected;\r\n        this.privDisconnectDeferral.resolve();\r\n        await this.privReceivingMessageQueue.drainAndDispose((pendingReceiveItem: ConnectionMessage) => {\r\n            // TODO: Events for these ?\r\n            // Logger.instance.onEvent(new LoggingEvent(LogType.Warning, null, `Failed to process received message. Reason: ${closeReason}, Message: ${JSON.stringify(pendingReceiveItem)}`));\r\n        }, closeReason);\r\n\r\n        await this.privSendMessageQueue.drainAndDispose((pendingSendItem: ISendItem) => {\r\n            pendingSendItem.sendStatusDeferral.reject(closeReason);\r\n        }, closeReason);\r\n    }\r\n\r\n    private async processSendQueue(): Promise<void> {\r\n        while (true) {\r\n            const itemToSend: Promise<ISendItem> = this.privSendMessageQueue.dequeue();\r\n            const sendItem: ISendItem = await itemToSend;\r\n            // indicates we are draining the queue and it came with no message;\r\n            if (!sendItem) {\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.sendRawMessage(sendItem);\r\n                sendItem.sendStatusDeferral.resolve();\r\n            } catch (sendError) {\r\n                sendItem.sendStatusDeferral.reject(sendError);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onEvent = (event: ConnectionEvent): void => {\r\n        this.privConnectionEvents.onEvent(event);\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private get isWebsocketOpen(): boolean {\r\n        return this.privWebsocketClient && this.privWebsocketClient.readyState === this.privWebsocketClient.OPEN;\r\n    }\r\n\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ArgumentNullError,\r\n    ConnectionEvent,\r\n    ConnectionMessage,\r\n    ConnectionOpenResponse,\r\n    ConnectionState,\r\n    createNoDashGuid,\r\n    EventSource,\r\n    IConnection,\r\n    IStringDictionary,\r\n    IWebsocketMessageFormatter,\r\n} from \"../common/Exports\";\r\nimport { ProxyInfo } from \"./ProxyInfo\";\r\nimport { WebsocketMessageAdapter } from \"./WebsocketMessageAdapter\";\r\n\r\nexport class WebsocketConnection implements IConnection {\r\n\r\n    private privUri: string;\r\n    private privMessageFormatter: IWebsocketMessageFormatter;\r\n    private privConnectionMessageAdapter: WebsocketMessageAdapter;\r\n    private privId: string;\r\n    private privIsDisposed: boolean = false;\r\n\r\n    public constructor(\r\n        uri: string,\r\n        queryParameters: IStringDictionary<string>,\r\n        headers: IStringDictionary<string>,\r\n        messageFormatter: IWebsocketMessageFormatter,\r\n        proxyInfo: ProxyInfo,\r\n        enableCompression: boolean = false,\r\n        connectionId?: string) {\r\n\r\n        if (!uri) {\r\n            throw new ArgumentNullError(\"uri\");\r\n        }\r\n\r\n        if (!messageFormatter) {\r\n            throw new ArgumentNullError(\"messageFormatter\");\r\n        }\r\n\r\n        this.privMessageFormatter = messageFormatter;\r\n\r\n        let queryParams = \"\";\r\n        let i = 0;\r\n\r\n        if (queryParameters) {\r\n            for (const paramName in queryParameters) {\r\n                if (paramName) {\r\n                    queryParams += ((i === 0) && (uri.indexOf(\"?\") === -1)) ? \"?\" : \"&\";\r\n                    const val = encodeURIComponent(queryParameters[paramName]);\r\n                    queryParams += `${paramName}=${val}`;\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (headers) {\r\n            for (const headerName in headers) {\r\n                if (headerName) {\r\n                    queryParams += ((i === 0) && (uri.indexOf(\"?\") === -1)) ? \"?\" : \"&\";\r\n                    const val = encodeURIComponent(headers[headerName]);\r\n                    queryParams += `${headerName}=${val}`;\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.privUri = uri + queryParams;\r\n        this.privId = connectionId ? connectionId : createNoDashGuid();\r\n\r\n        this.privConnectionMessageAdapter = new WebsocketMessageAdapter(\r\n            this.privUri,\r\n            this.id,\r\n            this.privMessageFormatter,\r\n            proxyInfo,\r\n            headers,\r\n            enableCompression);\r\n    }\r\n\r\n    public async dispose(): Promise<void> {\r\n        this.privIsDisposed = true;\r\n\r\n        if (this.privConnectionMessageAdapter) {\r\n            await this.privConnectionMessageAdapter.close();\r\n        }\r\n    }\r\n\r\n    public isDisposed = (): boolean => {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    public get id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public state = (): ConnectionState => {\r\n        return this.privConnectionMessageAdapter.state;\r\n    }\r\n\r\n    public open = (): Promise<ConnectionOpenResponse> => {\r\n        return this.privConnectionMessageAdapter.open();\r\n    }\r\n\r\n    public send = (message: ConnectionMessage): Promise<void> => {\r\n        return this.privConnectionMessageAdapter.send(message);\r\n    }\r\n\r\n    public read = (): Promise<ConnectionMessage> => {\r\n        return this.privConnectionMessageAdapter.read();\r\n    }\r\n\r\n    public get events(): EventSource<ConnectionEvent> {\r\n        return this.privConnectionMessageAdapter.events;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { RecognizerConfig } from \"../common.speech/Exports\";\r\nimport { PropertyCollection, PropertyId } from \"../sdk/Exports\";\r\n\r\nexport class ProxyInfo {\r\n    private privProxyHostName: string;\r\n    private privProxyPort: number;\r\n    private privProxyUserName: string;\r\n    private privProxyPassword: string;\r\n\r\n    private constructor(proxyHostName: string, proxyPort: number, proxyUserName: string, proxyPassword: string) {\r\n        this.privProxyHostName = proxyHostName;\r\n        this.privProxyPort = proxyPort;\r\n        this.privProxyUserName = proxyUserName;\r\n        this.privProxyPassword = proxyPassword;\r\n    }\r\n\r\n    public static fromParameters(parameters: PropertyCollection): ProxyInfo {\r\n        return new ProxyInfo(parameters.getProperty(PropertyId.SpeechServiceConnection_ProxyHostName),\r\n            parseInt(parameters.getProperty(PropertyId.SpeechServiceConnection_ProxyPort), 10),\r\n            parameters.getProperty(PropertyId.SpeechServiceConnection_ProxyUserName),\r\n            parameters.getProperty(PropertyId.SpeechServiceConnection_ProxyPassword));\r\n    }\r\n\r\n    public static fromRecognizerConfig(config: RecognizerConfig): ProxyInfo {\r\n        return this.fromParameters(config.parameters);\r\n    }\r\n\r\n    public get HostName(): string {\r\n        return this.privProxyHostName;\r\n    }\r\n\r\n    public get Port(): number {\r\n        return this.privProxyPort;\r\n    }\r\n\r\n    public get UserName(): string {\r\n        return this.privProxyUserName;\r\n    }\r\n\r\n    public get Password(): string {\r\n        return this.privProxyPassword;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport class QueryParameterNames {\r\n    public static BotId: string = \"botid\";\r\n    public static CustomSpeechDeploymentId: string = \"cid\";\r\n    public static CustomVoiceDeploymentId: string = \"deploymentId\";\r\n    public static EnableAudioLogging: string = \"storeAudio\";\r\n    public static EnableLanguageId: string = \"lidEnabled\";\r\n    public static EnableWordLevelTimestamps: string = \"wordLevelTimestamps\";\r\n    public static EndSilenceTimeoutMs: string = \"endSilenceTimeoutMs\";\r\n    public static Format: string = \"format\";\r\n    public static InitialSilenceTimeoutMs: string = \"initialSilenceTimeoutMs\";\r\n    public static Language: string = \"language\";\r\n    public static Profanity: string = \"profanity\";\r\n    public static RequestBotStatusMessages: string = \"enableBotMessageStatus\";\r\n    public static StableIntermediateThreshold: string = \"stableIntermediateThreshold\";\r\n    public static StableTranslation: string = \"stableTranslation\";\r\n    public static TestHooks: string = \"testhooks\";\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ServicePropertiesPropertyName,\r\n} from \"../common.speech/Exports\";\r\nimport { IConnection, IStringDictionary } from \"../common/Exports\";\r\nimport { OutputFormat, PropertyId } from \"../sdk/Exports\";\r\nimport { AuthInfo, IConnectionFactory, RecognitionMode, RecognizerConfig, WebsocketMessageFormatter } from \"./Exports\";\r\nimport { QueryParameterNames } from \"./QueryParameterNames\";\r\n\r\nexport abstract class ConnectionFactoryBase implements IConnectionFactory {\r\n    public abstract create(\r\n        config: RecognizerConfig,\r\n        authInfo: AuthInfo,\r\n        connectionId?: string): IConnection;\r\n\r\n    protected setCommonUrlParams(\r\n        config: RecognizerConfig,\r\n        queryParams: IStringDictionary<string>,\r\n        endpoint: string): void {\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceConnection_EnableAudioLogging,\r\n            QueryParameterNames.EnableAudioLogging,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,\r\n            QueryParameterNames.EnableWordLevelTimestamps,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceResponse_ProfanityOption,\r\n            QueryParameterNames.Profanity,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,\r\n            QueryParameterNames.InitialSilenceTimeoutMs,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,\r\n            QueryParameterNames.EndSilenceTimeoutMs,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        this.setUrlParameter(PropertyId.SpeechServiceResponse_StablePartialResultThreshold,\r\n            QueryParameterNames.StableIntermediateThreshold,\r\n            config,\r\n            queryParams,\r\n            endpoint);\r\n\r\n        const serviceProperties: IStringDictionary<string> = JSON.parse(config.parameters.getProperty(ServicePropertiesPropertyName, \"{}\"));\r\n\r\n        Object.keys(serviceProperties).forEach((value: string, num: number, array: string[]) => {\r\n            queryParams[value] = serviceProperties[value];\r\n        });\r\n    }\r\n\r\n    protected setUrlParameter(\r\n        propId: PropertyId,\r\n        parameterName: string,\r\n        config: RecognizerConfig,\r\n        queryParams: IStringDictionary<string>,\r\n        endpoint: string): void {\r\n\r\n        const value: string = config.parameters.getProperty(propId, undefined);\r\n\r\n        if (value && (!endpoint || endpoint.search(parameterName) === -1)) {\r\n            queryParams[parameterName] = value.toLocaleLowerCase();\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ProxyInfo,\r\n    WebsocketConnection,\r\n} from \"../common.browser/Exports\";\r\nimport {\r\n    ForceDictationPropertyName,\r\n    OutputFormatPropertyName,\r\n} from \"../common.speech/Exports\";\r\nimport {\r\n    IConnection,\r\n    IStringDictionary\r\n} from \"../common/Exports\";\r\nimport {\r\n    OutputFormat,\r\n    PropertyId\r\n} from \"../sdk/Exports\";\r\nimport {\r\n    ConnectionFactoryBase\r\n} from \"./ConnectionFactoryBase\";\r\nimport {\r\n    AuthInfo,\r\n    RecognitionMode,\r\n    RecognizerConfig,\r\n    WebsocketMessageFormatter\r\n} from \"./Exports\";\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport {\r\n    QueryParameterNames\r\n} from \"./QueryParameterNames\";\r\n\r\nexport class SpeechConnectionFactory extends ConnectionFactoryBase {\r\n\r\n    private readonly interactiveRelativeUri: string = \"/speech/recognition/interactive/cognitiveservices/v1\";\r\n    private readonly conversationRelativeUri: string = \"/speech/recognition/conversation/cognitiveservices/v1\";\r\n    private readonly dictationRelativeUri: string = \"/speech/recognition/dictation/cognitiveservices/v1\";\r\n\r\n    public create = (\r\n        config: RecognizerConfig,\r\n        authInfo: AuthInfo,\r\n        connectionId?: string): IConnection => {\r\n\r\n        let endpoint: string = config.parameters.getProperty(PropertyId.SpeechServiceConnection_Endpoint, undefined);\r\n        const region: string = config.parameters.getProperty(PropertyId.SpeechServiceConnection_Region, undefined);\r\n        const hostSuffix: string =  (region && region.toLowerCase().startsWith(\"china\")) ? \".azure.cn\" : \".microsoft.com\";\r\n        const host: string = config.parameters.getProperty(PropertyId.SpeechServiceConnection_Host, \"wss://\" + region + \".stt.speech\" + hostSuffix);\r\n\r\n        const queryParams: IStringDictionary<string> = {};\r\n\r\n        const endpointId: string = config.parameters.getProperty(PropertyId.SpeechServiceConnection_EndpointId, undefined);\r\n        const language: string = config.parameters.getProperty(PropertyId.SpeechServiceConnection_RecoLanguage, undefined);\r\n\r\n        if (endpointId) {\r\n            if (!endpoint || endpoint.search(QueryParameterNames.CustomSpeechDeploymentId) === -1) {\r\n                queryParams[QueryParameterNames.CustomSpeechDeploymentId] = endpointId;\r\n            }\r\n        } else if (language) {\r\n            if (!endpoint || endpoint.search(QueryParameterNames.Language) === -1) {\r\n                queryParams[QueryParameterNames.Language] = language;\r\n            }\r\n        }\r\n\r\n        if (!endpoint || endpoint.search(QueryParameterNames.Format) === -1) {\r\n            queryParams[QueryParameterNames.Format] = config.parameters.getProperty(OutputFormatPropertyName, OutputFormat[OutputFormat.Simple]).toLowerCase();\r\n        }\r\n\r\n        if (config.autoDetectSourceLanguages !== undefined) {\r\n            queryParams[QueryParameterNames.EnableLanguageId] = \"true\";\r\n        }\r\n\r\n        this.setCommonUrlParams(config, queryParams, endpoint);\r\n\r\n        if (!endpoint) {\r\n            switch (config.recognitionMode) {\r\n                case RecognitionMode.Conversation:\r\n                    if (config.parameters.getProperty(ForceDictationPropertyName, \"false\") === \"true\") {\r\n                        endpoint = host + this.dictationRelativeUri;\r\n                    } else {\r\n                        endpoint = host + this.conversationRelativeUri;\r\n                    }\r\n                    break;\r\n                case RecognitionMode.Dictation:\r\n                    endpoint = host + this.dictationRelativeUri;\r\n                    break;\r\n                default:\r\n                    endpoint = host + this.interactiveRelativeUri; // default is interactive\r\n                    break;\r\n            }\r\n        }\r\n\r\n        const headers: IStringDictionary<string> = {};\r\n        if (authInfo.token !== undefined && authInfo.token !== \"\") {\r\n            headers[authInfo.headerName] = authInfo.token;\r\n        }\r\n        headers[HeaderNames.ConnectionId] = connectionId;\r\n\r\n        config.parameters.setProperty(PropertyId.SpeechServiceConnection_Url, endpoint);\r\n\r\n        const enableCompression: boolean = config.parameters.getProperty(\"SPEECH-EnableWebsocketCompression\", \"false\") === \"true\";\r\n        return new WebsocketConnection(endpoint, queryParams, headers, new WebsocketMessageFormatter(), ProxyInfo.fromRecognizerConfig(config), enableCompression, connectionId);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { PropertyCollection, RecognitionResult, ResultReason } from \"./Exports\";\r\n\r\n/**\r\n * Defines result of speech recognition.\r\n * @class SpeechRecognitionResult\r\n */\r\nexport class SpeechRecognitionResult extends RecognitionResult {\r\n    private readonly privSpeakerId: string;\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @public\r\n     * @param {string} resultId - The result id.\r\n     * @param {ResultReason} reason - The reason.\r\n     * @param {string} text - The recognized text.\r\n     * @param {number} duration - The duration.\r\n     * @param {number} offset - The offset into the stream.\r\n     * @param {string} language - Primary Language detected, if provided.\r\n     * @param {string} languageDetectionConfidence - Primary Language confidence (\"Unknown,\" \"Low,\" \"Medium,\" \"High\"...), if provided.\r\n     * @param {string} speakerId - speaker id for conversation transcription, if provided.\r\n     * @param {string} errorDetails - Error details, if provided.\r\n     * @param {string} json - Additional Json, if provided.\r\n     * @param {PropertyCollection} properties - Additional properties, if provided.\r\n     */\r\n    public constructor(resultId?: string, reason?: ResultReason, text?: string,\r\n                       duration?: number, offset?: number, language?: string,\r\n                       languageDetectionConfidence?: string, speakerId?: string, errorDetails?: string,\r\n                       json?: string, properties?: PropertyCollection) {\r\n        super(resultId, reason, text, duration, offset, language, languageDetectionConfidence, errorDetails, json, properties);\r\n        this.privSpeakerId = speakerId;\r\n    }\r\n\r\n    /**\r\n     * speaker id from conversation transcription/id scenarios\r\n     * @member SpeechRecognitionResult.prototype.speakerId\r\n     * @function\r\n     * @public\r\n     * @returns {string} id of speaker in given result\r\n     */\r\n    public get speakerId(): string {\r\n        return this.privSpeakerId;\r\n    }\r\n\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { PropertyCollection, ResultReason } from \"./Exports\";\r\n\r\n/**\r\n * Defines result of speech recognition.\r\n * @class RecognitionResult\r\n */\r\nexport class RecognitionResult {\r\n    private privResultId: string;\r\n    private privReason: ResultReason;\r\n    private privText: string;\r\n    private privDuration: number;\r\n    private privOffset: number;\r\n    private privLanguage: string;\r\n    private privLanguageDetectionConfidence: string;\r\n    private privErrorDetails: string;\r\n    private privJson: string;\r\n    private privProperties: PropertyCollection;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {string} resultId - The result id.\r\n     * @param {ResultReason} reason - The reason.\r\n     * @param {string} text - The recognized text.\r\n     * @param {number} duration - The duration.\r\n     * @param {number} offset - The offset into the stream.\r\n     * @param {string} language - Primary Language detected, if provided.\r\n     * @param {string} languageDetectionConfidence - Primary Language confidence (\"Unknown,\" \"Low,\" \"Medium,\" \"High\"...), if provided.\r\n     * @param {string} errorDetails - Error details, if provided.\r\n     * @param {string} json - Additional Json, if provided.\r\n     * @param {PropertyCollection} properties - Additional properties, if provided.\r\n     */\r\n    constructor(resultId?: string, reason?: ResultReason, text?: string, duration?: number,\r\n                offset?: number, language?: string, languageDetectionConfidence?: string, errorDetails?: string, json?: string, properties?: PropertyCollection) {\r\n        this.privResultId = resultId;\r\n        this.privReason = reason;\r\n        this.privText = text;\r\n        this.privDuration = duration;\r\n        this.privOffset = offset;\r\n        this.privLanguage = language;\r\n        this.privLanguageDetectionConfidence = languageDetectionConfidence;\r\n        this.privErrorDetails = errorDetails;\r\n        this.privJson = json;\r\n        this.privProperties = properties;\r\n    }\r\n\r\n    /**\r\n     * Specifies the result identifier.\r\n     * @member RecognitionResult.prototype.resultId\r\n     * @function\r\n     * @public\r\n     * @returns {string} Specifies the result identifier.\r\n     */\r\n    public get resultId(): string {\r\n        return this.privResultId;\r\n    }\r\n\r\n    /**\r\n     * Specifies status of the result.\r\n     * @member RecognitionResult.prototype.reason\r\n     * @function\r\n     * @public\r\n     * @returns {ResultReason} Specifies status of the result.\r\n     */\r\n    public get reason(): ResultReason {\r\n        return this.privReason;\r\n    }\r\n\r\n    /**\r\n     * Presents the recognized text in the result.\r\n     * @member RecognitionResult.prototype.text\r\n     * @function\r\n     * @public\r\n     * @returns {string} Presents the recognized text in the result.\r\n     */\r\n    public get text(): string {\r\n        return this.privText;\r\n    }\r\n\r\n    /**\r\n     * Duration of recognized speech in 100 nano second incements.\r\n     * @member RecognitionResult.prototype.duration\r\n     * @function\r\n     * @public\r\n     * @returns {number} Duration of recognized speech in 100 nano second incements.\r\n     */\r\n    public get duration(): number {\r\n        return this.privDuration;\r\n    }\r\n\r\n    /**\r\n     * Offset of recognized speech in 100 nano second incements.\r\n     * @member RecognitionResult.prototype.offset\r\n     * @function\r\n     * @public\r\n     * @returns {number} Offset of recognized speech in 100 nano second incements.\r\n     */\r\n    public get offset(): number {\r\n        return this.privOffset;\r\n    }\r\n\r\n    /**\r\n     * Primary Language detected.\r\n     * @member RecognitionResult.prototype.language\r\n     * @function\r\n     * @public\r\n     * @returns {string} language detected.\r\n     */\r\n    public get language(): string {\r\n        return this.privLanguage;\r\n    }\r\n\r\n    /**\r\n     * Primary Language detection confidence (Unknown, Low, Medium, High).\r\n     * @member RecognitionResult.prototype.languageDetectionConfidence\r\n     * @function\r\n     * @public\r\n     * @returns {string} detection confidence strength.\r\n     */\r\n    public get languageDetectionConfidence(): string {\r\n        return this.privLanguageDetectionConfidence;\r\n    }\r\n\r\n    /**\r\n     * In case of an unsuccessful recognition, provides details of the occurred error.\r\n     * @member RecognitionResult.prototype.errorDetails\r\n     * @function\r\n     * @public\r\n     * @returns {string} a brief description of an error.\r\n     */\r\n    public get errorDetails(): string {\r\n        return this.privErrorDetails;\r\n    }\r\n\r\n    /**\r\n     * A string containing Json serialized recognition result as it was received from the service.\r\n     * @member RecognitionResult.prototype.json\r\n     * @function\r\n     * @private\r\n     * @returns {string} Json serialized representation of the result.\r\n     */\r\n    public get json(): string {\r\n        return this.privJson;\r\n    }\r\n\r\n    /**\r\n     *  The set of properties exposed in the result.\r\n     * @member RecognitionResult.prototype.properties\r\n     * @function\r\n     * @public\r\n     * @returns {PropertyCollection} The set of properties exposed in the result.\r\n     */\r\n    public get properties(): PropertyCollection {\r\n        return this.privProperties;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { RecognitionEventArgs, SpeechRecognitionResult } from \"./Exports\";\r\n\r\n/**\r\n * Defines contents of speech recognizing/recognized event.\r\n * @class SpeechRecognitionEventArgs\r\n */\r\nexport class SpeechRecognitionEventArgs extends RecognitionEventArgs {\r\n    private privResult: SpeechRecognitionResult;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {SpeechRecognitionResult} result - The speech recognition result.\r\n     * @param {number} offset - The offset.\r\n     * @param {string} sessionId - The session id.\r\n     */\r\n    public constructor(result: SpeechRecognitionResult, offset?: number, sessionId?: string) {\r\n        super(offset, sessionId);\r\n\r\n        this.privResult = result;\r\n    }\r\n\r\n    /**\r\n     * Specifies the recognition result.\r\n     * @member SpeechRecognitionEventArgs.prototype.result\r\n     * @function\r\n     * @public\r\n     * @returns {SpeechRecognitionResult} the recognition result.\r\n     */\r\n    public get result(): SpeechRecognitionResult {\r\n        return this.privResult;\r\n    }\r\n}\r\n\r\n/**\r\n * Defines contents of conversation transcribed/transcribing event.\r\n * @class ConversationTranscriptionEventArgs\r\n */\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class ConversationTranscriptionEventArgs extends SpeechRecognitionEventArgs {\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    CancellationEventArgsBase,\r\n} from \"./CancellationEventArgsBase\";\r\n\r\nexport class SpeechRecognitionCanceledEventArgs extends CancellationEventArgsBase {\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    CancellationErrorCode,\r\n    CancellationEventArgs,\r\n    CancellationReason,\r\n    RecognitionEventArgs\r\n} from \"./Exports\";\r\n\r\n/**\r\n * Defines content of a CancellationEvent.\r\n * @class CancellationEventArgsBase\r\n */\r\nexport class CancellationEventArgsBase extends RecognitionEventArgs implements CancellationEventArgs {\r\n    private privReason: CancellationReason;\r\n    private privErrorDetails: string;\r\n    private privErrorCode: CancellationErrorCode;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {CancellationReason} reason - The cancellation reason.\r\n     * @param {string} errorDetails - Error details, if provided.\r\n     * @param {number} offset - The offset.\r\n     * @param {string} sessionId - The session id.\r\n     */\r\n    public constructor(reason: CancellationReason, errorDetails: string,\r\n                       errorCode: CancellationErrorCode, offset?: number, sessionId?: string) {\r\n        super(offset, sessionId);\r\n\r\n        this.privReason = reason;\r\n        this.privErrorDetails = errorDetails;\r\n        this.privErrorCode = errorCode;\r\n    }\r\n\r\n    /**\r\n     * The reason the recognition was canceled.\r\n     * @member CancellationEventArgsBase.prototype.reason\r\n     * @function\r\n     * @public\r\n     * @returns {CancellationReason} Specifies the reason canceled.\r\n     */\r\n    public get reason(): CancellationReason {\r\n        return this.privReason;\r\n    }\r\n\r\n    /**\r\n     * The error code in case of an unsuccessful operation.\r\n     * @return An error code that represents the error reason.\r\n     */\r\n    public get errorCode(): CancellationErrorCode {\r\n        return this.privErrorCode;\r\n    }\r\n\r\n    /**\r\n     * In case of an unsuccessful operation, provides details of the occurred error.\r\n     * @member CancellationEventArgsBase.prototype.errorDetails\r\n     * @function\r\n     * @public\r\n     * @returns {string} A String that represents the error details.\r\n     */\r\n    public get errorDetails(): string {\r\n        return this.privErrorDetails;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { IAudioSource } from \"../common/Exports\";\r\nimport {\r\n    CancellationErrorCode,\r\n    CancellationReason,\r\n    OutputFormat,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    ResultReason,\r\n    SpeechRecognitionCanceledEventArgs,\r\n    SpeechRecognitionEventArgs,\r\n    SpeechRecognitionResult,\r\n    SpeechRecognizer,\r\n} from \"../sdk/Exports\";\r\nimport {\r\n    CancellationErrorCodePropertyName,\r\n    DetailedSpeechPhrase,\r\n    EnumTranslation,\r\n    OutputFormatPropertyName,\r\n    RecognitionStatus,\r\n    ServiceRecognizerBase,\r\n    SimpleSpeechPhrase,\r\n    SpeechHypothesis,\r\n} from \"./Exports\";\r\nimport { IAuthentication } from \"./IAuthentication\";\r\nimport { IConnectionFactory } from \"./IConnectionFactory\";\r\nimport { RecognizerConfig } from \"./RecognizerConfig\";\r\nimport { SpeechConnectionMessage } from \"./SpeechConnectionMessage.Internal\";\r\n\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class SpeechServiceRecognizer extends ServiceRecognizerBase {\r\n\r\n    private privSpeechRecognizer: SpeechRecognizer;\r\n\r\n    public constructor(\r\n        authentication: IAuthentication,\r\n        connectionFactory: IConnectionFactory,\r\n        audioSource: IAudioSource,\r\n        recognizerConfig: RecognizerConfig,\r\n        speechRecognizer: SpeechRecognizer) {\r\n        super(authentication, connectionFactory, audioSource, recognizerConfig, speechRecognizer);\r\n        this.privSpeechRecognizer = speechRecognizer;\r\n        if (recognizerConfig.autoDetectSourceLanguages !== undefined) {\r\n            const sourceLanguages: string[] = recognizerConfig.autoDetectSourceLanguages.split(\",\");\r\n            this.privSpeechContext.setSection(\"languageId\", {\r\n                languages: sourceLanguages,\r\n                onSuccess: { action: \"Recognize\" },\r\n                onUnknown: { action: \"None\" }\r\n            });\r\n            this.privSpeechContext.setSection(\"phraseOutput\", {\r\n                interimResults: {\r\n                    resultType: \"Auto\"\r\n                },\r\n                phraseResults: {\r\n                    resultType: \"Always\"\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    protected async processTypeSpecificMessages(connectionMessage: SpeechConnectionMessage): Promise<boolean> {\r\n\r\n        let result: SpeechRecognitionResult;\r\n        const resultProps: PropertyCollection = new PropertyCollection();\r\n        resultProps.setProperty(PropertyId.SpeechServiceResponse_JsonResult, connectionMessage.textBody);\r\n        let processed: boolean = false;\r\n\r\n        switch (connectionMessage.path.toLowerCase()) {\r\n            case \"speech.hypothesis\":\r\n            case \"speech.fragment\":\r\n                const hypothesis: SpeechHypothesis = SpeechHypothesis.fromJSON(connectionMessage.textBody);\r\n                const offset: number = hypothesis.Offset + this.privRequestSession.currentTurnAudioOffset;\r\n\r\n                result = new SpeechRecognitionResult(\r\n                    this.privRequestSession.requestId,\r\n                    ResultReason.RecognizingSpeech,\r\n                    hypothesis.Text,\r\n                    hypothesis.Duration,\r\n                    offset,\r\n                    hypothesis.Language,\r\n                    hypothesis.LanguageDetectionConfidence,\r\n                    undefined, // Speaker Id\r\n                    undefined,\r\n                    connectionMessage.textBody,\r\n                    resultProps);\r\n\r\n                this.privRequestSession.onHypothesis(offset);\r\n\r\n                const ev = new SpeechRecognitionEventArgs(result, hypothesis.Duration, this.privRequestSession.sessionId);\r\n\r\n                if (!!this.privSpeechRecognizer.recognizing) {\r\n                    try {\r\n                        this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer, ev);\r\n                        /* tslint:disable:no-empty */\r\n                    } catch (error) {\r\n                        // Not going to let errors in the event handler\r\n                        // trip things up.\r\n                    }\r\n                }\r\n                processed = true;\r\n                break;\r\n            case \"speech.phrase\":\r\n                const simple: SimpleSpeechPhrase = SimpleSpeechPhrase.fromJSON(connectionMessage.textBody);\r\n                const resultReason: ResultReason = EnumTranslation.implTranslateRecognitionResult(simple.RecognitionStatus);\r\n\r\n                this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset + simple.Offset + simple.Duration);\r\n\r\n                if (ResultReason.Canceled === resultReason) {\r\n                    const cancelReason: CancellationReason = EnumTranslation.implTranslateCancelResult(simple.RecognitionStatus);\r\n\r\n                    await this.cancelRecognitionLocal(\r\n                        cancelReason,\r\n                        EnumTranslation.implTranslateCancelErrorCode(simple.RecognitionStatus),\r\n                        undefined);\r\n\r\n                } else {\r\n                    if (!(this.privRequestSession.isSpeechEnded && resultReason === ResultReason.NoMatch && simple.RecognitionStatus !== RecognitionStatus.InitialSilenceTimeout)) {\r\n                        if (this.privRecognizerConfig.parameters.getProperty(OutputFormatPropertyName) === OutputFormat[OutputFormat.Simple]) {\r\n                            result = new SpeechRecognitionResult(\r\n                                this.privRequestSession.requestId,\r\n                                resultReason,\r\n                                simple.DisplayText,\r\n                                simple.Duration,\r\n                                simple.Offset + this.privRequestSession.currentTurnAudioOffset,\r\n                                simple.Language,\r\n                                simple.LanguageDetectionConfidence,\r\n                                undefined, // Speaker Id\r\n                                undefined,\r\n                                connectionMessage.textBody,\r\n                                resultProps);\r\n                        } else {\r\n                            const detailed: DetailedSpeechPhrase = DetailedSpeechPhrase.fromJSON(connectionMessage.textBody);\r\n\r\n                            result = new SpeechRecognitionResult(\r\n                                this.privRequestSession.requestId,\r\n                                resultReason,\r\n                                detailed.RecognitionStatus === RecognitionStatus.Success ? detailed.NBest[0].Display : undefined,\r\n                                detailed.Duration,\r\n                                detailed.Offset + this.privRequestSession.currentTurnAudioOffset,\r\n                                detailed.Language,\r\n                                detailed.LanguageDetectionConfidence,\r\n                                undefined, // Speaker Id\r\n                                undefined,\r\n                                connectionMessage.textBody,\r\n                                resultProps);\r\n                        }\r\n\r\n                        const event: SpeechRecognitionEventArgs = new SpeechRecognitionEventArgs(result, result.offset, this.privRequestSession.sessionId);\r\n\r\n                        if (!!this.privSpeechRecognizer.recognized) {\r\n                            try {\r\n                                this.privSpeechRecognizer.recognized(this.privSpeechRecognizer, event);\r\n                                /* tslint:disable:no-empty */\r\n                            } catch (error) {\r\n                                // Not going to let errors in the event handler\r\n                                // trip things up.\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (!!this.privSuccessCallback) {\r\n                        try {\r\n                            this.privSuccessCallback(result);\r\n                        } catch (e) {\r\n                            if (!!this.privErrorCallback) {\r\n                                this.privErrorCallback(e);\r\n                            }\r\n                        }\r\n                        // Only invoke the call back once.\r\n                        // and if it's successful don't invoke the\r\n                        // error after that.\r\n                        this.privSuccessCallback = undefined;\r\n                        this.privErrorCallback = undefined;\r\n                    }\r\n                }\r\n                processed = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return processed;\r\n    }\r\n\r\n    // Cancels recognition.\r\n    protected cancelRecognition(\r\n        sessionId: string,\r\n        requestId: string,\r\n        cancellationReason: CancellationReason,\r\n        errorCode: CancellationErrorCode,\r\n        error: string): void {\r\n\r\n        const properties: PropertyCollection = new PropertyCollection();\r\n        properties.setProperty(CancellationErrorCodePropertyName, CancellationErrorCode[errorCode]);\r\n\r\n        if (!!this.privSpeechRecognizer.canceled) {\r\n            const cancelEvent: SpeechRecognitionCanceledEventArgs = new SpeechRecognitionCanceledEventArgs(\r\n                cancellationReason,\r\n                error,\r\n                errorCode,\r\n                undefined,\r\n                sessionId);\r\n            try {\r\n                this.privSpeechRecognizer.canceled(this.privSpeechRecognizer, cancelEvent);\r\n                /* tslint:disable:no-empty */\r\n            } catch { }\r\n        }\r\n\r\n        if (!!this.privSuccessCallback) {\r\n            const result: SpeechRecognitionResult = new SpeechRecognitionResult(\r\n                requestId,\r\n                ResultReason.Canceled,\r\n                undefined, // Text\r\n                undefined, // Duration\r\n                undefined, // Offset\r\n                undefined, // Language\r\n                undefined, // Language Detection Confidence\r\n                undefined, // Speaker Id\r\n                error,\r\n                undefined, // Json\r\n                properties);\r\n            try {\r\n                this.privSuccessCallback(result);\r\n                this.privSuccessCallback = undefined;\r\n                /* tslint:disable:no-empty */\r\n            } catch { }\r\n        }\r\n    }\r\n}\r\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","import _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { AudioStreamFormatImpl } from \"../../src/sdk/Audio/AudioStreamFormat\";\r\nimport {\r\n    IAudioStreamNode,\r\n    IStreamChunk,\r\n} from \"../common/Exports\";\r\n\r\nexport class ReplayableAudioNode implements IAudioStreamNode {\r\n    private privAudioNode: IAudioStreamNode;\r\n    private privBytesPerSecond: number;\r\n    private privBuffers: BufferEntry[] = [];\r\n    private privReplayOffset: number = 0;\r\n    private privLastShrinkOffset: number = 0;\r\n    private privBufferStartOffset: number = 0;\r\n    private privBufferSerial: number = 0;\r\n    private privBufferedBytes: number = 0;\r\n    private privReplay: boolean = false;\r\n    private privLastChunkAcquiredTime: number = 0;\r\n\r\n    public constructor(audioSource: IAudioStreamNode, bytesPerSecond: number) {\r\n        this.privAudioNode = audioSource;\r\n        this.privBytesPerSecond = bytesPerSecond;\r\n    }\r\n\r\n    public id = (): string => {\r\n        return this.privAudioNode.id();\r\n    }\r\n\r\n    // Reads and returns the next chunk of audio buffer.\r\n    // If replay of existing buffers are needed, read() will first seek and replay\r\n    // existing content, and upoin completion it will read new content from the underlying\r\n    // audio node, saving that content into the replayable buffers.\r\n    public read(): Promise<IStreamChunk<ArrayBuffer>> {\r\n        // if there is a replay request to honor.\r\n        if (!!this.privReplay && this.privBuffers.length !== 0) {\r\n            // Find the start point in the buffers.\r\n            // Offsets are in 100ns increments.\r\n            // So how many bytes do we need to seek to get the right offset?\r\n            const offsetToSeek: number = this.privReplayOffset - this.privBufferStartOffset;\r\n\r\n            let bytesToSeek: number = Math.round(offsetToSeek * this.privBytesPerSecond * 1e-7);\r\n            if (0 !== (bytesToSeek % 2)) {\r\n                bytesToSeek++;\r\n            }\r\n\r\n            let i: number = 0;\r\n\r\n            while (i < this.privBuffers.length && bytesToSeek >= this.privBuffers[i].chunk.buffer.byteLength) {\r\n                bytesToSeek -= this.privBuffers[i++].chunk.buffer.byteLength;\r\n            }\r\n\r\n            if (i < this.privBuffers.length) {\r\n                const retVal: ArrayBuffer = this.privBuffers[i].chunk.buffer.slice(bytesToSeek);\r\n\r\n                this.privReplayOffset += (retVal.byteLength / this.privBytesPerSecond) * 1e+7;\r\n\r\n                // If we've reached the end of the buffers, stop replaying.\r\n                if (i === this.privBuffers.length - 1) {\r\n                    this.privReplay = false;\r\n                }\r\n\r\n                return Promise.resolve<IStreamChunk<ArrayBuffer>>({\r\n                    buffer: retVal,\r\n                    isEnd: false,\r\n                    timeReceived: this.privBuffers[i].chunk.timeReceived,\r\n                });\r\n            }\r\n        }\r\n\r\n        return this.privAudioNode.read()\r\n            .then((result: IStreamChunk<ArrayBuffer>) => {\r\n                if (result && result.buffer) {\r\n                    this.privBuffers.push(new BufferEntry(result, this.privBufferSerial++, this.privBufferedBytes));\r\n                    this.privBufferedBytes += result.buffer.byteLength;\r\n                }\r\n                return result;\r\n            });\r\n    }\r\n\r\n    public detach(): Promise<void> {\r\n        this.privBuffers = undefined;\r\n        return this.privAudioNode.detach();\r\n    }\r\n\r\n    public replay(): void {\r\n        if (this.privBuffers && 0 !== this.privBuffers.length) {\r\n            this.privReplay = true;\r\n            this.privReplayOffset = this.privLastShrinkOffset;\r\n        }\r\n    }\r\n\r\n    // Shrinks the existing audio buffers to start at the new offset, or at the\r\n    // beginning of the buffer closest to the requested offset.\r\n    // A replay request will start from the last shrink point.\r\n    public shrinkBuffers(offset: number): void {\r\n        if (this.privBuffers === undefined || this.privBuffers.length === 0) {\r\n            return;\r\n        }\r\n\r\n        this.privLastShrinkOffset = offset;\r\n\r\n        // Find the start point in the buffers.\r\n        // Offsets are in 100ns increments.\r\n        // So how many bytes do we need to seek to get the right offset?\r\n        const offsetToSeek: number = offset - this.privBufferStartOffset;\r\n\r\n        let bytesToSeek: number = Math.round(offsetToSeek * this.privBytesPerSecond * 1e-7);\r\n\r\n        let i: number = 0;\r\n\r\n        while (i < this.privBuffers.length && bytesToSeek >= this.privBuffers[i].chunk.buffer.byteLength) {\r\n            bytesToSeek -= this.privBuffers[i++].chunk.buffer.byteLength;\r\n        }\r\n        this.privBufferStartOffset = Math.round(offset - ((bytesToSeek / this.privBytesPerSecond) * 1e+7));\r\n        this.privBuffers = this.privBuffers.slice(i);\r\n    }\r\n\r\n    // Finds the time a buffer of audio was first seen by offset.\r\n    public findTimeAtOffset(offset: number): number {\r\n        if (offset < this.privBufferStartOffset || this.privBuffers === undefined) {\r\n            return 0;\r\n        }\r\n\r\n        for (const value of this.privBuffers) {\r\n            const startOffset: number = (value.byteOffset / this.privBytesPerSecond) * 1e7;\r\n            const endOffset: number = startOffset + ((value.chunk.buffer.byteLength / this.privBytesPerSecond) * 1e7);\r\n\r\n            if (offset >= startOffset && offset <= endOffset) {\r\n                return value.chunk.timeReceived;\r\n            }\r\n        }\r\n\r\n        return 0;\r\n    }\r\n}\r\n\r\n// Primary use of this class is to help debugging problems with the replay\r\n// code. If the memory cost of alloc / dealloc gets too much, drop it and just use\r\n// the ArrayBuffer directly.\r\n// tslint:disable-next-line:max-classes-per-file\r\nclass BufferEntry {\r\n    public chunk: IStreamChunk<ArrayBuffer>;\r\n    public serial: number;\r\n    public byteOffset: number;\r\n\r\n    public constructor(chunk: IStreamChunk<ArrayBuffer>, serial: number, byteOffset: number) {\r\n        this.chunk = chunk;\r\n        this.serial = serial;\r\n        this.byteOffset = byteOffset;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\ntype TWorkerMessage = ICallNotification | IClearResponse | IErrorNotification | IErrorResponse;\r\n\r\ninterface IClearResponse {\r\n    error: null;\r\n    id: number;\r\n}\r\n\r\ninterface IErrorNotification {\r\n    error: {\r\n        message: string;\r\n    };\r\n    id: null;\r\n    result: null;\r\n}\r\n\r\ninterface IErrorResponse {\r\n    error: {\r\n        message: string;\r\n    };\r\n    id: number;\r\n    result: null;\r\n}\r\n\r\ninterface ICallNotification {\r\n    id: null;\r\n    method: \"call\";\r\n    params: {\r\n        timerId: number;\r\n    };\r\n}\r\n\r\ninterface ISetNotification {\r\n    id: null;\r\n    method: \"set\";\r\n    params: {\r\n        delay: number;\r\n        now: number;\r\n        timerId: number;\r\n    };\r\n}\r\n\r\ninterface IClearRequest {\r\n    id: number;\r\n    method: \"clear\";\r\n    params: {\r\n        timerId: number;\r\n    };\r\n}\r\n\r\ninterface IWorkerEvent extends Event {\r\n    data: TWorkerMessage;\r\n}\r\n\r\ninterface IWorkerTimers {\r\n    clearTimeout: (timerId: number) => void;\r\n    setTimeout: (func: () => any, delay: number) => number;\r\n}\r\n\r\ndeclare type Func = () => any;\r\n\r\nexport class Timeout {\r\n\r\n    private static workerTimers: null | IWorkerTimers = null;\r\n\r\n    public static clearTimeout: IWorkerTimers[\"clearTimeout\"] = (timerId) => Timeout.timers().clearTimeout(timerId);\r\n\r\n    public static setTimeout: IWorkerTimers[\"setTimeout\"] = (func, delay) => Timeout.timers().setTimeout(func, delay);\r\n\r\n    public static load = (url: string) => {\r\n        // Prefilling the Maps with a function indexed by zero is necessary to be compliant with the specification.\r\n        const scheduledTimeoutFunctions: Map<number, number | Func> = new Map([[0, () => { }]]); // tslint:disable-line no-empty\r\n        const unhandledRequests: Map<number, number> = new Map();\r\n\r\n        const worker = new Worker(url);\r\n\r\n        worker.addEventListener(\"message\", ({ data }: IWorkerEvent) => {\r\n            if (Timeout.isCallNotification(data)) {\r\n                const {\r\n                    params: { timerId }\r\n                } = data;\r\n\r\n                const idOrFunc = scheduledTimeoutFunctions.get(timerId);\r\n\r\n                if (typeof idOrFunc === \"number\") {\r\n                    const unhandledTimerId = unhandledRequests.get(idOrFunc);\r\n\r\n                    if (\r\n                        unhandledTimerId === undefined ||\r\n                        unhandledTimerId !== timerId\r\n                    ) {\r\n                        throw new Error(\"The timer is in an undefined state.\");\r\n                    }\r\n                } else if (typeof idOrFunc !== \"undefined\") {\r\n                    idOrFunc();\r\n\r\n                    // A timeout can be safely deleted because it is only called once.\r\n                    scheduledTimeoutFunctions.delete(timerId);\r\n                } else {\r\n                    throw new Error(\"The timer is in an undefined state.\");\r\n                }\r\n            } else if (Timeout.isClearResponse(data)) {\r\n                const { id } = data;\r\n\r\n                const unhandledTimerId = unhandledRequests.get(id);\r\n\r\n                if (unhandledTimerId === undefined) {\r\n                    throw new Error(\"The timer is in an undefined state.\");\r\n                }\r\n\r\n                unhandledRequests.delete(id);\r\n\r\n                scheduledTimeoutFunctions.delete(unhandledTimerId);\r\n            } else {\r\n                const {\r\n                    error: { message }\r\n                } = data;\r\n\r\n                throw new Error(message);\r\n            }\r\n        });\r\n\r\n        const clearTimeout = (timerId: number) => {\r\n            const id = Math.random();\r\n\r\n            unhandledRequests.set(id, timerId);\r\n            scheduledTimeoutFunctions.set(timerId, id);\r\n\r\n            worker.postMessage({\r\n                id,\r\n                method: \"clear\",\r\n                params: { timerId }\r\n            } as IClearRequest);\r\n        };\r\n\r\n        const setTimeout = (func: () => void, delay: number) => {\r\n            const timerId = Math.random();\r\n\r\n            scheduledTimeoutFunctions.set(timerId, func);\r\n\r\n            worker.postMessage({\r\n                id: null,\r\n                method: \"set\",\r\n                params: {\r\n                    delay,\r\n                    now: performance.now(),\r\n                    timerId\r\n                }\r\n            } as ISetNotification);\r\n\r\n            return timerId;\r\n        };\r\n\r\n        return {\r\n            clearTimeout,\r\n            setTimeout\r\n        };\r\n    }\r\n\r\n    private static loadWorkerTimers = () => {\r\n        const worker = `!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=14)}([function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i})),n.d(t,\"b\",(function(){return u})),n.d(t,\"c\",(function(){return a})),n.d(t,\"d\",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id \"'.concat(e,'\".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id \"'.concat(e,'\".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if(\"performance\"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o=\"performance\"in self?performance.now():Date.now();o>n?postMessage({id:null,method:\"call\",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){\"use strict\";n.r(t);var r=n(2);for(var o in r)\"default\"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)\"default\"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)\"default\"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)\"default\"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)\"default\"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)\"default\"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)\"default\"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)\"default\"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){\"use strict\";n.r(t);var r=n(11);for(var o in r)\"default\"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)\"default\"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)\"default\"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){\"use strict\";n.r(t);var r=n(0),o=n(1);for(var i in o)\"default\"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)\"default\"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener(\"message\",({data:e})=>{try{if(\"clear\"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if(\"set\"!==e.method)throw new Error('The given method \"'.concat(e.method,'\" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`; // tslint:disable-line:max-line-length\r\n        return () => {\r\n            if (Timeout.workerTimers !== null) {\r\n                return Timeout.workerTimers;\r\n            }\r\n\r\n            const blob = new Blob([worker], { type: \"application/javascript; charset=utf-8\" });\r\n            const url = URL.createObjectURL(blob);\r\n\r\n            Timeout.workerTimers = Timeout.load(url);\r\n\r\n            // Edge doesn't like the URL to be revoked directly.\r\n            Timeout.workerTimers.setTimeout(() => URL.revokeObjectURL(url), 0);\r\n\r\n            return Timeout.workerTimers as IWorkerTimers;\r\n        };\r\n    }\r\n\r\n    public static timers: () => IWorkerTimers = Timeout.loadWorkerTimers();\r\n\r\n    private static isCallNotification = (message: TWorkerMessage): message is ICallNotification => {\r\n        return (message as ICallNotification).method !== undefined && (message as ICallNotification).method === \"call\";\r\n    }\r\n\r\n    private static isClearResponse = (message: TWorkerMessage): message is IClearResponse => {\r\n        return (message as IClearResponse).error === null && typeof message.id === \"number\";\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ReplayableAudioNode } from \"../common.browser/Exports\";\r\nimport {\r\n    ArgumentNullError,\r\n    ConnectionClosedEvent,\r\n    ConnectionEvent,\r\n    ConnectionState,\r\n    createNoDashGuid,\r\n    EventSource,\r\n    IAudioSource,\r\n    IAudioStreamNode,\r\n    IConnection,\r\n    IDisposable,\r\n    IStreamChunk,\r\n    MessageType,\r\n    ServiceEvent,\r\n    Timeout\r\n} from \"../common/Exports\";\r\nimport { AudioStreamFormatImpl } from \"../sdk/Audio/AudioStreamFormat\";\r\nimport {\r\n    CancellationErrorCode,\r\n    CancellationReason,\r\n    PropertyId,\r\n    RecognitionEventArgs,\r\n    Recognizer,\r\n    SessionEventArgs,\r\n    SpeechRecognitionResult,\r\n} from \"../sdk/Exports\";\r\nimport { Callback } from \"../sdk/Transcription/IConversation\";\r\nimport {\r\n    AgentConfig,\r\n    DynamicGrammarBuilder,\r\n    ISpeechConfigAudioDevice,\r\n    RecognitionMode,\r\n    RequestSession,\r\n    SpeechContext,\r\n    SpeechDetected,\r\n    type\r\n} from \"./Exports\";\r\nimport {\r\n    AuthInfo,\r\n    IAuthentication,\r\n} from \"./IAuthentication\";\r\nimport { IConnectionFactory } from \"./IConnectionFactory\";\r\nimport { RecognizerConfig } from \"./RecognizerConfig\";\r\nimport { SpeechConnectionMessage } from \"./SpeechConnectionMessage.Internal\";\r\n\r\nexport abstract class ServiceRecognizerBase implements IDisposable {\r\n    private privAuthentication: IAuthentication;\r\n    private privConnectionFactory: IConnectionFactory;\r\n\r\n    // A promise for a configured connection.\r\n    // Do not consume directly, call fetchConnection instead.\r\n    private privConnectionConfigurationPromise: Promise<IConnection>;\r\n\r\n    // A promise for a connection, but one that has not had the speech context sent yet.\r\n    // Do not consume directly, call fetchConnection instead.\r\n    private privConnectionPromise: Promise<IConnection>;\r\n    private privAuthFetchEventId: string;\r\n    private privIsDisposed: boolean;\r\n    private privMustReportEndOfStream: boolean;\r\n    private privConnectionEvents: EventSource<ConnectionEvent>;\r\n    private privServiceEvents: EventSource<ServiceEvent>;\r\n    private privDynamicGrammar: DynamicGrammarBuilder;\r\n    private privAgentConfig: AgentConfig;\r\n    private privServiceHasSentMessage: boolean;\r\n    private privActivityTemplate: string;\r\n    private privSetTimeout: (cb: () => void, delay: number) => number = setTimeout;\r\n    private privAudioSource: IAudioSource;\r\n    private privIsLiveAudio: boolean = false;\r\n    protected privSpeechContext: SpeechContext;\r\n    protected privRequestSession: RequestSession;\r\n    protected privConnectionId: string;\r\n    protected privRecognizerConfig: RecognizerConfig;\r\n    protected privRecognizer: Recognizer;\r\n    protected privSuccessCallback: (e: SpeechRecognitionResult) => void;\r\n    protected privErrorCallback: (e: string) => void;\r\n\r\n    public constructor(\r\n        authentication: IAuthentication,\r\n        connectionFactory: IConnectionFactory,\r\n        audioSource: IAudioSource,\r\n        recognizerConfig: RecognizerConfig,\r\n        recognizer: Recognizer) {\r\n\r\n        if (!authentication) {\r\n            throw new ArgumentNullError(\"authentication\");\r\n        }\r\n\r\n        if (!connectionFactory) {\r\n            throw new ArgumentNullError(\"connectionFactory\");\r\n        }\r\n\r\n        if (!audioSource) {\r\n            throw new ArgumentNullError(\"audioSource\");\r\n        }\r\n\r\n        if (!recognizerConfig) {\r\n            throw new ArgumentNullError(\"recognizerConfig\");\r\n        }\r\n\r\n        this.privMustReportEndOfStream = false;\r\n        this.privAuthentication = authentication;\r\n        this.privConnectionFactory = connectionFactory;\r\n        this.privAudioSource = audioSource;\r\n        this.privRecognizerConfig = recognizerConfig;\r\n        this.privIsDisposed = false;\r\n        this.privRecognizer = recognizer;\r\n        this.privRequestSession = new RequestSession(this.privAudioSource.id());\r\n        this.privConnectionEvents = new EventSource<ConnectionEvent>();\r\n        this.privServiceEvents = new EventSource<ServiceEvent>();\r\n        this.privDynamicGrammar = new DynamicGrammarBuilder();\r\n        this.privSpeechContext = new SpeechContext(this.privDynamicGrammar);\r\n        this.privAgentConfig = new AgentConfig();\r\n        if (typeof (Blob) !== \"undefined\" && typeof (Worker) !== \"undefined\") {\r\n            this.privSetTimeout = Timeout.setTimeout;\r\n        }\r\n\r\n        this.connectionEvents.attach(async (connectionEvent: ConnectionEvent): Promise<void> => {\r\n            if (connectionEvent.name === \"ConnectionClosedEvent\") {\r\n                const connectionClosedEvent = connectionEvent as ConnectionClosedEvent;\r\n                if (connectionClosedEvent.statusCode !== 1000) {\r\n                    await this.cancelRecognitionLocal(CancellationReason.Error,\r\n                        connectionClosedEvent.statusCode === 1007 ? CancellationErrorCode.BadRequestParameters : CancellationErrorCode.ConnectionFailure,\r\n                        connectionClosedEvent.reason + \" websocket error code: \" + connectionClosedEvent.statusCode);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public get audioSource(): IAudioSource {\r\n        return this.privAudioSource;\r\n    }\r\n\r\n    public get speechContext(): SpeechContext {\r\n        return this.privSpeechContext;\r\n    }\r\n\r\n    public get dynamicGrammar(): DynamicGrammarBuilder {\r\n        return this.privDynamicGrammar;\r\n    }\r\n\r\n    public get agentConfig(): AgentConfig {\r\n        return this.privAgentConfig;\r\n    }\r\n\r\n    public set conversationTranslatorToken(token: string) {\r\n        this.privRecognizerConfig.parameters.setProperty(PropertyId.ConversationTranslator_Token, token);\r\n    }\r\n\r\n    public set authentication(auth: IAuthentication) {\r\n        this.privAuthentication = this.authentication;\r\n    }\r\n\r\n    public isDisposed(): boolean {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    public async dispose(reason?: string): Promise<void> {\r\n        this.privIsDisposed = true;\r\n        if (this.privConnectionConfigurationPromise) {\r\n            try {\r\n                const connection: IConnection = await this.privConnectionConfigurationPromise;\r\n                await connection.dispose(reason);\r\n            } catch (error) {\r\n                // The connection is in a bad state. But we're trying to kill it, so...\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    public get connectionEvents(): EventSource<ConnectionEvent> {\r\n        return this.privConnectionEvents;\r\n    }\r\n\r\n    public get serviceEvents(): EventSource<ServiceEvent> {\r\n        return this.privServiceEvents;\r\n    }\r\n\r\n    public get recognitionMode(): RecognitionMode {\r\n        return this.privRecognizerConfig.recognitionMode;\r\n    }\r\n\r\n    protected recognizeOverride: (recoMode: RecognitionMode, sc: (e: SpeechRecognitionResult) => void, ec: (e: string) => void) => any = undefined;\r\n\r\n    public async recognize(\r\n        recoMode: RecognitionMode,\r\n        successCallback: (e: SpeechRecognitionResult) => void,\r\n        errorCallBack: (e: string) => void,\r\n    ): Promise<void> {\r\n\r\n        if (this.recognizeOverride !== undefined) {\r\n            return this.recognizeOverride(recoMode, successCallback, errorCallBack);\r\n        }\r\n        // Clear the existing configuration promise to force a re-transmission of config and context.\r\n        this.privConnectionConfigurationPromise = null;\r\n        this.privRecognizerConfig.recognitionMode = recoMode;\r\n\r\n        this.privSuccessCallback = successCallback;\r\n        this.privErrorCallback = errorCallBack;\r\n\r\n        this.privRequestSession.startNewRecognition();\r\n        this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);\r\n\r\n        // Start the connection to the service. The promise this will create is stored and will be used by configureConnection().\r\n        const conPromise: Promise<IConnection> = this.connectImpl();\r\n        let audioNode: ReplayableAudioNode;\r\n\r\n        try {\r\n            const audioStreamNode: IAudioStreamNode = await this.audioSource.attach(this.privRequestSession.audioNodeId);\r\n            const format: AudioStreamFormatImpl = await this.audioSource.format;\r\n            const deviceInfo: ISpeechConfigAudioDevice = await this.audioSource.deviceInfo;\r\n            this.privIsLiveAudio = deviceInfo.type && deviceInfo.type === type.Microphones;\r\n\r\n            audioNode = new ReplayableAudioNode(audioStreamNode, format.avgBytesPerSec);\r\n            await this.privRequestSession.onAudioSourceAttachCompleted(audioNode, false);\r\n            this.privRecognizerConfig.SpeechServiceConfig.Context.audio = { source: deviceInfo };\r\n\r\n        } catch (error) {\r\n            await this.privRequestSession.onStopRecognizing();\r\n            throw error;\r\n        }\r\n\r\n        try {\r\n            await conPromise;\r\n        } catch (error) {\r\n            await this.cancelRecognitionLocal(CancellationReason.Error, CancellationErrorCode.ConnectionFailure, error);\r\n            return;\r\n        }\r\n\r\n        const sessionStartEventArgs: SessionEventArgs = new SessionEventArgs(this.privRequestSession.sessionId);\r\n\r\n        if (!!this.privRecognizer.sessionStarted) {\r\n            this.privRecognizer.sessionStarted(this.privRecognizer, sessionStartEventArgs);\r\n        }\r\n\r\n        const messageRetrievalPromise = this.receiveMessage();\r\n        const audioSendPromise = this.sendAudio(audioNode);\r\n\r\n        audioSendPromise.catch(async (error: string) => {\r\n            await this.cancelRecognitionLocal(CancellationReason.Error, CancellationErrorCode.RuntimeError, error);\r\n        });\r\n\r\n        return;\r\n    }\r\n\r\n    public async stopRecognizing(): Promise<void> {\r\n        if (this.privRequestSession.isRecognizing) {\r\n            await this.audioSource.turnOff();\r\n            await this.sendFinalAudio();\r\n            await this.privRequestSession.onStopRecognizing();\r\n            await this.privRequestSession.turnCompletionPromise;\r\n            await this.privRequestSession.dispose();\r\n        }\r\n        return;\r\n    }\r\n\r\n    public async connect(): Promise<void> {\r\n        await this.connectImpl();\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public connectAsync(cb?: Callback, err?: Callback): void {\r\n        this.connectImpl().then((connection: IConnection): void => {\r\n            try {\r\n                if (!!cb) {\r\n                    cb();\r\n                }\r\n            } catch (e) {\r\n                if (!!err) {\r\n                    err(e);\r\n                }\r\n            }\r\n        }, (reason: any): void => {\r\n            try {\r\n                if (!!err) {\r\n                    err(reason);\r\n                }\r\n                /* tslint:disable:no-empty */\r\n            } catch (error) {\r\n            }\r\n        });\r\n    }\r\n\r\n    protected disconnectOverride: () => Promise<void> = undefined;\r\n\r\n    public async disconnect(): Promise<void> {\r\n        await this.cancelRecognitionLocal(CancellationReason.Error,\r\n            CancellationErrorCode.NoError,\r\n            \"Disconnecting\");\r\n\r\n        if (this.disconnectOverride !== undefined) {\r\n            await this.disconnectOverride();\r\n        }\r\n\r\n        try {\r\n            await (await this.privConnectionPromise).dispose();\r\n        } catch (error) {\r\n\r\n        }\r\n\r\n        this.privConnectionPromise = null;\r\n    }\r\n\r\n    // Called when telemetry data is sent to the service.\r\n    // Used for testing Telemetry capture.\r\n    public static telemetryData: (json: string) => void;\r\n    public static telemetryDataEnabled: boolean = true;\r\n\r\n    public sendMessage(message: string): void { }\r\n\r\n    public async sendNetworkMessage(path: string, payload: string | ArrayBuffer): Promise<void> {\r\n        const type: MessageType = typeof payload === \"string\" ? MessageType.Text : MessageType.Binary;\r\n        const contentType: string = typeof payload === \"string\" ? \"application/json\" : \"\";\r\n\r\n        const connection: IConnection = await this.fetchConnection();\r\n        return connection.send(new SpeechConnectionMessage(type, path, this.privRequestSession.requestId, contentType, payload));\r\n    }\r\n\r\n    public set activityTemplate(messagePayload: string) { this.privActivityTemplate = messagePayload; }\r\n    public get activityTemplate(): string { return this.privActivityTemplate; }\r\n\r\n    protected abstract processTypeSpecificMessages(\r\n        connectionMessage: SpeechConnectionMessage,\r\n        successCallback?: (e: SpeechRecognitionResult) => void,\r\n        errorCallBack?: (e: string) => void): Promise<boolean>;\r\n\r\n    protected async sendTelemetryData(): Promise<void> {\r\n        const telemetryData = this.privRequestSession.getTelemetry();\r\n        if (ServiceRecognizerBase.telemetryDataEnabled !== true ||\r\n            this.privIsDisposed ||\r\n            null === telemetryData) {\r\n            return;\r\n        }\r\n\r\n        if (!!ServiceRecognizerBase.telemetryData) {\r\n            try {\r\n                ServiceRecognizerBase.telemetryData(telemetryData);\r\n                /* tslint:disable:no-empty */\r\n            } catch { }\r\n        }\r\n\r\n        const connection: IConnection = await this.fetchConnection();\r\n        await connection.send(new SpeechConnectionMessage(\r\n            MessageType.Text,\r\n            \"telemetry\",\r\n            this.privRequestSession.requestId,\r\n            \"application/json\",\r\n            telemetryData));\r\n    }\r\n\r\n    // Cancels recognition.\r\n    protected abstract cancelRecognition(\r\n        sessionId: string,\r\n        requestId: string,\r\n        cancellationReason: CancellationReason,\r\n        errorCode: CancellationErrorCode,\r\n        error: string): void;\r\n\r\n    // Cancels recognition.\r\n    protected async cancelRecognitionLocal(\r\n        cancellationReason: CancellationReason,\r\n        errorCode: CancellationErrorCode,\r\n        error: string): Promise<void> {\r\n\r\n        if (!!this.privRequestSession.isRecognizing) {\r\n            await this.privRequestSession.onStopRecognizing();\r\n\r\n            this.cancelRecognition(\r\n                this.privRequestSession.sessionId,\r\n                this.privRequestSession.requestId,\r\n                cancellationReason,\r\n                errorCode,\r\n                error);\r\n        }\r\n    }\r\n\r\n    protected receiveMessageOverride: () => Promise<void> = undefined;\r\n\r\n    protected async receiveMessage(): Promise<void> {\r\n        try {\r\n            if (this.privIsDisposed) {\r\n                // We're done.\r\n                return;\r\n            }\r\n\r\n            let connection = await this.fetchConnection();\r\n            const message = await connection.read();\r\n\r\n            if (this.receiveMessageOverride !== undefined) {\r\n                return this.receiveMessageOverride();\r\n            }\r\n\r\n            // indicates we are draining the queue and it came with no message;\r\n            if (!message) {\r\n                if (!this.privRequestSession.isRecognizing) {\r\n                    return;\r\n                } else {\r\n                    return this.receiveMessage();\r\n                }\r\n            }\r\n\r\n            this.privServiceHasSentMessage = true;\r\n            const connectionMessage = SpeechConnectionMessage.fromConnectionMessage(message);\r\n\r\n            if (connectionMessage.requestId.toLowerCase() === this.privRequestSession.requestId.toLowerCase()) {\r\n                switch (connectionMessage.path.toLowerCase()) {\r\n                    case \"turn.start\":\r\n                        this.privMustReportEndOfStream = true;\r\n                        this.privRequestSession.onServiceTurnStartResponse();\r\n                        break;\r\n\r\n                    case \"speech.startdetected\":\r\n                        const speechStartDetected: SpeechDetected = SpeechDetected.fromJSON(connectionMessage.textBody);\r\n                        const speechStartEventArgs = new RecognitionEventArgs(speechStartDetected.Offset, this.privRequestSession.sessionId);\r\n                        if (!!this.privRecognizer.speechStartDetected) {\r\n                            this.privRecognizer.speechStartDetected(this.privRecognizer, speechStartEventArgs);\r\n                        }\r\n                        break;\r\n\r\n                    case \"speech.enddetected\":\r\n                        let json: string;\r\n                        if (connectionMessage.textBody.length > 0) {\r\n                            json = connectionMessage.textBody;\r\n                        } else {\r\n                            // If the request was empty, the JSON returned is empty.\r\n                            json = \"{ Offset: 0 }\";\r\n                        }\r\n                        const speechStopDetected: SpeechDetected = SpeechDetected.fromJSON(json);\r\n                        // Only shrink the buffers for continuous recognition.\r\n                        // For single shot, the speech.phrase message will come after the speech.end and it should own buffer shrink.\r\n                        if (this.privRecognizerConfig.isContinuousRecognition) {\r\n                            this.privRequestSession.onServiceRecognized(speechStopDetected.Offset + this.privRequestSession.currentTurnAudioOffset);\r\n                        }\r\n                        const speechStopEventArgs = new RecognitionEventArgs(speechStopDetected.Offset + this.privRequestSession.currentTurnAudioOffset, this.privRequestSession.sessionId);\r\n                        if (!!this.privRecognizer.speechEndDetected) {\r\n                            this.privRecognizer.speechEndDetected(this.privRecognizer, speechStopEventArgs);\r\n                        }\r\n                        break;\r\n\r\n                    case \"turn.end\":\r\n                        await this.sendTelemetryData();\r\n                        if (this.privRequestSession.isSpeechEnded && this.privMustReportEndOfStream) {\r\n                            this.privMustReportEndOfStream = false;\r\n                            await this.cancelRecognitionLocal(CancellationReason.EndOfStream, CancellationErrorCode.NoError, undefined);\r\n                        }\r\n                        const sessionStopEventArgs: SessionEventArgs = new SessionEventArgs(this.privRequestSession.sessionId);\r\n                        await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition);\r\n                        if (!this.privRecognizerConfig.isContinuousRecognition || this.privRequestSession.isSpeechEnded || !this.privRequestSession.isRecognizing) {\r\n                            if (!!this.privRecognizer.sessionStopped) {\r\n                                this.privRecognizer.sessionStopped(this.privRecognizer, sessionStopEventArgs);\r\n                            }\r\n                            return;\r\n                        } else {\r\n                            connection = await this.fetchConnection();\r\n                            await this.sendPrePayloadJSON(connection);\r\n                        }\r\n                        break;\r\n\r\n                    default:\r\n                        if (!await this.processTypeSpecificMessages(connectionMessage)) {\r\n                            // here are some messages that the derived class has not processed, dispatch them to connect class\r\n                            if (!!this.privServiceEvents) {\r\n                                this.serviceEvents.onEvent(new ServiceEvent(connectionMessage.path.toLowerCase(), connectionMessage.textBody));\r\n                            }\r\n                        }\r\n                }\r\n            }\r\n            return this.receiveMessage();\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    protected sendSpeechContext = (connection: IConnection): Promise<void> => {\r\n        const speechContextJson = this.speechContext.toJSON();\r\n\r\n        if (speechContextJson) {\r\n            return connection.send(new SpeechConnectionMessage(\r\n                MessageType.Text,\r\n                \"speech.context\",\r\n                this.privRequestSession.requestId,\r\n                \"application/json\",\r\n                speechContextJson));\r\n        }\r\n        return;\r\n    }\r\n\r\n    protected sendPrePayloadJSONOverride: (connection: IConnection) => Promise<void> = undefined;\r\n\r\n    // Encapsulated for derived service recognizers that need to send additional JSON\r\n    protected async sendPrePayloadJSON(connection: IConnection): Promise<void> {\r\n        if (this.sendPrePayloadJSONOverride !== undefined) {\r\n            return this.sendPrePayloadJSONOverride(connection);\r\n        }\r\n\r\n        await this.sendSpeechContext(connection);\r\n        await this.sendWaveHeader(connection);\r\n        return;\r\n    }\r\n\r\n    protected async sendWaveHeader(connection: IConnection): Promise<void> {\r\n        const format: AudioStreamFormatImpl = await this.audioSource.format;\r\n        // this.writeBufferToConsole(format.header);\r\n        return connection.send(new SpeechConnectionMessage(\r\n            MessageType.Binary,\r\n            \"audio\",\r\n            this.privRequestSession.requestId,\r\n            \"audio/x-wav\",\r\n            format.header\r\n        ));\r\n    }\r\n\r\n    protected postConnectImplOverride: (connection: Promise<IConnection>) => Promise<IConnection> = undefined;\r\n\r\n    // Establishes a websocket connection to the end point.\r\n    protected connectImpl(isUnAuthorized: boolean = false): Promise<IConnection> {\r\n        if (this.privConnectionPromise) {\r\n            return this.privConnectionPromise.then((connection: IConnection): Promise<IConnection> => {\r\n                if (connection.state() === ConnectionState.Disconnected) {\r\n                    this.privConnectionId = null;\r\n                    this.privConnectionPromise = null;\r\n                    this.privServiceHasSentMessage = false;\r\n                    return this.connectImpl();\r\n                }\r\n                return this.privConnectionPromise;\r\n            }, (error: string): Promise<IConnection> => {\r\n                this.privConnectionId = null;\r\n                this.privConnectionPromise = null;\r\n                this.privServiceHasSentMessage = false;\r\n                return this.connectImpl();\r\n            });\r\n        }\r\n\r\n        this.privAuthFetchEventId = createNoDashGuid();\r\n        const sessionId: string = this.privRecognizerConfig.parameters.getProperty(PropertyId.Speech_SessionId, undefined);\r\n        this.privConnectionId = (sessionId !== undefined) ? sessionId : createNoDashGuid();\r\n\r\n        this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId, this.privConnectionId);\r\n\r\n        const authPromise = isUnAuthorized ? this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId) : this.privAuthentication.fetch(this.privAuthFetchEventId);\r\n\r\n        this.privConnectionPromise = authPromise.then(async (result: AuthInfo) => {\r\n            await this.privRequestSession.onAuthCompleted(false);\r\n\r\n            const connection: IConnection = this.privConnectionFactory.create(this.privRecognizerConfig, result, this.privConnectionId);\r\n\r\n            this.privRequestSession.listenForServiceTelemetry(connection.events);\r\n\r\n            // Attach to the underlying event. No need to hold onto the detach pointers as in the event the connection goes away,\r\n            // it'll stop sending events.\r\n            connection.events.attach((event: ConnectionEvent) => {\r\n                this.connectionEvents.onEvent(event);\r\n            });\r\n            const response = await connection.open();\r\n            if (response.statusCode === 200) {\r\n                await this.privRequestSession.onConnectionEstablishCompleted(response.statusCode);\r\n                return Promise.resolve(connection);\r\n            } else if (response.statusCode === 403 && !isUnAuthorized) {\r\n                return this.connectImpl(true);\r\n            } else {\r\n                await this.privRequestSession.onConnectionEstablishCompleted(response.statusCode, response.reason);\r\n                return Promise.reject(`Unable to contact server. StatusCode: ${response.statusCode}, ${this.privRecognizerConfig.parameters.getProperty(PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${response.reason}`);\r\n            }\r\n        }, async (error: string): Promise<IConnection> => {\r\n            await this.privRequestSession.onAuthCompleted(true, error);\r\n            throw new Error(error);\r\n        });\r\n\r\n        // Attach an empty handler to allow the promise to run in the background while\r\n        // other startup events happen. It'll eventually be awaited on.\r\n        this.privConnectionPromise.catch(() => { });\r\n\r\n        if (this.postConnectImplOverride !== undefined) {\r\n            return this.postConnectImplOverride(this.privConnectionPromise);\r\n        }\r\n\r\n        return this.privConnectionPromise;\r\n    }\r\n\r\n    protected configConnectionOverride: (connection: IConnection) => Promise<IConnection> = undefined;\r\n\r\n    protected sendSpeechServiceConfig = (connection: IConnection, requestSession: RequestSession, SpeechServiceConfigJson: string): Promise<void> => {\r\n        // filter out anything that is not required for the service to work.\r\n        if (ServiceRecognizerBase.telemetryDataEnabled !== true) {\r\n            const withTelemetry = JSON.parse(SpeechServiceConfigJson);\r\n\r\n            const replacement: any = {\r\n                context: {\r\n                    system: withTelemetry.context.system,\r\n                },\r\n            };\r\n\r\n            SpeechServiceConfigJson = JSON.stringify(replacement);\r\n        }\r\n\r\n        if (SpeechServiceConfigJson) {\r\n            return connection.send(new SpeechConnectionMessage(\r\n                MessageType.Text,\r\n                \"speech.config\",\r\n                requestSession.requestId,\r\n                \"application/json\",\r\n                SpeechServiceConfigJson));\r\n        }\r\n\r\n        return;\r\n    }\r\n\r\n    protected async fetchConnection(): Promise<IConnection> {\r\n        if (this.privConnectionConfigurationPromise) {\r\n            return this.privConnectionConfigurationPromise.then((connection: IConnection): Promise<IConnection> => {\r\n                if (connection.state() === ConnectionState.Disconnected) {\r\n                    this.privConnectionId = null;\r\n                    this.privConnectionConfigurationPromise = null;\r\n                    this.privServiceHasSentMessage = false;\r\n                    return this.fetchConnection();\r\n                }\r\n                return this.privConnectionConfigurationPromise;\r\n            }, (error: string): Promise<IConnection> => {\r\n                this.privConnectionId = null;\r\n                this.privConnectionConfigurationPromise = null;\r\n                this.privServiceHasSentMessage = false;\r\n                return this.fetchConnection();\r\n            });\r\n        }\r\n        this.privConnectionConfigurationPromise = this.configureConnection();\r\n        return await this.privConnectionConfigurationPromise;\r\n    }\r\n\r\n    protected async sendAudio(audioStreamNode: IAudioStreamNode): Promise<void> {\r\n        const audioFormat: AudioStreamFormatImpl = await this.audioSource.format;\r\n\r\n        // The time we last sent data to the service.\r\n        let nextSendTime: number = Date.now();\r\n\r\n        // Max amount to send before we start to throttle\r\n        const fastLaneSizeMs: string = this.privRecognizerConfig.parameters.getProperty(\"SPEECH-TransmitLengthBeforThrottleMs\", \"5000\");\r\n        const maxSendUnthrottledBytes: number = audioFormat.avgBytesPerSec / 1000 * parseInt(fastLaneSizeMs, 10);\r\n        const startRecogNumber: number = this.privRequestSession.recogNumber;\r\n\r\n        const readAndUploadCycle = async (): Promise<void> => {\r\n            // If speech is done, stop sending audio.\r\n            if (!this.privIsDisposed &&\r\n                !this.privRequestSession.isSpeechEnded &&\r\n                this.privRequestSession.isRecognizing &&\r\n                this.privRequestSession.recogNumber === startRecogNumber) {\r\n\r\n                const connection: IConnection = await this.fetchConnection();\r\n                const audioStreamChunk: IStreamChunk<ArrayBuffer> = await audioStreamNode.read();\r\n                // we have a new audio chunk to upload.\r\n                if (this.privRequestSession.isSpeechEnded) {\r\n                    // If service already recognized audio end then don't send any more audio\r\n                    return;\r\n                }\r\n\r\n                let payload: ArrayBuffer;\r\n                let sendDelay: number;\r\n\r\n                if (!audioStreamChunk || audioStreamChunk.isEnd) {\r\n                    payload = null;\r\n                    sendDelay = 0;\r\n                } else {\r\n                    payload = audioStreamChunk.buffer;\r\n\r\n                    this.privRequestSession.onAudioSent(payload.byteLength);\r\n\r\n                    if (maxSendUnthrottledBytes >= this.privRequestSession.bytesSent) {\r\n                        sendDelay = 0;\r\n                    } else {\r\n                        sendDelay = Math.max(0, nextSendTime - Date.now());\r\n                    }\r\n                }\r\n\r\n                if (0 !== sendDelay) {\r\n                    await this.delay(sendDelay);\r\n                }\r\n\r\n                if (payload !== null) {\r\n                    nextSendTime = Date.now() + (payload.byteLength * 1000 / (audioFormat.avgBytesPerSec * 2));\r\n                }\r\n\r\n                // Are we still alive?\r\n                if (!this.privIsDisposed &&\r\n                    !this.privRequestSession.isSpeechEnded &&\r\n                    this.privRequestSession.isRecognizing &&\r\n                    this.privRequestSession.recogNumber === startRecogNumber) {\r\n                    connection.send(\r\n                        new SpeechConnectionMessage(MessageType.Binary, \"audio\", this.privRequestSession.requestId, null, payload)\r\n                    ).catch(() => {\r\n                        this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(() => { });\r\n                    });\r\n\r\n                    if (!audioStreamChunk?.isEnd) {\r\n                        // this.writeBufferToConsole(payload);\r\n                        // Regardless of success or failure, schedule the next upload.\r\n                        // If the underlying connection was broken, the next cycle will\r\n                        // get a new connection and re-transmit missing audio automatically.\r\n                        return readAndUploadCycle();\r\n                    } else {\r\n                        // the audio stream has been closed, no need to schedule next\r\n                        // read-upload cycle.\r\n                        if (!this.privIsLiveAudio) {\r\n                            this.privRequestSession.onSpeechEnded();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        return readAndUploadCycle();\r\n    }\r\n\r\n    private delay(delayMs: number): Promise<void> {\r\n        return new Promise((resolve: () => void, reject: (error: string) => void) => {\r\n            this.privSetTimeout(resolve, delayMs);\r\n        });\r\n    }\r\n\r\n    private writeBufferToConsole(buffer: ArrayBuffer): void {\r\n        let out: string = \"Buffer Size: \";\r\n        if (null === buffer) {\r\n            out += \"null\";\r\n        } else {\r\n            const readView: Uint8Array = new Uint8Array(buffer);\r\n            out += buffer.byteLength + \"\\r\\n\";\r\n            for (let i: number = 0; i < buffer.byteLength; i++) {\r\n                out += readView[i].toString(16).padStart(2, \"0\") + \" \";\r\n            }\r\n        }\r\n        // tslint:disable-next-line:no-console\r\n        console.info(out);\r\n    }\r\n\r\n    private async sendFinalAudio(): Promise<void> {\r\n        const connection: IConnection = await this.fetchConnection();\r\n        await connection.send(new SpeechConnectionMessage(MessageType.Binary, \"audio\", this.privRequestSession.requestId, null, null));\r\n        return;\r\n    }\r\n\r\n    // Takes an established websocket connection to the endpoint and sends speech configuration information.\r\n    private async configureConnection(): Promise<IConnection> {\r\n        const connection: IConnection = await this.connectImpl();\r\n        if (this.configConnectionOverride !== undefined) {\r\n            return this.configConnectionOverride(connection);\r\n        }\r\n        await this.sendSpeechServiceConfig(connection, this.privRequestSession, this.privRecognizerConfig.SpeechServiceConfig.serialize());\r\n        await this.sendPrePayloadJSON(connection);\r\n        return connection;\r\n    }\r\n}\r\n","import superPropBase from \"@babel/runtime/helpers/esm/superPropBase\";\nexport default function _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}","import getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nexport default function _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { EventType, PlatformEvent } from \"../common/Exports\";\r\n\r\nexport class SpeechSynthesisEvent extends PlatformEvent {\r\n    private privRequestId: string;\r\n\r\n    constructor(eventName: string, requestId: string, eventType: EventType = EventType.Info) {\r\n        super(eventName, eventType);\r\n\r\n        this.privRequestId = requestId;\r\n    }\r\n\r\n    public get requestId(): string {\r\n        return this.privRequestId;\r\n    }\r\n}\r\n\r\nexport class SynthesisTriggeredEvent extends SpeechSynthesisEvent {\r\n    private privSessionAudioDestinationId: string;\r\n    private privTurnAudioDestinationId: string;\r\n\r\n    constructor(requestId: string, sessionAudioDestinationId: string, turnAudioDestinationId: string) {\r\n        super(\"SynthesisTriggeredEvent\", requestId);\r\n\r\n        this.privSessionAudioDestinationId = sessionAudioDestinationId;\r\n        this.privTurnAudioDestinationId = turnAudioDestinationId;\r\n    }\r\n\r\n    public get audioSessionDestinationId(): string {\r\n        return this.privSessionAudioDestinationId;\r\n    }\r\n\r\n    public get audioTurnDestinationId(): string {\r\n        return this.privTurnAudioDestinationId;\r\n    }\r\n}\r\n\r\nexport class ConnectingToSynthesisServiceEvent extends SpeechSynthesisEvent {\r\n    private privAuthFetchEventId: string;\r\n\r\n    constructor(requestId: string, authFetchEventId: string) {\r\n        super(\"ConnectingToSynthesisServiceEvent\", requestId);\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n    }\r\n\r\n    public get authFetchEventId(): string {\r\n        return this.privAuthFetchEventId;\r\n    }\r\n}\r\n\r\nexport class SynthesisStartedEvent extends SpeechSynthesisEvent {\r\n    private privAuthFetchEventId: string;\r\n\r\n    constructor(requestId: string, authFetchEventId: string) {\r\n        super(\"SynthesisStartedEvent\", requestId);\r\n\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n    }\r\n\r\n    public get authFetchEventId(): string {\r\n        return this.privAuthFetchEventId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    createNoDashGuid,\r\n    Deferred,\r\n    Events, IAudioDestination\r\n} from \"../common/Exports\";\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\r\nimport { PullAudioOutputStreamImpl } from \"../sdk/Audio/AudioOutputStream\";\r\nimport { ISynthesisMetadata } from \"./ServiceMessages/SynthesisAudioMetadata\";\r\nimport { SynthesisAdapterBase } from \"./SynthesisAdapterBase\";\r\nimport {\r\n    ConnectingToSynthesisServiceEvent,\r\n    SpeechSynthesisEvent,\r\n    SynthesisStartedEvent,\r\n    SynthesisTriggeredEvent,\r\n} from \"./SynthesisEvents\";\r\n\r\nexport interface ISynthesisResponseContext {\r\n    serviceTag: string;\r\n}\r\n\r\nexport interface ISynthesisResponseAudio {\r\n    type: string;\r\n    streamId: string;\r\n}\r\n\r\nexport interface ISynthesisResponse {\r\n    context: ISynthesisResponseContext;\r\n    audio: ISynthesisResponseAudio;\r\n}\r\n\r\nexport class SynthesisTurn {\r\n\r\n    public get requestId(): string {\r\n        return this.privRequestId;\r\n    }\r\n\r\n    public get streamId(): string {\r\n        return this.privStreamId;\r\n    }\r\n\r\n    public set streamId(value: string) {\r\n        this.privStreamId = value;\r\n    }\r\n\r\n    public get audioOutputFormat(): AudioOutputFormatImpl {\r\n        return this.privAudioOutputFormat;\r\n    }\r\n\r\n    public set audioOutputFormat(format: AudioOutputFormatImpl) {\r\n        this.privAudioOutputFormat = format;\r\n    }\r\n\r\n    public get turnCompletionPromise(): Promise<void> {\r\n        return this.privTurnDeferral.promise;\r\n    }\r\n\r\n    public get isSynthesisEnded(): boolean {\r\n        return this.privIsSynthesisEnded;\r\n    }\r\n\r\n    public get isSynthesizing(): boolean {\r\n        return this.privIsSynthesizing;\r\n    }\r\n\r\n    public get currentTextOffset(): number {\r\n        return this.privTextOffset;\r\n    }\r\n\r\n    // The number of bytes received for current turn\r\n    public get bytesReceived(): number {\r\n        return this.privBytesReceived;\r\n    }\r\n\r\n    private privIsDisposed: boolean = false;\r\n    private privAuthFetchEventId: string;\r\n    private privIsSynthesizing: boolean = false;\r\n    private privIsSynthesisEnded: boolean = false;\r\n    private privBytesReceived: number = 0;\r\n    private privRequestId: string;\r\n    private privStreamId: string;\r\n    private privTurnDeferral: Deferred<void>;\r\n    private privInTurn: boolean = false;\r\n    private privAudioOutputFormat: AudioOutputFormatImpl;\r\n    private privAudioOutputStream: PullAudioOutputStreamImpl;\r\n    private privReceivedAudio: ArrayBuffer;\r\n    private privReceivedAudioWithHeader: ArrayBuffer;\r\n    private privTextOffset: number = 0;\r\n    private privNextSearchTextIndex: number = 0;\r\n    private privPartialVisemeAnimation: string;\r\n    private privRawText: string;\r\n    private privIsSSML: boolean;\r\n    private privTurnAudioDestination: IAudioDestination;\r\n\r\n    constructor() {\r\n        this.privRequestId = createNoDashGuid();\r\n        this.privTurnDeferral = new Deferred<void>();\r\n\r\n        // We're not in a turn, so resolve.\r\n        this.privTurnDeferral.resolve();\r\n    }\r\n\r\n    public async getAllReceivedAudio(): Promise<ArrayBuffer> {\r\n        if (!!this.privReceivedAudio) {\r\n            return Promise.resolve(this.privReceivedAudio);\r\n        }\r\n        if (!this.privIsSynthesisEnded) {\r\n            return null;\r\n        }\r\n        await this.readAllAudioFromStream();\r\n        return Promise.resolve(this.privReceivedAudio);\r\n    }\r\n\r\n    public async getAllReceivedAudioWithHeader(): Promise<ArrayBuffer> {\r\n        if (!!this.privReceivedAudioWithHeader) {\r\n            return this.privReceivedAudioWithHeader;\r\n        }\r\n        if (!this.privIsSynthesisEnded) {\r\n            return null;\r\n        }\r\n        if (this.audioOutputFormat.hasHeader) {\r\n            const audio: ArrayBuffer = await this.getAllReceivedAudio();\r\n            this.privReceivedAudioWithHeader = SynthesisAdapterBase.addHeader(audio, this.audioOutputFormat);\r\n            return this.privReceivedAudioWithHeader;\r\n        } else {\r\n            return this.getAllReceivedAudio();\r\n        }\r\n    }\r\n\r\n    public startNewSynthesis(requestId: string, rawText: string, isSSML: boolean, audioDestination?: IAudioDestination): void {\r\n        this.privIsSynthesisEnded = false;\r\n        this.privIsSynthesizing = true;\r\n        this.privRequestId = requestId;\r\n        this.privRawText = rawText;\r\n        this.privIsSSML = isSSML;\r\n        this.privAudioOutputStream = new PullAudioOutputStreamImpl();\r\n        this.privAudioOutputStream.format = this.privAudioOutputFormat;\r\n        this.privReceivedAudio = null;\r\n        this.privReceivedAudioWithHeader = null;\r\n        this.privBytesReceived = 0;\r\n        this.privTextOffset = 0;\r\n        this.privNextSearchTextIndex = 0;\r\n        this.privPartialVisemeAnimation = \"\";\r\n        if (audioDestination !== undefined) {\r\n            this.privTurnAudioDestination = audioDestination;\r\n            this.privTurnAudioDestination.format = this.privAudioOutputFormat;\r\n        }\r\n        this.onEvent(new SynthesisTriggeredEvent(this.requestId, undefined, audioDestination === undefined ? undefined : audioDestination.id()));\r\n    }\r\n\r\n    public onPreConnectionStart = (authFetchEventId: string, connectionId: string): void => {\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n        this.onEvent(new ConnectingToSynthesisServiceEvent(this.privRequestId, this.privAuthFetchEventId));\r\n    }\r\n\r\n    public onAuthCompleted = (isError: boolean, error?: string): void => {\r\n        if (isError) {\r\n            this.onComplete();\r\n        }\r\n    }\r\n\r\n    public onConnectionEstablishCompleted = (statusCode: number, reason?: string): void => {\r\n        if (statusCode === 200) {\r\n            this.onEvent(new SynthesisStartedEvent(this.requestId, this.privAuthFetchEventId));\r\n            this.privBytesReceived = 0;\r\n            return;\r\n        } else if (statusCode === 403) {\r\n            this.onComplete();\r\n        }\r\n    }\r\n\r\n    public onServiceResponseMessage = (responseJson: string): void => {\r\n        const response: ISynthesisResponse = JSON.parse(responseJson);\r\n        this.streamId = response.audio.streamId;\r\n    }\r\n\r\n    public onServiceTurnEndResponse = (): void => {\r\n        this.privInTurn = false;\r\n        this.privTurnDeferral.resolve();\r\n        this.onComplete();\r\n    }\r\n\r\n    public onServiceTurnStartResponse = (): void => {\r\n        if (!!this.privTurnDeferral && !!this.privInTurn) {\r\n            // What? How are we starting a turn with another not done?\r\n            this.privTurnDeferral.reject(\"Another turn started before current completed.\");\r\n        }\r\n        this.privInTurn = true;\r\n        this.privTurnDeferral = new Deferred<void>();\r\n    }\r\n\r\n    public onAudioChunkReceived(data: ArrayBuffer): void {\r\n        if (this.isSynthesizing) {\r\n            this.privAudioOutputStream.write(data);\r\n            this.privBytesReceived += data.byteLength;\r\n            if (this.privTurnAudioDestination !== undefined) {\r\n                this.privTurnAudioDestination.write(data);\r\n            }\r\n        }\r\n    }\r\n\r\n    public onWordBoundaryEvent(text: string): void {\r\n        this.updateTextOffset(text);\r\n    }\r\n\r\n    public onVisemeMetadataReceived(metadata: ISynthesisMetadata): void {\r\n        if (metadata.Data.AnimationChunk !== undefined) {\r\n            this.privPartialVisemeAnimation += metadata.Data.AnimationChunk;\r\n        }\r\n    }\r\n\r\n    public dispose = (error?: string): void => {\r\n        if (!this.privIsDisposed) {\r\n            // we should have completed by now. If we did not its an unknown error.\r\n            this.privIsDisposed = true;\r\n        }\r\n    }\r\n\r\n    public onStopSynthesizing(): void {\r\n        this.onComplete();\r\n    }\r\n\r\n    /**\r\n     * Gets the viseme animation string (merged from animation chunk), and clears the internal\r\n     * partial animation.\r\n     */\r\n    public getAndClearVisemeAnimation(): string {\r\n        const animation: string = this.privPartialVisemeAnimation;\r\n        this.privPartialVisemeAnimation = \"\";\r\n        return animation;\r\n    }\r\n\r\n    protected onEvent = (event: SpeechSynthesisEvent): void => {\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private updateTextOffset(text: string): void {\r\n        if (this.privTextOffset >= 0) {\r\n            this.privTextOffset = this.privRawText.indexOf(text, this.privNextSearchTextIndex);\r\n            if (this.privTextOffset >= 0) {\r\n                this.privNextSearchTextIndex = this.privTextOffset + text.length;\r\n            }\r\n            if (this.privIsSSML) {\r\n                if (this.privRawText.indexOf(\"<\", this.privTextOffset + 1) > this.privRawText.indexOf(\">\", this.privTextOffset + 1)) {\r\n                    this.updateTextOffset(text);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private onComplete = (): void => {\r\n        if (this.privIsSynthesizing) {\r\n            this.privIsSynthesizing = false;\r\n            this.privIsSynthesisEnded = true;\r\n            this.privAudioOutputStream.close();\r\n            this.privInTurn = false;\r\n            if (this.privTurnAudioDestination !== undefined) {\r\n                this.privTurnAudioDestination.close();\r\n                this.privTurnAudioDestination = undefined;\r\n            }\r\n        }\r\n    }\r\n\r\n    private async readAllAudioFromStream(): Promise<void> {\r\n        if (this.privIsSynthesisEnded) {\r\n            this.privReceivedAudio = new ArrayBuffer(this.bytesReceived);\r\n            try {\r\n                await this.privAudioOutputStream.read(this.privReceivedAudio);\r\n            } catch (e) {\r\n                this.privReceivedAudio = new ArrayBuffer(0);\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport {\r\n    AudioSourceErrorEvent,\r\n    AudioStreamNodeAttachedEvent,\r\n    AudioStreamNodeAttachingEvent,\r\n    AudioStreamNodeDetachedEvent,\r\n    AudioStreamNodeErrorEvent,\r\n    ConnectionEstablishedEvent,\r\n    ConnectionEstablishErrorEvent,\r\n    ConnectionMessageReceivedEvent,\r\n    ConnectionStartEvent,\r\n    IEventListener,\r\n    IStringDictionary,\r\n    PlatformEvent,\r\n} from \"../common/Exports\";\r\nimport { ConnectingToServiceEvent, RecognitionTriggeredEvent } from \"./RecognitionEvents\";\r\n\r\nexport interface ITelemetry {\r\n    Metrics: IMetric[];\r\n    ReceivedMessages: IStringDictionary<string[]>;\r\n}\r\n\r\nexport interface IMetric {\r\n    End?: string;\r\n    Error?: string;\r\n    Id?: string;\r\n    Name?: string;\r\n    Start?: string;\r\n    PhraseLatencyMs?: number[];\r\n    FirstHypothesisLatencyMs?: number[];\r\n}\r\n\r\nexport class ServiceTelemetryListener implements IEventListener<PlatformEvent> {\r\n    private privIsDisposed: boolean = false;\r\n\r\n    private privRequestId: string;\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n\r\n    private privListeningTriggerMetric: IMetric = null;\r\n    private privMicMetric: IMetric = null;\r\n    private privConnectionEstablishMetric: IMetric = null;\r\n\r\n    private privMicStartTime: string;\r\n\r\n    private privConnectionId: string;\r\n    private privConnectionStartTime: string;\r\n\r\n    private privReceivedMessages: IStringDictionary<string[]>;\r\n    private privPhraseLatencies: number[];\r\n    private privHypothesisLatencies: number[];\r\n\r\n    constructor(requestId: string, audioSourceId: string, audioNodeId: string) {\r\n        this.privRequestId = requestId;\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privAudioNodeId = audioNodeId;\r\n\r\n        this.privReceivedMessages = {};\r\n        this.privPhraseLatencies = [];\r\n        this.privHypothesisLatencies = [];\r\n    }\r\n\r\n    public phraseReceived(audioReceivedTime: number): void {\r\n        if (audioReceivedTime > 0) { // 0 indicates the time is unknown. Drop it.\r\n            this.privPhraseLatencies.push(Date.now() - audioReceivedTime);\r\n        }\r\n    }\r\n\r\n    public hypothesisReceived(audioReceivedTime: number): void {\r\n        if (audioReceivedTime > 0) { // 0 indicates the time is unknown. Drop it.\r\n            this.privHypothesisLatencies.push(Date.now() - audioReceivedTime);\r\n        }\r\n    }\r\n\r\n    public onEvent = (e: PlatformEvent): void => {\r\n        if (this.privIsDisposed) {\r\n            return;\r\n        }\r\n\r\n        if (e instanceof RecognitionTriggeredEvent && e.requestId === this.privRequestId) {\r\n            this.privListeningTriggerMetric = {\r\n                End: e.eventTime,\r\n                Name: \"ListeningTrigger\",\r\n                Start: e.eventTime,\r\n            };\r\n        }\r\n\r\n        if (e instanceof AudioStreamNodeAttachingEvent && e.audioSourceId === this.privAudioSourceId && e.audioNodeId === this.privAudioNodeId) {\r\n            this.privMicStartTime = e.eventTime;\r\n        }\r\n\r\n        if (e instanceof AudioStreamNodeAttachedEvent && e.audioSourceId === this.privAudioSourceId && e.audioNodeId === this.privAudioNodeId) {\r\n            this.privMicStartTime = e.eventTime;\r\n        }\r\n\r\n        if (e instanceof AudioSourceErrorEvent && e.audioSourceId === this.privAudioSourceId) {\r\n            if (!this.privMicMetric) {\r\n                this.privMicMetric = {\r\n                    End: e.eventTime,\r\n                    Error: e.error,\r\n                    Name: \"Microphone\",\r\n                    Start: this.privMicStartTime,\r\n                };\r\n            }\r\n        }\r\n\r\n        if (e instanceof AudioStreamNodeErrorEvent && e.audioSourceId === this.privAudioSourceId && e.audioNodeId === this.privAudioNodeId) {\r\n            if (!this.privMicMetric) {\r\n                this.privMicMetric = {\r\n                    End: e.eventTime,\r\n                    Error: e.error,\r\n                    Name: \"Microphone\",\r\n                    Start: this.privMicStartTime,\r\n                };\r\n            }\r\n        }\r\n\r\n        if (e instanceof AudioStreamNodeDetachedEvent && e.audioSourceId === this.privAudioSourceId && e.audioNodeId === this.privAudioNodeId) {\r\n            if (!this.privMicMetric) {\r\n                this.privMicMetric = {\r\n                    End: e.eventTime,\r\n                    Name: \"Microphone\",\r\n                    Start: this.privMicStartTime,\r\n                };\r\n            }\r\n        }\r\n\r\n        if (e instanceof ConnectingToServiceEvent && e.requestId === this.privRequestId) {\r\n            this.privConnectionId = e.sessionId;\r\n        }\r\n\r\n        if (e instanceof ConnectionStartEvent && e.connectionId === this.privConnectionId) {\r\n            this.privConnectionStartTime = e.eventTime;\r\n        }\r\n\r\n        if (e instanceof ConnectionEstablishedEvent && e.connectionId === this.privConnectionId) {\r\n            if (!this.privConnectionEstablishMetric) {\r\n                this.privConnectionEstablishMetric = {\r\n                    End: e.eventTime,\r\n                    Id: this.privConnectionId,\r\n                    Name: \"Connection\",\r\n                    Start: this.privConnectionStartTime,\r\n                };\r\n            }\r\n        }\r\n\r\n        if (e instanceof ConnectionEstablishErrorEvent && e.connectionId === this.privConnectionId) {\r\n            if (!this.privConnectionEstablishMetric) {\r\n                this.privConnectionEstablishMetric = {\r\n                    End: e.eventTime,\r\n                    Error: this.getConnectionError(e.statusCode),\r\n                    Id: this.privConnectionId,\r\n                    Name: \"Connection\",\r\n                    Start: this.privConnectionStartTime,\r\n                };\r\n            }\r\n        }\r\n\r\n        if (e instanceof ConnectionMessageReceivedEvent && e.connectionId === this.privConnectionId) {\r\n            if (e.message && e.message.headers && e.message.headers.path) {\r\n                if (!this.privReceivedMessages[e.message.headers.path]) {\r\n                    this.privReceivedMessages[e.message.headers.path] = new Array<string>();\r\n                }\r\n\r\n                this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    public getTelemetry = (): string => {\r\n        const metrics = new Array<IMetric>();\r\n\r\n        if (this.privListeningTriggerMetric) {\r\n            metrics.push(this.privListeningTriggerMetric);\r\n        }\r\n\r\n        if (this.privMicMetric) {\r\n            metrics.push(this.privMicMetric);\r\n        }\r\n\r\n        if (this.privConnectionEstablishMetric) {\r\n            metrics.push(this.privConnectionEstablishMetric);\r\n        }\r\n\r\n        if (this.privPhraseLatencies.length > 0) {\r\n            metrics.push({\r\n                PhraseLatencyMs: this.privPhraseLatencies,\r\n            });\r\n        }\r\n\r\n        if (this.privHypothesisLatencies.length > 0) {\r\n            metrics.push({\r\n                FirstHypothesisLatencyMs: this.privHypothesisLatencies,\r\n            });\r\n        }\r\n\r\n        const telemetry: ITelemetry = {\r\n            Metrics: metrics,\r\n            ReceivedMessages: this.privReceivedMessages,\r\n        };\r\n\r\n        const json = JSON.stringify(telemetry);\r\n\r\n        // We dont want to send the same telemetry again. So clean those out.\r\n        this.privReceivedMessages = {};\r\n        this.privListeningTriggerMetric = null;\r\n        this.privMicMetric = null;\r\n        this.privConnectionEstablishMetric = null;\r\n        this.privPhraseLatencies = [];\r\n        this.privHypothesisLatencies = [];\r\n        return json;\r\n    }\r\n\r\n    // Determines if there are any telemetry events to send to the service.\r\n    public get hasTelemetry(): boolean {\r\n        return (Object.keys(this.privReceivedMessages).length !== 0 ||\r\n            this.privListeningTriggerMetric !== null ||\r\n            this.privMicMetric !== null ||\r\n            this.privConnectionEstablishMetric !== null ||\r\n            this.privPhraseLatencies.length !== 0 ||\r\n            this.privHypothesisLatencies.length !== 0);\r\n    }\r\n\r\n    public dispose = (): void => {\r\n        this.privIsDisposed = true;\r\n    }\r\n\r\n    private getConnectionError = (statusCode: number): string => {\r\n        /*\r\n        -- Websocket status codes --\r\n        NormalClosure = 1000,\r\n        EndpointUnavailable = 1001,\r\n        ProtocolError = 1002,\r\n        InvalidMessageType = 1003,\r\n        Empty = 1005,\r\n        InvalidPayloadData = 1007,\r\n        PolicyViolation = 1008,\r\n        MessageTooBig = 1009,\r\n        MandatoryExtension = 1010,\r\n        InternalServerError = 1011\r\n        */\r\n\r\n        switch (statusCode) {\r\n            case 400:\r\n            case 1002:\r\n            case 1003:\r\n            case 1005:\r\n            case 1007:\r\n            case 1008:\r\n            case 1009: return \"BadRequest\";\r\n            case 401: return \"Unauthorized\";\r\n            case 403: return \"Forbidden\";\r\n            case 503:\r\n            case 1001: return \"ServerUnavailable\";\r\n            case 500:\r\n            case 1011: return \"ServerError\";\r\n            case 408:\r\n            case 504: return \"Timeout\";\r\n            default: return \"statuscode:\" + statusCode.toString();\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ReplayableAudioNode } from \"../common.browser/Exports\";\r\nimport {\r\n    createNoDashGuid,\r\n    Deferred,\r\n    Events,\r\n    IDetachable,\r\n    IEventSource,\r\n    PlatformEvent\r\n} from \"../common/Exports\";\r\nimport {\r\n    ConnectingToServiceEvent,\r\n    ListeningStartedEvent,\r\n    RecognitionStartedEvent,\r\n    RecognitionTriggeredEvent,\r\n    SpeechRecognitionEvent,\r\n} from \"./RecognitionEvents\";\r\nimport { ServiceTelemetryListener } from \"./ServiceTelemetryListener.Internal\";\r\n\r\nexport class RequestSession {\r\n    private privIsDisposed: boolean = false;\r\n    private privServiceTelemetryListener: ServiceTelemetryListener;\r\n    private privDetachables: IDetachable[] = new Array<IDetachable>();\r\n    private privRequestId: string;\r\n    private privAudioSourceId: string;\r\n    private privAudioNodeId: string;\r\n    private privAudioNode: ReplayableAudioNode;\r\n    private privAuthFetchEventId: string;\r\n    private privIsAudioNodeDetached: boolean = false;\r\n    private privIsRecognizing: boolean = false;\r\n    private privIsSpeechEnded: boolean = false;\r\n    private privTurnStartAudioOffset: number = 0;\r\n    private privLastRecoOffset: number = 0;\r\n    private privHypothesisReceived: boolean = false;\r\n    private privBytesSent: number = 0;\r\n    private privRecogNumber: number = 0;\r\n    private privSessionId: string;\r\n    private privTurnDeferral: Deferred<void>;\r\n    private privInTurn: boolean = false;\r\n\r\n    constructor(audioSourceId: string) {\r\n        this.privAudioSourceId = audioSourceId;\r\n        this.privRequestId = createNoDashGuid();\r\n        this.privAudioNodeId = createNoDashGuid();\r\n        this.privTurnDeferral = new Deferred<void>();\r\n\r\n        // We're not in a turn, so resolve.\r\n        this.privTurnDeferral.resolve();\r\n    }\r\n\r\n    public get sessionId(): string {\r\n        return this.privSessionId;\r\n    }\r\n\r\n    public get requestId(): string {\r\n        return this.privRequestId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n\r\n    public get turnCompletionPromise(): Promise<void> {\r\n        return this.privTurnDeferral.promise;\r\n    }\r\n\r\n    public get isSpeechEnded(): boolean {\r\n        return this.privIsSpeechEnded;\r\n    }\r\n\r\n    public get isRecognizing(): boolean {\r\n        return this.privIsRecognizing;\r\n    }\r\n\r\n    public get currentTurnAudioOffset(): number {\r\n        return this.privTurnStartAudioOffset;\r\n    }\r\n\r\n    public get recogNumber(): number {\r\n        return this.privRecogNumber;\r\n    }\r\n\r\n    // The number of bytes sent for the current connection.\r\n    // Counter is reset to 0 each time a connection is established.\r\n    public get bytesSent(): number {\r\n        return this.privBytesSent;\r\n    }\r\n    public listenForServiceTelemetry(eventSource: IEventSource<PlatformEvent>): void {\r\n        if (!!this.privServiceTelemetryListener) {\r\n            this.privDetachables.push(eventSource.attachListener(this.privServiceTelemetryListener));\r\n        }\r\n    }\r\n\r\n    public startNewRecognition(): void {\r\n        this.privIsSpeechEnded = false;\r\n        this.privIsRecognizing = true;\r\n        this.privTurnStartAudioOffset = 0;\r\n        this.privLastRecoOffset = 0;\r\n        this.privRequestId = createNoDashGuid();\r\n        this.privRecogNumber++;\r\n        this.privServiceTelemetryListener = new ServiceTelemetryListener(this.privRequestId, this.privAudioSourceId, this.privAudioNodeId);\r\n        this.onEvent(new RecognitionTriggeredEvent(this.requestId, this.privSessionId, this.privAudioSourceId, this.privAudioNodeId));\r\n    }\r\n\r\n    public async onAudioSourceAttachCompleted(audioNode: ReplayableAudioNode, isError: boolean, error?: string): Promise<void> {\r\n        this.privAudioNode = audioNode;\r\n        this.privIsAudioNodeDetached = false;\r\n\r\n        if (isError) {\r\n            await this.onComplete();\r\n        } else {\r\n            this.onEvent(new ListeningStartedEvent(this.privRequestId, this.privSessionId, this.privAudioSourceId, this.privAudioNodeId));\r\n        }\r\n    }\r\n\r\n    public onPreConnectionStart = (authFetchEventId: string, connectionId: string): void => {\r\n        this.privAuthFetchEventId = authFetchEventId;\r\n        this.privSessionId = connectionId;\r\n        this.onEvent(new ConnectingToServiceEvent(this.privRequestId, this.privAuthFetchEventId, this.privSessionId));\r\n    }\r\n\r\n    public async onAuthCompleted(isError: boolean, error?: string): Promise<void> {\r\n        if (isError) {\r\n            await this.onComplete();\r\n        }\r\n    }\r\n\r\n    public async onConnectionEstablishCompleted(statusCode: number, reason?: string): Promise<void> {\r\n        if (statusCode === 200) {\r\n            this.onEvent(new RecognitionStartedEvent(this.requestId, this.privAudioSourceId, this.privAudioNodeId, this.privAuthFetchEventId, this.privSessionId));\r\n            if (!!this.privAudioNode) {\r\n                this.privAudioNode.replay();\r\n            }\r\n            this.privTurnStartAudioOffset = this.privLastRecoOffset;\r\n            this.privBytesSent = 0;\r\n            return;\r\n        } else if (statusCode === 403) {\r\n            await this.onComplete();\r\n        }\r\n    }\r\n\r\n    public async onServiceTurnEndResponse(continuousRecognition: boolean): Promise<void> {\r\n        this.privTurnDeferral.resolve();\r\n\r\n        if (!continuousRecognition || this.isSpeechEnded) {\r\n            await this.onComplete();\r\n            this.privInTurn = false;\r\n        } else {\r\n            // Start a new request set.\r\n            this.privTurnStartAudioOffset = this.privLastRecoOffset;\r\n            this.privRequestId = createNoDashGuid();\r\n            this.privAudioNode.replay();\r\n        }\r\n    }\r\n\r\n    public onServiceTurnStartResponse = (): void => {\r\n        if (!!this.privTurnDeferral && !!this.privInTurn) {\r\n            // What? How are we starting a turn with another not done?\r\n            this.privTurnDeferral.reject(\"Another turn started before current completed.\");\r\n        }\r\n\r\n        this.privInTurn = true;\r\n        this.privTurnDeferral = new Deferred<void>();\r\n    }\r\n\r\n    public onHypothesis(offset: number): void {\r\n        if (!this.privHypothesisReceived) {\r\n            this.privHypothesisReceived = true;\r\n            this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(offset));\r\n        }\r\n    }\r\n\r\n    public onPhraseRecognized(offset: number): void {\r\n        this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(offset));\r\n        this.onServiceRecognized(offset);\r\n    }\r\n\r\n    public onServiceRecognized(offset: number): void {\r\n        this.privLastRecoOffset = offset;\r\n        this.privHypothesisReceived = false;\r\n        this.privAudioNode.shrinkBuffers(offset);\r\n    }\r\n\r\n    public onAudioSent(bytesSent: number): void {\r\n        this.privBytesSent += bytesSent;\r\n    }\r\n\r\n    public async dispose(error?: string): Promise<void> {\r\n        if (!this.privIsDisposed) {\r\n            // we should have completed by now. If we did not its an unknown error.\r\n            this.privIsDisposed = true;\r\n            for (const detachable of this.privDetachables) {\r\n                await detachable.detach();\r\n            }\r\n\r\n            this.privServiceTelemetryListener.dispose();\r\n            this.privIsRecognizing = false;\r\n        }\r\n    }\r\n\r\n    public getTelemetry = (): string => {\r\n        if (this.privServiceTelemetryListener.hasTelemetry) {\r\n            return this.privServiceTelemetryListener.getTelemetry();\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public async onStopRecognizing(): Promise<void> {\r\n        await this.onComplete();\r\n    }\r\n\r\n    // Should be called with the audioNode for this session has indicated that it is out of speech.\r\n    public onSpeechEnded(): void {\r\n        this.privIsSpeechEnded = true;\r\n    }\r\n\r\n    protected onEvent = (event: SpeechRecognitionEvent): void => {\r\n        if (!!this.privServiceTelemetryListener) {\r\n            this.privServiceTelemetryListener.onEvent(event);\r\n        }\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private async onComplete(): Promise<void> {\r\n        if (!!this.privIsRecognizing) {\r\n            this.privIsRecognizing = false;\r\n            await this.detachAudioNode();\r\n        }\r\n    }\r\n\r\n    private async detachAudioNode(): Promise<void> {\r\n        if (!this.privIsAudioNodeDetached) {\r\n            this.privIsAudioNodeDetached = true;\r\n            if (this.privAudioNode) {\r\n                await this.privAudioNode.detach();\r\n            }\r\n        }\r\n    }\r\n}\r\n","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest;","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var getPrototypeOf = require(\"./getPrototypeOf\");\n\nvar isNativeReflectConstruct = require(\"./isNativeReflectConstruct\");\n\nvar possibleConstructorReturn = require(\"./possibleConstructorReturn\");\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}\n\nmodule.exports = _createSuper;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nmodule.exports = _isNativeReflectConstruct;","var _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Define speech synthesis audio output formats.\r\n * @enum SpeechSynthesisOutputFormat\r\n * Updated in version 1.16.0\r\n */\r\nexport enum SpeechSynthesisOutputFormat {\r\n    /**\r\n     * raw-8khz-8bit-mono-mulaw\r\n     * @member SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw,\r\n     */\r\n    Raw8Khz8BitMonoMULaw,\r\n\r\n    /**\r\n     * riff-16khz-16kbps-mono-siren\r\n     * @member SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren\r\n     */\r\n    Riff16Khz16KbpsMonoSiren ,\r\n\r\n    /**\r\n     * audio-16khz-16kbps-mono-siren\r\n     * @member SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren\r\n     */\r\n    Audio16Khz16KbpsMonoSiren,\r\n\r\n    /**\r\n     * audio-16khz-32kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3\r\n     */\r\n    Audio16Khz32KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-16khz-128kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3\r\n     */\r\n    Audio16Khz128KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-16khz-64kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3\r\n     */\r\n    Audio16Khz64KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-24khz-48kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3\r\n     */\r\n    Audio24Khz48KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-24khz-96kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3\r\n     */\r\n    Audio24Khz96KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-24khz-160kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3\r\n     */\r\n    Audio24Khz160KBitRateMonoMp3,\r\n\r\n    /**\r\n     * raw-16khz-16bit-mono-truesilk\r\n     * @member SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk\r\n     */\r\n    Raw16Khz16BitMonoTrueSilk,\r\n\r\n    /**\r\n     * riff-16khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm\r\n     */\r\n    Riff16Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * riff-8khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm\r\n     */\r\n    Riff8Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * riff-24khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm\r\n     */\r\n    Riff24Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * riff-8khz-8bit-mono-mulaw\r\n     * @member SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw\r\n     */\r\n    Riff8Khz8BitMonoMULaw,\r\n\r\n    /**\r\n     * raw-16khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm\r\n     */\r\n    Raw16Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * raw-24khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm\r\n     */\r\n    Raw24Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * raw-8khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm\r\n     */\r\n    Raw8Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * ogg-16khz-16bit-mono-opus\r\n     * @member SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus\r\n     */\r\n    Ogg16Khz16BitMonoOpus,\r\n\r\n    /**\r\n     * ogg-24khz-16bit-mono-opus\r\n     * @member SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus\r\n     */\r\n    Ogg24Khz16BitMonoOpus,\r\n\r\n    /**\r\n     * raw-48khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm\r\n     */\r\n    Raw48Khz16BitMonoPcm,\r\n\r\n    /**\r\n     * riff-48khz-16bit-mono-pcm\r\n     * @member SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm\r\n     */\r\n\r\n    Riff48Khz16BitMonoPcm,\r\n    /**\r\n     * audio-48khz-96kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3\r\n     */\r\n    Audio48Khz96KBitRateMonoMp3,\r\n\r\n    /**\r\n     * audio-48khz-192kbitrate-mono-mp3\r\n     * @member SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3\r\n     */\r\n    Audio48Khz192KBitRateMonoMp3,\r\n\r\n    /**\r\n     * ogg-48khz-16bit-mono-opus\r\n     * Added in version 1.16.0\r\n     * @member SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus\r\n     */\r\n    Ogg48Khz16BitMonoOpus,\r\n\r\n    /**\r\n     * webm-16khz-16bit-mono-opus\r\n     * Added in version 1.16.0\r\n     * @member SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus\r\n     */\r\n    Webm16Khz16BitMonoOpus,\r\n\r\n    /**\r\n     * webm-24khz-16bit-mono-opus\r\n     * Added in version 1.16.0\r\n     * @member SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus\r\n     */\r\n    Webm24Khz16BitMonoOpus,\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { ArgumentNullError } from \"./Error\";\r\n\r\nexport enum PromiseState {\r\n    None,\r\n    Resolved,\r\n    Rejected,\r\n}\r\n\r\nexport interface IDeferred<T> {\r\n    readonly promise: Promise<T>;\r\n\r\n    resolve(result: T): IDeferred<T>;\r\n\r\n    reject(error: string): IDeferred<T>;\r\n}\r\n\r\nexport class PromiseResult<T> {\r\n    protected privIsCompleted: boolean;\r\n    protected privIsError: boolean;\r\n    protected privError: string;\r\n    protected privResult: T;\r\n\r\n    public constructor(promiseResultEventSource: PromiseResultEventSource<T>) {\r\n        promiseResultEventSource.on((result: T) => {\r\n            if (!this.privIsCompleted) {\r\n                this.privIsCompleted = true;\r\n                this.privIsError = false;\r\n                this.privResult = result;\r\n            }\r\n        }, (error: string) => {\r\n            if (!this.privIsCompleted) {\r\n                this.privIsCompleted = true;\r\n                this.privIsError = true;\r\n                this.privError = error;\r\n            }\r\n        });\r\n    }\r\n\r\n    public get isCompleted(): boolean {\r\n        return this.privIsCompleted;\r\n    }\r\n\r\n    public get isError(): boolean {\r\n        return this.privIsError;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n\r\n    public get result(): T {\r\n        return this.privResult;\r\n    }\r\n\r\n    public throwIfError = (): void => {\r\n        if (this.isError) {\r\n            throw this.error;\r\n        }\r\n    }\r\n}\r\n\r\nexport class PromiseResultEventSource<T>  {\r\n\r\n    private privOnSetResult: (result: T) => void;\r\n    private privOnSetError: (error: string) => void;\r\n\r\n    public setResult = (result: T): void => {\r\n        this.privOnSetResult(result);\r\n    }\r\n\r\n    public setError = (error: string): void => {\r\n        this.privOnSetError(error);\r\n    }\r\n\r\n    public on = (onSetResult: (result: T) => void, onSetError: (error: string) => void): void => {\r\n        this.privOnSetResult = onSetResult;\r\n        this.privOnSetError = onSetError;\r\n    }\r\n}\r\n\r\nexport class Deferred<T> implements IDeferred<T> {\r\n    private privPromise: Promise<T>;\r\n    private privResolve: (value?: T | PromiseLike<T>) => void;\r\n    private privReject: (reason?: any) => void;\r\n\r\n    public constructor() {\r\n        this.privPromise = new Promise<T>((resolve: (value: T) => void, reject: (reason: any) => void) => {\r\n            this.privResolve = resolve;\r\n            this.privReject = reject;\r\n        });\r\n    }\r\n\r\n    public get promise(): Promise<T> {\r\n        return this.privPromise;\r\n    }\r\n\r\n    public resolve = (result: T | Promise<T>): Deferred<T> => {\r\n        this.privResolve(result);\r\n        return this;\r\n    }\r\n\r\n    public reject = (error: string): Deferred<T> => {\r\n        this.privReject(error);\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class Sink<T> {\r\n    private privState: PromiseState = PromiseState.None;\r\n    private privPromiseResult: PromiseResult<T> = null;\r\n    private privPromiseResultEvents: PromiseResultEventSource<T> = null;\r\n\r\n    private privSuccessHandlers: ((result: T) => void)[] = [];\r\n    private privErrorHandlers: ((e: string) => void)[] = [];\r\n\r\n    public constructor() {\r\n        this.privPromiseResultEvents = new PromiseResultEventSource();\r\n        this.privPromiseResult = new PromiseResult(this.privPromiseResultEvents);\r\n    }\r\n\r\n    public get state(): PromiseState {\r\n        return this.privState;\r\n    }\r\n\r\n    public get result(): PromiseResult<T> {\r\n        return this.privPromiseResult;\r\n    }\r\n\r\n    public resolve = (result: T): void => {\r\n        if (this.privState !== PromiseState.None) {\r\n            throw new Error(\"'Cannot resolve a completed promise'\");\r\n        }\r\n\r\n        this.privState = PromiseState.Resolved;\r\n        this.privPromiseResultEvents.setResult(result);\r\n\r\n        for (let i = 0; i < this.privSuccessHandlers.length; i++) {\r\n            this.executeSuccessCallback(result, this.privSuccessHandlers[i], this.privErrorHandlers[i]);\r\n        }\r\n\r\n        this.detachHandlers();\r\n    }\r\n\r\n    public reject = (error: string): void => {\r\n        if (this.privState !== PromiseState.None) {\r\n            throw new Error(\"'Cannot reject a completed promise'\");\r\n        }\r\n\r\n        this.privState = PromiseState.Rejected;\r\n        this.privPromiseResultEvents.setError(error);\r\n\r\n        for (const errorHandler of this.privErrorHandlers) {\r\n            this.executeErrorCallback(error, errorHandler);\r\n        }\r\n\r\n        this.detachHandlers();\r\n    }\r\n\r\n    public on = (\r\n        successCallback: (result: T) => void,\r\n        errorCallback: (error: string) => void): void => {\r\n\r\n        if (successCallback == null) {\r\n            successCallback = (r: T) => { return; };\r\n        }\r\n\r\n        if (this.privState === PromiseState.None) {\r\n            this.privSuccessHandlers.push(successCallback);\r\n            this.privErrorHandlers.push(errorCallback);\r\n        } else {\r\n            if (this.privState === PromiseState.Resolved) {\r\n                this.executeSuccessCallback(this.privPromiseResult.result, successCallback, errorCallback);\r\n            } else if (this.privState === PromiseState.Rejected) {\r\n                this.executeErrorCallback(this.privPromiseResult.error, errorCallback);\r\n            }\r\n\r\n            this.detachHandlers();\r\n        }\r\n    }\r\n\r\n    private executeSuccessCallback = (result: T, successCallback: (result: T) => void, errorCallback: (error: string) => void): void => {\r\n        try {\r\n            successCallback(result);\r\n        } catch (e) {\r\n            this.executeErrorCallback(`'Unhandled callback error: ${e}'`, errorCallback);\r\n        }\r\n    }\r\n\r\n    private executeErrorCallback = (error: string, errorCallback: (error: string) => void): void => {\r\n        if (errorCallback) {\r\n            try {\r\n                errorCallback(error);\r\n            } catch (e) {\r\n                throw new Error(`'Unhandled callback error: ${e}. InnerError: ${error}'`);\r\n            }\r\n        } else {\r\n            throw new Error(`'Unhandled error: ${error}'`);\r\n        }\r\n    }\r\n\r\n    private detachHandlers = (): void => {\r\n        this.privErrorHandlers = [];\r\n        this.privSuccessHandlers = [];\r\n    }\r\n}\r\n\r\nexport function marshalPromiseToCallbacks<T>(\r\n    promise: Promise<T>,\r\n    cb?: (value: T) => void,\r\n    err?: (error: string) => void): void {\r\n    promise.then((val: T): void => {\r\n        try {\r\n            if (!!cb) {\r\n                cb(val);\r\n            }\r\n        } catch (error) {\r\n            if (!!err) {\r\n                try {\r\n                    if (error instanceof Error) {\r\n                        const typedError: Error = error as Error;\r\n                        err(typedError.name + \": \" + typedError.message);\r\n                    } else {\r\n                        err(error);\r\n                    }\r\n                    /* tslint:disable:no-empty */\r\n                } catch (error) { }\r\n            }\r\n        }\r\n    }, (error: any): void => {\r\n        if (!!err) {\r\n            try {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n                /* tslint:disable:no-empty */\r\n            } catch (error) { }\r\n        }\r\n    });\r\n}\r\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/uuidjs/uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ObjectDisposedError } from \"./Error\";\r\nimport { createNoDashGuid } from \"./Guid\";\r\nimport { IDetachable } from \"./IDetachable\";\r\nimport { IStringDictionary } from \"./IDictionary\";\r\nimport { IEventListener, IEventSource } from \"./IEventSource\";\r\nimport { PlatformEvent } from \"./PlatformEvent\";\r\n\r\nexport class EventSource<TEvent extends PlatformEvent> implements IEventSource<TEvent> {\r\n    private privEventListeners: IStringDictionary<(event: TEvent) => void> = {};\r\n    private privMetadata: IStringDictionary<string>;\r\n    private privIsDisposed: boolean = false;\r\n\r\n    constructor(metadata?: IStringDictionary<string>) {\r\n        this.privMetadata = metadata;\r\n    }\r\n\r\n    public onEvent = (event: TEvent): void => {\r\n        if (this.isDisposed()) {\r\n            throw (new ObjectDisposedError(\"EventSource\"));\r\n        }\r\n\r\n        if (this.metadata) {\r\n            for (const paramName in this.metadata) {\r\n                if (paramName) {\r\n                    if (event.metadata) {\r\n                        if (!event.metadata[paramName]) {\r\n                            event.metadata[paramName] = this.metadata[paramName];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        for (const eventId in this.privEventListeners) {\r\n            if (eventId && this.privEventListeners[eventId]) {\r\n                this.privEventListeners[eventId](event);\r\n            }\r\n        }\r\n    }\r\n\r\n    public attach = (onEventCallback: (event: TEvent) => void): IDetachable => {\r\n        const id = createNoDashGuid();\r\n        this.privEventListeners[id] = onEventCallback;\r\n        return {\r\n            detach: () => {\r\n                delete this.privEventListeners[id];\r\n                return Promise.resolve();\r\n            },\r\n        };\r\n    }\r\n\r\n    public attachListener = (listener: IEventListener<TEvent>): IDetachable => {\r\n        return this.attach(listener.onEvent);\r\n    }\r\n\r\n    public isDisposed = (): boolean => {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    public dispose = (): void => {\r\n        this.privEventListeners = null;\r\n        this.privIsDisposed = true;\r\n    }\r\n\r\n    public get metadata(): IStringDictionary<string> {\r\n        return this.privMetadata;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport {\r\n    connectivity,\r\n    ISpeechConfigAudioDevice,\r\n    type,\r\n} from \"../../common.speech/Exports\";\r\nimport {\r\n    AudioSourceEvent,\r\n    AudioSourceInitializingEvent,\r\n    AudioSourceReadyEvent,\r\n    AudioStreamNodeAttachedEvent,\r\n    AudioStreamNodeAttachingEvent,\r\n    AudioStreamNodeDetachedEvent,\r\n    ChunkedArrayBufferStream,\r\n    Deferred,\r\n    Events,\r\n    EventSource,\r\n    IAudioSource,\r\n    IAudioStreamNode,\r\n    IStreamChunk,\r\n    Stream,\r\n} from \"../../common/Exports\";\r\nimport { createNoDashGuid } from \"../../common/Guid\";\r\nimport { AudioStreamFormat, PullAudioInputStreamCallback } from \"../Exports\";\r\nimport { AudioStreamFormatImpl } from \"./AudioStreamFormat\";\r\n\r\n/**\r\n * Represents audio input stream used for custom audio input configurations.\r\n * @class AudioInputStream\r\n */\r\nexport abstract class AudioInputStream {\r\n\r\n    /**\r\n     * Creates and initializes an instance.\r\n     * @constructor\r\n     */\r\n    protected constructor() { }\r\n\r\n    /**\r\n     * Creates a memory backed PushAudioInputStream with the specified audio format.\r\n     * @member AudioInputStream.createPushStream\r\n     * @function\r\n     * @public\r\n     * @param {AudioStreamFormat} format - The audio data format in which audio will be\r\n     *        written to the push audio stream's write() method (Required if format is not 16 kHz 16bit mono PCM).\r\n     * @returns {PushAudioInputStream} The audio input stream being created.\r\n     */\r\n    public static createPushStream(format?: AudioStreamFormat): PushAudioInputStream {\r\n        return PushAudioInputStream.create(format);\r\n    }\r\n\r\n    /**\r\n     * Creates a PullAudioInputStream that delegates to the specified callback interface for read()\r\n     * and close() methods.\r\n     * @member AudioInputStream.createPullStream\r\n     * @function\r\n     * @public\r\n     * @param {PullAudioInputStreamCallback} callback - The custom audio input object, derived from\r\n     *        PullAudioInputStreamCallback\r\n     * @param {AudioStreamFormat} format - The audio data format in which audio will be returned from\r\n     *        the callback's read() method (Required if format is not 16 kHz 16bit mono PCM).\r\n     * @returns {PullAudioInputStream} The audio input stream being created.\r\n     */\r\n    public static createPullStream(callback: PullAudioInputStreamCallback, format?: AudioStreamFormat): PullAudioInputStream {\r\n        return PullAudioInputStream.create(callback, format);\r\n        // throw new Error(\"Oops\");\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member AudioInputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n\r\n/**\r\n * Represents memory backed push audio input stream used for custom audio input configurations.\r\n * @class PushAudioInputStream\r\n */\r\nexport abstract class PushAudioInputStream extends AudioInputStream {\r\n\r\n    /**\r\n     * Creates a memory backed PushAudioInputStream with the specified audio format.\r\n     * @member PushAudioInputStream.create\r\n     * @function\r\n     * @public\r\n     * @param {AudioStreamFormat} format - The audio data format in which audio will be written to the\r\n     *        push audio stream's write() method (Required if format is not 16 kHz 16bit mono PCM).\r\n     * @returns {PushAudioInputStream} The push audio input stream being created.\r\n     */\r\n    public static create(format?: AudioStreamFormat): PushAudioInputStream {\r\n        return new PushAudioInputStreamImpl(format);\r\n    }\r\n\r\n    /**\r\n     * Writes the audio data specified by making an internal copy of the data.\r\n     * @member PushAudioInputStream.prototype.write\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - The audio buffer of which this function will make a copy.\r\n     */\r\n    public abstract write(dataBuffer: ArrayBuffer): void;\r\n\r\n    /**\r\n     * Closes the stream.\r\n     * @member PushAudioInputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n\r\n/**\r\n * Represents memory backed push audio input stream used for custom audio input configurations.\r\n * @private\r\n * @class PushAudioInputStreamImpl\r\n */\r\nexport class PushAudioInputStreamImpl extends PushAudioInputStream implements IAudioSource {\r\n\r\n    private privFormat: AudioStreamFormatImpl;\r\n    private privId: string;\r\n    private privEvents: EventSource<AudioSourceEvent>;\r\n    private privStream: Stream<ArrayBuffer>;\r\n\r\n    /**\r\n     * Creates and initalizes an instance with the given values.\r\n     * @constructor\r\n     * @param {AudioStreamFormat} format - The audio stream format.\r\n     */\r\n    public constructor(format?: AudioStreamFormat) {\r\n        super();\r\n        if (format === undefined) {\r\n            this.privFormat = AudioStreamFormatImpl.getDefaultInputFormat();\r\n        } else {\r\n            this.privFormat = format as AudioStreamFormatImpl;\r\n        }\r\n        this.privEvents = new EventSource<AudioSourceEvent>();\r\n        this.privId = createNoDashGuid();\r\n        this.privStream = new ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec / 10);\r\n    }\r\n\r\n    /**\r\n     * Format information for the audio\r\n     */\r\n    public get format(): Promise<AudioStreamFormatImpl> {\r\n        return Promise.resolve(this.privFormat);\r\n    }\r\n\r\n    /**\r\n     * Writes the audio data specified by making an internal copy of the data.\r\n     * @member PushAudioInputStreamImpl.prototype.write\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - The audio buffer of which this function will make a copy.\r\n     */\r\n    public write(dataBuffer: ArrayBuffer): void {\r\n        this.privStream.writeStreamChunk({\r\n            buffer: dataBuffer,\r\n            isEnd: false,\r\n            timeReceived: Date.now()\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Closes the stream.\r\n     * @member PushAudioInputStreamImpl.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(): void {\r\n        this.privStream.close();\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public get blob(): Promise<Blob | Buffer> {\r\n        return this.attach(\"id\").then<Blob | Buffer>((audioNode: IAudioStreamNode) => {\r\n            const data: ArrayBuffer[] = [];\r\n            let bufferData = Buffer.from(\"\");\r\n            const readCycle = (): Promise<Blob | Buffer> => {\r\n                return audioNode.read().then<Blob | Buffer>((audioStreamChunk: IStreamChunk<ArrayBuffer>) => {\r\n                    if (!audioStreamChunk || audioStreamChunk.isEnd) {\r\n                        if (typeof (XMLHttpRequest) !== \"undefined\" && typeof (Blob) !== \"undefined\") {\r\n                            return Promise.resolve(new Blob(data));\r\n                        } else {\r\n                            return Promise.resolve(Buffer.from(bufferData));\r\n                        }\r\n                    } else {\r\n                        if (typeof (Blob) !== \"undefined\") {\r\n                            data.push(audioStreamChunk.buffer);\r\n                        } else {\r\n                            bufferData = Buffer.concat([bufferData, this.toBuffer(audioStreamChunk.buffer)]);\r\n                        }\r\n                        return readCycle();\r\n                    }\r\n                });\r\n            };\r\n            return readCycle();\r\n        });\r\n    }\r\n\r\n    public turnOn(): Promise<void> {\r\n        this.onEvent(new AudioSourceInitializingEvent(this.privId)); // no stream id\r\n        this.onEvent(new AudioSourceReadyEvent(this.privId));\r\n        return;\r\n    }\r\n\r\n    public async attach(audioNodeId: string): Promise<IAudioStreamNode> {\r\n        this.onEvent(new AudioStreamNodeAttachingEvent(this.privId, audioNodeId));\r\n\r\n        await this.turnOn();\r\n        const stream = this.privStream;\r\n        this.onEvent(new AudioStreamNodeAttachedEvent(this.privId, audioNodeId));\r\n        return {\r\n            detach: async () => {\r\n                stream.readEnded();\r\n                this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n                return this.turnOff();\r\n            },\r\n            id: () => {\r\n                return audioNodeId;\r\n            },\r\n            read: () => {\r\n                return stream.read();\r\n            },\r\n        };\r\n    }\r\n\r\n    public detach(audioNodeId: string): void {\r\n        this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n    }\r\n\r\n    public turnOff(): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    public get events(): EventSource<AudioSourceEvent> {\r\n        return this.privEvents;\r\n    }\r\n\r\n    public get deviceInfo(): Promise<ISpeechConfigAudioDevice> {\r\n        return Promise.resolve({\r\n            bitspersample: this.privFormat.bitsPerSample,\r\n            channelcount: this.privFormat.channels,\r\n            connectivity: connectivity.Unknown,\r\n            manufacturer: \"Speech SDK\",\r\n            model: \"PushStream\",\r\n            samplerate: this.privFormat.samplesPerSec,\r\n            type: type.Stream,\r\n        });\r\n    }\r\n\r\n    private onEvent = (event: AudioSourceEvent): void => {\r\n        this.privEvents.onEvent(event);\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private toBuffer(arrayBuffer: ArrayBuffer): Buffer {\r\n        const buf: Buffer = Buffer.alloc(arrayBuffer.byteLength);\r\n        const view: Uint8Array = new Uint8Array(arrayBuffer);\r\n        for (let i = 0; i < buf.length; ++i) {\r\n            buf[i] = view[i];\r\n        }\r\n        return buf;\r\n    }\r\n}\r\n\r\n/*\r\n * Represents audio input stream used for custom audio input configurations.\r\n * @class PullAudioInputStream\r\n */\r\nexport abstract class PullAudioInputStream extends AudioInputStream {\r\n    /**\r\n     * Creates and initializes and instance.\r\n     * @constructor\r\n     */\r\n    protected constructor() { super(); }\r\n\r\n    /**\r\n     * Creates a PullAudioInputStream that delegates to the specified callback interface for\r\n     * read() and close() methods, using the default format (16 kHz 16bit mono PCM).\r\n     * @member PullAudioInputStream.create\r\n     * @function\r\n     * @public\r\n     * @param {PullAudioInputStreamCallback} callback - The custom audio input object,\r\n     *        derived from PullAudioInputStreamCustomCallback\r\n     * @param {AudioStreamFormat} format - The audio data format in which audio will be\r\n     *        returned from the callback's read() method (Required if format is not 16 kHz 16bit mono PCM).\r\n     * @returns {PullAudioInputStream} The push audio input stream being created.\r\n     */\r\n    public static create(callback: PullAudioInputStreamCallback, format?: AudioStreamFormat): PullAudioInputStream {\r\n        return new PullAudioInputStreamImpl(callback, format as AudioStreamFormatImpl);\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member PullAudioInputStream.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n\r\n}\r\n\r\n/**\r\n * Represents audio input stream used for custom audio input configurations.\r\n * @private\r\n * @class PullAudioInputStreamImpl\r\n */\r\nexport class PullAudioInputStreamImpl extends PullAudioInputStream implements IAudioSource {\r\n\r\n    private privCallback: PullAudioInputStreamCallback;\r\n    private privFormat: AudioStreamFormatImpl;\r\n    private privId: string;\r\n    private privEvents: EventSource<AudioSourceEvent>;\r\n    private privIsClosed: boolean;\r\n    private privBufferSize: number;\r\n\r\n    /**\r\n     * Creates a PullAudioInputStream that delegates to the specified callback interface for\r\n     * read() and close() methods, using the default format (16 kHz 16bit mono PCM).\r\n     * @constructor\r\n     * @param {PullAudioInputStreamCallback} callback - The custom audio input object,\r\n     *        derived from PullAudioInputStreamCustomCallback\r\n     * @param {AudioStreamFormat} format - The audio data format in which audio will be\r\n     *        returned from the callback's read() method (Required if format is not 16 kHz 16bit mono PCM).\r\n     */\r\n    public constructor(callback: PullAudioInputStreamCallback, format?: AudioStreamFormatImpl) {\r\n        super();\r\n        if (undefined === format) {\r\n            this.privFormat = AudioStreamFormat.getDefaultInputFormat() as AudioStreamFormatImpl;\r\n        } else {\r\n            this.privFormat = format;\r\n        }\r\n        this.privEvents = new EventSource<AudioSourceEvent>();\r\n        this.privId = createNoDashGuid();\r\n        this.privCallback = callback;\r\n        this.privIsClosed = false;\r\n        this.privBufferSize = this.privFormat.avgBytesPerSec / 10;\r\n    }\r\n\r\n    /**\r\n     * Format information for the audio\r\n     */\r\n    public get format(): Promise<AudioStreamFormatImpl> {\r\n        return Promise.resolve(this.privFormat);\r\n    }\r\n\r\n    /**\r\n     * Closes the stream.\r\n     * @member PullAudioInputStreamImpl.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(): void {\r\n        this.privIsClosed = true;\r\n        this.privCallback.close();\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public get blob(): Promise<Blob | Buffer> {\r\n        return Promise.reject(\"Not implemented\");\r\n    }\r\n\r\n    public turnOn(): Promise<void> {\r\n        this.onEvent(new AudioSourceInitializingEvent(this.privId)); // no stream id\r\n        this.onEvent(new AudioSourceReadyEvent(this.privId));\r\n        return;\r\n    }\r\n\r\n    public async attach(audioNodeId: string): Promise<IAudioStreamNode> {\r\n        this.onEvent(new AudioStreamNodeAttachingEvent(this.privId, audioNodeId));\r\n\r\n        await this.turnOn();\r\n        this.onEvent(new AudioStreamNodeAttachedEvent(this.privId, audioNodeId));\r\n        return {\r\n            detach: () => {\r\n                this.privCallback.close();\r\n                this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n                return this.turnOff();\r\n            },\r\n            id: () => {\r\n                return audioNodeId;\r\n            },\r\n            read: (): Promise<IStreamChunk<ArrayBuffer>> => {\r\n                let totalBytes: number = 0;\r\n                let transmitBuff: ArrayBuffer;\r\n                // Until we have the minimum number of bytes to send in a transmission, keep asking for more.\r\n                while (totalBytes < this.privBufferSize) {\r\n                    // Sizing the read buffer to the delta between the perfect size and what's left means we won't ever get too much\r\n                    // data back.\r\n                    const readBuff: ArrayBuffer = new ArrayBuffer(this.privBufferSize - totalBytes);\r\n                    const pulledBytes: number = this.privCallback.read(readBuff);\r\n                    // If there is no return buffer yet defined, set the return buffer to the that was just populated.\r\n                    // This was, if we have enough data there's no copy penalty, but if we don't we have a buffer that's the\r\n                    // preferred size allocated.\r\n                    if (undefined === transmitBuff) {\r\n                        transmitBuff = readBuff;\r\n                    } else {\r\n                        // Not the first bite at the apple, so fill the return buffer with the data we got back.\r\n                        const intView: Int8Array = new Int8Array(transmitBuff);\r\n                        intView.set(new Int8Array(readBuff), totalBytes);\r\n                    }\r\n                    // If there are no bytes to read, just break out and be done.\r\n                    if (0 === pulledBytes) {\r\n                        break;\r\n                    }\r\n                    totalBytes += pulledBytes;\r\n                }\r\n                return Promise.resolve<IStreamChunk<ArrayBuffer>>({\r\n                    buffer: transmitBuff.slice(0, totalBytes),\r\n                    isEnd: this.privIsClosed || totalBytes === 0,\r\n                    timeReceived: Date.now(),\r\n                });\r\n            },\r\n        };\r\n    }\r\n\r\n    public detach(audioNodeId: string): void {\r\n        this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n    }\r\n\r\n    public turnOff(): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    public get events(): EventSource<AudioSourceEvent> {\r\n        return this.privEvents;\r\n    }\r\n\r\n    public get deviceInfo(): Promise<ISpeechConfigAudioDevice> {\r\n        return Promise.resolve({\r\n            bitspersample: this.privFormat.bitsPerSample,\r\n            channelcount: this.privFormat.channels,\r\n            connectivity: connectivity.Unknown,\r\n            manufacturer: \"Speech SDK\",\r\n            model: \"PullStream\",\r\n            samplerate: this.privFormat.samplesPerSec,\r\n            type: type.Stream,\r\n        });\r\n    }\r\n\r\n    private onEvent = (event: AudioSourceEvent): void => {\r\n        this.privEvents.onEvent(event);\r\n        Events.instance.onEvent(event);\r\n    }\r\n}\r\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { InvalidOperationError } from \"./Error\";\r\nimport { createNoDashGuid } from \"./Guid\";\r\nimport { IStringDictionary } from \"./IDictionary\";\r\n\r\nexport enum MessageType {\r\n    Text,\r\n    Binary,\r\n}\r\n\r\nexport class ConnectionMessage {\r\n\r\n    private privMessageType: MessageType;\r\n    private privHeaders: IStringDictionary<string>;\r\n    private privBody: any = null;\r\n    private privSize: number;\r\n\r\n    private privId: string;\r\n\r\n    public constructor(\r\n        messageType: MessageType,\r\n        body: any,\r\n        headers?: IStringDictionary<string>,\r\n        id?: string) {\r\n\r\n        if (messageType === MessageType.Text && body && !(typeof (body) === \"string\")) {\r\n            throw new InvalidOperationError(\"Payload must be a string\");\r\n        }\r\n\r\n        if (messageType === MessageType.Binary && body && !(body instanceof ArrayBuffer)) {\r\n            throw new InvalidOperationError(\"Payload must be ArrayBuffer\");\r\n        }\r\n\r\n        this.privMessageType = messageType;\r\n        this.privBody = body;\r\n        this.privHeaders = headers ? headers : {};\r\n        this.privId = id ? id : createNoDashGuid();\r\n        switch (this.messageType) {\r\n            case MessageType.Binary:\r\n                this.privSize = this.binaryBody !== null ? this.binaryBody.byteLength : 0;\r\n                break;\r\n            case MessageType.Text:\r\n                this.privSize = this.textBody.length;\r\n        }\r\n    }\r\n\r\n    public get messageType(): MessageType {\r\n        return this.privMessageType;\r\n    }\r\n\r\n    public get headers(): IStringDictionary<string> {\r\n        return this.privHeaders;\r\n    }\r\n\r\n    public get body(): any {\r\n        return this.privBody;\r\n    }\r\n\r\n    public get textBody(): string {\r\n        if (this.privMessageType === MessageType.Binary) {\r\n            throw new InvalidOperationError(\"Not supported for binary message\");\r\n        }\r\n\r\n        return this.privBody as string;\r\n    }\r\n\r\n    public get binaryBody(): ArrayBuffer {\r\n        if (this.privMessageType === MessageType.Text) {\r\n            throw new InvalidOperationError(\"Not supported for text message\");\r\n        }\r\n\r\n        return this.privBody;\r\n    }\r\n\r\n    public get id(): string {\r\n        return this.privId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport * as http from \"http\";\r\nimport * as tls from \"tls\";\r\nimport * as parse from \"url-parse\";\r\nimport * as ocsp from \"../../external/ocsp/ocsp\";\r\nimport {\r\n    Events,\r\n    OCSPCacheEntryExpiredEvent,\r\n    OCSPCacheEntryNeedsRefreshEvent,\r\n    OCSPCacheFetchErrorEvent,\r\n    OCSPCacheHitEvent,\r\n    OCSPCacheMissEvent,\r\n    OCSPCacheUpdatehCompleteEvent,\r\n    OCSPCacheUpdateNeededEvent,\r\n    OCSPDiskCacheHitEvent,\r\n    OCSPDiskCacheStoreEvent,\r\n    OCSPEvent,\r\n    OCSPMemoryCacheHitEvent,\r\n    OCSPMemoryCacheStoreEvent,\r\n    OCSPResponseRetrievedEvent,\r\n    OCSPStapleReceivedEvent,\r\n    OCSPVerificationFailedEvent,\r\n} from \"../common/Exports\";\r\nimport { IStringDictionary } from \"../common/IDictionary\";\r\nimport { ProxyInfo } from \"./ProxyInfo\";\r\n\r\nimport Agent from \"agent-base\";\r\n\r\n// @ts-ignore\r\nimport Cache from \"async-disk-cache\";\r\nimport HttpsProxyAgent from \"https-proxy-agent\";\r\nimport * as net from \"net\";\r\nimport { OCSPCacheUpdateErrorEvent } from \"../common/OCSPEvents\";\r\n\r\nexport class CertCheckAgent {\r\n\r\n    // Test hook to enable forcing expiration / refresh to happen.\r\n    public static testTimeOffset: number = 0;\r\n\r\n    // Test hook to disable stapling for cache testing.\r\n    public static forceDisableOCSPStapling: boolean = false;\r\n\r\n    // An in memory cache for recived responses.\r\n    private static privMemCache: IStringDictionary<Buffer> = {};\r\n\r\n    // The on disk cache.\r\n    private static privDiskCache: Cache;\r\n\r\n    private privProxyInfo: ProxyInfo;\r\n\r\n    constructor(proxyInfo?: ProxyInfo) {\r\n        if (!!proxyInfo) {\r\n            this.privProxyInfo = proxyInfo;\r\n        }\r\n\r\n        // Initialize this here to allow tests to set the env variable before the cache is constructed.\r\n        if (!CertCheckAgent.privDiskCache) {\r\n            CertCheckAgent.privDiskCache = new Cache(\"microsoft-cognitiveservices-speech-sdk-cache\", { supportBuffer: true, location: (typeof process !== \"undefined\" && !!process.env.SPEECH_OCSP_CACHE_ROOT) ? process.env.SPEECH_OCSP_CACHE_ROOT : undefined });\r\n        }\r\n    }\r\n\r\n    // Test hook to force the disk cache to be recreated.\r\n    public static forceReinitDiskCache(): void {\r\n        CertCheckAgent.privDiskCache = undefined;\r\n        CertCheckAgent.privMemCache = {};\r\n    }\r\n\r\n    public GetAgent(disableStapling?: boolean): http.Agent {\r\n        const agent: any = new Agent.Agent(this.CreateConnection);\r\n\r\n        if (this.privProxyInfo !== undefined &&\r\n            this.privProxyInfo.HostName !== undefined &&\r\n            this.privProxyInfo.Port > 0) {\r\n            const proxyName: string = \"privProxyInfo\";\r\n            agent[proxyName] = this.privProxyInfo;\r\n        }\r\n\r\n        return agent;\r\n    }\r\n\r\n    private static GetProxyAgent(proxyInfo: ProxyInfo): HttpsProxyAgent {\r\n        const httpProxyOptions: HttpsProxyAgent.HttpsProxyAgentOptions = {\r\n            host: proxyInfo.HostName,\r\n            port: proxyInfo.Port,\r\n        };\r\n\r\n        if (!!proxyInfo.UserName) {\r\n            httpProxyOptions.headers = {\r\n                \"Proxy-Authentication\": \"Basic \" + new Buffer(proxyInfo.UserName + \":\" + (proxyInfo.Password === undefined) ? \"\" : proxyInfo.Password).toString(\"base64\"),\r\n            };\r\n        } else {\r\n            httpProxyOptions.headers = {};\r\n        }\r\n\r\n        httpProxyOptions.headers.requestOCSP = \"true\";\r\n\r\n        const httpProxyAgent: HttpsProxyAgent = new HttpsProxyAgent(httpProxyOptions);\r\n        return httpProxyAgent;\r\n    }\r\n\r\n    private static async OCSPCheck(socketPromise: Promise<net.Socket>, proxyInfo: ProxyInfo): Promise<net.Socket> {\r\n        let ocspRequest: ocsp.Request;\r\n        let stapling: Buffer;\r\n        let resolved: boolean = false;\r\n\r\n        const socket: net.Socket = await socketPromise;\r\n        socket.cork();\r\n\r\n        const tlsSocket: tls.TLSSocket = socket as tls.TLSSocket;\r\n\r\n        return new Promise<net.Socket>((resolve: (value: net.Socket) => void, reject: (error: string | Error) => void) => {\r\n            socket.on(\"OCSPResponse\", (data: Buffer): void => {\r\n                if (!!data) {\r\n                    this.onEvent(new OCSPStapleReceivedEvent());\r\n                    stapling = data;\r\n                }\r\n            });\r\n\r\n            socket.on(\"error\", (error: Error) => {\r\n                if (!resolved) {\r\n                    resolved = true;\r\n                    socket.destroy();\r\n                    reject(error);\r\n                }\r\n            });\r\n\r\n            tlsSocket.on(\"secure\", async () => {\r\n                const peer: tls.DetailedPeerCertificate = tlsSocket.getPeerCertificate(true);\r\n                try {\r\n                    const issuer: tls.DetailedPeerCertificate = await this.GetIssuer(peer);\r\n\r\n                    // We always need a request to verify the response.\r\n                    ocspRequest = ocsp.request.generate(peer.raw, issuer.raw);\r\n\r\n                    // Do we have a result for this certificate in our memory cache?\r\n                    const sig: string = ocspRequest.id.toString(\"hex\");\r\n\r\n                    // Stapled response trumps cached response.\r\n                    if (!stapling) {\r\n                        const cacheEntry: Buffer = await CertCheckAgent.GetResponseFromCache(sig, ocspRequest, proxyInfo);\r\n                        stapling = cacheEntry;\r\n                    }\r\n\r\n                    await this.VerifyOCSPResponse(stapling, ocspRequest, proxyInfo);\r\n\r\n                    socket.uncork();\r\n                    resolved = true;\r\n                    resolve(socket);\r\n                } catch (e) {\r\n                    socket.destroy();\r\n                    resolved = true;\r\n                    reject(e);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private static GetIssuer(peer: tls.DetailedPeerCertificate): Promise<tls.DetailedPeerCertificate> {\r\n        if (peer.issuerCertificate) {\r\n            return Promise.resolve(peer.issuerCertificate);\r\n        }\r\n\r\n        return new Promise<tls.DetailedPeerCertificate>((resolve: (value: tls.DetailedPeerCertificate) => void, reject: (reason: string) => void) => {\r\n            const ocspAgent: ocsp.Agent = new ocsp.Agent({});\r\n            ocspAgent.fetchIssuer(peer, null, (error: string, value: tls.DetailedPeerCertificate): void => {\r\n                if (!!error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n\r\n                resolve(value);\r\n            });\r\n        });\r\n    }\r\n\r\n    private static async GetResponseFromCache(signature: string, ocspRequest: ocsp.Request, proxyInfo: ProxyInfo): Promise<Buffer> {\r\n        let cachedResponse: Buffer = CertCheckAgent.privMemCache[signature];\r\n\r\n        if (!!cachedResponse) {\r\n            this.onEvent(new OCSPMemoryCacheHitEvent(signature));\r\n        }\r\n\r\n        // Do we have a result for this certificate on disk in %TMP%?\r\n        if (!cachedResponse) {\r\n            try {\r\n                const diskCacheResponse: any = await CertCheckAgent.privDiskCache.get(signature);\r\n                if (!!diskCacheResponse.isCached) {\r\n                    CertCheckAgent.onEvent(new OCSPDiskCacheHitEvent(signature));\r\n                    CertCheckAgent.StoreMemoryCacheEntry(signature, diskCacheResponse.value);\r\n                    cachedResponse = diskCacheResponse.value;\r\n                }\r\n            } catch (error) {\r\n                cachedResponse = null;\r\n            }\r\n        }\r\n\r\n        if (!cachedResponse) {\r\n            return cachedResponse;\r\n        }\r\n\r\n        try {\r\n            const cachedOcspResponse: ocsp.Response = ocsp.utils.parseResponse(cachedResponse);\r\n            const tbsData = cachedOcspResponse.value.tbsResponseData;\r\n            if (tbsData.responses.length < 1) {\r\n                this.onEvent(new OCSPCacheFetchErrorEvent(signature, \"Not enough data in cached response\"));\r\n                return;\r\n            }\r\n\r\n            const cachedStartTime: number = tbsData.responses[0].thisUpdate;\r\n            const cachedNextTime: number = tbsData.responses[0].nextUpdate;\r\n\r\n            if (cachedNextTime < (Date.now() + this.testTimeOffset - 60000)) {\r\n                // Cached entry has expired.\r\n                this.onEvent(new OCSPCacheEntryExpiredEvent(signature, cachedNextTime));\r\n                cachedResponse = null;\r\n            } else {\r\n                // If we're within one day of the next update, or 50% of the way through the validity period,\r\n                // background an update to the cache.\r\n\r\n                const minUpdate: number = Math.min(24 * 60 * 60 * 1000, (cachedNextTime - cachedStartTime) / 2);\r\n\r\n                if ((cachedNextTime - (Date.now() + this.testTimeOffset)) < minUpdate) {\r\n                    this.onEvent(new OCSPCacheEntryNeedsRefreshEvent(signature, cachedStartTime, cachedNextTime));\r\n                    this.UpdateCache(ocspRequest, proxyInfo).catch((error: string) => {\r\n                        // Well, not much we can do here.\r\n                        this.onEvent(new OCSPCacheUpdateErrorEvent(signature, error.toString()));\r\n                    });\r\n                } else {\r\n                    this.onEvent(new OCSPCacheHitEvent(signature, cachedStartTime, cachedNextTime));\r\n                }\r\n            }\r\n        } catch (error) {\r\n            this.onEvent(new OCSPCacheFetchErrorEvent(signature, error));\r\n            cachedResponse = null;\r\n        }\r\n        if (!cachedResponse) {\r\n            this.onEvent(new OCSPCacheMissEvent(signature));\r\n        }\r\n        return cachedResponse;\r\n    }\r\n\r\n    private static async VerifyOCSPResponse(cacheValue: Buffer, ocspRequest: ocsp.Request, proxyInfo: ProxyInfo): Promise<void> {\r\n        let ocspResponse: Buffer = cacheValue;\r\n        const sig: string = ocspRequest.certID.toString(\"hex\");\r\n\r\n        // Do we have a valid response?\r\n        if (!ocspResponse) {\r\n            ocspResponse = await CertCheckAgent.GetOCSPResponse(ocspRequest, proxyInfo);\r\n        }\r\n\r\n        return new Promise<void>((resolve: () => void, reject: (error: string | Error) => void) => {\r\n            ocsp.verify({ request: ocspRequest, response: ocspResponse }, (error: string, result: any): void => {\r\n                if (!!error) {\r\n                    CertCheckAgent.onEvent(new OCSPVerificationFailedEvent(ocspRequest.id.toString(\"hex\"), error));\r\n\r\n                    // Bad Cached Value? One more try without the cache.\r\n                    if (!!cacheValue) {\r\n                        this.VerifyOCSPResponse(null, ocspRequest, proxyInfo).then(() => {\r\n                            resolve();\r\n                        }, (error: Error) => {\r\n                            reject(error);\r\n                        });\r\n                    } else {\r\n                        reject(error);\r\n                    }\r\n                } else {\r\n                    if (!cacheValue) {\r\n                        CertCheckAgent.StoreCacheEntry(ocspRequest.id.toString(\"hex\"), ocspResponse);\r\n                    }\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private static async UpdateCache(req: ocsp.Request, proxyInfo: ProxyInfo): Promise<void> {\r\n        const signature: string = req.id.toString(\"hex\");\r\n        this.onEvent(new OCSPCacheUpdateNeededEvent(signature));\r\n\r\n        const rawResponse: Buffer = await this.GetOCSPResponse(req, proxyInfo);\r\n        this.StoreCacheEntry(signature, rawResponse);\r\n        this.onEvent(new OCSPCacheUpdatehCompleteEvent(req.id.toString(\"hex\")));\r\n\r\n    }\r\n\r\n    private static StoreCacheEntry(sig: string, rawResponse: Buffer): void {\r\n        this.StoreMemoryCacheEntry(sig, rawResponse);\r\n        this.StoreDiskCacheEntry(sig, rawResponse);\r\n    }\r\n\r\n    private static StoreMemoryCacheEntry(sig: string, rawResponse: Buffer): void {\r\n        this.privMemCache[sig] = rawResponse;\r\n        this.onEvent(new OCSPMemoryCacheStoreEvent(sig));\r\n    }\r\n\r\n    private static StoreDiskCacheEntry(sig: string, rawResponse: Buffer): void {\r\n        this.privDiskCache.set(sig, rawResponse).then(() => {\r\n            this.onEvent(new OCSPDiskCacheStoreEvent(sig));\r\n        });\r\n    }\r\n\r\n    private static GetOCSPResponse(req: ocsp.Request, proxyInfo: ProxyInfo): Promise<Buffer> {\r\n\r\n        const ocspMethod: string = \"1.3.6.1.5.5.7.48.1\";\r\n        let options: http.RequestOptions = {};\r\n\r\n        if (!!proxyInfo) {\r\n            const agent: HttpsProxyAgent = CertCheckAgent.GetProxyAgent(proxyInfo);\r\n            options.agent = agent;\r\n        }\r\n\r\n        return new Promise<Buffer>((resolve: (value: Buffer) => void, reject: (error: string | Error) => void) => {\r\n            ocsp.utils.getAuthorityInfo(req.cert, ocspMethod, (error: string, uri: string): void => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n\r\n                const parsedUri: {[k: string]: any} = parse.default(uri);\r\n                parsedUri.path = parsedUri.pathname;\r\n                options = { ...options, ...parsedUri };\r\n\r\n                ocsp.utils.getResponse(options, req.data, (error: string, raw: Buffer): void => {\r\n                    if (error) {\r\n                        reject(error);\r\n                        return;\r\n                    }\r\n\r\n                    this.onEvent(new OCSPResponseRetrievedEvent(req.certID.toString(\"hex\")));\r\n                    resolve(raw);\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    private static onEvent = (event: OCSPEvent): void => {\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private CreateConnection(request: Agent.ClientRequest, options: Agent.RequestOptions): Promise<net.Socket> {\r\n        const enableOCSP: boolean = (typeof process !== \"undefined\" && process.env.NODE_TLS_REJECT_UNAUTHORIZED !== \"0\" && process.env.SPEECH_CONDUCT_OCSP_CHECK !== \"0\") && options.secureEndpoint;\r\n        let socketPromise: Promise<net.Socket>;\r\n\r\n        options = {\r\n            ...options,\r\n            ...{\r\n                requestOCSP: !CertCheckAgent.forceDisableOCSPStapling,\r\n                servername: options.host\r\n            }\r\n        };\r\n\r\n        if (!!this.privProxyInfo) {\r\n            const httpProxyAgent: HttpsProxyAgent = CertCheckAgent.GetProxyAgent(this.privProxyInfo);\r\n            const baseAgent: Agent.Agent = httpProxyAgent as unknown as Agent.Agent;\r\n\r\n            socketPromise = new Promise<net.Socket>((resolve: (value: net.Socket) => void, reject: (error: string | Error) => void) => {\r\n                baseAgent.callback(request, options, (error: Error, socket: net.Socket) => {\r\n                    if (!!error) {\r\n                        reject(error);\r\n                    } else {\r\n                        resolve(socket);\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            if (!!options.secureEndpoint) {\r\n                socketPromise = Promise.resolve(tls.connect(options));\r\n            } else {\r\n                socketPromise = Promise.resolve(net.connect(options));\r\n            }\r\n        }\r\n\r\n        if (!!enableOCSP) {\r\n            return CertCheckAgent.OCSPCheck(socketPromise, this.privProxyInfo);\r\n        } else {\r\n            return socketPromise;\r\n        }\r\n    }\r\n}\r\n","'use strict';\n\nvar required = require('requires-port')\n  , qs = require('querystringify')\n  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:[\\\\/]+/\n  , protocolre = /^([a-z][a-z0-9.+-]*:)?([\\\\/]{1,})?([\\S\\s]*)/i\n  , whitespace = '[\\\\x09\\\\x0A\\\\x0B\\\\x0C\\\\x0D\\\\x20\\\\xA0\\\\u1680\\\\u180E\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200A\\\\u202F\\\\u205F\\\\u3000\\\\u2028\\\\u2029\\\\uFEFF]'\n  , left = new RegExp('^'+ whitespace +'+');\n\n/**\n * Trim a given string.\n *\n * @param {String} str String to trim.\n * @public\n */\nfunction trimLeft(str) {\n  return (str ? str : '').toString().replace(left, '');\n}\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  function sanitize(address) {          // Sanitize what is left of the address\n    return address.replace('\\\\', '/');\n  },\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @public\n */\nfunction lolcation(loc) {\n  var globalVar;\n\n  if (typeof window !== 'undefined') globalVar = window;\n  else if (typeof global !== 'undefined') globalVar = global;\n  else if (typeof self !== 'undefined') globalVar = self;\n  else globalVar = {};\n\n  var location = globalVar.location || {};\n  loc = loc || location;\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new Url(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new Url(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) continue;\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @return {ProtocolExtract} Extracted information.\n * @private\n */\nfunction extractProtocol(address) {\n  address = trimLeft(address);\n\n  var match = protocolre.exec(address)\n    , protocol = match[1] ? match[1].toLowerCase() : ''\n    , slashes = !!(match[2] && match[2].length >= 2)\n    , rest =  match[2] && match[2].length === 1 ? '/' + match[3] : match[3];\n\n  return {\n    protocol: protocol,\n    slashes: slashes,\n    rest: rest\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @private\n */\nfunction resolve(relative, base) {\n  if (relative === '') return base;\n\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) unshift = true;\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) path.unshift('');\n  if (last === '.' || last === '..') path.push('');\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * It is worth noting that we should not use `URL` as class name to prevent\n * clashes with the global URL instance that got introduced in browsers.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} [location] Location defaults for relative paths.\n * @param {Boolean|Function} [parser] Parser for the query string.\n * @private\n */\nfunction Url(address, location, parser) {\n  address = trimLeft(address);\n\n  if (!(this instanceof Url)) {\n    return new Url(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) parser = qs.parse;\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '');\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (!extracted.slashes) instructions[3] = [/(.*)/, 'pathname'];\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n\n    if (typeof instruction === 'function') {\n      address = instruction(address);\n      continue;\n    }\n\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) url[key] = url[key].toLowerCase();\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // Default to a / for pathname if none exists. This normalizes the URL\n  // to always have a /\n  //\n  if (url.pathname.charAt(0) !== '/' && url.hostname) {\n    url.pathname = '/' + url.pathname;\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL} URL instance for chaining.\n * @public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || qs.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!required(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) value += ':'+ url.port;\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    default:\n      url[part] = value;\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String} Compiled version of the URL.\n * @public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';\n\n  var result = protocol + (url.slashes ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  }\n\n  result += url.host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n}\n\nUrl.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nUrl.extractProtocol = extractProtocol;\nUrl.location = lolcation;\nUrl.trimLeft = trimLeft;\nUrl.qs = qs;\n\nmodule.exports = Url;\n","'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , undef;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String|Null} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  try {\n    return decodeURIComponent(input.replace(/\\+/g, ' '));\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Attempts to encode a given input.\n *\n * @param {String} input The string that needs to be encoded.\n * @returns {String|Null} The encoded string.\n * @api private\n */\nfunction encode(input) {\n  try {\n    return encodeURIComponent(input);\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?#&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  while (part = parser.exec(query)) {\n    var key = decode(part[1])\n      , value = decode(part[2]);\n\n    //\n    // Prevent overriding of existing properties. This ensures that build-in\n    // methods like `toString` or __proto__ are not overriden by malicious\n    // querystrings.\n    //\n    // In the case if failed decoding, we want to omit the key/value pairs\n    // from the result.\n    //\n    if (key === null || value === null || key in result) continue;\n    result[key] = value;\n  }\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = []\n    , value\n    , key;\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (key in obj) {\n    if (has.call(obj, key)) {\n      value = obj[key];\n\n      //\n      // Edge cases where we actually want to encode the value to an empty\n      // string instead of the stringified value.\n      //\n      if (!value && (value === null || value === undef || isNaN(value))) {\n        value = '';\n      }\n\n      key = encode(key);\n      value = encode(value);\n\n      //\n      // If we failed to encode the strings, we should bail out as we don't\n      // want to add invalid strings to the query.\n      //\n      if (key === null || value === null) continue;\n      pairs.push(key +'='+ value);\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { EventType, PlatformEvent } from \"./PlatformEvent\";\r\n\r\nexport class OCSPEvent extends PlatformEvent {\r\n    private privSignature: string;\r\n\r\n    constructor(eventName: string, eventType: EventType, signature: string) {\r\n        super(eventName, eventType);\r\n\r\n        this.privSignature = signature;\r\n    }\r\n}\r\n\r\nexport class OCSPMemoryCacheHitEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPMemoryCacheHitEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPCacheMissEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPCacheMissEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPDiskCacheHitEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPDiskCacheHitEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPCacheUpdateNeededEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPCacheUpdateNeededEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPMemoryCacheStoreEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPMemoryCacheStoreEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPDiskCacheStoreEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPDiskCacheStoreEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPCacheUpdatehCompleteEvent extends OCSPEvent {\r\n    constructor(signature: string) {\r\n        super(\"OCSPCacheUpdatehCompleteEvent\", EventType.Debug, signature);\r\n    }\r\n}\r\n\r\nexport class OCSPStapleReceivedEvent extends OCSPEvent {\r\n    constructor() {\r\n        super(\"OCSPStapleReceivedEvent\", EventType.Debug, \"\");\r\n    }\r\n}\r\n\r\nexport class OCSPWSUpgradeStartedEvent extends OCSPEvent {\r\n    constructor(serialNumber: string) {\r\n        super(\"OCSPWSUpgradeStartedEvent\", EventType.Debug, serialNumber);\r\n    }\r\n}\r\n\r\nexport class OCSPCacheEntryExpiredEvent extends OCSPEvent {\r\n    private privExpireTime: number;\r\n\r\n    constructor(serialNumber: string, expireTime: number) {\r\n        super(\"OCSPCacheEntryExpiredEvent\", EventType.Debug, serialNumber);\r\n        this.privExpireTime = expireTime;\r\n    }\r\n}\r\n\r\nexport class OCSPCacheEntryNeedsRefreshEvent extends OCSPEvent {\r\n    private privExpireTime: number;\r\n    private privStartTime: number;\r\n\r\n    constructor(serialNumber: string, startTime: number, expireTime: number) {\r\n        super(\"OCSPCacheEntryNeedsRefreshEvent\", EventType.Debug, serialNumber);\r\n        this.privExpireTime = expireTime;\r\n        this.privStartTime = startTime;\r\n    }\r\n}\r\n\r\nexport class OCSPCacheHitEvent extends OCSPEvent {\r\n    private privExpireTime: number;\r\n    private privStartTime: number;\r\n    private privExpireTimeString: string;\r\n    private privStartTimeString: string;\r\n\r\n    constructor(serialNumber: string, startTime: number, expireTime: number) {\r\n        super(\"OCSPCacheHitEvent\", EventType.Debug, serialNumber);\r\n        this.privExpireTime = expireTime;\r\n        this.privExpireTimeString = new Date(expireTime).toLocaleDateString();\r\n        this.privStartTime = startTime;\r\n        this.privStartTimeString = new Date(startTime).toLocaleTimeString();\r\n    }\r\n}\r\n\r\nexport class OCSPVerificationFailedEvent extends OCSPEvent {\r\n    private privError: string;\r\n\r\n    constructor(serialNumber: string, error: string) {\r\n        super(\"OCSPVerificationFailedEvent\", EventType.Debug, serialNumber);\r\n        this.privError = error;\r\n    }\r\n}\r\n\r\nexport class OCSPCacheFetchErrorEvent extends OCSPEvent {\r\n    private privError: string;\r\n\r\n    constructor(serialNumber: string, error: string) {\r\n        super(\"OCSPCacheFetchErrorEvent\", EventType.Debug, serialNumber);\r\n        this.privError = error;\r\n    }\r\n}\r\n\r\nexport class OCSPResponseRetrievedEvent extends OCSPEvent {\r\n    constructor(serialNumber: string) {\r\n        super(\"OCSPResponseRetrievedEvent\", EventType.Debug, serialNumber);\r\n    }\r\n}\r\n\r\nexport class OCSPCacheUpdateErrorEvent extends OCSPEvent {\r\n    private privError: string;\r\n\r\n    constructor(serialNumber: string, error: string) {\r\n        super(\"OCSPCacheUpdateErrorEvent\", EventType.Debug, serialNumber);\r\n        this.privError = error;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { InvalidOperationError, ObjectDisposedError } from \"./Error\";\r\nimport { IDetachable } from \"./IDetachable\";\r\nimport { IDisposable } from \"./IDisposable\";\r\nimport { List } from \"./List\";\r\nimport {\r\n    Deferred,\r\n} from \"./Promise\";\r\nexport interface IQueue<TItem> extends IDisposable {\r\n    enqueue(item: TItem): void;\r\n    enqueueFromPromise(promise: Promise<TItem>): void;\r\n    dequeue(): Promise<TItem>;\r\n    peek(): Promise<TItem>;\r\n    length(): number;\r\n}\r\n\r\nenum SubscriberType {\r\n    Dequeue,\r\n    Peek,\r\n}\r\n\r\nexport class Queue<TItem> implements IQueue<TItem> {\r\n    private privPromiseStore: List<Promise<TItem>> = new List<Promise<TItem>>();\r\n    private privList: List<TItem>;\r\n    private privDetachables: IDetachable[];\r\n    private privSubscribers: List<{ type: SubscriberType, deferral: Deferred<TItem> }>;\r\n    private privIsDrainInProgress: boolean = false;\r\n    private privIsDisposing: boolean = false;\r\n    private privDisposeReason: string = null;\r\n\r\n    public constructor(list?: List<TItem>) {\r\n        this.privList = list ? list : new List<TItem>();\r\n        this.privDetachables = [];\r\n        this.privSubscribers = new List<{ type: SubscriberType, deferral: Deferred<TItem> }>();\r\n        this.privDetachables.push(this.privList.onAdded(this.drain));\r\n    }\r\n\r\n    public enqueue = (item: TItem): void => {\r\n        this.throwIfDispose();\r\n        this.enqueueFromPromise(new Promise<TItem>((resolve: (value: TItem) => void, reject: (reason: any) => void) => { resolve(item); }));\r\n    }\r\n\r\n    public enqueueFromPromise = (promise: Promise<TItem>): void => {\r\n        this.throwIfDispose();\r\n        promise.then((val: TItem): void => {\r\n            this.privList.add(val);\r\n             /* tslint:disable:no-empty */\r\n        }, (error: string): void => { });\r\n    }\r\n\r\n    public dequeue = (): Promise<TItem> => {\r\n        this.throwIfDispose();\r\n        const deferredSubscriber = new Deferred<TItem>();\r\n\r\n        if (this.privSubscribers) {\r\n            this.privSubscribers.add({ deferral: deferredSubscriber, type: SubscriberType.Dequeue });\r\n            this.drain();\r\n        }\r\n\r\n        return deferredSubscriber.promise;\r\n    }\r\n\r\n    public peek = (): Promise<TItem> => {\r\n        this.throwIfDispose();\r\n        const deferredSubscriber = new Deferred<TItem>();\r\n\r\n        const subs = this.privSubscribers;\r\n        if (subs) {\r\n            this.privSubscribers.add({ deferral: deferredSubscriber, type: SubscriberType.Peek });\r\n            this.drain();\r\n        }\r\n\r\n        return deferredSubscriber.promise;\r\n    }\r\n\r\n    public length = (): number => {\r\n        this.throwIfDispose();\r\n        return this.privList.length();\r\n    }\r\n\r\n    public isDisposed = (): boolean => {\r\n        return this.privSubscribers == null;\r\n    }\r\n\r\n    public async drainAndDispose(pendingItemProcessor: (pendingItemInQueue: TItem) => void, reason?: string): Promise<void> {\r\n        if (!this.isDisposed() && !this.privIsDisposing) {\r\n            this.privDisposeReason = reason;\r\n            this.privIsDisposing = true;\r\n\r\n            const subs = this.privSubscribers;\r\n            if (subs) {\r\n                while (subs.length() > 0) {\r\n                    const subscriber = subs.removeFirst();\r\n                    // TODO: this needs work (Resolve(null) instead?).\r\n                    subscriber.deferral.resolve(undefined);\r\n                    // subscriber.deferral.reject(\"Disposed\");\r\n                }\r\n\r\n                // note: this block assumes cooperative multitasking, i.e.,\r\n                // between the if-statement and the assignment there are no\r\n                // thread switches.\r\n                // Reason is that between the initial const = this.; and this\r\n                // point there is the derral.resolve() operation that might have\r\n                // caused recursive calls to the Queue, especially, calling\r\n                // Dispose() on the queue alredy (which would reset the var\r\n                // here to null!).\r\n                // That should generally hold true for javascript...\r\n                if (this.privSubscribers === subs) {\r\n                    this.privSubscribers = subs;\r\n                }\r\n            }\r\n\r\n            for (const detachable of this.privDetachables) {\r\n                await detachable.detach();\r\n            }\r\n\r\n            if (this.privPromiseStore.length() > 0 && pendingItemProcessor) {\r\n                const promiseArray: Promise<TItem>[] = [];\r\n\r\n                this.privPromiseStore.toArray().forEach((wrapper: Promise<TItem>) => {\r\n                    promiseArray.push(wrapper);\r\n                });\r\n                return Promise.all(promiseArray).finally(() => {\r\n                    this.privSubscribers = null;\r\n                    this.privList.forEach((item: TItem, index: number): void => {\r\n                        pendingItemProcessor(item);\r\n                    });\r\n                    this.privList = null;\r\n                    return;\r\n                }).then<void>();\r\n            } else {\r\n                this.privSubscribers = null;\r\n                this.privList = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public async dispose(reason?: string): Promise<void> {\r\n        await this.drainAndDispose(null, reason);\r\n    }\r\n\r\n    private drain = (): void => {\r\n        if (!this.privIsDrainInProgress && !this.privIsDisposing) {\r\n            this.privIsDrainInProgress = true;\r\n\r\n            const subs = this.privSubscribers;\r\n            const lists = this.privList;\r\n            if (subs && lists) {\r\n                while (lists.length() > 0 && subs.length() > 0 && !this.privIsDisposing) {\r\n                    const subscriber = subs.removeFirst();\r\n                    if (subscriber.type === SubscriberType.Peek) {\r\n                        subscriber.deferral.resolve(lists.first());\r\n                    } else {\r\n                        const dequeuedItem = lists.removeFirst();\r\n                        subscriber.deferral.resolve(dequeuedItem);\r\n                    }\r\n                }\r\n\r\n                // note: this block assumes cooperative multitasking, i.e.,\r\n                // between the if-statement and the assignment there are no\r\n                // thread switches.\r\n                // Reason is that between the initial const = this.; and this\r\n                // point there is the derral.resolve() operation that might have\r\n                // caused recursive calls to the Queue, especially, calling\r\n                // Dispose() on the queue alredy (which would reset the var\r\n                // here to null!).\r\n                // That should generally hold true for javascript...\r\n                if (this.privSubscribers === subs) {\r\n                    this.privSubscribers = subs;\r\n                }\r\n\r\n                // note: this block assumes cooperative multitasking, i.e.,\r\n                // between the if-statement and the assignment there are no\r\n                // thread switches.\r\n                // Reason is that between the initial const = this.; and this\r\n                // point there is the derral.resolve() operation that might have\r\n                // caused recursive calls to the Queue, especially, calling\r\n                // Dispose() on the queue alredy (which would reset the var\r\n                // here to null!).\r\n                // That should generally hold true for javascript...\r\n                if (this.privList === lists) {\r\n                    this.privList = lists;\r\n                }\r\n            }\r\n\r\n            this.privIsDrainInProgress = false;\r\n        }\r\n    }\r\n\r\n    private throwIfDispose = (): void => {\r\n        if (this.isDisposed()) {\r\n            if (this.privDisposeReason) {\r\n                throw new InvalidOperationError(this.privDisposeReason);\r\n            }\r\n\r\n            throw new ObjectDisposedError(\"Queue\");\r\n        } else if (this.privIsDisposing) {\r\n            throw new InvalidOperationError(\"Queue disposing\");\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ObjectDisposedError } from \"./Error\";\r\nimport { IDetachable } from \"./IDetachable\";\r\nimport { IStringDictionary } from \"./IDictionary\";\r\nimport { IDisposable } from \"./IDisposable\";\r\n\r\nexport interface IList<TItem> extends IDisposable {\r\n    get(itemIndex: number): TItem;\r\n    first(): TItem;\r\n    last(): TItem;\r\n\r\n    add(item: TItem): void;\r\n    insertAt(index: number, item: TItem): void;\r\n\r\n    removeFirst(): TItem;\r\n    removeLast(): TItem;\r\n    removeAt(index: number): TItem;\r\n    remove(index: number, count: number): TItem[];\r\n    clear(): void;\r\n\r\n    length(): number;\r\n\r\n    onAdded(addedCallback: () => void): IDetachable;\r\n    onRemoved(removedCallback: () => void): IDetachable;\r\n    onDisposed(disposedCallback: () => void): IDetachable;\r\n\r\n    join(seperator?: string): string;\r\n\r\n    toArray(): TItem[];\r\n\r\n    any(callback?: (item: TItem, index: number) => boolean): boolean;\r\n    all(callback: (item: TItem) => boolean): boolean;\r\n    forEach(callback: (item: TItem, index: number) => void): void;\r\n    select<T2>(callback: (item: TItem, index: number) => T2): List<T2>;\r\n    where(callback: (item: TItem, index: number) => boolean): List<TItem>;\r\n    orderBy(compareFn: (a: TItem, b: TItem) => number): List<TItem>;\r\n    orderByDesc(compareFn: (a: TItem, b: TItem) => number): List<TItem>;\r\n    clone(): List<TItem>;\r\n    concat(list: List<TItem>): List<TItem>;\r\n    concatArray(array: TItem[]): List<TItem>;\r\n}\r\n\r\nexport class List<TItem> implements IList<TItem>  {\r\n    private privList: TItem[];\r\n    private privSubscriptionIdCounter: number = 0;\r\n    private privAddSubscriptions: IStringDictionary<() => void> = {};\r\n    private privRemoveSubscriptions: IStringDictionary<() => void> = {};\r\n    private privDisposedSubscriptions: IStringDictionary<() => void> = {};\r\n    private privDisposeReason: string = null;\r\n\r\n    public constructor(list?: TItem[]) {\r\n        this.privList = [];\r\n        // copy the list rather than taking as is.\r\n        if (list) {\r\n            for (const item of list) {\r\n                this.privList.push(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    public get = (itemIndex: number): TItem => {\r\n        this.throwIfDisposed();\r\n        return this.privList[itemIndex];\r\n    }\r\n\r\n    public first = (): TItem => {\r\n        return this.get(0);\r\n    }\r\n\r\n    public last = (): TItem => {\r\n        return this.get(this.length() - 1);\r\n    }\r\n\r\n    public add = (item: TItem): void => {\r\n        this.throwIfDisposed();\r\n        this.insertAt(this.privList.length, item);\r\n    }\r\n\r\n    public insertAt = (index: number, item: TItem): void => {\r\n        this.throwIfDisposed();\r\n        if (index === 0) {\r\n            this.privList.unshift(item);\r\n        } else if (index === this.privList.length) {\r\n            this.privList.push(item);\r\n        } else {\r\n            this.privList.splice(index, 0, item);\r\n        }\r\n        this.triggerSubscriptions(this.privAddSubscriptions);\r\n    }\r\n\r\n    public removeFirst = (): TItem => {\r\n        this.throwIfDisposed();\r\n        return this.removeAt(0);\r\n    }\r\n\r\n    public removeLast = (): TItem => {\r\n        this.throwIfDisposed();\r\n        return this.removeAt(this.length() - 1);\r\n    }\r\n\r\n    public removeAt = (index: number): TItem => {\r\n        this.throwIfDisposed();\r\n        return this.remove(index, 1)[0];\r\n    }\r\n\r\n    public remove = (index: number, count: number): TItem[] => {\r\n        this.throwIfDisposed();\r\n        const removedElements = this.privList.splice(index, count);\r\n        this.triggerSubscriptions(this.privRemoveSubscriptions);\r\n        return removedElements;\r\n    }\r\n\r\n    public clear = (): void => {\r\n        this.throwIfDisposed();\r\n        this.remove(0, this.length());\r\n    }\r\n\r\n    public length = (): number => {\r\n        this.throwIfDisposed();\r\n        return this.privList.length;\r\n    }\r\n\r\n    public onAdded = (addedCallback: () => void): IDetachable => {\r\n        this.throwIfDisposed();\r\n        const subscriptionId = this.privSubscriptionIdCounter++;\r\n\r\n        this.privAddSubscriptions[subscriptionId] = addedCallback;\r\n\r\n        return {\r\n            detach: () => {\r\n                delete this.privAddSubscriptions[subscriptionId];\r\n                return Promise.resolve();\r\n            },\r\n        };\r\n    }\r\n\r\n    public onRemoved = (removedCallback: () => void): IDetachable => {\r\n        this.throwIfDisposed();\r\n        const subscriptionId = this.privSubscriptionIdCounter++;\r\n\r\n        this.privRemoveSubscriptions[subscriptionId] = removedCallback;\r\n\r\n        return {\r\n            detach: () => {\r\n                delete this.privRemoveSubscriptions[subscriptionId];\r\n                return Promise.resolve();\r\n            },\r\n        };\r\n    }\r\n\r\n    public onDisposed = (disposedCallback: () => void): IDetachable => {\r\n        this.throwIfDisposed();\r\n        const subscriptionId = this.privSubscriptionIdCounter++;\r\n\r\n        this.privDisposedSubscriptions[subscriptionId] = disposedCallback;\r\n\r\n        return {\r\n            detach: () => {\r\n                delete this.privDisposedSubscriptions[subscriptionId];\r\n                return Promise.resolve();\r\n            },\r\n        };\r\n    }\r\n\r\n    public join = (seperator?: string): string => {\r\n        this.throwIfDisposed();\r\n        return this.privList.join(seperator);\r\n    }\r\n\r\n    public toArray = (): TItem[] => {\r\n        const cloneCopy = Array<TItem>();\r\n        this.privList.forEach((val: TItem) => {\r\n            cloneCopy.push(val);\r\n        });\r\n        return cloneCopy;\r\n    }\r\n\r\n    public any = (callback?: (item: TItem, index: number) => boolean): boolean => {\r\n        this.throwIfDisposed();\r\n        if (callback) {\r\n            return this.where(callback).length() > 0;\r\n        } else {\r\n            return this.length() > 0;\r\n        }\r\n    }\r\n\r\n    public all = (callback: (item: TItem) => boolean): boolean => {\r\n        this.throwIfDisposed();\r\n        return this.where(callback).length() === this.length();\r\n    }\r\n\r\n    public forEach = (callback: (item: TItem, index: number) => void): void => {\r\n        this.throwIfDisposed();\r\n        for (let i = 0; i < this.length(); i++) {\r\n            callback(this.privList[i], i);\r\n        }\r\n    }\r\n\r\n    public select = <T2>(callback: (item: TItem, index: number) => T2): List<T2> => {\r\n        this.throwIfDisposed();\r\n        const selectList: T2[] = [];\r\n        for (let i = 0; i < this.privList.length; i++) {\r\n            selectList.push(callback(this.privList[i], i));\r\n        }\r\n\r\n        return new List<T2>(selectList);\r\n    }\r\n\r\n    public where = (callback: (item: TItem, index: number) => boolean): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        const filteredList = new List<TItem>();\r\n        for (let i = 0; i < this.privList.length; i++) {\r\n            if (callback(this.privList[i], i)) {\r\n                filteredList.add(this.privList[i]);\r\n            }\r\n        }\r\n        return filteredList;\r\n    }\r\n\r\n    public orderBy = (compareFn: (a: TItem, b: TItem) => number): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        const clonedArray = this.toArray();\r\n        const orderedArray = clonedArray.sort(compareFn);\r\n        return new List(orderedArray);\r\n    }\r\n\r\n    public orderByDesc = (compareFn: (a: TItem, b: TItem) => number): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        return this.orderBy((a: TItem, b: TItem) => compareFn(b, a));\r\n    }\r\n\r\n    public clone = (): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        return new List<TItem>(this.toArray());\r\n    }\r\n\r\n    public concat = (list: List<TItem>): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        return new List<TItem>(this.privList.concat(list.toArray()));\r\n    }\r\n\r\n    public concatArray = (array: TItem[]): List<TItem> => {\r\n        this.throwIfDisposed();\r\n        return new List<TItem>(this.privList.concat(array));\r\n    }\r\n\r\n    public isDisposed = (): boolean => {\r\n        return this.privList == null;\r\n    }\r\n\r\n    public dispose = (reason?: string): void => {\r\n        if (!this.isDisposed()) {\r\n            this.privDisposeReason = reason;\r\n            this.privList = null;\r\n            this.privAddSubscriptions = null;\r\n            this.privRemoveSubscriptions = null;\r\n            this.triggerSubscriptions(this.privDisposedSubscriptions);\r\n        }\r\n    }\r\n\r\n    private throwIfDisposed = (): void => {\r\n        if (this.isDisposed()) {\r\n            throw new ObjectDisposedError(\"List\", this.privDisposeReason);\r\n        }\r\n    }\r\n\r\n    private triggerSubscriptions = (subscriptions: IStringDictionary<() => void>): void => {\r\n        if (subscriptions) {\r\n            for (const subscriptionId in subscriptions) {\r\n                if (subscriptionId) {\r\n                    subscriptions[subscriptionId]();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines speech property ids.\r\n * @class PropertyId\r\n */\r\nexport enum PropertyId {\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service subscription Key. If you are using an intent recognizer, you need to specify\r\n     * to specify the LUIS endpoint key for your particular LUIS app. Under normal circumstances, you shouldn't\r\n     * have to use this property directly.\r\n     * Instead, use [[SpeechConfig.fromSubscription]].\r\n     * @member PropertyId.SpeechServiceConnection_Key\r\n     */\r\n    SpeechServiceConnection_Key = 0,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service endpoint (url). Under normal circumstances, you shouldn't\r\n     * have to use this property directly.\r\n     * Instead, use [[SpeechConfig.fromEndpoint]].\r\n     * NOTE: This endpoint is not the same as the endpoint used to obtain an access token.\r\n     * @member PropertyId.SpeechServiceConnection_Endpoint\r\n     */\r\n    SpeechServiceConnection_Endpoint,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service region. Under normal circumstances, you shouldn't have to\r\n     * use this property directly.\r\n     * Instead, use [[SpeechConfig.fromSubscription]], [[SpeechConfig.fromEndpoint]], [[SpeechConfig.fromAuthorizationToken]].\r\n     * @member PropertyId.SpeechServiceConnection_Region\r\n     */\r\n    SpeechServiceConnection_Region,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service authorization token (aka access token). Under normal circumstances,\r\n     * you shouldn't have to use this property directly.\r\n     * Instead, use [[SpeechConfig.fromAuthorizationToken]], [[SpeechRecognizer.authorizationToken]],\r\n     * [[IntentRecognizer.authorizationToken]], [[TranslationRecognizer.authorizationToken]], [[SpeakerRecognizer.authorizationToken]].\r\n     * @member PropertyId.SpeechServiceAuthorization_Token\r\n     */\r\n    SpeechServiceAuthorization_Token,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service authorization type. Currently unused.\r\n     * @member PropertyId.SpeechServiceAuthorization_Type\r\n     */\r\n    SpeechServiceAuthorization_Type,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service endpoint id. Under normal circumstances, you shouldn't\r\n     * have to use this property directly.\r\n     * Instead, use [[SpeechConfig.endpointId]].\r\n     * NOTE: The endpoint id is available in the Speech Portal, listed under Endpoint Details.\r\n     * @member PropertyId.SpeechServiceConnection_EndpointId\r\n     */\r\n    SpeechServiceConnection_EndpointId,\r\n\r\n    /**\r\n     * The list of comma separated languages (BCP-47 format) used as target translation languages. Under normal circumstances,\r\n     * you shouldn't have to use this property directly.\r\n     * Instead use [[SpeechTranslationConfig.addTargetLanguage]],\r\n     * [[SpeechTranslationConfig.targetLanguages]], [[TranslationRecognizer.targetLanguages]].\r\n     * @member PropertyId.SpeechServiceConnection_TranslationToLanguages\r\n     */\r\n    SpeechServiceConnection_TranslationToLanguages,\r\n\r\n    /**\r\n     * The name of the Cognitive Service Text to Speech Service Voice. Under normal circumstances, you shouldn't have to use this\r\n     * property directly.\r\n     * Instead, use [[SpeechTranslationConfig.voiceName]].\r\n     * NOTE: Valid voice names can be found <a href=\"https://aka.ms/csspeech/voicenames\">here</a>.\r\n     * @member PropertyId.SpeechServiceConnection_TranslationVoice\r\n     */\r\n    SpeechServiceConnection_TranslationVoice,\r\n\r\n    /**\r\n     * Translation features.\r\n     * @member PropertyId.SpeechServiceConnection_TranslationFeatures\r\n     */\r\n    SpeechServiceConnection_TranslationFeatures,\r\n\r\n    /**\r\n     * The Language Understanding Service Region. Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Instead, use [[LanguageUnderstandingModel]].\r\n     * @member PropertyId.SpeechServiceConnection_IntentRegion\r\n     */\r\n    SpeechServiceConnection_IntentRegion,\r\n\r\n    /**\r\n     * The host name of the proxy server used to connect to the Cognitive Services Speech Service. Only relevant in Node.js environments.\r\n     * You shouldn't have to use this property directly.\r\n     * Instead use <see cref=\"SpeechConfig.SetProxy(string,int,string,string)\"/>.\r\n     * Added in version 1.4.0.\r\n     */\r\n    SpeechServiceConnection_ProxyHostName,\r\n\r\n    /**\r\n     * The port of the proxy server used to connect to the Cognitive Services Speech Service. Only relevant in Node.js environments.\r\n     * You shouldn't have to use this property directly.\r\n     * Instead use <see cref=\"SpeechConfig.SetProxy(string,int,string,string)\"/>.\r\n     * Added in version 1.4.0.\r\n     */\r\n    SpeechServiceConnection_ProxyPort,\r\n\r\n    /**\r\n     * The user name of the proxy server used to connect to the Cognitive Services Speech Service. Only relevant in Node.js environments.\r\n     * You shouldn't have to use this property directly.\r\n     * Instead use <see cref=\"SpeechConfig.SetProxy(string,int,string,string)\"/>.\r\n     * Added in version 1.4.0.\r\n     */\r\n    SpeechServiceConnection_ProxyUserName,\r\n\r\n    /**\r\n     * The password of the proxy server used to connect to the Cognitive Services Speech Service. Only relevant in Node.js environments.\r\n     * You shouldn't have to use this property directly.\r\n     * Instead use <see cref=\"SpeechConfig.SetProxy(string,int,string,string)\"/>.\r\n     * Added in version 1.4.0.\r\n     */\r\n    SpeechServiceConnection_ProxyPassword,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service recognition Mode. Can be \"INTERACTIVE\", \"CONVERSATION\", \"DICTATION\".\r\n     * This property is intended to be read-only. The SDK is using it internally.\r\n     * @member PropertyId.SpeechServiceConnection_RecoMode\r\n     */\r\n    SpeechServiceConnection_RecoMode,\r\n\r\n    /**\r\n     * The spoken language to be recognized (in BCP-47 format). Under normal circumstances, you shouldn't have to use this property\r\n     * directly.\r\n     * Instead, use [[SpeechConfig.speechRecognitionLanguage]].\r\n     * @member PropertyId.SpeechServiceConnection_RecoLanguage\r\n     */\r\n    SpeechServiceConnection_RecoLanguage,\r\n\r\n    /**\r\n     * The session id. This id is a universally unique identifier (aka UUID) representing a specific binding of an audio input stream\r\n     * and the underlying speech recognition instance to which it is bound. Under normal circumstances, you shouldn't have to use this\r\n     * property directly.\r\n     * Instead use [[SessionEventArgs.sessionId]].\r\n     * @member PropertyId.Speech_SessionId\r\n     */\r\n    Speech_SessionId,\r\n\r\n    /**\r\n     * The spoken language to be synthesized (e.g. en-US)\r\n     * @member PropertyId.SpeechServiceConnection_SynthLanguage\r\n     */\r\n    SpeechServiceConnection_SynthLanguage,\r\n\r\n    /**\r\n     * The name of the TTS voice to be used for speech synthesis\r\n     * @member PropertyId.SpeechServiceConnection_SynthVoice\r\n     */\r\n    SpeechServiceConnection_SynthVoice,\r\n\r\n    /**\r\n     * The string to specify TTS output audio format\r\n     * @member PropertyId.SpeechServiceConnection_SynthOutputFormat\r\n     */\r\n    SpeechServiceConnection_SynthOutputFormat,\r\n\r\n    /**\r\n     * The list of comma separated languages used as possible source languages\r\n     * Added in version 1.13.0\r\n     * @member PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages\r\n     */\r\n    SpeechServiceConnection_AutoDetectSourceLanguages,\r\n\r\n    /**\r\n     * The requested Cognitive Services Speech Service response output format (simple or detailed). Under normal circumstances, you shouldn't have\r\n     * to use this property directly.\r\n     * Instead use [[SpeechConfig.outputFormat]].\r\n     * @member PropertyId.SpeechServiceResponse_RequestDetailedResultTrueFalse\r\n     */\r\n    SpeechServiceResponse_RequestDetailedResultTrueFalse,\r\n\r\n    /**\r\n     * The requested Cognitive Services Speech Service response output profanity level. Currently unused.\r\n     * @member PropertyId.SpeechServiceResponse_RequestProfanityFilterTrueFalse\r\n     */\r\n    SpeechServiceResponse_RequestProfanityFilterTrueFalse,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service response output (in JSON format). This property is available on recognition result objects only.\r\n     * @member PropertyId.SpeechServiceResponse_JsonResult\r\n     */\r\n    SpeechServiceResponse_JsonResult,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service error details (in JSON format). Under normal circumstances, you shouldn't have to\r\n     * use this property directly. Instead use [[CancellationDetails.errorDetails]].\r\n     * @member PropertyId.SpeechServiceResponse_JsonErrorDetails\r\n     */\r\n    SpeechServiceResponse_JsonErrorDetails,\r\n\r\n    /**\r\n     * The cancellation reason. Currently unused.\r\n     * @member PropertyId.CancellationDetails_Reason\r\n     */\r\n    CancellationDetails_Reason,\r\n\r\n    /**\r\n     * The cancellation text. Currently unused.\r\n     * @member PropertyId.CancellationDetails_ReasonText\r\n     */\r\n    CancellationDetails_ReasonText,\r\n\r\n    /**\r\n     * The Cancellation detailed text. Currently unused.\r\n     * @member PropertyId.CancellationDetails_ReasonDetailedText\r\n     */\r\n    CancellationDetails_ReasonDetailedText,\r\n\r\n    /**\r\n     * The Language Understanding Service response output (in JSON format). Available via [[IntentRecognitionResult]]\r\n     * @member PropertyId.LanguageUnderstandingServiceResponse_JsonResult\r\n     */\r\n    LanguageUnderstandingServiceResponse_JsonResult,\r\n\r\n    /**\r\n     * The URL string built from speech configuration.\r\n     * This property is intended to be read-only. The SDK is using it internally.\r\n     * NOTE: Added in version 1.7.0.\r\n     */\r\n    SpeechServiceConnection_Url,\r\n\r\n    /**\r\n     * The initial silence timeout value (in milliseconds) used by the service.\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceConnection_InitialSilenceTimeoutMs,\r\n\r\n    /**\r\n     * The end silence timeout value (in milliseconds) used by the service.\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceConnection_EndSilenceTimeoutMs,\r\n\r\n    /**\r\n     * A boolean value specifying whether audio logging is enabled in the service or not.\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceConnection_EnableAudioLogging,\r\n\r\n    /**\r\n     * The requested Cognitive Services Speech Service response output profanity setting.\r\n     * Allowed values are \"masked\", \"removed\", and \"raw\".\r\n     * Added in version 1.7.0.\r\n     */\r\n    SpeechServiceResponse_ProfanityOption,\r\n\r\n    /**\r\n     * A string value specifying which post processing option should be used by service.\r\n     * Allowed values are \"TrueText\".\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceResponse_PostProcessingOption,\r\n\r\n    /**\r\n     *  A boolean value specifying whether to include word-level timestamps in the response result.\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceResponse_RequestWordLevelTimestamps,\r\n\r\n    /**\r\n     * The number of times a word has to be in partial results to be returned.\r\n     * Added in version 1.7.0\r\n     */\r\n    SpeechServiceResponse_StablePartialResultThreshold,\r\n\r\n    /**\r\n     * A string value specifying the output format option in the response result. Internal use only.\r\n     * Added in version 1.7.0.\r\n     */\r\n    SpeechServiceResponse_OutputFormatOption,\r\n\r\n    /**\r\n     * A boolean value to request for stabilizing translation partial results by omitting words in the end.\r\n     * Added in version 1.7.0.\r\n     */\r\n    SpeechServiceResponse_TranslationRequestStablePartialResult,\r\n\r\n    /**\r\n     * Identifier used to connect to the backend service.\r\n     * @member PropertyId.Conversation_ApplicationId\r\n     */\r\n    Conversation_ApplicationId,\r\n\r\n    /**\r\n     * Type of dialog backend to connect to.\r\n     * @member PropertyId.Conversation_DialogType\r\n     */\r\n    Conversation_DialogType,\r\n\r\n    /**\r\n     * Silence timeout for listening\r\n     * @member PropertyId.Conversation_Initial_Silence_Timeout\r\n     */\r\n    Conversation_Initial_Silence_Timeout,\r\n\r\n    /**\r\n     * From Id to add to speech recognition activities.\r\n     * @member PropertyId.Conversation_From_Id\r\n     */\r\n    Conversation_From_Id,\r\n\r\n    /**\r\n     * ConversationId for the session.\r\n     * @member PropertyId.Conversation_Conversation_Id\r\n     */\r\n    Conversation_Conversation_Id,\r\n\r\n    /**\r\n     * Comma separated list of custom voice deployment ids.\r\n     * @member PropertyId.Conversation_Custom_Voice_Deployment_Ids\r\n     */\r\n    Conversation_Custom_Voice_Deployment_Ids,\r\n\r\n    /**\r\n     * Speech activity template, stamp properties from the template on the activity generated by the service for speech.\r\n     * @member PropertyId.Conversation_Speech_Activity_Template\r\n     * Added in version 1.10.0.\r\n     */\r\n    Conversation_Speech_Activity_Template,\r\n\r\n    /**\r\n     * Enables or disables the receipt of turn status messages as obtained on the turnStatusReceived event.\r\n     * @member PropertyId.Conversation_Request_Bot_Status_Messages\r\n     * Added in version 1.15.0.\r\n     */\r\n    Conversation_Request_Bot_Status_Messages,\r\n\r\n    /**\r\n     * Specifies the connection ID to be provided in the Agent configuration message, e.g. a Direct Line token for\r\n     * channel authentication.\r\n     * Added in version 1.15.1.\r\n     */\r\n    Conversation_Agent_Connection_Id,\r\n\r\n    /**\r\n     * The Cognitive Services Speech Service host (url). Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Instead, use [[SpeechConfig.fromHost]].\r\n     */\r\n    SpeechServiceConnection_Host,\r\n\r\n    /**\r\n     * Set the host for service calls to the Conversation Translator REST management and websocket calls.\r\n     */\r\n    ConversationTranslator_Host,\r\n\r\n    /**\r\n     * Optionally set the the host's display name.\r\n     * Used when joining a conversation.\r\n     */\r\n    ConversationTranslator_Name,\r\n\r\n    /**\r\n     * Optionally set a value for the X-CorrelationId request header.\r\n     * Used for troubleshooting errors in the server logs. It should be a valid guid.\r\n     */\r\n    ConversationTranslator_CorrelationId,\r\n\r\n    /**\r\n     * Set the conversation token to be sent to the speech service. This enables the\r\n     * service to service call from the speech service to the Conversation Translator service for relaying\r\n     * recognitions. For internal use.\r\n     */\r\n    ConversationTranslator_Token,\r\n\r\n    /**\r\n     * The reference text of the audio for pronunciation evaluation.\r\n     * For this and the following pronunciation assessment parameters, see\r\n     * https://docs.microsoft.com/azure/cognitive-services/speech-service/rest-speech-to-text#pronunciation-assessment-parameters for details.\r\n     * Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_ReferenceText,\r\n\r\n    /**\r\n     * The point system for pronunciation score calibration (FivePoint or HundredMark).\r\n     * Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_GradingSystem,\r\n\r\n    /**\r\n     * The pronunciation evaluation granularity (Phoneme, Word, or FullText).\r\n     * Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_Granularity,\r\n\r\n    /**\r\n     * Defines if enable miscue calculation.\r\n     * With this enabled, the pronounced words will be compared to the reference text,\r\n     * and will be marked with omission/insertion based on the comparison. The default setting is False.\r\n     * Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_EnableMiscue,\r\n\r\n    /**\r\n     * The json string of pronunciation assessment parameters\r\n     * Under normal circumstances, you shouldn't have to use this property directly.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_Json,\r\n\r\n    /**\r\n     * Pronunciation assessment parameters.\r\n     * This property is intended to be read-only. The SDK is using it internally.\r\n     * Added in version 1.15.0\r\n     */\r\n    PronunciationAssessment_Params\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { PropertyId } from \"./Exports\";\r\n\r\n/**\r\n * Represents collection of properties and their values.\r\n * @class PropertyCollection\r\n */\r\nexport class PropertyCollection {\r\n    private privKeys: string[] = [] as string[];\r\n    private privValues: string[] = [] as string[];\r\n\r\n    /**\r\n     * Returns the property value in type String. The parameter must have the same type as String.\r\n     * Currently only String, int and bool are allowed.\r\n     * If the name is not available, the specified defaultValue is returned.\r\n     * @member PropertyCollection.prototype.getProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} key - The parameter name.\r\n     * @param {string} def - The default value which is returned if the parameter\r\n     *        is not available in the collection.\r\n     * @returns {string} value of the parameter.\r\n     */\r\n    public getProperty(key: PropertyId | string, def?: string): string {\r\n        let keyToUse: string;\r\n\r\n        if (typeof key === \"string\") {\r\n            keyToUse = key;\r\n        } else {\r\n            keyToUse = PropertyId[key];\r\n        }\r\n\r\n        for (let n = 0; n < this.privKeys.length; n++) {\r\n            if (this.privKeys[n] === keyToUse) {\r\n                return this.privValues[n];\r\n            }\r\n        }\r\n\r\n        return def;\r\n    }\r\n\r\n    /**\r\n     * Sets the String value of the parameter specified by name.\r\n     * @member PropertyCollection.prototype.setProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} key - The parameter name.\r\n     * @param {string} value - The value of the parameter.\r\n     */\r\n    public setProperty(key: string | PropertyId, value: string): void {\r\n        let keyToUse: string;\r\n\r\n        if (typeof key === \"string\") {\r\n            keyToUse = key;\r\n        } else {\r\n            keyToUse = PropertyId[key];\r\n        }\r\n\r\n        for (let n = 0; n < this.privKeys.length; n++) {\r\n            if (this.privKeys[n] === keyToUse) {\r\n                this.privValues[n] = value;\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.privKeys.push(keyToUse);\r\n        this.privValues.push(value);\r\n    }\r\n\r\n    /**\r\n     * Clones the collection.\r\n     * @member PropertyCollection.prototype.clone\r\n     * @function\r\n     * @public\r\n     * @returns {PropertyCollection} A copy of the collection.\r\n     */\r\n    public clone(): PropertyCollection {\r\n        const clonedMap = new PropertyCollection();\r\n\r\n        for (let n = 0; n < this.privKeys.length; n++) {\r\n            clonedMap.privKeys.push(this.privKeys[n]);\r\n            clonedMap.privValues.push(this.privValues[n]);\r\n        }\r\n\r\n        return clonedMap;\r\n    }\r\n\r\n    /**\r\n     * Merges this set of properties into another, no overwrites.\r\n     * @member PropertyCollection.prototype.mergeTo\r\n     * @function\r\n     * @public\r\n     * @param {PropertyCollection} The collection to merge into.\r\n     */\r\n    public mergeTo(destinationCollection: PropertyCollection): void {\r\n        this.privKeys.forEach((key: string | PropertyId) => {\r\n            if (destinationCollection.getProperty(key, undefined) === undefined) {\r\n                const value = this.getProperty(key);\r\n                destinationCollection.setProperty(key, value);\r\n            }\r\n        });\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Define Speech Recognizer output formats.\r\n * @class OutputFormat\r\n */\r\nexport enum OutputFormat {\r\n    /**\r\n     * @member OutputFormat.Simple\r\n     */\r\n    Simple = 0,\r\n\r\n    /**\r\n     * @member OutputFormat.Detailed\r\n     */\r\n    Detailed,\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines channels used to pass property settings to service.\r\n * Added in version 1.7.0.\r\n */\r\nexport enum ServicePropertyChannel {\r\n    /**\r\n     * Uses URI query parameter to pass property settings to service.\r\n     */\r\n    UriQueryParameter = 0.\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { EventType, PlatformEvent } from \"./PlatformEvent\";\r\n\r\nexport class AudioSourceEvent extends PlatformEvent {\r\n    private privAudioSourceId: string;\r\n\r\n    constructor(eventName: string, audioSourceId: string, eventType: EventType = EventType.Info) {\r\n        super(eventName, eventType);\r\n        this.privAudioSourceId = audioSourceId;\r\n    }\r\n\r\n    public get audioSourceId(): string {\r\n        return this.privAudioSourceId;\r\n    }\r\n}\r\n\r\nexport class AudioSourceInitializingEvent extends AudioSourceEvent {\r\n    constructor(audioSourceId: string) {\r\n        super(\"AudioSourceInitializingEvent\", audioSourceId);\r\n    }\r\n}\r\n\r\nexport class AudioSourceReadyEvent extends AudioSourceEvent {\r\n    constructor(audioSourceId: string) {\r\n        super(\"AudioSourceReadyEvent\", audioSourceId);\r\n    }\r\n}\r\n\r\nexport class AudioSourceOffEvent extends AudioSourceEvent {\r\n    constructor(audioSourceId: string) {\r\n        super(\"AudioSourceOffEvent\", audioSourceId);\r\n    }\r\n}\r\n\r\nexport class AudioSourceErrorEvent extends AudioSourceEvent {\r\n    private privError: string;\r\n\r\n    constructor(audioSourceId: string, error: string) {\r\n        super(\"AudioSourceErrorEvent\", audioSourceId, EventType.Error);\r\n        this.privError = error;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n}\r\n\r\nexport class AudioStreamNodeEvent extends AudioSourceEvent {\r\n    private privAudioNodeId: string;\r\n\r\n    constructor(eventName: string, audioSourceId: string, audioNodeId: string) {\r\n        super(eventName, audioSourceId);\r\n        this.privAudioNodeId = audioNodeId;\r\n    }\r\n\r\n    public get audioNodeId(): string {\r\n        return this.privAudioNodeId;\r\n    }\r\n}\r\n\r\nexport class AudioStreamNodeAttachingEvent extends AudioStreamNodeEvent {\r\n    constructor(audioSourceId: string, audioNodeId: string) {\r\n        super(\"AudioStreamNodeAttachingEvent\", audioSourceId, audioNodeId);\r\n    }\r\n}\r\n\r\nexport class AudioStreamNodeAttachedEvent extends AudioStreamNodeEvent {\r\n    constructor(audioSourceId: string, audioNodeId: string) {\r\n        super(\"AudioStreamNodeAttachedEvent\", audioSourceId, audioNodeId);\r\n    }\r\n}\r\n\r\nexport class AudioStreamNodeDetachedEvent extends AudioStreamNodeEvent {\r\n    constructor(audioSourceId: string, audioNodeId: string) {\r\n        super(\"AudioStreamNodeDetachedEvent\", audioSourceId, audioNodeId);\r\n    }\r\n}\r\n\r\nexport class AudioStreamNodeErrorEvent extends AudioStreamNodeEvent {\r\n    private privError: string;\r\n\r\n    constructor(audioSourceId: string, audioNodeId: string, error: string) {\r\n        super(\"AudioStreamNodeErrorEvent\", audioSourceId, audioNodeId);\r\n        this.privError = error;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { IStreamChunk, Stream } from \"./Exports\";\r\n\r\nexport class ChunkedArrayBufferStream extends Stream<ArrayBuffer> {\r\n    private privTargetChunkSize: number;\r\n    private privNextBufferToWrite: ArrayBuffer;\r\n    private privNextBufferStartTime: number;\r\n    private privNextBufferReadyBytes: number;\r\n\r\n    constructor(targetChunkSize: number, streamId?: string) {\r\n        super(streamId);\r\n        this.privTargetChunkSize = targetChunkSize;\r\n        this.privNextBufferReadyBytes = 0;\r\n    }\r\n\r\n    public writeStreamChunk(chunk: IStreamChunk<ArrayBuffer>): void {\r\n        // No pending write, and the buffer is the right size so write it.\r\n        if (chunk.isEnd ||\r\n            (0 === this.privNextBufferReadyBytes && chunk.buffer.byteLength === this.privTargetChunkSize)) {\r\n            super.writeStreamChunk(chunk);\r\n            return;\r\n        }\r\n\r\n        let bytesCopiedFromBuffer: number = 0;\r\n\r\n        while (bytesCopiedFromBuffer < chunk.buffer.byteLength) {\r\n            // Fill the next buffer.\r\n            if (undefined === this.privNextBufferToWrite) {\r\n                this.privNextBufferToWrite = new ArrayBuffer(this.privTargetChunkSize);\r\n                this.privNextBufferStartTime = chunk.timeReceived;\r\n            }\r\n\r\n            // Find out how many bytes we can copy into the read buffer.\r\n            const bytesToCopy: number = Math.min(chunk.buffer.byteLength - bytesCopiedFromBuffer, this.privTargetChunkSize - this.privNextBufferReadyBytes);\r\n            const targetView: Uint8Array = new Uint8Array(this.privNextBufferToWrite);\r\n            const sourceView: Uint8Array = new Uint8Array(chunk.buffer.slice(bytesCopiedFromBuffer, bytesToCopy + bytesCopiedFromBuffer));\r\n\r\n            targetView.set(sourceView, this.privNextBufferReadyBytes);\r\n            this.privNextBufferReadyBytes += bytesToCopy;\r\n            bytesCopiedFromBuffer += bytesToCopy;\r\n\r\n            // Are we ready to write?\r\n            if (this.privNextBufferReadyBytes === this.privTargetChunkSize) {\r\n                super.writeStreamChunk({\r\n                    buffer: this.privNextBufferToWrite,\r\n                    isEnd: false,\r\n                    timeReceived: this.privNextBufferStartTime,\r\n                });\r\n                this.privNextBufferReadyBytes = 0;\r\n                this.privNextBufferToWrite = undefined;\r\n            }\r\n        }\r\n    }\r\n\r\n    public close(): void {\r\n        // Send whatever is pending, then close the base class.\r\n        if (0 !== this.privNextBufferReadyBytes && !this.isClosed) {\r\n            super.writeStreamChunk({\r\n                buffer: this.privNextBufferToWrite.slice(0, this.privNextBufferReadyBytes),\r\n                isEnd: false,\r\n                timeReceived: this.privNextBufferStartTime,\r\n            });\r\n        }\r\n\r\n        super.close();\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { InvalidOperationError } from \"./Error\";\r\nimport { createNoDashGuid } from \"./Guid\";\r\nimport { Queue } from \"./Queue\";\r\n\r\nexport interface IStreamChunk<TBuffer> {\r\n    isEnd: boolean;\r\n    buffer: TBuffer;\r\n    timeReceived: number;\r\n}\r\n\r\nexport class Stream<TBuffer> {\r\n    private privId: string;\r\n    private privIsWriteEnded: boolean = false;\r\n    private privIsReadEnded: boolean = false;\r\n    private privReaderQueue: Queue<IStreamChunk<TBuffer>>;\r\n\r\n    public constructor(streamId?: string) {\r\n        this.privId = streamId ? streamId : createNoDashGuid();\r\n        this.privReaderQueue = new Queue<IStreamChunk<TBuffer>>();\r\n    }\r\n\r\n    public get isClosed(): boolean {\r\n        return this.privIsWriteEnded;\r\n    }\r\n\r\n    public get isReadEnded(): boolean {\r\n        return this.privIsReadEnded;\r\n    }\r\n\r\n    public get id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public close(): void {\r\n        if (!this.privIsWriteEnded) {\r\n            this.writeStreamChunk({\r\n                buffer: null,\r\n                isEnd: true,\r\n                timeReceived: Date.now(),\r\n            });\r\n            this.privIsWriteEnded = true;\r\n        }\r\n    }\r\n\r\n    public writeStreamChunk(streamChunk: IStreamChunk<TBuffer>): void {\r\n        this.throwIfClosed();\r\n        if (!this.privReaderQueue.isDisposed()) {\r\n            try {\r\n                this.privReaderQueue.enqueue(streamChunk);\r\n            } catch (e) {\r\n                // Do nothing\r\n            }\r\n        }\r\n    }\r\n\r\n    public read = (): Promise<IStreamChunk<TBuffer>> => {\r\n        if (this.privIsReadEnded) {\r\n            throw new InvalidOperationError(\"Stream read has already finished\");\r\n        }\r\n\r\n        return this.privReaderQueue\r\n            .dequeue()\r\n            .then(async (streamChunk: IStreamChunk<TBuffer>) => {\r\n                if (streamChunk === undefined || streamChunk.isEnd) {\r\n                    await this.privReaderQueue.dispose(\"End of stream reached\");\r\n                }\r\n\r\n                return streamChunk;\r\n            });\r\n    }\r\n    public readEnded = (): void => {\r\n        if (!this.privIsReadEnded) {\r\n            this.privIsReadEnded = true;\r\n            this.privReaderQueue = new Queue<IStreamChunk<TBuffer>>();\r\n        }\r\n    }\r\n\r\n    private throwIfClosed = (): void => {\r\n        if (this.privIsWriteEnded) {\r\n            throw new InvalidOperationError(\"Stream closed\");\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ArgumentNullError } from \"./Error\";\r\nimport { EventSource } from \"./EventSource\";\r\nimport { IEventSource } from \"./IEventSource\";\r\nimport { PlatformEvent } from \"./PlatformEvent\";\r\n\r\nexport class Events {\r\n    private static privInstance: IEventSource<PlatformEvent> = new EventSource<PlatformEvent>();\r\n\r\n    public static setEventSource = (eventSource: IEventSource<PlatformEvent>): void => {\r\n        if (!eventSource) {\r\n            throw new ArgumentNullError(\"eventSource\");\r\n        }\r\n\r\n        Events.privInstance = eventSource;\r\n    }\r\n\r\n    public static get instance(): IEventSource<PlatformEvent> {\r\n        return Events.privInstance;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines the possible reasons a recognition result might be canceled.\r\n * @class CancellationReason\r\n */\r\nexport enum CancellationReason {\r\n    /**\r\n     * Indicates that an error occurred during speech recognition.\r\n     * @member CancellationReason.Error\r\n     */\r\n    Error,\r\n\r\n    /**\r\n     * Indicates that the end of the audio stream was reached.\r\n     * @member CancellationReason.EndOfStream\r\n     */\r\n    EndOfStream,\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n *  Defines error code in case that CancellationReason is Error.\r\n *  Added in version 1.1.0.\r\n */\r\nexport enum CancellationErrorCode {\r\n    /**\r\n     * Indicates that no error occurred during speech recognition.\r\n     */\r\n    NoError,\r\n\r\n    /**\r\n     * Indicates an authentication error.\r\n     */\r\n    AuthenticationFailure,\r\n\r\n    /**\r\n     * Indicates that one or more recognition parameters are invalid.\r\n     */\r\n    BadRequestParameters,\r\n\r\n    /**\r\n     * Indicates that the number of parallel requests exceeded the number of allowed\r\n     * concurrent transcriptions for the subscription.\r\n     */\r\n    TooManyRequests,\r\n\r\n    /**\r\n     * Indicates a connection error.\r\n     */\r\n    ConnectionFailure,\r\n\r\n    /**\r\n     * Indicates a time-out error when waiting for response from service.\r\n     */\r\n    ServiceTimeout,\r\n\r\n    /**\r\n     * Indicates that an error is returned by the service.\r\n     */\r\n    ServiceError,\r\n\r\n    /**\r\n     * Indicates an unexpected runtime error.\r\n     */\r\n    RuntimeError,\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines the possible reasons a recognition result might be generated.\r\n * @class ResultReason\r\n */\r\nexport enum ResultReason {\r\n    /**\r\n     * Indicates speech could not be recognized. More details\r\n     * can be found in the NoMatchDetails object.\r\n     * @member ResultReason.NoMatch\r\n     */\r\n    NoMatch,\r\n\r\n    /**\r\n     * Indicates that the recognition was canceled. More details\r\n     * can be found using the CancellationDetails object.\r\n     * @member ResultReason.Canceled\r\n     */\r\n    Canceled,\r\n\r\n    /**\r\n     * Indicates the speech result contains hypothesis text.\r\n     * @member ResultReason.RecognizedSpeech\r\n     */\r\n    RecognizingSpeech,\r\n\r\n    /**\r\n     * Indicates the speech result contains final text that has been recognized.\r\n     * Speech Recognition is now complete for this phrase.\r\n     * @member ResultReason.RecognizedSpeech\r\n     */\r\n    RecognizedSpeech,\r\n\r\n    /**\r\n     * Indicates the intent result contains hypothesis text and intent.\r\n     * @member ResultReason.RecognizingIntent\r\n     */\r\n    RecognizingIntent,\r\n\r\n    /**\r\n     * Indicates the intent result contains final text and intent.\r\n     * Speech Recognition and Intent determination are now complete for this phrase.\r\n     * @member ResultReason.RecognizedIntent\r\n     */\r\n    RecognizedIntent,\r\n\r\n    /**\r\n     * Indicates the translation result contains hypothesis text and its translation(s).\r\n     * @member ResultReason.TranslatingSpeech\r\n     */\r\n    TranslatingSpeech,\r\n\r\n    /**\r\n     * Indicates the translation result contains final text and corresponding translation(s).\r\n     * Speech Recognition and Translation are now complete for this phrase.\r\n     * @member ResultReason.TranslatedSpeech\r\n     */\r\n    TranslatedSpeech,\r\n\r\n    /**\r\n     * Indicates the synthesized audio result contains a non-zero amount of audio data\r\n     * @member ResultReason.SynthesizingAudio\r\n     */\r\n    SynthesizingAudio,\r\n\r\n    /**\r\n     * Indicates the synthesized audio is now complete for this phrase.\r\n     * @member ResultReason.SynthesizingAudioCompleted\r\n     */\r\n    SynthesizingAudioCompleted,\r\n\r\n    /**\r\n     * Indicates the speech synthesis is now started\r\n     * @member ResultReason.SynthesizingAudioStarted\r\n     */\r\n    SynthesizingAudioStarted,\r\n\r\n    /**\r\n     * Indicates the voice profile is being enrolled and customers need to send more audio to create a voice profile.\r\n     * @member ResultReason.EnrollingVoiceProfile\r\n     */\r\n    EnrollingVoiceProfile,\r\n\r\n    /**\r\n     * Indicates the voice profile has been enrolled.\r\n     * @member ResultReason.EnrolledVoiceProfile\r\n     */\r\n    EnrolledVoiceProfile,\r\n\r\n    /**\r\n     * Indicates successful identification of some speakers.\r\n     * @member ResultReason.RecognizedSpeakers\r\n     */\r\n    RecognizedSpeakers,\r\n\r\n    /**\r\n     * Indicates successfully verified one speaker.\r\n     * @member ResultReason.RecognizedSpeaker\r\n     */\r\n    RecognizedSpeaker,\r\n\r\n    /**\r\n     * Indicates a voice profile has been reset successfully.\r\n     * @member ResultReason.ResetVoiceProfile\r\n     */\r\n    ResetVoiceProfile,\r\n\r\n    /**\r\n     * Indicates a voice profile has been deleted successfully.\r\n     * @member ResultReason.DeletedVoiceProfile\r\n     */\r\n    DeletedVoiceProfile,\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { ConnectionMessage } from \"./ConnectionMessage\";\r\nimport { IStringDictionary } from \"./IDictionary\";\r\nimport { EventType, PlatformEvent } from \"./PlatformEvent\";\r\n\r\nexport class ServiceEvent extends PlatformEvent {\r\n    private privJsonResult: string;\r\n\r\n    constructor(eventName: string, jsonstring: string, eventType: EventType = EventType.Info) {\r\n      super(eventName, eventType);\r\n      this.privJsonResult = jsonstring;\r\n    }\r\n\r\n    public get jsonString(): string {\r\n        return this.privJsonResult;\r\n    }\r\n}\r\n\r\nexport class ConnectionEvent extends PlatformEvent {\r\n    private privConnectionId: string;\r\n\r\n    constructor(eventName: string, connectionId: string, eventType: EventType = EventType.Info) {\r\n        super(eventName, eventType);\r\n        this.privConnectionId = connectionId;\r\n    }\r\n\r\n    public get connectionId(): string {\r\n        return this.privConnectionId;\r\n    }\r\n}\r\n\r\nexport class ConnectionStartEvent extends ConnectionEvent {\r\n    private privUri: string;\r\n    private privHeaders: IStringDictionary<string>;\r\n\r\n    constructor(connectionId: string, uri: string, headers?: IStringDictionary<string>) {\r\n        super(\"ConnectionStartEvent\", connectionId);\r\n        this.privUri = uri;\r\n        this.privHeaders = headers;\r\n    }\r\n\r\n    public get uri(): string {\r\n        return this.privUri;\r\n    }\r\n\r\n    public get headers(): IStringDictionary<string> {\r\n        return this.privHeaders;\r\n    }\r\n}\r\n\r\nexport class ConnectionEstablishedEvent extends ConnectionEvent {\r\n    constructor(connectionId: string, metadata?: IStringDictionary<string>) {\r\n        super(\"ConnectionEstablishedEvent\", connectionId);\r\n    }\r\n}\r\n\r\nexport class ConnectionClosedEvent extends ConnectionEvent {\r\n    private privReason: string;\r\n    private privStatusCode: number;\r\n\r\n    constructor(connectionId: string, statusCode: number, reason: string) {\r\n        super(\"ConnectionClosedEvent\", connectionId, EventType.Debug);\r\n        this.privReason = reason;\r\n        this.privStatusCode = statusCode;\r\n    }\r\n\r\n    public get reason(): string {\r\n        return this.privReason;\r\n    }\r\n\r\n    public get statusCode(): number {\r\n        return this.privStatusCode;\r\n    }\r\n}\r\n\r\nexport class ConnectionErrorEvent extends ConnectionEvent {\r\n    private readonly privMessage: string;\r\n    private readonly privType: string;\r\n\r\n    constructor(connectionId: string, message: string, type: string) {\r\n        super(\"ConnectionErrorEvent\", connectionId, EventType.Debug);\r\n        this.privMessage = message;\r\n        this.privType = type;\r\n    }\r\n\r\n    public get message(): string {\r\n        return this.privMessage;\r\n    }\r\n\r\n    public get type(): string {\r\n        return this.privType;\r\n    }\r\n}\r\n\r\nexport class ConnectionEstablishErrorEvent extends ConnectionEvent {\r\n    private privStatusCode: number;\r\n    private privReason: string;\r\n\r\n    constructor(connectionId: string, statuscode: number, reason: string) {\r\n        super(\"ConnectionEstablishErrorEvent\", connectionId, EventType.Error);\r\n        this.privStatusCode = statuscode;\r\n        this.privReason = reason;\r\n    }\r\n\r\n    public get reason(): string {\r\n        return this.privReason;\r\n    }\r\n\r\n    public get statusCode(): number {\r\n        return this.privStatusCode;\r\n    }\r\n}\r\n\r\nexport class ConnectionMessageReceivedEvent extends ConnectionEvent {\r\n    private privNetworkReceivedTime: string;\r\n    private privMessage: ConnectionMessage;\r\n\r\n    constructor(connectionId: string, networkReceivedTimeISO: string, message: ConnectionMessage) {\r\n        super(\"ConnectionMessageReceivedEvent\", connectionId);\r\n        this.privNetworkReceivedTime = networkReceivedTimeISO;\r\n        this.privMessage = message;\r\n    }\r\n\r\n    public get networkReceivedTime(): string {\r\n        return this.privNetworkReceivedTime;\r\n    }\r\n\r\n    public get message(): ConnectionMessage {\r\n        return this.privMessage;\r\n    }\r\n}\r\n\r\nexport class ConnectionMessageSentEvent extends ConnectionEvent {\r\n    private privNetworkSentTime: string;\r\n    private privMessage: ConnectionMessage;\r\n\r\n    constructor(connectionId: string, networkSentTimeISO: string, message: ConnectionMessage) {\r\n        super(\"ConnectionMessageSentEvent\", connectionId);\r\n        this.privNetworkSentTime = networkSentTimeISO;\r\n        this.privMessage = message;\r\n    }\r\n\r\n    public get networkSentTime(): string {\r\n        return this.privNetworkSentTime;\r\n    }\r\n\r\n    public get message(): ConnectionMessage {\r\n        return this.privMessage;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ConnectionEvent } from \"./ConnectionEvents\";\r\nimport { ConnectionMessage } from \"./ConnectionMessage\";\r\nimport { ConnectionOpenResponse } from \"./ConnectionOpenResponse\";\r\nimport { EventSource } from \"./EventSource\";\r\n\r\nexport enum ConnectionState {\r\n    None,\r\n    Connected,\r\n    Connecting,\r\n    Disconnected,\r\n}\r\n\r\nexport interface IConnection {\r\n    id: string;\r\n    state(): ConnectionState;\r\n    open(): Promise<ConnectionOpenResponse>;\r\n    send(message: ConnectionMessage): Promise<void>;\r\n    read(): Promise<ConnectionMessage>;\r\n    events: EventSource<ConnectionEvent>;\r\n    dispose(disposing?: string): Promise<void>;\r\n}\r\n","\r\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    EventType,\r\n    PlatformEvent\r\n} from \"./Exports\";\r\n\r\nexport class BackgroundEvent extends PlatformEvent {\r\n    private privError: string;\r\n\r\n    constructor(error: string) {\r\n        super(\"BackgroundEvent\", EventType.Error);\r\n        this.privError = error;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { MessageType } from \"./ConnectionMessage\";\r\nimport { ArgumentNullError, InvalidOperationError } from \"./Error\";\r\nimport { createNoDashGuid } from \"./Guid\";\r\n\r\nexport class RawWebsocketMessage {\r\n    private privMessageType: MessageType;\r\n    private privPayload: any = null;\r\n    private privId: string;\r\n\r\n    public constructor(messageType: MessageType, payload: any, id?: string) {\r\n        if (!payload) {\r\n            throw new ArgumentNullError(\"payload\");\r\n        }\r\n\r\n        if (messageType === MessageType.Binary && payload.__proto__.constructor.name !== \"ArrayBuffer\") {\r\n            throw new InvalidOperationError(\"Payload must be ArrayBuffer\");\r\n        }\r\n\r\n        if (messageType === MessageType.Text && !(typeof (payload) === \"string\")) {\r\n            throw new InvalidOperationError(\"Payload must be a string\");\r\n        }\r\n\r\n        this.privMessageType = messageType;\r\n        this.privPayload = payload;\r\n        this.privId = id ? id : createNoDashGuid();\r\n    }\r\n\r\n    public get messageType(): MessageType {\r\n        return this.privMessageType;\r\n    }\r\n\r\n    public get payload(): any {\r\n        return this.privPayload;\r\n    }\r\n\r\n    public get textContent(): string {\r\n        if (this.privMessageType === MessageType.Binary) {\r\n            throw new InvalidOperationError(\"Not supported for binary message\");\r\n        }\r\n\r\n        return this.privPayload as string;\r\n    }\r\n\r\n    public get binaryContent(): ArrayBuffer {\r\n        if (this.privMessageType === MessageType.Text) {\r\n            throw new InvalidOperationError(\"Not supported for text message\");\r\n        }\r\n\r\n        return this.privPayload;\r\n    }\r\n\r\n    public get id(): string {\r\n        return this.privId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { SessionEventArgs } from \"./Exports\";\r\n\r\n/**\r\n * Defines payload for session events like Speech Start/End Detected\r\n * @class\r\n */\r\nexport class RecognitionEventArgs extends SessionEventArgs {\r\n    private privOffset: number;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {number} offset - The offset.\r\n     * @param {string} sessionId - The session id.\r\n     */\r\n    public constructor(offset: number, sessionId?: string) {\r\n        super(sessionId);\r\n\r\n        this.privOffset = offset;\r\n    }\r\n\r\n    /**\r\n     * Represents the message offset\r\n     * @member RecognitionEventArgs.prototype.offset\r\n     * @function\r\n     * @public\r\n     */\r\n    public get offset(): number {\r\n        return this.privOffset;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Defines content for session events like SessionStarted/Stopped, SoundStarted/Stopped.\r\n * @class SessionEventArgs\r\n */\r\nexport class SessionEventArgs {\r\n    private privSessionId: string;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {string} sessionId - The session id.\r\n     */\r\n    public constructor(sessionId: string) {\r\n        this.privSessionId = sessionId;\r\n    }\r\n\r\n    /**\r\n     * Represents the session identifier.\r\n     * @member SessionEventArgs.prototype.sessionId\r\n     * @function\r\n     * @public\r\n     * @returns {string} Represents the session identifier.\r\n     */\r\n    public get sessionId(): string {\r\n        return this.privSessionId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nexport class RiffPcmEncoder {\r\n\r\n    private privActualSampleRate: number;\r\n    private privDesiredSampleRate: number;\r\n\r\n    public constructor(actualSampleRate: number, desiredSampleRate: number) {\r\n        this.privActualSampleRate = actualSampleRate;\r\n        this.privDesiredSampleRate = desiredSampleRate;\r\n    }\r\n\r\n    public encode = (\r\n        actualAudioFrame: Float32Array): ArrayBuffer => {\r\n\r\n        const audioFrame = this.downSampleAudioFrame(actualAudioFrame, this.privActualSampleRate, this.privDesiredSampleRate);\r\n\r\n        if (!audioFrame) {\r\n            return null;\r\n        }\r\n\r\n        const audioLength = audioFrame.length * 2;\r\n\r\n        const buffer = new ArrayBuffer(audioLength);\r\n        const view = new DataView(buffer);\r\n        this.floatTo16BitPCM(view, 0, audioFrame);\r\n\r\n        return buffer;\r\n    }\r\n\r\n    private setString = (view: DataView, offset: number, str: string): void => {\r\n        for (let i = 0; i < str.length; i++) {\r\n            view.setUint8(offset + i, str.charCodeAt(i));\r\n        }\r\n    }\r\n\r\n    private floatTo16BitPCM = (view: DataView, offset: number, input: Float32Array): void => {\r\n        for (let i = 0; i < input.length; i++ , offset += 2) {\r\n            const s = Math.max(-1, Math.min(1, input[i]));\r\n            view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\r\n        }\r\n    }\r\n\r\n    private downSampleAudioFrame = (\r\n        srcFrame: Float32Array,\r\n        srcRate: number,\r\n        dstRate: number): Float32Array => {\r\n\r\n        if (dstRate === srcRate || dstRate > srcRate) {\r\n            return srcFrame;\r\n        }\r\n\r\n        const ratio = srcRate / dstRate;\r\n        const dstLength = Math.round(srcFrame.length / ratio);\r\n        const dstFrame = new Float32Array(dstLength);\r\n        let srcOffset = 0;\r\n        let dstOffset = 0;\r\n        while (dstOffset < dstLength) {\r\n            const nextSrcOffset = Math.round((dstOffset + 1) * ratio);\r\n            let accum = 0;\r\n            let count = 0;\r\n            while (srcOffset < nextSrcOffset && srcOffset < srcFrame.length) {\r\n                accum += srcFrame[srcOffset++];\r\n                count++;\r\n            }\r\n            dstFrame[dstOffset++] = accum / count;\r\n        }\r\n\r\n        return dstFrame;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { RiffPcmEncoder, Stream } from \"../common/Exports\";\r\nimport { IRecorder } from \"./IRecorder\";\r\n\r\nexport class PcmRecorder implements IRecorder {\r\n    private privMediaResources: IMediaResources;\r\n    private privSpeechProcessorScript: string; // speech-processor.js Url\r\n\r\n    public record = (context: AudioContext, mediaStream: MediaStream, outputStream: Stream<ArrayBuffer>): void => {\r\n        const desiredSampleRate = 16000;\r\n\r\n        const scriptNode = (() => {\r\n            let bufferSize = 0;\r\n            try {\r\n                return context.createScriptProcessor(bufferSize, 1, 1);\r\n            } catch (error) {\r\n                // Webkit (<= version 31) requires a valid bufferSize.\r\n                bufferSize = 2048;\r\n                let audioSampleRate = context.sampleRate;\r\n                while (bufferSize < 16384 && audioSampleRate >= (2 * desiredSampleRate)) {\r\n                    bufferSize <<= 1;\r\n                    audioSampleRate >>= 1;\r\n                }\r\n                return context.createScriptProcessor(bufferSize, 1, 1);\r\n            }\r\n        })();\r\n\r\n        const waveStreamEncoder = new RiffPcmEncoder(context.sampleRate, desiredSampleRate);\r\n        let needHeader: boolean = true;\r\n        const that = this;\r\n        scriptNode.onaudioprocess = (event: AudioProcessingEvent) => {\r\n            const inputFrame = event.inputBuffer.getChannelData(0);\r\n\r\n            if (outputStream && !outputStream.isClosed) {\r\n                const waveFrame = waveStreamEncoder.encode(inputFrame);\r\n                if (!!waveFrame) {\r\n                    outputStream.writeStreamChunk({\r\n                        buffer: waveFrame,\r\n                        isEnd: false,\r\n                        timeReceived: Date.now(),\r\n                    });\r\n                    needHeader = false;\r\n                }\r\n            }\r\n        };\r\n\r\n        const micInput = context.createMediaStreamSource(mediaStream);\r\n\r\n        // https://webaudio.github.io/web-audio-api/#audioworklet\r\n        // Using AudioWorklet to improve audio quality and avoid audio glitches due to blocking the UI thread\r\n\r\n        if (!!this.privSpeechProcessorScript && !!context.audioWorklet) {\r\n            context.audioWorklet\r\n                .addModule(this.privSpeechProcessorScript)\r\n                .then(() => {\r\n                    const workletNode = new AudioWorkletNode(context, \"speech-processor\");\r\n                    workletNode.port.onmessage = (ev: MessageEvent) => {\r\n                        const inputFrame: Float32Array = ev.data as Float32Array;\r\n\r\n                        if (outputStream && !outputStream.isClosed) {\r\n                            const waveFrame = waveStreamEncoder.encode(inputFrame);\r\n                            if (!!waveFrame) {\r\n                                outputStream.writeStreamChunk({\r\n                                    buffer: waveFrame,\r\n                                    isEnd: false,\r\n                                    timeReceived: Date.now(),\r\n                                });\r\n                                needHeader = false;\r\n                            }\r\n                        }\r\n                    };\r\n                    micInput.connect(workletNode);\r\n                    workletNode.connect(context.destination);\r\n                    this.privMediaResources = {\r\n                        scriptProcessorNode: workletNode,\r\n                        source: micInput,\r\n                        stream: mediaStream,\r\n                    };\r\n                })\r\n                .catch(() => {\r\n                    micInput.connect(scriptNode);\r\n                    scriptNode.connect(context.destination);\r\n                    this.privMediaResources = {\r\n                        scriptProcessorNode: scriptNode,\r\n                        source: micInput,\r\n                        stream: mediaStream,\r\n                    };\r\n                });\r\n        } else {\r\n            micInput.connect(scriptNode);\r\n            scriptNode.connect(context.destination);\r\n            this.privMediaResources = {\r\n                scriptProcessorNode: scriptNode,\r\n                source: micInput,\r\n                stream: mediaStream,\r\n            };\r\n        }\r\n    }\r\n\r\n    public releaseMediaResources = (context: AudioContext): void => {\r\n        if (this.privMediaResources) {\r\n            if (this.privMediaResources.scriptProcessorNode) {\r\n                this.privMediaResources.scriptProcessorNode.disconnect(context.destination);\r\n                this.privMediaResources.scriptProcessorNode = null;\r\n            }\r\n            if (this.privMediaResources.source) {\r\n                this.privMediaResources.source.disconnect();\r\n                this.privMediaResources.stream.getTracks().forEach((track: any) => track.stop());\r\n                this.privMediaResources.source = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public setWorkletUrl(url: string): void {\r\n        this.privSpeechProcessorScript = url;\r\n    }\r\n}\r\n\r\ninterface IMediaResources {\r\n    source: MediaStreamAudioSourceNode;\r\n    scriptProcessorNode: ScriptProcessorNode | AudioWorkletNode;\r\n    stream: MediaStream;\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    connectivity,\r\n    ISpeechConfigAudioDevice,\r\n    type\r\n} from \"../common.speech/Exports\";\r\nimport {\r\n    AudioSourceErrorEvent,\r\n    AudioSourceEvent,\r\n    AudioSourceInitializingEvent,\r\n    AudioSourceOffEvent,\r\n    AudioSourceReadyEvent,\r\n    AudioStreamNodeAttachedEvent,\r\n    AudioStreamNodeAttachingEvent,\r\n    AudioStreamNodeDetachedEvent,\r\n    AudioStreamNodeErrorEvent,\r\n    ChunkedArrayBufferStream,\r\n    createNoDashGuid,\r\n    Deferred,\r\n    Events,\r\n    EventSource,\r\n    IAudioSource,\r\n    IAudioStreamNode,\r\n    IStringDictionary,\r\n    Stream,\r\n} from \"../common/Exports\";\r\nimport {\r\n    AudioStreamFormat,\r\n    AudioStreamFormatImpl,\r\n} from \"../sdk/Audio/AudioStreamFormat\";\r\nimport { IRecorder } from \"./IRecorder\";\r\n\r\n// Extending the default definition with browser specific definitions for backward compatibility\r\ninterface INavigator extends Navigator {\r\n    webkitGetUserMedia?: (constraints: MediaStreamConstraints, successCallback: NavigatorUserMediaSuccessCallback, errorCallback: NavigatorUserMediaErrorCallback) => void;\r\n    mozGetUserMedia?: (constraints: MediaStreamConstraints, successCallback: NavigatorUserMediaSuccessCallback, errorCallback: NavigatorUserMediaErrorCallback) => void;\r\n    msGetUserMedia?: (constraints: MediaStreamConstraints, successCallback: NavigatorUserMediaSuccessCallback, errorCallback: NavigatorUserMediaErrorCallback) => void;\r\n}\r\n\r\nexport const AudioWorkletSourceURLPropertyName = \"MICROPHONE-WorkletSourceUrl\";\r\n\r\nexport class MicAudioSource implements IAudioSource {\r\n\r\n    private static readonly AUDIOFORMAT: AudioStreamFormatImpl = AudioStreamFormat.getDefaultInputFormat() as AudioStreamFormatImpl;\r\n\r\n    private privStreams: IStringDictionary<Stream<ArrayBuffer>> = {};\r\n\r\n    private privId: string;\r\n\r\n    private privEvents: EventSource<AudioSourceEvent>;\r\n\r\n    private privInitializeDeferral: Deferred<void>;\r\n\r\n    private privMediaStream: MediaStream;\r\n\r\n    private privContext: AudioContext;\r\n\r\n    private privMicrophoneLabel: string;\r\n\r\n    private privOutputChunkSize: number;\r\n\r\n    public constructor(\r\n        private readonly privRecorder: IRecorder,\r\n        private readonly deviceId?: string,\r\n        audioSourceId?: string,\r\n        mediaStream?: MediaStream\r\n        ) {\r\n\r\n        this.privOutputChunkSize = MicAudioSource.AUDIOFORMAT.avgBytesPerSec / 10;\r\n        this.privId = audioSourceId ? audioSourceId : createNoDashGuid();\r\n        this.privEvents = new EventSource<AudioSourceEvent>();\r\n        this.privMediaStream = mediaStream || null;\r\n    }\r\n\r\n    public get format(): Promise<AudioStreamFormatImpl> {\r\n        return Promise.resolve(MicAudioSource.AUDIOFORMAT);\r\n    }\r\n\r\n    public get blob(): Promise<Blob> {\r\n        return Promise.reject(\"Not implemented for Mic input\");\r\n    }\r\n\r\n    public turnOn = (): Promise<void> => {\r\n        if (this.privInitializeDeferral) {\r\n            return this.privInitializeDeferral.promise;\r\n        }\r\n\r\n        this.privInitializeDeferral = new Deferred<void>();\r\n\r\n        try {\r\n            this.createAudioContext();\r\n        } catch (error) {\r\n            if (error instanceof Error) {\r\n                const typedError: Error = error as Error;\r\n                this.privInitializeDeferral.reject(typedError.name + \": \" + typedError.message);\r\n            } else {\r\n                this.privInitializeDeferral.reject(error);\r\n            }\r\n            return this.privInitializeDeferral.promise;\r\n        }\r\n\r\n        const nav = window.navigator as INavigator;\r\n\r\n        let getUserMedia = (\r\n            nav.getUserMedia ||\r\n            nav.webkitGetUserMedia ||\r\n            nav.mozGetUserMedia ||\r\n            nav.msGetUserMedia\r\n        );\r\n\r\n        if (!!nav.mediaDevices) {\r\n            getUserMedia = (constraints: MediaStreamConstraints, successCallback: NavigatorUserMediaSuccessCallback, errorCallback: NavigatorUserMediaErrorCallback): void => {\r\n                nav.mediaDevices\r\n                    .getUserMedia(constraints)\r\n                    .then(successCallback)\r\n                    .catch(errorCallback);\r\n            };\r\n        }\r\n\r\n        if (!getUserMedia) {\r\n            const errorMsg = \"Browser does not support getUserMedia.\";\r\n            this.privInitializeDeferral.reject(errorMsg);\r\n            this.onEvent(new AudioSourceErrorEvent(errorMsg, \"\")); // mic initialized error - no streamid at this point\r\n        } else {\r\n            const next = () => {\r\n                this.onEvent(new AudioSourceInitializingEvent(this.privId)); // no stream id\r\n                if (this.privMediaStream && this.privMediaStream.active) {\r\n                    this.onEvent(new AudioSourceReadyEvent(this.privId));\r\n                    this.privInitializeDeferral.resolve();\r\n                } else {\r\n                    getUserMedia(\r\n                        { audio: this.deviceId ? { deviceId: this.deviceId } : true, video: false },\r\n                        (mediaStream: MediaStream) => {\r\n                            this.privMediaStream = mediaStream;\r\n                            this.onEvent(new AudioSourceReadyEvent(this.privId));\r\n                            this.privInitializeDeferral.resolve();\r\n                        }, (error: MediaStreamError) => {\r\n                            const errorMsg = `Error occurred during microphone initialization: ${error}`;\r\n                            this.privInitializeDeferral.reject(errorMsg);\r\n                            this.onEvent(new AudioSourceErrorEvent(this.privId, errorMsg));\r\n                        });\r\n                }\r\n            };\r\n\r\n            if (this.privContext.state === \"suspended\") {\r\n                // NOTE: On iOS, the Web Audio API requires sounds to be triggered from an explicit user action.\r\n                // https://github.com/WebAudio/web-audio-api/issues/790\r\n                this.privContext.resume()\r\n                    .then(next)\r\n                    .catch((reason: any) => {\r\n                        this.privInitializeDeferral.reject(`Failed to initialize audio context: ${reason}`);\r\n                    });\r\n            } else {\r\n                next();\r\n            }\r\n        }\r\n\r\n        return this.privInitializeDeferral.promise;\r\n    }\r\n\r\n    public id = (): string => {\r\n        return this.privId;\r\n    }\r\n\r\n    public attach = (audioNodeId: string): Promise<IAudioStreamNode> => {\r\n        this.onEvent(new AudioStreamNodeAttachingEvent(this.privId, audioNodeId));\r\n\r\n        return this.listen(audioNodeId).then<IAudioStreamNode>(\r\n            (stream: Stream<ArrayBuffer>) => {\r\n                this.onEvent(new AudioStreamNodeAttachedEvent(this.privId, audioNodeId));\r\n                return {\r\n                    detach: async () => {\r\n                        stream.readEnded();\r\n                        delete this.privStreams[audioNodeId];\r\n                        this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n                        return this.turnOff();\r\n                    },\r\n                    id: () => {\r\n                        return audioNodeId;\r\n                    },\r\n                    read: () => {\r\n                        return stream.read();\r\n                    },\r\n                };\r\n            });\r\n    }\r\n\r\n    public detach = (audioNodeId: string): void => {\r\n        if (audioNodeId && this.privStreams[audioNodeId]) {\r\n            this.privStreams[audioNodeId].close();\r\n            delete this.privStreams[audioNodeId];\r\n            this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n        }\r\n    }\r\n\r\n    public async turnOff(): Promise<void> {\r\n        for (const streamId in this.privStreams) {\r\n            if (streamId) {\r\n                const stream = this.privStreams[streamId];\r\n                if (stream) {\r\n                    stream.close();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.onEvent(new AudioSourceOffEvent(this.privId)); // no stream now\r\n        if (this.privInitializeDeferral) {\r\n            // Correctly handle when browser forces mic off before turnOn() completes\r\n            await this.privInitializeDeferral;\r\n            this.privInitializeDeferral = null;\r\n        }\r\n\r\n        await this.destroyAudioContext();\r\n\r\n        return;\r\n    }\r\n\r\n    public get events(): EventSource<AudioSourceEvent> {\r\n        return this.privEvents;\r\n    }\r\n\r\n    public get deviceInfo(): Promise<ISpeechConfigAudioDevice> {\r\n        return this.getMicrophoneLabel().then((label: string) => {\r\n            return {\r\n                bitspersample: MicAudioSource.AUDIOFORMAT.bitsPerSample,\r\n                channelcount: MicAudioSource.AUDIOFORMAT.channels,\r\n                connectivity: connectivity.Unknown,\r\n                manufacturer: \"Speech SDK\",\r\n                model: label,\r\n                samplerate: MicAudioSource.AUDIOFORMAT.samplesPerSec,\r\n                type: type.Microphones,\r\n            };\r\n        });\r\n    }\r\n\r\n    public setProperty(name: string, value: string): void {\r\n        if (name === AudioWorkletSourceURLPropertyName) {\r\n            this.privRecorder.setWorkletUrl(value);\r\n        } else {\r\n            throw new Error(\"Property '\" + name + \"' is not supported on Microphone.\");\r\n        }\r\n    }\r\n\r\n    private getMicrophoneLabel(): Promise<string> {\r\n        const defaultMicrophoneName: string = \"microphone\";\r\n\r\n        // If we did this already, return the value.\r\n        if (this.privMicrophoneLabel !== undefined) {\r\n            return Promise.resolve(this.privMicrophoneLabel);\r\n        }\r\n\r\n        // If the stream isn't currently running, we can't query devices because security.\r\n        if (this.privMediaStream === undefined || !this.privMediaStream.active) {\r\n            return Promise.resolve(defaultMicrophoneName);\r\n        }\r\n\r\n        // Setup a default\r\n        this.privMicrophoneLabel = defaultMicrophoneName;\r\n\r\n        // Get the id of the device running the audio track.\r\n        const microphoneDeviceId: string = this.privMediaStream.getTracks()[0].getSettings().deviceId;\r\n\r\n        // If the browser doesn't support getting the device ID, set a default and return.\r\n        if (undefined === microphoneDeviceId) {\r\n            return Promise.resolve(this.privMicrophoneLabel);\r\n        }\r\n\r\n        const deferred: Deferred<string> = new Deferred<string>();\r\n\r\n        // Enumerate the media devices.\r\n        navigator.mediaDevices.enumerateDevices().then((devices: MediaDeviceInfo[]) => {\r\n            for (const device of devices) {\r\n                if (device.deviceId === microphoneDeviceId) {\r\n                    // Found the device\r\n                    this.privMicrophoneLabel = device.label;\r\n                    break;\r\n                }\r\n            }\r\n            deferred.resolve(this.privMicrophoneLabel);\r\n        }, () => deferred.resolve(this.privMicrophoneLabel));\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    private listen = async (audioNodeId: string): Promise<Stream<ArrayBuffer>> => {\r\n        await this.turnOn();\r\n        const stream = new ChunkedArrayBufferStream(this.privOutputChunkSize, audioNodeId);\r\n        this.privStreams[audioNodeId] = stream;\r\n        try {\r\n            this.privRecorder.record(this.privContext, this.privMediaStream, stream);\r\n        } catch (error) {\r\n            this.onEvent(new AudioStreamNodeErrorEvent(this.privId, audioNodeId, error));\r\n            throw error;\r\n        }\r\n        const result: Stream<ArrayBuffer> = stream;\r\n        return result;\r\n    }\r\n\r\n    private onEvent = (event: AudioSourceEvent): void => {\r\n        this.privEvents.onEvent(event);\r\n        Events.instance.onEvent(event);\r\n    }\r\n\r\n    private createAudioContext = (): void => {\r\n        if (!!this.privContext) {\r\n            return;\r\n        }\r\n\r\n        this.privContext = AudioStreamFormatImpl.getAudioContext(MicAudioSource.AUDIOFORMAT.samplesPerSec);\r\n    }\r\n\r\n    private async destroyAudioContext(): Promise<void> {\r\n        if (!this.privContext) {\r\n            return;\r\n        }\r\n\r\n        this.privRecorder.releaseMediaResources(this.privContext);\r\n\r\n        // This pattern brought to you by a bug in the TypeScript compiler where it\r\n        // confuses the (\"close\" in this.privContext) with this.privContext always being null as the alternate.\r\n        // https://github.com/Microsoft/TypeScript/issues/11498\r\n        let hasClose: boolean = false;\r\n        if (\"close\" in this.privContext) {\r\n            hasClose = true;\r\n        }\r\n\r\n        if (hasClose) {\r\n            await this.privContext.close();\r\n            this.privContext = null;\r\n        } else if (null !== this.privContext && this.privContext.state === \"running\") {\r\n            // Suspend actually takes a callback, but analogous to the\r\n            // resume method, it'll be only fired if suspend is called\r\n            // in a direct response to a user action. The later is not always\r\n            // the case, as TurnOff is also called, when we receive an\r\n            // end-of-speech message from the service. So, doing a best effort\r\n            // fire-and-forget here.\r\n            await this.privContext.suspend();\r\n        }\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    connectivity,\r\n    ISpeechConfigAudioDevice,\r\n    type,\r\n} from \"../common.speech/Exports\";\r\nimport {\r\n    AudioSourceErrorEvent,\r\n    AudioSourceEvent,\r\n    AudioSourceInitializingEvent,\r\n    AudioSourceOffEvent,\r\n    AudioSourceReadyEvent,\r\n    AudioStreamNodeAttachedEvent,\r\n    AudioStreamNodeAttachingEvent,\r\n    AudioStreamNodeDetachedEvent,\r\n    AudioStreamNodeErrorEvent,\r\n    ChunkedArrayBufferStream,\r\n    createNoDashGuid,\r\n    Deferred,\r\n    Events,\r\n    EventSource,\r\n    IAudioSource,\r\n    IAudioStreamNode,\r\n    IStreamChunk,\r\n    IStringDictionary,\r\n    Stream,\r\n} from \"../common/Exports\";\r\nimport { AudioStreamFormat, AudioStreamFormatImpl } from \"../sdk/Audio/AudioStreamFormat\";\r\n\r\nexport class FileAudioSource implements IAudioSource {\r\n\r\n    private privAudioFormatPromise: Promise<AudioStreamFormatImpl>;\r\n\r\n    private privStreams: IStringDictionary<Stream<ArrayBuffer>> = {};\r\n\r\n    private privId: string;\r\n\r\n    private privEvents: EventSource<AudioSourceEvent>;\r\n\r\n    private privSource: Blob | Buffer;\r\n\r\n    private privFilename: string;\r\n\r\n    private privHeaderEnd: number = 44;\r\n\r\n    public constructor(file: File | Buffer, filename?: string, audioSourceId?: string) {\r\n        this.privId = audioSourceId ? audioSourceId : createNoDashGuid();\r\n        this.privEvents = new EventSource<AudioSourceEvent>();\r\n        this.privSource = file;\r\n        if (typeof window !== \"undefined\" && typeof Blob !== \"undefined\" && this.privSource instanceof Blob) {\r\n            this.privFilename = (file as File).name;\r\n        } else {\r\n            this.privFilename = filename || \"unknown.wav\";\r\n        }\r\n\r\n        // Read the header.\r\n        this.privAudioFormatPromise = this.readHeader();\r\n    }\r\n\r\n    public get format(): Promise<AudioStreamFormatImpl> {\r\n        return this.privAudioFormatPromise;\r\n    }\r\n\r\n    public get blob(): Promise<Blob | Buffer> {\r\n        return Promise.resolve(this.privSource);\r\n    }\r\n\r\n    public turnOn = (): Promise<void> => {\r\n        if (this.privFilename.lastIndexOf(\".wav\") !== this.privFilename.length - 4) {\r\n            const errorMsg = this.privFilename + \" is not supported. Only WAVE files are allowed at the moment.\";\r\n            this.onEvent(new AudioSourceErrorEvent(errorMsg, \"\"));\r\n            return Promise.reject(errorMsg);\r\n        }\r\n\r\n        this.onEvent(new AudioSourceInitializingEvent(this.privId)); // no stream id\r\n        this.onEvent(new AudioSourceReadyEvent(this.privId));\r\n        return;\r\n    }\r\n\r\n    public id = (): string => {\r\n        return this.privId;\r\n    }\r\n\r\n    public attach = async (audioNodeId: string): Promise<IAudioStreamNode> => {\r\n        this.onEvent(new AudioStreamNodeAttachingEvent(this.privId, audioNodeId));\r\n\r\n        const stream: Stream<ArrayBuffer> = await this.upload(audioNodeId);\r\n\r\n        this.onEvent(new AudioStreamNodeAttachedEvent(this.privId, audioNodeId));\r\n        return Promise.resolve({\r\n            detach: async (): Promise<void> => {\r\n                stream.readEnded();\r\n                delete this.privStreams[audioNodeId];\r\n                this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n                await this.turnOff();\r\n            },\r\n            id: () => {\r\n                return audioNodeId;\r\n            },\r\n            read: (): Promise<IStreamChunk<ArrayBuffer>> => {\r\n                return stream.read();\r\n            },\r\n        });\r\n    }\r\n\r\n    public detach = (audioNodeId: string): void => {\r\n        if (audioNodeId && this.privStreams[audioNodeId]) {\r\n            this.privStreams[audioNodeId].close();\r\n            delete this.privStreams[audioNodeId];\r\n            this.onEvent(new AudioStreamNodeDetachedEvent(this.privId, audioNodeId));\r\n        }\r\n    }\r\n\r\n    public turnOff = (): Promise<void> => {\r\n        for (const streamId in this.privStreams) {\r\n            if (streamId) {\r\n                const stream = this.privStreams[streamId];\r\n                if (stream && !stream.isClosed) {\r\n                    stream.close();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.onEvent(new AudioSourceOffEvent(this.privId)); // no stream now\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public get events(): EventSource<AudioSourceEvent> {\r\n        return this.privEvents;\r\n    }\r\n\r\n    public get deviceInfo(): Promise<ISpeechConfigAudioDevice> {\r\n        return this.privAudioFormatPromise.then<ISpeechConfigAudioDevice>((result: AudioStreamFormatImpl) => {\r\n            return Promise.resolve({\r\n                bitspersample: result.bitsPerSample,\r\n                channelcount: result.channels,\r\n                connectivity: connectivity.Unknown,\r\n                manufacturer: \"Speech SDK\",\r\n                model: \"File\",\r\n                samplerate: result.samplesPerSec,\r\n                type: type.File,\r\n            });\r\n        });\r\n    }\r\n\r\n    private readHeader(): Promise<AudioStreamFormatImpl> {\r\n        // Read the wave header.\r\n        const maxHeaderSize: number = 512;\r\n        const header: Blob | Buffer = this.privSource.slice(0, maxHeaderSize);\r\n\r\n        const headerResult: Deferred<AudioStreamFormatImpl> = new Deferred<AudioStreamFormatImpl>();\r\n\r\n        const processHeader = (header: ArrayBuffer): void => {\r\n            const view: DataView = new DataView(header);\r\n\r\n            const getWord = (index: number): string => {\r\n                return String.fromCharCode(view.getUint8(index), view.getUint8(index + 1), view.getUint8(index + 2), view.getUint8(index + 3));\r\n            };\r\n\r\n            // RIFF 4 bytes.\r\n            if (\"RIFF\" !== getWord(0)) {\r\n                headerResult.reject(\"Invalid WAV header in file, RIFF was not found\");\r\n                return;\r\n            }\r\n\r\n            // length, 4 bytes\r\n            // RIFF Type & fmt 8 bytes\r\n            if (\"WAVE\" !== getWord(8) || \"fmt \" !== getWord(12)) {\r\n                headerResult.reject(\"Invalid WAV header in file, WAVEfmt was not found\");\r\n                return;\r\n            }\r\n\r\n            const formatSize: number = view.getInt32(16, true);\r\n            const channelCount: number = view.getUint16(22, true);\r\n            const sampleRate: number = view.getUint32(24, true);\r\n            const bitsPerSample: number = view.getUint16(34, true);\r\n            // Confirm if header is 44 bytes long.\r\n            let pos: number = 36 + Math.max(formatSize - 16, 0);\r\n            for (; getWord(pos) !== \"data\"; pos += 2) {\r\n                if (pos > maxHeaderSize - 8) {\r\n                    headerResult.reject(\"Invalid WAV header in file, data block was not found\");\r\n                    return;\r\n                }\r\n            }\r\n            this.privHeaderEnd = pos + 8;\r\n            headerResult.resolve(AudioStreamFormat.getWaveFormatPCM(sampleRate, bitsPerSample, channelCount) as AudioStreamFormatImpl);\r\n        };\r\n\r\n        if (typeof window !== \"undefined\" && typeof Blob !== \"undefined\" && header instanceof Blob) {\r\n            const reader: FileReader = new FileReader();\r\n\r\n            reader.onload = (event: Event) => {\r\n                const header: ArrayBuffer = (event.target as FileReader).result as ArrayBuffer;\r\n                processHeader(header);\r\n            };\r\n\r\n            reader.readAsArrayBuffer(header);\r\n        } else {\r\n            const h: Buffer = header as Buffer;\r\n            processHeader(h.buffer.slice(h.byteOffset, h.byteOffset + h.byteLength));\r\n        }\r\n        return headerResult.promise;\r\n    }\r\n\r\n    private async upload(audioNodeId: string): Promise<Stream<ArrayBuffer>> {\r\n        const onerror = (error: string) => {\r\n            const errorMsg = `Error occurred while processing '${this.privFilename}'. ${error}`;\r\n            this.onEvent(new AudioStreamNodeErrorEvent(this.privId, audioNodeId, errorMsg));\r\n            throw new Error(errorMsg);\r\n        };\r\n\r\n        try {\r\n            await this.turnOn();\r\n\r\n            const format: AudioStreamFormatImpl = await this.privAudioFormatPromise;\r\n            const stream = new ChunkedArrayBufferStream(format.avgBytesPerSec / 10, audioNodeId);\r\n\r\n            this.privStreams[audioNodeId] = stream;\r\n            const chunk: Blob | Buffer = this.privSource.slice(this.privHeaderEnd);\r\n\r\n            const processFile = (buff: ArrayBuffer): void => {\r\n                if (stream.isClosed) {\r\n                    return; // output stream was closed (somebody called TurnOff). We're done here.\r\n                }\r\n\r\n                stream.writeStreamChunk({\r\n                    buffer: buff,\r\n                    isEnd: false,\r\n                    timeReceived: Date.now(),\r\n                });\r\n                stream.close();\r\n            };\r\n\r\n            if (typeof window !== \"undefined\" && typeof Blob !== \"undefined\" && chunk instanceof Blob) {\r\n                const reader: FileReader = new FileReader();\r\n                reader.onerror = (ev: ProgressEvent<FileReader>) => { onerror(ev.toString()); };\r\n\r\n                reader.onload = (event: Event) => {\r\n                    const fileBuffer: ArrayBuffer = (event.target as FileReader).result as ArrayBuffer;\r\n                    processFile(fileBuffer);\r\n                };\r\n\r\n                reader.readAsArrayBuffer(chunk);\r\n            } else {\r\n                const c: Buffer = chunk as Buffer;\r\n                processFile(c.buffer.slice(c.byteOffset, c.byteOffset + c.byteLength));\r\n            }\r\n\r\n            return stream;\r\n        } catch (e) {\r\n            onerror(e);\r\n        }\r\n    }\r\n\r\n    private onEvent = (event: AudioSourceEvent): void => {\r\n        this.privEvents.onEvent(event);\r\n        Events.instance.onEvent(event);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n /**\r\n  * An abstract base class that defines callback methods (read() and close()) for\r\n  * custom audio input streams).\r\n  * @class PullAudioInputStreamCallback\r\n  */\r\nexport abstract class PullAudioInputStreamCallback {\r\n\r\n    /**\r\n     * Reads data from audio input stream into the data buffer. The maximal number of bytes\r\n     * to be read is determined by the size of dataBuffer.\r\n     * @member PullAudioInputStreamCallback.prototype.read\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - The byte array to store the read data.\r\n     * @returns {number} the number of bytes have been read.\r\n     */\r\n    public abstract read(dataBuffer: ArrayBuffer): number;\r\n\r\n    /**\r\n     * Closes the audio input stream.\r\n     * @member PullAudioInputStreamCallback.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { SynthesisAdapterBase } from \"../../common.speech/Exports\";\r\nimport {\r\n    BackgroundEvent,\r\n    createNoDashGuid,\r\n    Events,\r\n    IAudioDestination,\r\n    INumberDictionary\r\n} from \"../../common/Exports\";\r\nimport { AudioStreamFormat, IPlayer } from \"../Exports\";\r\nimport { AudioFormatTag, AudioOutputFormatImpl } from \"./AudioOutputFormat\";\r\nimport { PullAudioOutputStreamImpl } from \"./AudioOutputStream\";\r\n\r\nconst MediaDurationPlaceholderSeconds = 60 * 30;\r\n\r\nconst AudioFormatToMimeType: INumberDictionary<string> = {\r\n    [AudioFormatTag.PCM]: \"audio/wav\",\r\n    [AudioFormatTag.MP3]: \"audio/mpeg\",\r\n    [AudioFormatTag.OGG_OPUS]: \"audio/ogg\",\r\n    [AudioFormatTag.WEBM_OPUS]: \"audio/webm; codecs=opus\"\r\n};\r\n\r\n/**\r\n * Represents the speaker playback audio destination, which only works in browser.\r\n * Note: the SDK will try to use <a href=\"https://www.w3.org/TR/media-source/\">Media Source Extensions</a> to play audio.\r\n * Mp3 format has better supports on Microsoft Edge, Chrome and Safari (desktop), so, it's better to specify mp3 format for playback.\r\n * @class SpeakerAudioDestination\r\n * Updated in version 1.12.1\r\n */\r\nexport class SpeakerAudioDestination implements IAudioDestination, IPlayer {\r\n    private readonly privId: string;\r\n    private privFormat: AudioOutputFormatImpl;\r\n    private privAudio: HTMLAudioElement;\r\n    private privMediaSource: MediaSource;\r\n    private privSourceBuffer: SourceBuffer;\r\n    private privPlaybackStarted: boolean = false;\r\n    private privAudioBuffer: ArrayBuffer[];\r\n    private privAppendingToBuffer: boolean = false;\r\n    private privMediaSourceOpened: boolean = false;\r\n    private privIsClosed: boolean;\r\n    private privIsPaused: boolean;\r\n    private privAudioOutputStream: PullAudioOutputStreamImpl;\r\n    private privBytesReceived: number = 0;\r\n\r\n    public constructor(audioDestinationId?: string) {\r\n        this.privId = audioDestinationId ? audioDestinationId : createNoDashGuid();\r\n        this.privIsPaused = false;\r\n        this.privIsClosed = false;\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privId;\r\n    }\r\n\r\n    public write(buffer: ArrayBuffer, cb?: () => void, err?: (error: string) => void): void {\r\n        if (this.privAudioBuffer !== undefined) {\r\n            this.privAudioBuffer.push(buffer);\r\n            this.updateSourceBuffer().then(() => {\r\n                if (!!cb) {\r\n                    cb();\r\n                }\r\n            }, (error: string): void => {\r\n                if (!!err) {\r\n                    err(error);\r\n                }\r\n            });\r\n        } else if (this.privAudioOutputStream !== undefined) {\r\n            this.privAudioOutputStream.write(buffer);\r\n            this.privBytesReceived += buffer.byteLength;\r\n        }\r\n    }\r\n\r\n    public close(cb?: () => void, err?: (error: string) => void): void {\r\n        this.privIsClosed = true;\r\n        if (this.privSourceBuffer !== undefined) {\r\n            this.handleSourceBufferUpdateEnd().then(() => {\r\n                if (!!cb) {\r\n                    cb();\r\n                }\r\n            }, (error: string): void => {\r\n                if (!!err) {\r\n                    err(error);\r\n                }\r\n            });\r\n        } else if (this.privAudioOutputStream !== undefined) {\r\n            let receivedAudio = new ArrayBuffer(this.privBytesReceived);\r\n            this.privAudioOutputStream.read(receivedAudio).then((_: number): void => {\r\n                if (this.privFormat.hasHeader) {\r\n                    receivedAudio = SynthesisAdapterBase.addHeader(receivedAudio, this.privFormat);\r\n                }\r\n                const audioBlob = new Blob([receivedAudio], { type: AudioFormatToMimeType[this.privFormat.formatTag] });\r\n                this.privAudio.src = window.URL.createObjectURL(audioBlob);\r\n                this.notifyPlayback().then(() => {\r\n                    if (!!cb) {\r\n                        cb();\r\n                    }\r\n                }, (error: string): void => {\r\n                    if (!!err) {\r\n                        err(error);\r\n                    }\r\n                });\r\n            }, (error: string): void => {\r\n                if (!!err) {\r\n                    err(error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    set format(format: AudioStreamFormat) {\r\n        if (typeof (AudioContext) !== \"undefined\" || typeof ((window as any).webkitAudioContext) !== \"undefined\") {\r\n            this.privFormat = format as AudioOutputFormatImpl;\r\n            const mimeType: string = AudioFormatToMimeType[this.privFormat.formatTag];\r\n            if (mimeType === undefined) {\r\n                // tslint:disable-next-line:no-console\r\n                console.warn(\r\n                    `Unknown mimeType for format ${AudioFormatTag[this.privFormat.formatTag]}.`);\r\n\r\n            } else if (typeof (MediaSource) !== \"undefined\" && MediaSource.isTypeSupported(mimeType)) {\r\n                this.privAudio = new Audio();\r\n                this.privAudioBuffer = [];\r\n                this.privMediaSource = new MediaSource();\r\n                this.privAudio.src = URL.createObjectURL(this.privMediaSource);\r\n                this.privAudio.load();\r\n                this.privMediaSource.onsourceopen = (event: Event): void => {\r\n                    this.privMediaSourceOpened = true;\r\n                    this.privMediaSource.duration = MediaDurationPlaceholderSeconds;\r\n                    this.privSourceBuffer = this.privMediaSource.addSourceBuffer(mimeType);\r\n                    this.privSourceBuffer.onupdate = (_: Event) => {\r\n                        this.updateSourceBuffer().catch((reason: string): void => {\r\n                            Events.instance.onEvent(new BackgroundEvent(reason));\r\n                        });\r\n                    };\r\n                    this.privSourceBuffer.onupdateend = (_: Event) => {\r\n                        this.handleSourceBufferUpdateEnd().catch((reason: string): void => {\r\n                            Events.instance.onEvent(new BackgroundEvent(reason));\r\n                        });\r\n                    };\r\n                    this.privSourceBuffer.onupdatestart = (_: Event) => {\r\n                        this.privAppendingToBuffer = false;\r\n                    };\r\n                };\r\n                this.updateSourceBuffer().catch((reason: string): void => {\r\n                    Events.instance.onEvent(new BackgroundEvent(reason));\r\n                });\r\n\r\n            } else {\r\n                // tslint:disable-next-line:no-console\r\n                console.warn(\r\n                    `Format ${AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`);\r\n                this.privAudioOutputStream = new PullAudioOutputStreamImpl();\r\n                this.privAudioOutputStream.format = this.privFormat;\r\n                this.privAudio = new Audio();\r\n            }\r\n        }\r\n    }\r\n\r\n    public get isClosed(): boolean {\r\n        return this.privIsClosed;\r\n    }\r\n\r\n    public get currentTime(): number {\r\n        if (this.privAudio !== undefined) {\r\n            return this.privAudio.currentTime;\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    public pause(): void {\r\n        if (!this.privIsPaused && this.privAudio !== undefined) {\r\n            this.privAudio.pause();\r\n            this.privIsPaused = true;\r\n        }\r\n    }\r\n\r\n    public resume(cb?: () => void, err?: (error: string) => void): void {\r\n        if (this.privIsPaused && this.privAudio !== undefined) {\r\n            this.privAudio.play().then(() => {\r\n                if (!!cb) {\r\n                    cb();\r\n                }\r\n            }, (error: string): void => {\r\n                if (!!err) {\r\n                    err(error);\r\n                }\r\n            });\r\n            this.privIsPaused = false;\r\n        }\r\n    }\r\n\r\n    public onAudioStart: (sender: IPlayer) => void;\r\n\r\n    public onAudioEnd: (sender: IPlayer) => void;\r\n\r\n    public get internalAudio(): HTMLAudioElement {\r\n        return this.privAudio;\r\n    }\r\n\r\n    private async updateSourceBuffer(): Promise<void> {\r\n        if (this.privAudioBuffer !== undefined && (this.privAudioBuffer.length > 0) && this.sourceBufferAvailable()) {\r\n            this.privAppendingToBuffer = true;\r\n            const binary = this.privAudioBuffer.shift();\r\n            try {\r\n                this.privSourceBuffer.appendBuffer(binary);\r\n            } catch (error) {\r\n                this.privAudioBuffer.unshift(binary);\r\n                // tslint:disable-next-line:no-console\r\n                console.log(\r\n                    \"buffer filled, pausing addition of binaries until space is made\");\r\n                return;\r\n            }\r\n            await this.notifyPlayback();\r\n        } else if (this.canEndStream()) {\r\n            await this.handleSourceBufferUpdateEnd();\r\n        }\r\n    }\r\n\r\n    private async handleSourceBufferUpdateEnd(): Promise<void> {\r\n        if (this.canEndStream() && this.sourceBufferAvailable()) {\r\n            this.privMediaSource.endOfStream();\r\n            await this.notifyPlayback();\r\n        }\r\n    }\r\n\r\n    private async notifyPlayback(): Promise<void> {\r\n        if (!this.privPlaybackStarted && this.privAudio !== undefined) {\r\n            this.privPlaybackStarted = true;\r\n            if (!!this.onAudioStart) {\r\n                this.onAudioStart(this);\r\n            }\r\n            this.privAudio.onended = (): void => {\r\n                if (!!this.onAudioEnd) {\r\n                    this.onAudioEnd(this);\r\n                }\r\n            };\r\n            if (!this.privIsPaused) {\r\n                await this.privAudio.play();\r\n            }\r\n        }\r\n    }\r\n\r\n    private canEndStream(): boolean {\r\n        return (this.isClosed && this.privSourceBuffer !== undefined && (this.privAudioBuffer.length === 0)\r\n            && this.privMediaSourceOpened && !this.privAppendingToBuffer && this.privMediaSource.readyState === \"open\");\r\n    }\r\n\r\n    private sourceBufferAvailable(): boolean {\r\n        return (this.privSourceBuffer !== undefined && !this.privSourceBuffer.updating);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n/**\r\n * An abstract base class that defines callback methods (write() and close()) for\r\n * custom audio output streams).\r\n * @class PushAudioOutputStreamCallback\r\n */\r\nexport abstract class PushAudioOutputStreamCallback {\r\n\r\n    /**\r\n     * Writes audio data into the data buffer.\r\n     * @member PushAudioOutputStreamCallback.prototype.write\r\n     * @function\r\n     * @public\r\n     * @param {ArrayBuffer} dataBuffer - The byte array that stores the audio data to write.\r\n     */\r\n    public abstract write(dataBuffer: ArrayBuffer): void;\r\n\r\n    /**\r\n     * Closes the audio output stream.\r\n     * @member PushAudioOutputStreamCallback.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport * as fs from \"fs\";\r\nimport { IAudioDestination } from \"../../common/Exports\";\r\nimport { Contracts } from \"../Contracts\";\r\nimport { AudioStreamFormat } from \"../Exports\";\r\nimport { AudioOutputFormatImpl } from \"./AudioOutputFormat\";\r\n\r\nexport class AudioFileWriter implements IAudioDestination {\r\n    private privAudioFormat: AudioOutputFormatImpl;\r\n    private privFd: number;\r\n    private privId: string;\r\n    private privWriteStream: fs.WriteStream;\r\n\r\n    public constructor(filename: fs.PathLike) {\r\n        this.privFd = fs.openSync(filename, \"w\");\r\n    }\r\n\r\n    public set format(format: AudioStreamFormat) {\r\n        Contracts.throwIfNotUndefined(this.privAudioFormat, \"format is already set\");\r\n        this.privAudioFormat = format as AudioOutputFormatImpl;\r\n        let headerOffset: number = 0;\r\n        if (this.privAudioFormat.hasHeader) {\r\n            headerOffset = this.privAudioFormat.header.byteLength;\r\n        }\r\n        if (this.privFd !== undefined) {\r\n            this.privWriteStream = fs.createWriteStream(\"\", {fd: this.privFd, start: headerOffset, autoClose: false});\r\n        }\r\n    }\r\n\r\n    public write(buffer: ArrayBuffer): void {\r\n        Contracts.throwIfNullOrUndefined(this.privAudioFormat, \"must set format before writing.\");\r\n        if (this.privWriteStream !== undefined) {\r\n            this.privWriteStream.write(new Uint8Array(buffer.slice(0)));\r\n        }\r\n    }\r\n\r\n    public close(): void {\r\n        if (this.privFd !== undefined) {\r\n            this.privWriteStream.on(\"finish\", () => {\r\n                if (this.privAudioFormat.hasHeader) {\r\n                    this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten);\r\n                    fs.writeSync(this.privFd,\r\n                        new Int8Array(this.privAudioFormat.header),\r\n                        0,\r\n                        this.privAudioFormat.header.byteLength,\r\n                        0);\r\n                }\r\n                fs.closeSync(this.privFd);\r\n                this.privFd = undefined;\r\n            });\r\n            this.privWriteStream.end();\r\n        }\r\n    }\r\n\r\n    public id = (): string => {\r\n        return this.privId;\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\n// tslint:disable:max-classes-per-file\r\n\r\nimport { PathLike } from \"fs\";\r\nimport {\r\n    FileAudioSource,\r\n    MicAudioSource,\r\n    PcmRecorder,\r\n} from \"../../common.browser/Exports\";\r\nimport { ISpeechConfigAudioDevice } from \"../../common.speech/Exports\";\r\nimport {\r\n    AudioSourceEvent,\r\n    Deferred,\r\n    EventSource,\r\n    IAudioDestination,\r\n    IAudioSource,\r\n    IAudioStreamNode\r\n} from \"../../common/Exports\";\r\nimport { Contracts } from \"../Contracts\";\r\nimport {\r\n    AudioInputStream,\r\n    AudioOutputStream,\r\n    AudioStreamFormat,\r\n    IPlayer,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    PullAudioInputStreamCallback,\r\n    PullAudioOutputStream,\r\n    PushAudioOutputStream,\r\n    PushAudioOutputStreamCallback,\r\n    SpeakerAudioDestination\r\n} from \"../Exports\";\r\nimport { AudioFileWriter } from \"./AudioFileWriter\";\r\nimport { PullAudioInputStreamImpl, PushAudioInputStreamImpl } from \"./AudioInputStream\";\r\nimport { PullAudioOutputStreamImpl, PushAudioOutputStreamImpl } from \"./AudioOutputStream\";\r\nimport { AudioStreamFormatImpl } from \"./AudioStreamFormat\";\r\n\r\n/**\r\n * Represents audio input configuration used for specifying what type of input to use (microphone, file, stream).\r\n * @class AudioConfig\r\n * Updated in version 1.11.0\r\n */\r\nexport abstract class AudioConfig {\r\n    /**\r\n     * Creates an AudioConfig object representing the default microphone on the system.\r\n     * @member AudioConfig.fromDefaultMicrophoneInput\r\n     * @function\r\n     * @public\r\n     * @returns {AudioConfig} The audio input configuration being created.\r\n     */\r\n    public static fromDefaultMicrophoneInput(): AudioConfig {\r\n        const pcmRecorder = new PcmRecorder();\r\n        return new AudioConfigImpl(new MicAudioSource(pcmRecorder));\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing a microphone with the specified device ID.\r\n     * @member AudioConfig.fromMicrophoneInput\r\n     * @function\r\n     * @public\r\n     * @param {string | undefined} deviceId - Specifies the device ID of the microphone to be used.\r\n     *        Default microphone is used the value is omitted.\r\n     * @returns {AudioConfig} The audio input configuration being created.\r\n     */\r\n    public static fromMicrophoneInput(deviceId?: string): AudioConfig {\r\n        const pcmRecorder = new PcmRecorder();\r\n        return new AudioConfigImpl(new MicAudioSource(pcmRecorder, deviceId));\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing the specified file.\r\n     * @member AudioConfig.fromWavFileInput\r\n     * @function\r\n     * @public\r\n     * @param {File} fileName - Specifies the audio input file. Currently, only WAV / PCM is supported.\r\n     * @returns {AudioConfig} The audio input configuration being created.\r\n     */\r\n    public static fromWavFileInput(file: File | Buffer, name: string = \"unnamedBuffer.wav\"): AudioConfig {\r\n        return new AudioConfigImpl(new FileAudioSource(file, name));\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing the specified stream.\r\n     * @member AudioConfig.fromStreamInput\r\n     * @function\r\n     * @public\r\n     * @param {AudioInputStream | PullAudioInputStreamCallback | MediaStream} audioStream - Specifies the custom audio input\r\n     *        stream. Currently, only WAV / PCM is supported.\r\n     * @returns {AudioConfig} The audio input configuration being created.\r\n     */\r\n    public static fromStreamInput(audioStream: AudioInputStream | PullAudioInputStreamCallback\r\n        | MediaStream): AudioConfig {\r\n        if (audioStream instanceof PullAudioInputStreamCallback) {\r\n            return new AudioConfigImpl(new PullAudioInputStreamImpl(audioStream as PullAudioInputStreamCallback));\r\n        }\r\n\r\n        if (audioStream instanceof AudioInputStream) {\r\n            return new AudioConfigImpl(audioStream as PushAudioInputStreamImpl);\r\n        }\r\n        if (audioStream instanceof MediaStream) {\r\n            const pcmRecorder = new PcmRecorder();\r\n            return new AudioConfigImpl(new MicAudioSource(pcmRecorder, null, null, audioStream));\r\n        }\r\n\r\n        throw new Error(\"Not Supported Type\");\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing the default speaker.\r\n     * @member AudioConfig.fromDefaultSpeakerOutput\r\n     * @function\r\n     * @public\r\n     * @returns {AudioConfig} The audio output configuration being created.\r\n     * Added in version 1.11.0\r\n     */\r\n    public static fromDefaultSpeakerOutput(): AudioConfig {\r\n        return new AudioOutputConfigImpl(new SpeakerAudioDestination());\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing the custom IPlayer object.\r\n     * You can use the IPlayer object to control pause, resume, etc.\r\n     * @member AudioConfig.fromSpeakerOutput\r\n     * @function\r\n     * @public\r\n     * @param {IPlayer} player - the IPlayer object for playback.\r\n     * @returns {AudioConfig} The audio output configuration being created.\r\n     * Added in version 1.12.0\r\n     */\r\n    public static fromSpeakerOutput(player?: IPlayer): AudioConfig {\r\n        if (player === undefined) {\r\n            return AudioConfig.fromDefaultSpeakerOutput();\r\n        }\r\n        if (player instanceof SpeakerAudioDestination) {\r\n            return new AudioOutputConfigImpl(player as SpeakerAudioDestination);\r\n        }\r\n\r\n        throw new Error(\"Not Supported Type\");\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing a specified output audio file\r\n     * @member AudioConfig.fromAudioFileOutput\r\n     * @function\r\n     * @public\r\n     * @param {PathLike} filename - the filename of the output audio file\r\n     * @returns {AudioConfig} The audio output configuration being created.\r\n     * Added in version 1.11.0\r\n     */\r\n    public static fromAudioFileOutput(filename: PathLike): AudioConfig {\r\n        return new AudioOutputConfigImpl(new AudioFileWriter(filename));\r\n    }\r\n\r\n    /**\r\n     * Creates an AudioConfig object representing a specified audio output stream\r\n     * @member AudioConfig.fromStreamOutput\r\n     * @function\r\n     * @public\r\n     * @param {AudioOutputStream | PushAudioOutputStreamCallback} audioStream - Specifies the custom audio output\r\n     *        stream.\r\n     * @returns {AudioConfig} The audio output configuration being created.\r\n     * Added in version 1.11.0\r\n     */\r\n    public static fromStreamOutput(audioStream: AudioOutputStream | PushAudioOutputStreamCallback): AudioConfig {\r\n        if (audioStream instanceof PushAudioOutputStreamCallback) {\r\n            return new AudioOutputConfigImpl(new PushAudioOutputStreamImpl(audioStream as PushAudioOutputStreamCallback));\r\n        }\r\n\r\n        if (audioStream instanceof PushAudioOutputStream) {\r\n            return new AudioOutputConfigImpl(audioStream as PushAudioOutputStreamImpl);\r\n        }\r\n\r\n        if (audioStream instanceof PullAudioOutputStream) {\r\n            return new AudioOutputConfigImpl(audioStream as PullAudioOutputStreamImpl);\r\n        }\r\n\r\n        throw new Error(\"Not Supported Type\");\r\n    }\r\n\r\n    /**\r\n     * Explicitly frees any external resource attached to the object\r\n     * @member AudioConfig.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract close(): void;\r\n\r\n    /**\r\n     * Sets an arbitrary property.\r\n     * @member SpeechConfig.prototype.setProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} name - The name of the property to set.\r\n     * @param {string} value - The new value of the property.\r\n     */\r\n    public abstract setProperty(name: string, value: string): void;\r\n\r\n    /**\r\n     * Returns the current value of an arbitrary property.\r\n     * @member SpeechConfig.prototype.getProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} name - The name of the property to query.\r\n     * @param {string} def - The value to return in case the property is not known.\r\n     * @returns {string} The current value, or provided default, of the given property.\r\n     */\r\n    public abstract getProperty(name: string, def?: string): string;\r\n\r\n}\r\n\r\n/**\r\n * Represents audio input stream used for custom audio input configurations.\r\n * @private\r\n * @class AudioConfigImpl\r\n */\r\nexport class AudioConfigImpl extends AudioConfig implements IAudioSource {\r\n    private privSource: IAudioSource;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {IAudioSource} source - An audio source.\r\n     */\r\n    public constructor(source: IAudioSource) {\r\n        super();\r\n        this.privSource = source;\r\n    }\r\n\r\n    /**\r\n     * Format information for the audio\r\n     */\r\n    public get format(): Promise<AudioStreamFormatImpl> {\r\n        return this.privSource.format;\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(cb?: () => void, err?: (error: string) => void): void {\r\n        this.privSource.turnOff().then(() => {\r\n            if (!!cb) {\r\n                cb();\r\n            }\r\n        }, (error: string) => {\r\n            if (!!err) {\r\n                err(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.id\r\n     * @function\r\n     * @public\r\n     */\r\n    public id(): string {\r\n        return this.privSource.id();\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.blob\r\n     * @function\r\n     * @public\r\n     */\r\n    public get blob(): Promise<Blob | Buffer> {\r\n        return this.privSource.blob;\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.turnOn\r\n     * @function\r\n     * @public\r\n     * @returns {Promise<void>} A promise.\r\n     */\r\n    public turnOn(): Promise<void> {\r\n        return this.privSource.turnOn();\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.attach\r\n     * @function\r\n     * @public\r\n     * @param {string} audioNodeId - The audio node id.\r\n     * @returns {Promise<IAudioStreamNode>} A promise.\r\n     */\r\n    public attach(audioNodeId: string): Promise<IAudioStreamNode> {\r\n        return this.privSource.attach(audioNodeId);\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.detach\r\n     * @function\r\n     * @public\r\n     * @param {string} audioNodeId - The audio node id.\r\n     */\r\n    public detach(audioNodeId: string): void {\r\n        return this.privSource.detach(audioNodeId);\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.turnOff\r\n     * @function\r\n     * @public\r\n     * @returns {Promise<void>} A promise.\r\n     */\r\n    public turnOff(): Promise<void> {\r\n        return this.privSource.turnOff();\r\n    }\r\n\r\n    /**\r\n     * @member AudioConfigImpl.prototype.events\r\n     * @function\r\n     * @public\r\n     * @returns {EventSource<AudioSourceEvent>} An event source for audio events.\r\n     */\r\n    public get events(): EventSource<AudioSourceEvent> {\r\n        return this.privSource.events;\r\n    }\r\n\r\n    public setProperty(name: string, value: string): void {\r\n        Contracts.throwIfNull(value, \"value\");\r\n\r\n        if (undefined !== this.privSource.setProperty) {\r\n            this.privSource.setProperty(name, value);\r\n        } else {\r\n            throw new Error(\"This AudioConfig instance does not support setting properties.\");\r\n        }\r\n\r\n    }\r\n\r\n    public getProperty(name: string, def?: string): string {\r\n        if (undefined !== this.privSource.getProperty) {\r\n            return this.privSource.getProperty(name, def);\r\n        } else {\r\n            throw new Error(\"This AudioConfig instance does not support getting properties.\");\r\n        }\r\n\r\n        return def;\r\n    }\r\n\r\n    public get deviceInfo(): Promise<ISpeechConfigAudioDevice> {\r\n        return this.privSource.deviceInfo;\r\n    }\r\n}\r\n\r\nexport class AudioOutputConfigImpl extends AudioConfig implements IAudioDestination {\r\n    private privDestination: IAudioDestination;\r\n\r\n    /**\r\n     * Creates and initializes an instance of this class.\r\n     * @constructor\r\n     * @param {IAudioDestination} destination - An audio destination.\r\n     */\r\n    public constructor(destination: IAudioDestination) {\r\n        super();\r\n        this.privDestination = destination;\r\n    }\r\n\r\n    public set format(format: AudioStreamFormat) {\r\n        this.privDestination.format = format;\r\n    }\r\n\r\n    public write(buffer: ArrayBuffer): void {\r\n        this.privDestination.write(buffer);\r\n    }\r\n\r\n    public close(): void {\r\n        this.privDestination.close();\r\n    }\r\n\r\n    public id(): string {\r\n        return this.privDestination.id();\r\n    }\r\n\r\n    public setProperty(name: string, value: string): void {\r\n        throw new Error(\"This AudioConfig instance does not support setting properties.\");\r\n    }\r\n\r\n    public getProperty(name: string, def?: string): string {\r\n        throw new Error(\"This AudioConfig instance does not support getting properties.\");\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation.\r\n// Licensed under the MIT license.\r\n\r\n/**\r\n * Profanity option.\r\n * Added in version 1.7.0.\r\n */\r\nexport enum ProfanityOption {\r\n    Masked = 0,\r\n    Removed = 1,\r\n    Raw = 2\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    ForceDictationPropertyName,\r\n    OutputFormatPropertyName,\r\n    ServicePropertiesPropertyName\r\n} from \"../common.speech/Exports\";\r\nimport {IStringDictionary} from \"../common/Exports\";\r\nimport {Contracts} from \"./Contracts\";\r\nimport {\r\n    OutputFormat,\r\n    ProfanityOption,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    ServicePropertyChannel,\r\n    SpeechSynthesisOutputFormat,\r\n} from \"./Exports\";\r\n\r\n/**\r\n * Speech configuration.\r\n * @class SpeechConfig\r\n */\r\nexport abstract class SpeechConfig {\r\n    /**\r\n     * Creates and initializes an instance.\r\n     * @constructor\r\n     */\r\n    protected constructor() { }\r\n\r\n    /**\r\n     * Static instance of SpeechConfig returned by passing subscriptionKey and service region.\r\n     * Note: Please use your LanguageUnderstanding subscription key in case you want to use the Intent recognizer.\r\n     * @member SpeechConfig.fromSubscription\r\n     * @function\r\n     * @public\r\n     * @param {string} subscriptionKey - The subscription key.\r\n     * @param {string} region - The region name (see the <a href=\"https://aka.ms/csspeech/region\">region page</a>).\r\n     * @returns {SpeechConfig} The speech factory\r\n     */\r\n    public static fromSubscription(subscriptionKey: string, region: string): SpeechConfig {\r\n        Contracts.throwIfNullOrWhitespace(subscriptionKey, \"subscriptionKey\");\r\n        Contracts.throwIfNullOrWhitespace(region, \"region\");\r\n\r\n        const speechImpl: SpeechConfigImpl = new SpeechConfigImpl();\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_Region, region);\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_IntentRegion, region);\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_Key, subscriptionKey);\r\n\r\n        return speechImpl;\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of the speech config with specified endpoint and subscription key.\r\n     * This method is intended only for users who use a non-standard service endpoint or parameters.\r\n     * Note: Please use your LanguageUnderstanding subscription key in case you want to use the Intent recognizer.\r\n     * Note: The query parameters specified in the endpoint URL are not changed, even if they are set by any other APIs.\r\n     * For example, if language is defined in the uri as query parameter \"language=de-DE\", and also set by\r\n     *              SpeechConfig.speechRecognitionLanguage = \"en-US\", the language setting in uri takes precedence,\r\n     *              and the effective language is \"de-DE\". Only the parameters that are not specified in the\r\n     *              endpoint URL can be set by other APIs.\r\n     * Note: To use authorization token with fromEndpoint, pass an empty string to the subscriptionKey in the\r\n     *       fromEndpoint method, and then set authorizationToken=\"token\" on the created SpeechConfig instance to\r\n     *       use the authorization token.\r\n     * @member SpeechConfig.fromEndpoint\r\n     * @function\r\n     * @public\r\n     * @param {URL} endpoint - The service endpoint to connect to.\r\n     * @param {string} subscriptionKey - The subscription key. If a subscription key is not specified, an authorization token must be set.\r\n     * @returns {SpeechConfig} A speech factory instance.\r\n     */\r\n    public static fromEndpoint(endpoint: URL, subscriptionKey?: string): SpeechConfig {\r\n        Contracts.throwIfNull(endpoint, \"endpoint\");\r\n\r\n        const speechImpl: SpeechConfigImpl = new SpeechConfigImpl();\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_Endpoint, endpoint.href);\r\n\r\n        if (undefined !== subscriptionKey) {\r\n            speechImpl.setProperty(PropertyId.SpeechServiceConnection_Key, subscriptionKey);\r\n        }\r\n        return speechImpl;\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of the speech config with specified host and subscription key.\r\n     * This method is intended only for users who use a non-default service host. Standard resource path will be assumed.\r\n     * For services with a non-standard resource path or no path at all, use fromEndpoint instead.\r\n     * Note: Query parameters are not allowed in the host URI and must be set by other APIs.\r\n     * Note: To use an authorization token with fromHost, use fromHost(URL),\r\n     * and then set the AuthorizationToken property on the created SpeechConfig instance.\r\n     * Note: Added in version 1.9.0.\r\n     * @member SpeechConfig.fromHost\r\n     * @function\r\n     * @public\r\n     * @param {URL} host - The service endpoint to connect to. Format is \"protocol://host:port\" where \":port\" is optional.\r\n     * @param {string} subscriptionKey - The subscription key. If a subscription key is not specified, an authorization token must be set.\r\n     * @returns {SpeechConfig} A speech factory instance.\r\n     */\r\n    public static fromHost(hostName: URL, subscriptionKey?: string): SpeechConfig {\r\n        Contracts.throwIfNull(hostName, \"hostName\");\r\n\r\n        const speechImpl: SpeechConfigImpl = new SpeechConfigImpl();\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_Host, hostName.protocol + \"//\" + hostName.hostname + (hostName.port === \"\" ? \"\" : \":\" + hostName.port));\r\n\r\n        if (undefined !== subscriptionKey) {\r\n            speechImpl.setProperty(PropertyId.SpeechServiceConnection_Key, subscriptionKey);\r\n        }\r\n        return speechImpl;\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of the speech factory with specified initial authorization token and region.\r\n     * Note: The caller needs to ensure that the authorization token is valid. Before the authorization token\r\n     *       expires, the caller needs to refresh it by calling this setter with a new valid token.\r\n     * Note: Please use a token derived from your LanguageUnderstanding subscription key in case you want\r\n     *       to use the Intent recognizer. As configuration values are copied when creating a new recognizer,\r\n     *       the new token value will not apply to recognizers that have already been created. For recognizers\r\n     *       that have been created before, you need to set authorization token of the corresponding recognizer\r\n     *       to refresh the token. Otherwise, the recognizers will encounter errors during recognition.\r\n     * @member SpeechConfig.fromAuthorizationToken\r\n     * @function\r\n     * @public\r\n     * @param {string} authorizationToken - The initial authorization token.\r\n     * @param {string} region - The region name (see the <a href=\"https://aka.ms/csspeech/region\">region page</a>).\r\n     * @returns {SpeechConfig} A speech factory instance.\r\n     */\r\n    public static fromAuthorizationToken(authorizationToken: string, region: string): SpeechConfig {\r\n        Contracts.throwIfNull(authorizationToken, \"authorizationToken\");\r\n        Contracts.throwIfNullOrWhitespace(region, \"region\");\r\n\r\n        const speechImpl: SpeechConfigImpl = new SpeechConfigImpl();\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_Region, region);\r\n        speechImpl.setProperty(PropertyId.SpeechServiceConnection_IntentRegion, region);\r\n        speechImpl.authorizationToken = authorizationToken;\r\n        return speechImpl;\r\n    }\r\n\r\n    /**\r\n     * Sets the proxy configuration.\r\n     * Only relevant in Node.js environments.\r\n     * Added in version 1.4.0.\r\n     * @param proxyHostName The host name of the proxy server.\r\n     * @param proxyPort The port number of the proxy server.\r\n     */\r\n    public abstract setProxy(proxyHostName: string, proxyPort: number): void;\r\n\r\n    /**\r\n     * Sets the proxy configuration.\r\n     * Only relevant in Node.js environments.\r\n     * Added in version 1.4.0.\r\n     * @param proxyHostName The host name of the proxy server, without the protocol scheme (http://)\r\n     * @param proxyPort The port number of the proxy server.\r\n     * @param proxyUserName The user name of the proxy server.\r\n     * @param proxyPassword The password of the proxy server.\r\n     */\r\n    public abstract setProxy(proxyHostName: string, proxyPort: number, proxyUserName: string, proxyPassword: string): void;\r\n\r\n    /**\r\n     * Gets the authorization token.\r\n     * @member SpeechConfig.prototype.authorizationToken\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract get authorizationToken(): string;\r\n\r\n    /**\r\n     * Gets/Sets the authorization token.\r\n     * Note: The caller needs to ensure that the authorization token is valid. Before the authorization token\r\n     * expires, the caller needs to refresh it by calling this setter with a new valid token.\r\n     * @member SpeechConfig.prototype.authorizationToken\r\n     * @function\r\n     * @public\r\n     * @param {string} value - The authorization token.\r\n     */\r\n    public abstract set authorizationToken(value: string);\r\n\r\n    /**\r\n     * Returns the configured language.\r\n     * @member SpeechConfig.prototype.speechRecognitionLanguage\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract get speechRecognitionLanguage(): string;\r\n\r\n    /**\r\n     * Gets/Sets the input language.\r\n     * @member SpeechConfig.prototype.speechRecognitionLanguage\r\n     * @function\r\n     * @public\r\n     * @param {string} value - The authorization token.\r\n     */\r\n    public abstract set speechRecognitionLanguage(value: string);\r\n\r\n    /**\r\n     * Sets an arbitrary property.\r\n     * @member SpeechConfig.prototype.setProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} name - The name of the property to set.\r\n     * @param {string} value - The new value of the property.\r\n     */\r\n    public abstract setProperty(name: string, value: string): void;\r\n\r\n    /**\r\n     * Returns the current value of an arbitrary property.\r\n     * @member SpeechConfig.prototype.getProperty\r\n     * @function\r\n     * @public\r\n     * @param {string} name - The name of the property to query.\r\n     * @param {string} def - The value to return in case the property is not known.\r\n     * @returns {string} The current value, or provided default, of the given property.\r\n     */\r\n    public abstract getProperty(name: string, def?: string): string;\r\n\r\n    /**\r\n     * Gets speech recognition output format (simple or detailed).\r\n     * Note: This output format is for speech recognition result, use [SpeechConfig.speechSynthesisOutputFormat] to\r\n     * get synthesized audio output format.\r\n     * @member SpeechConfig.prototype.outputFormat\r\n     * @function\r\n     * @public\r\n     * @returns {OutputFormat} Returns the output format.\r\n     */\r\n    public abstract get outputFormat(): OutputFormat;\r\n\r\n    /**\r\n     * Gets/Sets speech recognition output format (simple or detailed).\r\n     * Note: This output format is for speech recognition result, use [SpeechConfig.speechSynthesisOutputFormat] to\r\n     * set synthesized audio output format.\r\n     * @member SpeechConfig.prototype.outputFormat\r\n     * @function\r\n     * @public\r\n     */\r\n    public abstract set outputFormat(format: OutputFormat);\r\n\r\n    /**\r\n     * Gets the endpoint ID of a customized speech model that is used for speech recognition.\r\n     * @member SpeechConfig.prototype.endpointId\r\n     * @function\r\n     * @public\r\n     * @return {string} The endpoint ID\r\n     */\r\n    public abstract get endpointId(): string;\r\n\r\n    /**\r\n     * Gets/Sets the endpoint ID of a customized speech model that is used for speech recognition.\r\n     * @member SpeechConfig.prototype.endpointId\r\n     * @function\r\n     * @public\r\n     * @param {string} value - The endpoint ID\r\n     */\r\n    public abstract set endpointId(value: string);\r\n\r\n    /**\r\n     * Closes the configuration.\r\n     * @member SpeechConfig.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    /* tslint:disable:no-empty */\r\n    public close(): void { }\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.subscriptionKey\r\n     * @function\r\n     * @public\r\n     * @return {string} The subscription key set on the config.\r\n     */\r\n    public abstract get subscriptionKey(): string;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.region\r\n     * @function\r\n     * @public\r\n     * @return {region} The region set on the config.\r\n     */\r\n    public abstract get region(): string;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.setServiceProperty\r\n     * @function\r\n     * @public\r\n     * @param {name} The name of the property.\r\n     * @param {value} Value to set.\r\n     * @param {channel} The channel used to pass the specified property to service.\r\n     * @summary Sets a property value that will be passed to service using the specified channel.\r\n     * Added in version 1.7.0.\r\n     */\r\n    public abstract setServiceProperty(name: string, value: string, channel: ServicePropertyChannel): void;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.setProfanity\r\n     * @function\r\n     * @public\r\n     * @param {profanity} Profanity option to set.\r\n     * @summary Sets profanity option.\r\n     * Added in version 1.7.0.\r\n     */\r\n    public abstract setProfanity(profanity: ProfanityOption): void;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.enableAudioLogging\r\n     * @function\r\n     * @public\r\n     * @summary Enable audio logging in service.\r\n     * Added in version 1.7.0.\r\n     */\r\n    public abstract enableAudioLogging(): void;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.requestWordLevelTimestamps\r\n     * @function\r\n     * @public\r\n     * @summary Includes word-level timestamps.\r\n     * Added in version 1.7.0.\r\n     */\r\n    public abstract requestWordLevelTimestamps(): void;\r\n\r\n    /**\r\n     * @member SpeechConfig.prototype.enableDictation\r\n     * @function\r\n     * @public\r\n     * @summary Enable dictation. Only supported in speech continuous recognition.\r\n     * Added in version 1.7.0.\r\n     */\r\n    public abstract enableDictation(): void;\r\n\r\n    /**\r\n     * Gets the language of the speech synthesizer.\r\n     * @member SpeechConfig.prototype.speechSynthesisLanguage\r\n     * @function\r\n     * @public\r\n     * @returns {string} Returns the speech synthesis language.\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract get speechSynthesisLanguage(): string;\r\n\r\n    /**\r\n     * Sets the language of the speech synthesizer.\r\n     * @member SpeechConfig.prototype.speechSynthesisLanguage\r\n     * @function\r\n     * @public\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract set speechSynthesisLanguage(language: string);\r\n\r\n    /**\r\n     * Gets the voice of the speech synthesizer.\r\n     * @member SpeechConfig.prototype.speechSynthesisVoiceName\r\n     * @function\r\n     * @public\r\n     * @returns {string} Returns the speech synthesis voice.\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract get speechSynthesisVoiceName(): string;\r\n\r\n    /**\r\n     * Sets the voice of the speech synthesizer. (see <a href=\"https://aka.ms/speech/tts-languages\">available voices</a>).\r\n     * @member SpeechConfig.prototype.speechSynthesisVoiceName\r\n     * @function\r\n     * @public\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract set speechSynthesisVoiceName(voice: string);\r\n\r\n    /**\r\n     * Gets the speech synthesis output format.\r\n     * @member SpeechConfig.prototype.speechSynthesisOutputFormat\r\n     * @function\r\n     * @public\r\n     * @returns {SpeechSynthesisOutputFormat} Returns the speech synthesis output format\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract get speechSynthesisOutputFormat(): SpeechSynthesisOutputFormat;\r\n\r\n    /**\r\n     * Sets the speech synthesis output format (e.g. Riff16Khz16BitMonoPcm).\r\n     * @member SpeechConfig.prototype.speechSynthesisOutputFormat\r\n     * @function\r\n     * @public\r\n     * The default format is Audio16Khz64KBitRateMonoMp3 for browser and Riff16Khz16BitMonoPcm for Node.JS\r\n     * Added in version 1.11.0.\r\n     */\r\n    public abstract set speechSynthesisOutputFormat(format: SpeechSynthesisOutputFormat);\r\n}\r\n\r\n/**\r\n * @public\r\n * @class SpeechConfigImpl\r\n */\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class SpeechConfigImpl extends SpeechConfig {\r\n\r\n    private privProperties: PropertyCollection;\r\n\r\n    public constructor() {\r\n        super();\r\n        this.privProperties = new PropertyCollection();\r\n        this.speechRecognitionLanguage = \"en-US\"; // Should we have a default?\r\n        this.outputFormat = OutputFormat.Simple;\r\n    }\r\n\r\n    public get properties(): PropertyCollection {\r\n        return this.privProperties;\r\n    }\r\n\r\n    public get endPoint(): URL {\r\n        return new URL(this.privProperties.getProperty(PropertyId.SpeechServiceConnection_Endpoint));\r\n    }\r\n\r\n    public get subscriptionKey(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_Key);\r\n    }\r\n\r\n    public get region(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_Region);\r\n    }\r\n\r\n    public get authorizationToken(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceAuthorization_Token);\r\n    }\r\n\r\n    public set authorizationToken(value: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceAuthorization_Token, value);\r\n    }\r\n\r\n    public get speechRecognitionLanguage(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_RecoLanguage);\r\n    }\r\n\r\n    public set speechRecognitionLanguage(value: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_RecoLanguage, value);\r\n    }\r\n\r\n    public get autoDetectSourceLanguages(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages);\r\n    }\r\n\r\n    public set autoDetectSourceLanguages(value: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages, value);\r\n    }\r\n\r\n    public get outputFormat(): OutputFormat {\r\n        return (OutputFormat as any)[this.privProperties.getProperty(OutputFormatPropertyName, undefined)];\r\n    }\r\n\r\n    public set outputFormat(value: OutputFormat) {\r\n        this.privProperties.setProperty(OutputFormatPropertyName, OutputFormat[value]);\r\n    }\r\n\r\n    public get endpointId(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_EndpointId);\r\n    }\r\n\r\n    public set endpointId(value: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_EndpointId, value);\r\n    }\r\n\r\n    public setProperty(name: string | PropertyId, value: string): void {\r\n        Contracts.throwIfNull(value, \"value\");\r\n\r\n        this.privProperties.setProperty(name, value);\r\n    }\r\n\r\n    public getProperty(name: string | PropertyId, def?: string): string {\r\n\r\n        return this.privProperties.getProperty(name, def);\r\n    }\r\n\r\n    public setProxy(proxyHostName: string, proxyPort: number): void;\r\n    public setProxy(proxyHostName: string, proxyPort: number, proxyUserName: string, proxyPassword: string): void;\r\n    public setProxy(proxyHostName: any, proxyPort: any, proxyUserName?: any, proxyPassword?: any): void {\r\n        this.setProperty(PropertyId[PropertyId.SpeechServiceConnection_ProxyHostName], proxyHostName);\r\n        this.setProperty(PropertyId[PropertyId.SpeechServiceConnection_ProxyPort], proxyPort);\r\n        this.setProperty(PropertyId[PropertyId.SpeechServiceConnection_ProxyUserName], proxyUserName);\r\n        this.setProperty(PropertyId[PropertyId.SpeechServiceConnection_ProxyPassword], proxyPassword);\r\n    }\r\n\r\n    public setServiceProperty(name: string, value: string, channel: ServicePropertyChannel): void {\r\n        const currentProperties: IStringDictionary<string> = JSON.parse(this.privProperties.getProperty(ServicePropertiesPropertyName, \"{}\"));\r\n\r\n        currentProperties[name] = value;\r\n\r\n        this.privProperties.setProperty(ServicePropertiesPropertyName, JSON.stringify(currentProperties));\r\n    }\r\n\r\n    public setProfanity(profanity: ProfanityOption): void {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceResponse_ProfanityOption, ProfanityOption[profanity]);\r\n    }\r\n\r\n    public enableAudioLogging(): void {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_EnableAudioLogging, \"true\");\r\n    }\r\n    public requestWordLevelTimestamps(): void {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps, \"true\");\r\n    }\r\n    public enableDictation(): void {\r\n        this.privProperties.setProperty(ForceDictationPropertyName, \"true\");\r\n    }\r\n\r\n    public clone(): SpeechConfigImpl {\r\n        const ret: SpeechConfigImpl = new SpeechConfigImpl();\r\n        ret.privProperties = this.privProperties.clone();\r\n        return ret;\r\n    }\r\n\r\n    public get speechSynthesisLanguage(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_SynthLanguage);\r\n    }\r\n\r\n    public set speechSynthesisLanguage(language: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_SynthLanguage, language);\r\n    }\r\n\r\n    public get speechSynthesisVoiceName(): string {\r\n        return this.privProperties.getProperty(PropertyId.SpeechServiceConnection_SynthVoice);\r\n    }\r\n\r\n    public set speechSynthesisVoiceName(voice: string) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_SynthVoice, voice);\r\n    }\r\n\r\n    public get speechSynthesisOutputFormat(): SpeechSynthesisOutputFormat {\r\n        return (SpeechSynthesisOutputFormat as any)[this.privProperties.getProperty(PropertyId.SpeechServiceConnection_SynthOutputFormat, undefined)];\r\n    }\r\n\r\n    public set speechSynthesisOutputFormat(format: SpeechSynthesisOutputFormat) {\r\n        this.privProperties.setProperty(PropertyId.SpeechServiceConnection_SynthOutputFormat, SpeechSynthesisOutputFormat[format]);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    IAuthentication,\r\n    IConnectionFactory,\r\n    OutputFormatPropertyName,\r\n    RecognitionMode,\r\n    RecognizerConfig,\r\n    ServiceRecognizerBase,\r\n    SpeechConnectionFactory,\r\n    SpeechServiceConfig,\r\n    SpeechServiceRecognizer,\r\n} from \"../common.speech/Exports\";\r\nimport { marshalPromiseToCallbacks } from \"../common/Exports\";\r\nimport { AudioConfigImpl } from \"./Audio/AudioConfig\";\r\nimport { Contracts } from \"./Contracts\";\r\nimport {\r\n    AudioConfig,\r\n    AutoDetectSourceLanguageConfig,\r\n    KeywordRecognitionModel,\r\n    OutputFormat,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    Recognizer,\r\n    SpeechRecognitionCanceledEventArgs,\r\n    SpeechRecognitionEventArgs,\r\n    SpeechRecognitionResult,\r\n} from \"./Exports\";\r\nimport { SpeechConfig, SpeechConfigImpl } from \"./SpeechConfig\";\r\n\r\n/**\r\n * Performs speech recognition from microphone, file, or other audio input streams, and gets transcribed text as result.\r\n * @class SpeechRecognizer\r\n */\r\nexport class SpeechRecognizer extends Recognizer {\r\n    private privDisposedRecognizer: boolean;\r\n\r\n    /**\r\n     * SpeechRecognizer constructor.\r\n     * @constructor\r\n     * @param {SpeechConfig} speechConfig - an set of initial properties for this recognizer\r\n     * @param {AudioConfig} audioConfig - An optional audio configuration associated with the recognizer\r\n     */\r\n    public constructor(speechConfig: SpeechConfig, audioConfig?: AudioConfig) {\r\n        const speechConfigImpl: SpeechConfigImpl = speechConfig as SpeechConfigImpl;\r\n        Contracts.throwIfNull(speechConfigImpl, \"speechConfig\");\r\n\r\n        Contracts.throwIfNullOrWhitespace(\r\n            speechConfigImpl.properties.getProperty(PropertyId.SpeechServiceConnection_RecoLanguage),\r\n            PropertyId[PropertyId.SpeechServiceConnection_RecoLanguage]);\r\n\r\n        super(audioConfig, speechConfigImpl.properties, new SpeechConnectionFactory());\r\n        this.privDisposedRecognizer = false;\r\n    }\r\n\r\n    /**\r\n     * SpeechRecognizer constructor.\r\n     * @constructor\r\n     * @param {SpeechConfig} speechConfig - an set of initial properties for this recognizer\r\n     * @param {AutoDetectSourceLanguageConfig} autoDetectSourceLanguageConfig - An source language detection configuration associated with the recognizer\r\n     * @param {AudioConfig} audioConfig - An optional audio configuration associated with the recognizer\r\n     */\r\n    public static FromConfig(speechConfig: SpeechConfig, autoDetectSourceLanguageConfig: AutoDetectSourceLanguageConfig, audioConfig?: AudioConfig): SpeechRecognizer {\r\n        const speechConfigImpl: SpeechConfigImpl = speechConfig as SpeechConfigImpl;\r\n        autoDetectSourceLanguageConfig.properties.mergeTo(speechConfigImpl.properties);\r\n        const recognizer = new SpeechRecognizer(speechConfig, audioConfig);\r\n        return recognizer;\r\n    }\r\n\r\n    /**\r\n     * The event recognizing signals that an intermediate recognition result is received.\r\n     * @member SpeechRecognizer.prototype.recognizing\r\n     * @function\r\n     * @public\r\n     */\r\n    public recognizing: (sender: Recognizer, event: SpeechRecognitionEventArgs) => void;\r\n\r\n    /**\r\n     * The event recognized signals that a final recognition result is received.\r\n     * @member SpeechRecognizer.prototype.recognized\r\n     * @function\r\n     * @public\r\n     */\r\n    public recognized: (sender: Recognizer, event: SpeechRecognitionEventArgs) => void;\r\n\r\n    /**\r\n     * The event canceled signals that an error occurred during recognition.\r\n     * @member SpeechRecognizer.prototype.canceled\r\n     * @function\r\n     * @public\r\n     */\r\n    public canceled: (sender: Recognizer, event: SpeechRecognitionCanceledEventArgs) => void;\r\n\r\n    /**\r\n     * Gets the endpoint id of a customized speech model that is used for speech recognition.\r\n     * @member SpeechRecognizer.prototype.endpointId\r\n     * @function\r\n     * @public\r\n     * @returns {string} the endpoint id of a customized speech model that is used for speech recognition.\r\n     */\r\n    public get endpointId(): string {\r\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\r\n\r\n        return this.properties.getProperty(PropertyId.SpeechServiceConnection_EndpointId, \"00000000-0000-0000-0000-000000000000\");\r\n    }\r\n\r\n    /**\r\n     * Gets the authorization token used to communicate with the service.\r\n     * @member SpeechRecognizer.prototype.authorizationToken\r\n     * @function\r\n     * @public\r\n     * @returns {string} Authorization token.\r\n     */\r\n    public get authorizationToken(): string {\r\n        return this.properties.getProperty(PropertyId.SpeechServiceAuthorization_Token);\r\n    }\r\n\r\n    /**\r\n     * Gets/Sets the authorization token used to communicate with the service.\r\n     * @member SpeechRecognizer.prototype.authorizationToken\r\n     * @function\r\n     * @public\r\n     * @param {string} token - Authorization token.\r\n     */\r\n    public set authorizationToken(token: string) {\r\n        Contracts.throwIfNullOrWhitespace(token, \"token\");\r\n        this.properties.setProperty(PropertyId.SpeechServiceAuthorization_Token, token);\r\n    }\r\n\r\n    /**\r\n     * Gets the spoken language of recognition.\r\n     * @member SpeechRecognizer.prototype.speechRecognitionLanguage\r\n     * @function\r\n     * @public\r\n     * @returns {string} The spoken language of recognition.\r\n     */\r\n    public get speechRecognitionLanguage(): string {\r\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\r\n\r\n        return this.properties.getProperty(PropertyId.SpeechServiceConnection_RecoLanguage);\r\n    }\r\n\r\n    /**\r\n     * Gets the output format of recognition.\r\n     * @member SpeechRecognizer.prototype.outputFormat\r\n     * @function\r\n     * @public\r\n     * @returns {OutputFormat} The output format of recognition.\r\n     */\r\n    public get outputFormat(): OutputFormat {\r\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\r\n\r\n        if (this.properties.getProperty(OutputFormatPropertyName, OutputFormat[OutputFormat.Simple]) === OutputFormat[OutputFormat.Simple]) {\r\n            return OutputFormat.Simple;\r\n        } else {\r\n            return OutputFormat.Detailed;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The collection of properties and their values defined for this SpeechRecognizer.\r\n     * @member SpeechRecognizer.prototype.properties\r\n     * @function\r\n     * @public\r\n     * @returns {PropertyCollection} The collection of properties and their values defined for this SpeechRecognizer.\r\n     */\r\n    public get properties(): PropertyCollection {\r\n        return this.privProperties;\r\n    }\r\n\r\n    /**\r\n     * Starts speech recognition, and stops after the first utterance is recognized.\r\n     * The task returns the recognition text as result.\r\n     * Note: RecognizeOnceAsync() returns when the first utterance has been recognized,\r\n     *       so it is suitable only for single shot recognition\r\n     *       like command or query. For long-running recognition, use StartContinuousRecognitionAsync() instead.\r\n     * @member SpeechRecognizer.prototype.recognizeOnceAsync\r\n     * @function\r\n     * @public\r\n     * @param cb - Callback that received the SpeechRecognitionResult.\r\n     * @param err - Callback invoked in case of an error.\r\n     */\r\n    public recognizeOnceAsync(cb?: (e: SpeechRecognitionResult) => void, err?: (e: string) => void): void {\r\n        marshalPromiseToCallbacks(this.recognizeOnceAsyncImpl(RecognitionMode.Interactive), cb, err);\r\n    }\r\n\r\n    /**\r\n     * Starts speech recognition, until stopContinuousRecognitionAsync() is called.\r\n     * User must subscribe to events to receive recognition results.\r\n     * @member SpeechRecognizer.prototype.startContinuousRecognitionAsync\r\n     * @function\r\n     * @public\r\n     * @param cb - Callback invoked once the recognition has started.\r\n     * @param err - Callback invoked in case of an error.\r\n     */\r\n    public startContinuousRecognitionAsync(cb?: () => void, err?: (e: string) => void): void {\r\n        marshalPromiseToCallbacks(this.startContinuousRecognitionAsyncImpl(RecognitionMode.Conversation), cb, err);\r\n    }\r\n\r\n    /**\r\n     * Stops continuous speech recognition.\r\n     * @member SpeechRecognizer.prototype.stopContinuousRecognitionAsync\r\n     * @function\r\n     * @public\r\n     * @param cb - Callback invoked once the recognition has stopped.\r\n     * @param err - Callback invoked in case of an error.\r\n     */\r\n    public stopContinuousRecognitionAsync(cb?: () => void, err?: (e: string) => void): void {\r\n        marshalPromiseToCallbacks(this.stopContinuousRecognitionAsyncImpl(), cb, err);\r\n    }\r\n\r\n    /**\r\n     * Starts speech recognition with keyword spotting, until\r\n     * stopKeywordRecognitionAsync() is called.\r\n     * User must subscribe to events to receive recognition results.\r\n     * Note: Key word spotting functionality is only available on the\r\n     *      Speech Devices SDK. This functionality is currently not included in the SDK itself.\r\n     * @member SpeechRecognizer.prototype.startKeywordRecognitionAsync\r\n     * @function\r\n     * @public\r\n     * @param {KeywordRecognitionModel} model The keyword recognition model that\r\n     *        specifies the keyword to be recognized.\r\n     * @param cb - Callback invoked once the recognition has started.\r\n     * @param err - Callback invoked in case of an error.\r\n     */\r\n    public startKeywordRecognitionAsync(model: KeywordRecognitionModel, cb?: () => void, err?: (e: string) => void): void {\r\n        Contracts.throwIfNull(model, \"model\");\r\n\r\n        if (!!err) {\r\n            err(\"Not yet implemented.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stops continuous speech recognition.\r\n     * Note: Key word spotting functionality is only available on the\r\n     *       Speech Devices SDK. This functionality is currently not included in the SDK itself.\r\n     * @member SpeechRecognizer.prototype.stopKeywordRecognitionAsync\r\n     * @function\r\n     * @public\r\n     * @param cb - Callback invoked once the recognition has stopped.\r\n     * @param err - Callback invoked in case of an error.\r\n     */\r\n    public stopKeywordRecognitionAsync(cb?: () => void, err?: (e: string) => void): void {\r\n        if (!!cb) {\r\n            cb();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * closes all external resources held by an instance of this class.\r\n     * @member SpeechRecognizer.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(cb?: () => void, errorCb?: (error: string) => void): void {\r\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\r\n        marshalPromiseToCallbacks(this.dispose(true), cb, errorCb);\r\n    }\r\n\r\n    /**\r\n     * Disposes any resources held by the object.\r\n     * @member SpeechRecognizer.prototype.dispose\r\n     * @function\r\n     * @public\r\n     * @param {boolean} disposing - true if disposing the object.\r\n     */\r\n    protected async dispose(disposing: boolean): Promise<void> {\r\n        if (this.privDisposedRecognizer) {\r\n            return;\r\n        }\r\n\r\n        if (disposing) {\r\n            this.privDisposedRecognizer = true;\r\n            await this.implRecognizerStop();\r\n        }\r\n\r\n        await super.dispose(disposing);\r\n    }\r\n\r\n    protected createRecognizerConfig(speechConfig: SpeechServiceConfig): RecognizerConfig {\r\n        return new RecognizerConfig(\r\n            speechConfig,\r\n            this.properties);\r\n    }\r\n\r\n    protected createServiceRecognizer(\r\n        authentication: IAuthentication,\r\n        connectionFactory: IConnectionFactory,\r\n        audioConfig: AudioConfig,\r\n        recognizerConfig: RecognizerConfig): ServiceRecognizerBase {\r\n        const configImpl: AudioConfigImpl = audioConfig as AudioConfigImpl;\r\n        return new SpeechServiceRecognizer(authentication, connectionFactory, configImpl, recognizerConfig, this);\r\n    }\r\n}\r\n","// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    CognitiveSubscriptionKeyAuthentication,\r\n    CognitiveTokenAuthentication,\r\n    Context,\r\n    IAuthentication,\r\n    IConnectionFactory,\r\n    OS,\r\n    RecognitionMode,\r\n    RecognizerConfig,\r\n    ServiceRecognizerBase,\r\n    SpeechServiceConfig,\r\n} from \"../common.speech/Exports\";\r\nimport {\r\n    Deferred,\r\n    marshalPromiseToCallbacks\r\n} from \"../common/Exports\";\r\nimport {\r\n    Contracts\r\n} from \"./Contracts\";\r\nimport {\r\n    AudioConfig,\r\n    Connection,\r\n    PropertyCollection,\r\n    PropertyId,\r\n    RecognitionEventArgs,\r\n    SessionEventArgs,\r\n    SpeechRecognitionResult,\r\n} from \"./Exports\";\r\n\r\n/**\r\n * Defines the base class Recognizer which mainly contains common event handlers.\r\n * @class Recognizer\r\n */\r\nexport abstract class Recognizer {\r\n    private privDisposed: boolean;\r\n    protected audioConfig: AudioConfig;\r\n    protected privReco: ServiceRecognizerBase;\r\n    protected privProperties: PropertyCollection;\r\n    private privConnectionFactory: IConnectionFactory;\r\n\r\n    /**\r\n     * Creates and initializes an instance of a Recognizer\r\n     * @constructor\r\n     * @param {AudioConfig} audioInput - An optional audio input stream associated with the recognizer\r\n     */\r\n    protected constructor(audioConfig: AudioConfig, properties: PropertyCollection, connectionFactory: IConnectionFactory) {\r\n        this.audioConfig = (audioConfig !== undefined) ? audioConfig : AudioConfig.fromDefaultMicrophoneInput();\r\n        this.privDisposed = false;\r\n        this.privProperties = properties.clone();\r\n        this.privConnectionFactory = connectionFactory;\r\n        this.implCommonRecognizerSetup();\r\n    }\r\n\r\n    /**\r\n     * Defines event handler for session started events.\r\n     * @member Recognizer.prototype.sessionStarted\r\n     * @function\r\n     * @public\r\n     */\r\n    public sessionStarted: (sender: Recognizer, event: SessionEventArgs) => void;\r\n\r\n    /**\r\n     * Defines event handler for session stopped events.\r\n     * @member Recognizer.prototype.sessionStopped\r\n     * @function\r\n     * @public\r\n     */\r\n    public sessionStopped: (sender: Recognizer, event: SessionEventArgs) => void;\r\n\r\n    /**\r\n     * Defines event handler for speech started events.\r\n     * @member Recognizer.prototype.speechStartDetected\r\n     * @function\r\n     * @public\r\n     */\r\n    public speechStartDetected: (sender: Recognizer, event: RecognitionEventArgs) => void;\r\n\r\n    /**\r\n     * Defines event handler for speech stopped events.\r\n     * @member Recognizer.prototype.speechEndDetected\r\n     * @function\r\n     * @public\r\n     */\r\n    public speechEndDetected: (sender: Recognizer, event: RecognitionEventArgs) => void;\r\n\r\n    /**\r\n     * Dispose of associated resources.\r\n     * @member Recognizer.prototype.close\r\n     * @function\r\n     * @public\r\n     */\r\n    public close(cb?: () => void, errorCb?: (error: string) => void): void {\r\n        Contracts.throwIfDisposed(this.privDisposed);\r\n        marshalPromiseToCallbacks(this.dispose(true), cb, errorCb);\r\n    }\r\n\r\n    /**\r\n     * @Internal\r\n     * Internal data member to support fromRecognizer* pattern methods on other classes.\r\n     * Do not use externally, object returned will change without warning or notice.\r\n     */\r\n    public get internalData(): object {\r\n        return this.privReco;\r\n    }\r\n\r\n    /**\r\n     * This method performs cleanup of resources.\r\n     * The Boolean parameter disposing indicates whether the method is called\r\n     * from Dispose (if disposing is true) or from the finalizer (if disposing is false).\r\n     * Derived classes should override this method to dispose resource if needed.\r\n     * @member Recognizer.prototype.dispose\r\n     * @function\r\n     * @public\r\n     * @param {boolean} disposing - Flag to request disposal.\r\n     */\r\n    protected async dispose(disposing: boolean): Promise<void> {\r\n        if (this.privDisposed) {\r\n            return;\r\n        }\r\n\r\n        this.privDisposed = true;\r\n\r\n        if (disposing) {\r\n            if (this.privReco) {\r\n                await this.privReco.audioSource.turnOff();\r\n                await this.privReco.dispose();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This method returns the current state of the telemetry setting.\r\n     * @member Recognizer.prototype.telemetryEnabled\r\n     * @function\r\n     * @public\r\n     * @returns true if the telemetry is enabled, false otherwise.\r\n     */\r\n    public static get telemetryEnabled(): boolean {\r\n        return ServiceRecognizerBase.telemetryDataEnabled;\r\n    }\r\n\r\n    /**\r\n     * This method globally enables or disables telemetry.\r\n     * @member Recognizer.prototype.enableTelemetry\r\n     * @function\r\n     * @public\r\n     * @param enabled - Global setting for telemetry collection.\r\n     * If set to true, telemetry information like microphone errors,\r\n     * recognition errors are collected and sent to Microsoft.\r\n     * If set to false, no telemetry is sent to Microsoft.\r\n     */\r\n    /* tslint:disable:member-ordering */\r\n    public static enableTelemetry(enabled: boolean): void {\r\n        ServiceRecognizerBase.telemetryDataEnabled = enabled;\r\n    }\r\n\r\n    //\r\n    // ################################################################################################################\r\n    // IMPLEMENTATION.\r\n    // Move to independent class\r\n    // ################################################################################################################\r\n    //\r\n    protected abstract createRecognizerConfig(speechConfig: SpeechServiceConfig): RecognizerConfig;\r\n\r\n    // Creates the correct service recognizer for the type\r\n    protected abstract createServiceRecognizer(\r\n        authentication: IAuthentication,\r\n        connectionFactory: IConnectionFactory,\r\n        audioConfig: AudioConfig,\r\n        recognizerConfig: RecognizerConfig): ServiceRecognizerBase;\r\n\r\n    // Does the generic recognizer setup that is common across all recognizer types.\r\n    protected implCommonRecognizerSetup(): void {\r\n\r\n        let osPlatform = (typeof window !== \"undefined\") ? \"Browser\" : \"Node\";\r\n        let osName = \"unknown\";\r\n        let osVersion = \"unknown\";\r\n\r\n        if (typeof navigator !== \"undefined\") {\r\n            osPlatform = osPlatform + \"/\" + navigator.platform;\r\n            osName = navigator.userAgent;\r\n            osVersion = navigator.appVersion;\r\n        }\r\n\r\n        const recognizerConfig = this.createRecognizerConfig(\r\n            new SpeechServiceConfig(\r\n                new Context(new OS(osPlatform, osName, osVersion))));\r\n\r\n        this.privReco = this.createServiceRecognizer(\r\n            Recognizer.getAuthFromProperties(this.privProperties),\r\n            this.privConnectionFactory,\r\n            this.audioConfig,\r\n            recognizerConfig);\r\n    }\r\n\r\n    protected async recognizeOnceAsyncImpl(recognitionMode: RecognitionMode): Promise<SpeechRecognitionResult> {\r\n        Contracts.throwIfDisposed(this.privDisposed);\r\n        const ret: Deferred<SpeechRecognitionResult> = new Deferred<SpeechRecognitionResult>();\r\n\r\n        await this.implRecognizerStop();\r\n        await this.privReco.recognize(recognitionMode, ret.resolve, ret.reject);\r\n        const result: SpeechRecognitionResult = await ret.promise;\r\n        await this.implRecognizerStop();\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n    protected async startContinuousRecognitionAsyncImpl(recognitionMode: RecognitionMode): Promise<void> {\r\n        Contracts.throwIfDisposed(this.privDisposed);\r\n\r\n        await this.implRecognizerStop();\r\n        await this.privReco.recognize(recognitionMode, undefined, undefined);\r\n    }\r\n\r\n    protected async stopContinuousRecognitionAsyncImpl(): Promise<void> {\r\n        Contracts.throwIfDisposed(this.privDisposed);\r\n        await this.implRecognizerStop();\r\n    }\r\n\r\n    protected async implRecognizerStop(): Promise<void> {\r\n        if (this.privReco) {\r\n            await this.privReco.stopRecognizing();\r\n        }\r\n        return;\r\n    }\r\n\r\n    protected static getAuthFromProperties(properties: PropertyCollection): IAuthentication {\r\n        const subscriptionKey = properties.getProperty(PropertyId.SpeechServiceConnection_Key, undefined);\r\n        const authentication = (subscriptionKey && subscriptionKey !== \"\") ?\r\n            new CognitiveSubscriptionKeyAuthentication(subscriptionKey) :\r\n            new CognitiveTokenAuthentication(\r\n                (authFetchEventId: string): Promise<string> => {\r\n                    const authorizationToken = properties.getProperty(PropertyId.SpeechServiceAuthorization_Token, undefined);\r\n                    return Promise.resolve(authorizationToken);\r\n                },\r\n                (authFetchEventId: string): Promise<string> => {\r\n                    const authorizationToken = properties.getProperty(PropertyId.SpeechServiceAuthorization_Token, undefined);\r\n                    return Promise.resolve(authorizationToken);\r\n                });\r\n\r\n        return authentication;\r\n    }\r\n}\r\n"],"sourceRoot":""}